let aw;let __tla=(async()=>{const Kf=(n,t)=>n===t,Yf=Symbol("solid-track"),br={equals:Kf};let fi=null,xl=Cl;const Ze=1,wr=2,Ll={owned:null,cleanups:null,context:null,owner:null};var Tt=null;let Mo=null,Jf=null,Ot=null,Wt=null,be=null,jr=0;function dr(n,t){const i=Ot,s=Tt,r=n.length===0,a=t===void 0?s:t,l=r?Ll:{owned:null,cleanups:null,context:a?a.context:null,owner:a},u=r?n:()=>n(()=>$e(()=>yi(l)));Tt=l,Ot=null;try{return Ci(u,!0)}finally{Ot=i,Tt=s}}function mn(n,t){t=t?Object.assign({},br,t):br;const i={value:n,observers:null,observerSlots:null,comparator:t.equals||void 0},s=r=>(typeof r=="function"&&(r=r(i.value)),Tl(i,r));return[kl.bind(i),s]}function fn(n,t,i){const s=Ur(n,t,!1,Ze);Ti(s)}function Sl(n,t,i){xl=n_;const s=Ur(n,t,!1,Ze);s.user=!0,be?be.push(s):Ti(s)}function _i(n,t,i){i=i?Object.assign({},br,i):br;const s=Ur(n,t,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=i.equals||void 0,Ti(s),kl.bind(s)}function $e(n){if(Ot===null)return n();const t=Ot;Ot=null;try{return n()}finally{Ot=t}}function Xf(n){Sl(()=>$e(n))}function El(n){return Tt===null||(Tt.cleanups===null?Tt.cleanups=[n]:Tt.cleanups.push(n)),n}function Qf(n,t){fi||(fi=Symbol("error")),Tt=Ur(void 0,void 0,!0),Tt.context={...Tt.context,[fi]:[t]};try{return n()}catch(i){Fr(i)}finally{Tt=Tt.owner}}function kl(){if(this.sources&&this.state)if(this.state===Ze)Ti(this);else{const n=Wt;Wt=null,Ci(()=>Lr(this),!1),Wt=n}if(Ot){const n=this.observers?this.observers.length:0;Ot.sources?(Ot.sources.push(this),Ot.sourceSlots.push(n)):(Ot.sources=[this],Ot.sourceSlots=[n]),this.observers?(this.observers.push(Ot),this.observerSlots.push(Ot.sources.length-1)):(this.observers=[Ot],this.observerSlots=[Ot.sources.length-1])}return this.value}function Tl(n,t,i){let s=n.value;return(!n.comparator||!n.comparator(s,t))&&(n.value=t,n.observers&&n.observers.length&&Ci(()=>{for(let r=0;r<n.observers.length;r+=1){const a=n.observers[r],l=Mo&&Mo.running;l&&Mo.disposed.has(a),(l?!a.tState:!a.state)&&(a.pure?Wt.push(a):be.push(a),a.observers&&Ml(a)),l||(a.state=Ze)}if(Wt.length>1e6)throw Wt=[],new Error},!1)),t}function Ti(n){if(!n.fn)return;yi(n);const t=jr;t_(n,n.value,t)}function t_(n,t,i){let s;const r=Tt,a=Ot;Ot=Tt=n;try{s=n.fn(t)}catch(l){return n.pure&&(n.state=Ze,n.owned&&n.owned.forEach(yi),n.owned=null),n.updatedAt=i+1,Fr(l)}finally{Ot=a,Tt=r}(!n.updatedAt||n.updatedAt<=i)&&(n.updatedAt!=null&&"observers"in n?Tl(n,s):n.value=s,n.updatedAt=i)}function Ur(n,t,i,s=Ze,r){const a={fn:n,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:Tt,context:Tt?Tt.context:null,pure:i};return Tt===null||Tt!==Ll&&(Tt.owned?Tt.owned.push(a):Tt.owned=[a]),a}function xr(n){if(n.state===0)return;if(n.state===wr)return Lr(n);if(n.suspense&&$e(n.suspense.inFallback))return n.suspense.effects.push(n);const t=[n];for(;(n=n.owner)&&(!n.updatedAt||n.updatedAt<jr);)n.state&&t.push(n);for(let i=t.length-1;i>=0;i--)if(n=t[i],n.state===Ze)Ti(n);else if(n.state===wr){const s=Wt;Wt=null,Ci(()=>Lr(n,t[0]),!1),Wt=s}}function Ci(n,t){if(Wt)return n();let i=!1;t||(Wt=[]),be?i=!0:be=[],jr++;try{const s=n();return e_(i),s}catch(s){i||(be=null),Wt=null,Fr(s)}}function e_(n){if(Wt&&(Cl(Wt),Wt=null),n)return;const t=be;be=null,t.length&&Ci(()=>xl(t),!1)}function Cl(n){for(let t=0;t<n.length;t++)xr(n[t])}function n_(n){let t,i=0;for(t=0;t<n.length;t++){const s=n[t];s.user?n[i++]=s:xr(s)}for(t=0;t<i;t++)xr(n[t])}function Lr(n,t){n.state=0;for(let i=0;i<n.sources.length;i+=1){const s=n.sources[i];if(s.sources){const r=s.state;r===Ze?s!==t&&(!s.updatedAt||s.updatedAt<jr)&&xr(s):r===wr&&Lr(s,t)}}}function Ml(n){for(let t=0;t<n.observers.length;t+=1){const i=n.observers[t];i.state||(i.state=wr,i.pure?Wt.push(i):be.push(i),i.observers&&Ml(i))}}function yi(n){let t;if(n.sources)for(;n.sources.length;){const i=n.sources.pop(),s=n.sourceSlots.pop(),r=i.observers;if(r&&r.length){const a=r.pop(),l=i.observerSlots.pop();s<r.length&&(a.sourceSlots[l]=s,r[s]=a,i.observerSlots[s]=l)}}if(n.tOwned){for(t=n.tOwned.length-1;t>=0;t--)yi(n.tOwned[t]);delete n.tOwned}if(n.owned){for(t=n.owned.length-1;t>=0;t--)yi(n.owned[t]);n.owned=null}if(n.cleanups){for(t=n.cleanups.length-1;t>=0;t--)n.cleanups[t]();n.cleanups=null}n.state=0}function i_(n){return n instanceof Error?n:new Error(typeof n=="string"?n:"Unknown error",{cause:n})}function uc(n,t,i){try{for(const s of t)s(n)}catch(s){Fr(s,i&&i.owner||null)}}function Fr(n,t=Tt){const i=fi&&t&&t.context&&t.context[fi],s=i_(n);if(!i)throw s;be?be.push({fn(){uc(s,i,t)},state:Ze}):uc(s,i,t)}const r_=Symbol("fallback");function dc(n){for(let t=0;t<n.length;t++)n[t]()}function o_(n,t,i={}){let s=[],r=[],a=[],l=0,u=t.length>1?[]:null;return El(()=>dc(a)),()=>{let f=n()||[],_=f.length,g,p;return f[Yf],$e(()=>{let v,b,S,C,V,A,w,F,O;if(_===0)l!==0&&(dc(a),a=[],s=[],r=[],l=0,u&&(u=[])),i.fallback&&(s=[r_],r[0]=dr(K=>(a[0]=K,i.fallback())),l=1);else if(l===0){for(r=new Array(_),p=0;p<_;p++)s[p]=f[p],r[p]=dr(m);l=_}else{for(S=new Array(_),C=new Array(_),u&&(V=new Array(_)),A=0,w=Math.min(l,_);A<w&&s[A]===f[A];A++);for(w=l-1,F=_-1;w>=A&&F>=A&&s[w]===f[F];w--,F--)S[F]=r[w],C[F]=a[w],u&&(V[F]=u[w]);for(v=new Map,b=new Array(F+1),p=F;p>=A;p--)O=f[p],g=v.get(O),b[p]=g===void 0?-1:g,v.set(O,p);for(g=A;g<=w;g++)O=s[g],p=v.get(O),p!==void 0&&p!==-1?(S[p]=r[g],C[p]=a[g],u&&(V[p]=u[g]),p=b[p],v.set(O,p)):a[g]();for(p=A;p<_;p++)p in S?(r[p]=S[p],a[p]=C[p],u&&(u[p]=V[p],u[p](p))):r[p]=dr(m);r=r.slice(0,l=_),s=f.slice(0)}return r});function m(v){if(a[p]=v,u){const[b,S]=mn(p);return u[p]=S,t(f[p],b)}return t(f[p])}}}function se(n,t){return $e(()=>n(t||{}))}const s_=n=>`Stale read from <${n}>.`;function a_(n){const t="fallback"in n&&{fallback:()=>n.fallback};return _i(o_(()=>n.each,n.children,t||void 0))}function rs(n){const t=n.keyed,i=_i(()=>n.when,void 0,void 0),s=t?i:_i(i,void 0,{equals:(r,a)=>!r==!a});return _i(()=>{const r=s();if(r){const a=n.children;return typeof a=="function"&&a.length>0?$e(()=>a(t?r:()=>{if(!$e(s))throw s_("Show");return i()})):a}return n.fallback},void 0,void 0)}let Xi;function c_(n){let t;const[i,s]=mn(t,void 0);return Xi||(Xi=new Set),Xi.add(s),El(()=>Xi.delete(s)),_i(()=>{let r;if(r=i()){const a=n.fallback;return typeof a=="function"&&a.length?$e(()=>a(r,()=>s())):a}return Qf(()=>n.children,s)},void 0,void 0)}function l_(n,t,i){let s=i.length,r=t.length,a=s,l=0,u=0,f=t[r-1].nextSibling,_=null;for(;l<r||u<a;){if(t[l]===i[u]){l++,u++;continue}for(;t[r-1]===i[a-1];)r--,a--;if(r===l){const g=a<s?u?i[u-1].nextSibling:i[a-u]:f;for(;u<a;)n.insertBefore(i[u++],g)}else if(a===u)for(;l<r;)(!_||!_.has(t[l]))&&t[l].remove(),l++;else if(t[l]===i[a-1]&&i[u]===t[r-1]){const g=t[--r].nextSibling;n.insertBefore(i[u++],t[l++].nextSibling),n.insertBefore(i[--a],g),t[r]=i[a]}else{if(!_){_=new Map;let p=u;for(;p<a;)_.set(i[p],p++)}const g=_.get(t[l]);if(g!=null)if(u<g&&g<a){let p=l,m=1,v;for(;++p<r&&p<a&&!((v=_.get(t[p]))==null||v!==g+m);)m++;if(m>g-u){const b=t[l];for(;u<g;)n.insertBefore(i[u++],b)}else n.replaceChild(i[u++],t[l++])}else l++;else t[l++].remove()}}}const fc="_$DX_DELEGATE";function Pl(n,t,i,s={}){let r;return dr(a=>{r=a,t===document?n():Ie(t,n(),t.firstChild?null:void 0,i)},s.owner),()=>{r(),t.textContent=""}}function Ve(n,t,i,s){let r;const a=()=>{const u=document.createElement("template");return u.innerHTML=n,u.content.firstChild},l=()=>(r||(r=a())).cloneNode(!0);return l.cloneNode=l,l}function h_(n,t=window.document){const i=t[fc]||(t[fc]=new Set);for(let s=0,r=n.length;s<r;s++){const a=n[s];i.has(a)||(i.add(a),t.addEventListener(a,__))}}function Il(n,t,i){i==null?n.removeAttribute(t):n.setAttribute(t,i)}function _c(n,t){t==null?n.removeAttribute("class"):n.className=t}function u_(n,t,i,s){Array.isArray(i)?(n[`$$${t}`]=i[0],n[`$$${t}Data`]=i[1]):n[`$$${t}`]=i}function d_(n,t,i){if(!t)return i?Il(n,"style"):t;const s=n.style;if(typeof t=="string")return s.cssText=t;typeof i=="string"&&(s.cssText=i=void 0),i||(i={}),t||(t={});let r,a;for(a in i)t[a]==null&&s.removeProperty(a),delete i[a];for(a in t)r=t[a],r!==i[a]&&(s.setProperty(a,r),i[a]=r);return i}function f_(n,t,i){return $e(()=>n(t,i))}function Ie(n,t,i,s){if(i!==void 0&&!s&&(s=[]),typeof t!="function")return Sr(n,t,s,i);fn(r=>Sr(n,t(),r,i),s)}function __(n){let t=n.target;const i=`$$${n.type}`,s=n.target,r=n.currentTarget,a=f=>Object.defineProperty(n,"target",{configurable:!0,value:f}),l=()=>{const f=t[i];if(f&&!t.disabled){const _=t[`${i}Data`];if(_!==void 0?f.call(t,_,n):f.call(t,n),n.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(n.target)&&a(t.host),!0},u=()=>{for(;l()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(n,"currentTarget",{configurable:!0,get(){return t||document}}),n.composedPath){const f=n.composedPath();a(f[0]);for(let _=0;_<f.length-2&&(t=f[_],!!l());_++){if(t._$host){t=t._$host,u();break}if(t.parentNode===r)break}}else u();a(s)}function Sr(n,t,i,s,r){for(;typeof i=="function";)i=i();if(t===i)return i;const a=typeof t,l=s!==void 0;if(n=l&&i[0]&&i[0].parentNode||n,a==="string"||a==="number"){if(a==="number"&&(t=t.toString(),t===i))return i;if(l){let u=i[0];u&&u.nodeType===3?u.data!==t&&(u.data=t):u=document.createTextNode(t),i=Dn(n,i,s,u)}else i!==""&&typeof i=="string"?i=n.firstChild.data=t:i=n.textContent=t}else if(t==null||a==="boolean")i=Dn(n,i,s);else{if(a==="function")return fn(()=>{let u=t();for(;typeof u=="function";)u=u();i=Sr(n,u,i,s)}),()=>i;if(Array.isArray(t)){const u=[],f=i&&Array.isArray(i);if(os(u,t,i,r))return fn(()=>i=Sr(n,u,i,s,!0)),()=>i;if(u.length===0){if(i=Dn(n,i,s),l)return i}else f?i.length===0?pc(n,u,s):l_(n,i,u):(i&&Dn(n),pc(n,u));i=u}else if(t.nodeType){if(Array.isArray(i)){if(l)return i=Dn(n,i,s,t);Dn(n,i,null,t)}else i==null||i===""||!n.firstChild?n.appendChild(t):n.replaceChild(t,n.firstChild);i=t}}return i}function os(n,t,i,s){let r=!1;for(let a=0,l=t.length;a<l;a++){let u=t[a],f=i&&i[n.length],_;if(!(u==null||u===!0||u===!1))if((_=typeof u)=="object"&&u.nodeType)n.push(u);else if(Array.isArray(u))r=os(n,u,f)||r;else if(_==="function")if(s){for(;typeof u=="function";)u=u();r=os(n,Array.isArray(u)?u:[u],Array.isArray(f)?f:[f])||r}else n.push(u),r=!0;else{const g=String(u);f&&f.nodeType===3&&f.data===g?n.push(f):n.push(document.createTextNode(g))}}return r}function pc(n,t,i=null){for(let s=0,r=t.length;s<r;s++)n.insertBefore(t[s],i)}function Dn(n,t,i,s){if(i===void 0)return n.textContent="";const r=s||document.createTextNode("");if(t.length){let a=!1;for(let l=t.length-1;l>=0;l--){const u=t[l];if(r!==u){const f=u.parentNode===n;!a&&!l?f?n.replaceChild(r,u):n.insertBefore(r,i):f&&u.remove()}else a=!0}}else n.insertBefore(r,i);return[r]}const Po="Invariant Violation",{setPrototypeOf:p_=function(n,t){return n.__proto__=t,n}}=Object;class Is extends Error{framesToPop=1;name=Po;constructor(t=Po){super(typeof t=="number"?`${Po}: ${t} (see https://github.com/apollographql/invariant-packages)`:t),p_(this,Is.prototype)}}function Io(n,t){if(!n)throw new Is(t)}const m_=/^[A-Za-z]:\//;function g_(n=""){return n&&n.replace(/\\/g,"/").replace(m_,t=>t.toUpperCase())}const y_=/^[/\\]{2}/,v_=/^[/\\](?![/\\])|^[/\\]{2}(?!\.)|^[A-Za-z]:[/\\]/,b_=/^[A-Za-z]:$/,w_=function(n){if(n.length===0)return".";n=g_(n);const t=n.match(y_),i=ss(n),s=n[n.length-1]==="/";return n=x_(n,!i),n.length===0?i?"/":s?"./":".":(s&&(n+="/"),b_.test(n)&&(n+="/"),t?i?`//${n}`:`//./${n}`:i&&!ss(n)?`/${n}`:n)},Al=function(...n){if(n.length===0)return".";let t;for(const i of n)i&&i.length>0&&(t===void 0?t=i:t+=`/${i}`);return t===void 0?".":w_(t.replace(/\/\/+/g,"/"))};function x_(n,t){let i="",s=0,r=-1,a=0,l=null;for(let u=0;u<=n.length;++u){if(u<n.length)l=n[u];else{if(l==="/")break;l="/"}if(l==="/"){if(!(r===u-1||a===1))if(a===2){if(i.length<2||s!==2||i[i.length-1]!=="."||i[i.length-2]!=="."){if(i.length>2){const f=i.lastIndexOf("/");f===-1?(i="",s=0):(i=i.slice(0,f),s=i.length-1-i.lastIndexOf("/")),r=u,a=0;continue}else if(i.length>0){i="",s=0,r=u,a=0;continue}}t&&(i+=i.length>0?"/..":"..",s=2)}else i.length>0?i+=`/${n.slice(r+1,u)}`:i=n.slice(r+1,u),s=u-r-1;r=u,a=0}else l==="."&&a!==-1?++a:a=-1}return i}const ss=function(n){return v_.test(n)};function L_(n){return`virtual:${n}`}function S_(n){return n.handler?.endsWith(".html")?ss(n.handler)?n.handler:Al(n.root,n.handler):`$vinxi/handler/${n.name}`}const E_=new Proxy({},{get(n,t){return Io(typeof t=="string","Bundler name should be a string"),{name:t,type:"client",handler:L_(S_({name:t})),baseURL:"./",chunks:new Proxy({},{get(i,s){Io(typeof s=="string","Chunk expected");let r=Al("./",s+".mjs");return{import(){return import(r).then(async m=>{await m.__tla;return m})},output:{path:r}}}}),inputs:new Proxy({},{get(i,s){Io(typeof s=="string","Input must be string");let r=window.manifest[s].output;return{async import(){return import(r).then(async m=>{await m.__tla;return m})},async assets(){return window.manifest[s].assets},output:{path:r}}}})}}});globalThis.MANIFEST=E_;let Dl;const Ao=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}};Ao.encodeInto;const k_=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&k_.decode();typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Dl.__wbg_automerge_free(n>>>0,1));typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Dl.__wbg_syncstate_free(n>>>0,1));let T_=[];function C_(n){for(const t in n)ne[t]=n[t];for(const t of T_)t()}const ne={create(n){throw new RangeError("Automerge.use() not called")},load(n,t){throw new RangeError("Automerge.use() not called (load)")},encodeChange(n){throw new RangeError("Automerge.use() not called (encodeChange)")},decodeChange(n){throw new RangeError("Automerge.use() not called (decodeChange)")},initSyncState(){throw new RangeError("Automerge.use() not called (initSyncState)")},encodeSyncMessage(n){throw new RangeError("Automerge.use() not called (encodeSyncMessage)")},decodeSyncMessage(n){throw new RangeError("Automerge.use() not called (decodeSyncMessage)")},encodeSyncState(n){throw new RangeError("Automerge.use() not called (encodeSyncState)")},decodeSyncState(n){throw new RangeError("Automerge.use() not called (decodeSyncState)")},exportSyncState(n){throw new RangeError("Automerge.use() not called (exportSyncState)")},importSyncState(n){throw new RangeError("Automerge.use() not called (importSyncState)")}},M_=""+new URL("automerge_wasm_bg-DlmoAj_s.wasm",import.meta.url).href,P_=async(n={},t)=>{let i;if(t.startsWith("data:")){const s=t.replace(/^data:.*?base64,/,"");let r;if(typeof Buffer=="function"&&typeof Buffer.from=="function")r=Buffer.from(s,"base64");else if(typeof atob=="function"){const a=atob(s);r=new Uint8Array(a.length);for(let l=0;l<a.length;l++)r[l]=a.charCodeAt(l)}else throw new Error("Cannot decode base64-encoded data URL");i=await WebAssembly.instantiate(r,n)}else{const s=await fetch(t),r=s.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&r.startsWith("application/wasm"))i=await WebAssembly.instantiateStreaming(s,n);else{const a=await s.arrayBuffer();i=await WebAssembly.instantiate(a,n)}}return i.instance.exports};let B;function Ol(n){B=n}let de=0,Qi=null;function pi(){return(Qi===null||Qi.byteLength===0)&&(Qi=new Uint8Array(B.memory.buffer)),Qi}const I_=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let fr=new I_("utf-8");const A_=typeof fr.encodeInto=="function"?function(n,t){return fr.encodeInto(n,t)}:function(n,t){const i=fr.encode(n);return t.set(i),{read:n.length,written:i.length}};function Ae(n,t,i){if(i===void 0){const u=fr.encode(n),f=t(u.length,1)>>>0;return pi().subarray(f,f+u.length).set(u),de=u.length,f}let s=n.length,r=t(s,1)>>>0;const a=pi();let l=0;for(;l<s;l++){const u=n.charCodeAt(l);if(u>127)break;a[r+l]=u}if(l!==s){l!==0&&(n=n.slice(l)),r=i(r,s,s=l+n.length*3,1)>>>0;const u=pi().subarray(r+l,r+s),f=A_(n,u);l+=f.written,r=i(r,s,l,1)>>>0}return de=l,r}let On=null;function pe(){return(On===null||On.buffer.detached===!0||On.buffer.detached===void 0&&On.buffer!==B.memory.buffer)&&(On=new DataView(B.memory.buffer)),On}function Gt(n){const t=B.__externref_table_alloc();return B.__wbindgen_export_4.set(t,n),t}function Ge(n,t){try{return n.apply(this,t)}catch(i){const s=Gt(i);B.__wbindgen_exn_store(s)}}const D_=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let Bl=new D_("utf-8",{ignoreBOM:!0,fatal:!0});Bl.decode();function fe(n,t){return n=n>>>0,Bl.decode(pi().subarray(n,n+t))}function O_(n,t){return n=n>>>0,pi().subarray(n/1,n/1+t)}function as(n){const t=typeof n;if(t=="number"||t=="boolean"||n==null)return`${n}`;if(t=="string")return`"${n}"`;if(t=="symbol"){const r=n.description;return r==null?"Symbol":`Symbol(${r})`}if(t=="function"){const r=n.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(n)){const r=n.length;let a="[";r>0&&(a+=as(n[0]));for(let l=1;l<r;l++)a+=", "+as(n[l]);return a+="]",a}const i=/\[object ([^\]]+)\]/.exec(toString.call(n));let s;if(i&&i.length>1)s=i[1];else return toString.call(n);if(s=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:s}function St(n){return n==null}function X(n){const t=B.__wbindgen_export_4.get(n);return B.__externref_table_dealloc(n),t}function un(n,t){if(!(n instanceof t))throw new Error(`expected instance of ${t.name}`)}function B_(n){const t=B.create(n);if(t[2])throw X(t[1]);return Pe.__wrap(t[0])}function z_(n,t){const i=B.load(n,t);if(i[2])throw X(i[1]);return Pe.__wrap(i[0])}function R_(n){const t=B.encodeChange(n);if(t[2])throw X(t[1]);return X(t[0])}function H_(n){const t=B.decodeChange(n);if(t[2])throw X(t[1]);return X(t[0])}function j_(){const n=B.initSyncState();return _e.__wrap(n)}function U_(n){const t=B.importSyncState(n);if(t[2])throw X(t[1]);return _e.__wrap(t[0])}function F_(n){return un(n,_e),B.exportSyncState(n.__wbg_ptr)}function N_(n){const t=B.encodeSyncMessage(n);if(t[2])throw X(t[1]);return X(t[0])}function $_(n){const t=B.decodeSyncMessage(n);if(t[2])throw X(t[1]);return X(t[0])}function Z_(n){return un(n,_e),B.encodeSyncState(n.__wbg_ptr)}function V_(n){const t=B.decodeSyncState(n);if(t[2])throw X(t[1]);return _e.__wrap(t[0])}const mc=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>B.__wbg_automerge_free(n>>>0,1));class Pe{static __wrap(t){t=t>>>0;const i=Object.create(Pe.prototype);return i.__wbg_ptr=t,mc.register(i,i.__wbg_ptr,i),i}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,mc.unregister(this),t}free(){const t=this.__destroy_into_raw();B.__wbg_automerge_free(t,0)}static new(t){var i=St(t)?0:Ae(t,B.__wbindgen_malloc,B.__wbindgen_realloc),s=de;const r=B.automerge_new(i,s);if(r[2])throw X(r[1]);return Pe.__wrap(r[0])}clone(t){var i=St(t)?0:Ae(t,B.__wbindgen_malloc,B.__wbindgen_realloc),s=de;const r=B.automerge_clone(this.__wbg_ptr,i,s);if(r[2])throw X(r[1]);return Pe.__wrap(r[0])}fork(t,i){var s=St(t)?0:Ae(t,B.__wbindgen_malloc,B.__wbindgen_realloc),r=de;const a=B.automerge_fork(this.__wbg_ptr,s,r,i);if(a[2])throw X(a[1]);return Pe.__wrap(a[0])}pendingOps(){return B.automerge_pendingOps(this.__wbg_ptr)}commit(t,i){var s=St(t)?0:Ae(t,B.__wbindgen_malloc,B.__wbindgen_realloc),r=de;return B.automerge_commit(this.__wbg_ptr,s,r,!St(i),St(i)?0:i)}merge(t){un(t,Pe);const i=B.automerge_merge(this.__wbg_ptr,t.__wbg_ptr);if(i[2])throw X(i[1]);return X(i[0])}rollback(){return B.automerge_rollback(this.__wbg_ptr)}keys(t,i){const s=B.automerge_keys(this.__wbg_ptr,t,St(i)?0:Gt(i));if(s[2])throw X(s[1]);return X(s[0])}text(t,i){let s,r;try{const u=B.automerge_text(this.__wbg_ptr,t,St(i)?0:Gt(i));var a=u[0],l=u[1];if(u[3])throw a=0,l=0,X(u[2]);return s=a,r=l,fe(a,l)}finally{B.__wbindgen_free(s,r,1)}}spans(t,i){const s=B.automerge_spans(this.__wbg_ptr,t,St(i)?0:Gt(i));if(s[2])throw X(s[1]);return X(s[0])}splice(t,i,s,r){const a=B.automerge_splice(this.__wbg_ptr,t,i,s,r);if(a[1])throw X(a[0])}updateText(t,i){const s=B.automerge_updateText(this.__wbg_ptr,t,i);if(s[1])throw X(s[0])}updateSpans(t,i,s){const r=B.automerge_updateSpans(this.__wbg_ptr,t,i,s);if(r[1])throw X(r[0])}push(t,i,s){const r=B.automerge_push(this.__wbg_ptr,t,i,s);if(r[1])throw X(r[0])}pushObject(t,i){let s,r;try{const u=B.automerge_pushObject(this.__wbg_ptr,t,i);var a=u[0],l=u[1];if(u[3])throw a=0,l=0,X(u[2]);return s=a,r=l,fe(a,l)}finally{B.__wbindgen_free(s,r,1)}}insert(t,i,s,r){const a=B.automerge_insert(this.__wbg_ptr,t,i,s,r);if(a[1])throw X(a[0])}splitBlock(t,i,s){const r=B.automerge_splitBlock(this.__wbg_ptr,t,i,s);if(r[1])throw X(r[0])}joinBlock(t,i){const s=B.automerge_joinBlock(this.__wbg_ptr,t,i);if(s[1])throw X(s[0])}updateBlock(t,i,s){const r=B.automerge_updateBlock(this.__wbg_ptr,t,i,s);if(r[1])throw X(r[0])}getBlock(t,i,s){const r=B.automerge_getBlock(this.__wbg_ptr,t,i,St(s)?0:Gt(s));if(r[2])throw X(r[1]);return X(r[0])}insertObject(t,i,s){let r,a;try{const f=B.automerge_insertObject(this.__wbg_ptr,t,i,s);var l=f[0],u=f[1];if(f[3])throw l=0,u=0,X(f[2]);return r=l,a=u,fe(l,u)}finally{B.__wbindgen_free(r,a,1)}}put(t,i,s,r){const a=B.automerge_put(this.__wbg_ptr,t,i,s,r);if(a[1])throw X(a[0])}putObject(t,i,s){const r=B.automerge_putObject(this.__wbg_ptr,t,i,s);if(r[2])throw X(r[1]);return X(r[0])}increment(t,i,s){const r=B.automerge_increment(this.__wbg_ptr,t,i,s);if(r[1])throw X(r[0])}get(t,i,s){const r=B.automerge_get(this.__wbg_ptr,t,i,St(s)?0:Gt(s));if(r[2])throw X(r[1]);return X(r[0])}getWithType(t,i,s){const r=B.automerge_getWithType(this.__wbg_ptr,t,i,St(s)?0:Gt(s));if(r[2])throw X(r[1]);return X(r[0])}objInfo(t,i){const s=B.automerge_objInfo(this.__wbg_ptr,t,St(i)?0:Gt(i));if(s[2])throw X(s[1]);return X(s[0])}getAll(t,i,s){const r=B.automerge_getAll(this.__wbg_ptr,t,i,St(s)?0:Gt(s));if(r[2])throw X(r[1]);return X(r[0])}enableFreeze(t){const i=B.automerge_enableFreeze(this.__wbg_ptr,t);if(i[2])throw X(i[1]);return i[0]!==0}registerDatatype(t,i,s){const r=B.automerge_registerDatatype(this.__wbg_ptr,t,i,s);if(r[1])throw X(r[0])}applyPatches(t,i){const s=B.automerge_applyPatches(this.__wbg_ptr,t,i);if(s[2])throw X(s[1]);return X(s[0])}applyAndReturnPatches(t,i){const s=B.automerge_applyAndReturnPatches(this.__wbg_ptr,t,i);if(s[2])throw X(s[1]);return X(s[0])}diffIncremental(){const t=B.automerge_diffIncremental(this.__wbg_ptr);if(t[2])throw X(t[1]);return X(t[0])}updateDiffCursor(){B.automerge_updateDiffCursor(this.__wbg_ptr)}resetDiffCursor(){B.automerge_resetDiffCursor(this.__wbg_ptr)}diff(t,i){const s=B.automerge_diff(this.__wbg_ptr,t,i);if(s[2])throw X(s[1]);return X(s[0])}isolate(t){const i=B.automerge_isolate(this.__wbg_ptr,t);if(i[1])throw X(i[0])}integrate(){B.automerge_integrate(this.__wbg_ptr)}length(t,i){const s=B.automerge_length(this.__wbg_ptr,t,St(i)?0:Gt(i));if(s[2])throw X(s[1]);return s[0]}delete(t,i){const s=B.automerge_delete(this.__wbg_ptr,t,i);if(s[1])throw X(s[0])}save(){return B.automerge_save(this.__wbg_ptr)}saveIncremental(){return B.automerge_saveIncremental(this.__wbg_ptr)}saveSince(t){const i=B.automerge_saveSince(this.__wbg_ptr,t);if(i[2])throw X(i[1]);return X(i[0])}saveNoCompress(){return B.automerge_saveNoCompress(this.__wbg_ptr)}saveAndVerify(){const t=B.automerge_saveAndVerify(this.__wbg_ptr);if(t[2])throw X(t[1]);return X(t[0])}loadIncremental(t){const i=B.automerge_loadIncremental(this.__wbg_ptr,t);if(i[2])throw X(i[1]);return i[0]}applyChanges(t){const i=B.automerge_applyChanges(this.__wbg_ptr,t);if(i[1])throw X(i[0])}getChanges(t){const i=B.automerge_getChanges(this.__wbg_ptr,t);if(i[2])throw X(i[1]);return X(i[0])}getChangesMeta(t){const i=B.automerge_getChangesMeta(this.__wbg_ptr,t);if(i[2])throw X(i[1]);return X(i[0])}getChangeByHash(t){const i=B.automerge_getChangeByHash(this.__wbg_ptr,t);if(i[2])throw X(i[1]);return X(i[0])}getChangeMetaByHash(t){const i=B.automerge_getChangeMetaByHash(this.__wbg_ptr,t);if(i[2])throw X(i[1]);return X(i[0])}getDecodedChangeByHash(t){const i=B.automerge_getDecodedChangeByHash(this.__wbg_ptr,t);if(i[2])throw X(i[1]);return X(i[0])}getChangesAdded(t){return un(t,Pe),B.automerge_getChangesAdded(this.__wbg_ptr,t.__wbg_ptr)}getHeads(){return B.automerge_getHeads(this.__wbg_ptr)}getActorId(){let t,i;try{const s=B.automerge_getActorId(this.__wbg_ptr);return t=s[0],i=s[1],fe(s[0],s[1])}finally{B.__wbindgen_free(t,i,1)}}getLastLocalChange(){return B.automerge_getLastLocalChange(this.__wbg_ptr)}dump(){B.automerge_dump(this.__wbg_ptr)}getMissingDeps(t){const i=B.automerge_getMissingDeps(this.__wbg_ptr,St(t)?0:Gt(t));if(i[2])throw X(i[1]);return X(i[0])}receiveSyncMessage(t,i){un(t,_e);const s=B.automerge_receiveSyncMessage(this.__wbg_ptr,t.__wbg_ptr,i);if(s[1])throw X(s[0])}generateSyncMessage(t){return un(t,_e),B.automerge_generateSyncMessage(this.__wbg_ptr,t.__wbg_ptr)}toJS(t){const i=B.automerge_toJS(this.__wbg_ptr,t);if(i[2])throw X(i[1]);return X(i[0])}materialize(t,i,s){const r=B.automerge_materialize(this.__wbg_ptr,t,St(i)?0:Gt(i),s);if(r[2])throw X(r[1]);return X(r[0])}getCursor(t,i,s,r){let a,l;try{const _=B.automerge_getCursor(this.__wbg_ptr,t,i,St(s)?0:Gt(s),r);var u=_[0],f=_[1];if(_[3])throw u=0,f=0,X(_[2]);return a=u,l=f,fe(u,f)}finally{B.__wbindgen_free(a,l,1)}}getCursorPosition(t,i,s){const r=B.automerge_getCursorPosition(this.__wbg_ptr,t,i,St(s)?0:Gt(s));if(r[2])throw X(r[1]);return r[0]}emptyChange(t,i){var s=St(t)?0:Ae(t,B.__wbindgen_malloc,B.__wbindgen_realloc),r=de;return B.automerge_emptyChange(this.__wbg_ptr,s,r,!St(i),St(i)?0:i)}mark(t,i,s,r,a){const l=B.automerge_mark(this.__wbg_ptr,t,i,s,r,a);if(l[1])throw X(l[0])}unmark(t,i,s){const r=B.automerge_unmark(this.__wbg_ptr,t,i,s);if(r[1])throw X(r[0])}marks(t,i){const s=B.automerge_marks(this.__wbg_ptr,t,St(i)?0:Gt(i));if(s[2])throw X(s[1]);return X(s[0])}marksAt(t,i,s){const r=B.automerge_marksAt(this.__wbg_ptr,t,i,St(s)?0:Gt(s));if(r[2])throw X(r[1]);return X(r[0])}hasOurChanges(t){return un(t,_e),B.automerge_hasOurChanges(this.__wbg_ptr,t.__wbg_ptr)!==0}topoHistoryTraversal(){return B.automerge_topoHistoryTraversal(this.__wbg_ptr)}stats(){return B.automerge_stats(this.__wbg_ptr)}}const gc=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>B.__wbg_syncstate_free(n>>>0,1));class _e{static __wrap(t){t=t>>>0;const i=Object.create(_e.prototype);return i.__wbg_ptr=t,gc.register(i,i.__wbg_ptr,i),i}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,gc.unregister(this),t}free(){const t=this.__destroy_into_raw();B.__wbg_syncstate_free(t,0)}get sharedHeads(){return B.syncstate_sharedHeads(this.__wbg_ptr)}get lastSentHeads(){return B.syncstate_lastSentHeads(this.__wbg_ptr)}set lastSentHeads(t){const i=B.syncstate_set_lastSentHeads(this.__wbg_ptr,t);if(i[1])throw X(i[0])}set sentHashes(t){const i=B.syncstate_set_sentHashes(this.__wbg_ptr,t);if(i[1])throw X(i[0])}clone(){const t=B.syncstate_clone(this.__wbg_ptr);return _e.__wrap(t)}}function zl(n,t){const i=String(t),s=Ae(i,B.__wbindgen_malloc,B.__wbindgen_realloc),r=de;pe().setInt32(n+4,r,!0),pe().setInt32(n+0,s,!0)}function Rl(){return Ge(function(n,t,i){return Reflect.apply(n,t,i)},arguments)}function Hl(n,t){return Object.assign(n,t)}function jl(n){return n.buffer}function Ul(){return Ge(function(n,t){return n.call(t)},arguments)}function Fl(){return Ge(function(n,t,i){return n.call(t,i)},arguments)}function Nl(n,t){return n.concat(t)}function $l(n,t,i){return Object.defineProperty(n,t,i)}function Zl(){return Ge(function(n,t){return Reflect.deleteProperty(n,t)},arguments)}function Vl(n){return n.done}function Gl(n){return Object.entries(n)}function Wl(n,t){let i,s;try{i=n,s=t,console.error(fe(n,t))}finally{B.__wbindgen_free(i,s,1)}}function ql(n,t){return Symbol.for(fe(n,t))}function Kl(n){return Object.freeze(n)}function Yl(n){return Array.from(n)}function Jl(){return Ge(function(n,t){globalThis.crypto.getRandomValues(O_(n,t))},arguments)}function Xl(n){return n.getTime()}function Ql(){return Ge(function(n,t){return Reflect.get(n,t)},arguments)}function th(n,t){return n[t>>>0]}function eh(n){let t;try{t=n instanceof ArrayBuffer}catch{t=!1}return t}function nh(n){let t;try{t=n instanceof Date}catch{t=!1}return t}function ih(n){let t;try{t=n instanceof Object}catch{t=!1}return t}function rh(n){let t;try{t=n instanceof Uint8Array}catch{t=!1}return t}function oh(n){return Array.isArray(n)}function sh(){return Symbol.iterator}function ah(n){return Object.keys(n)}function ch(n){return n.length}function lh(n){return n.length}function hh(n){return n.length}function uh(n,t){console.log(n,t)}function dh(n){console.log(n)}function fh(n,t){return new RangeError(fe(n,t))}function _h(n){return new Date(n)}function ph(){return new Object}function mh(){return new Array}function gh(){return new Error}function yh(n){return new Uint8Array(n)}function vh(n,t){return new Error(fe(n,t))}function bh(n,t,i){return new Uint8Array(n,t>>>0,i>>>0)}function wh(n){return n.next}function xh(){return Ge(function(n){return n.next()},arguments)}function Lh(){return Ge(function(n){return Reflect.ownKeys(n)},arguments)}function Sh(n,t){return n.push(t)}function Eh(n,t,i){n[t>>>0]=i}function kh(n,t,i){n[t]=i}function Th(n,t,i){n.set(t,i>>>0)}function Ch(){return Ge(function(n,t,i){return Reflect.set(n,t,i)},arguments)}function Mh(n,t,i){return n.slice(t>>>0,i>>>0)}function Ph(n,t){const i=t.stack,s=Ae(i,B.__wbindgen_malloc,B.__wbindgen_realloc),r=de;pe().setInt32(n+4,r,!0),pe().setInt32(n+0,s,!0)}function Ih(n){return n.toString()}function Ah(n,t){return n.unshift(t)}function Dh(n){return n.value}function Oh(n){return Object.values(n)}function Bh(n){return n}function zh(n){return BigInt.asUintN(64,n)}function Rh(n){const t=n;return typeof t=="boolean"?t?1:0:2}function Hh(n,t){const i=as(t),s=Ae(i,B.__wbindgen_malloc,B.__wbindgen_realloc),r=de;pe().setInt32(n+4,r,!0),pe().setInt32(n+0,s,!0)}function jh(n,t){return new Error(fe(n,t))}function Uh(){const n=B.__wbindgen_export_4,t=n.grow(4);n.set(0,void 0),n.set(t+0,void 0),n.set(t+1,null),n.set(t+2,!0),n.set(t+3,!1)}function Fh(n){return Array.isArray(n)}function Nh(n){return typeof n=="function"}function $h(n){return n===null}function Zh(n){const t=n;return typeof t=="object"&&t!==null}function Vh(n){return typeof n=="string"}function Gh(n){return n===void 0}function Wh(n,t){const i=t,s=JSON.stringify(i===void 0?null:i),r=Ae(s,B.__wbindgen_malloc,B.__wbindgen_realloc),a=de;pe().setInt32(n+4,a,!0),pe().setInt32(n+0,r,!0)}function qh(n,t){return n==t}function Kh(){return B.memory}function Yh(n,t){const i=t,s=typeof i=="number"?i:void 0;pe().setFloat64(n+8,St(s)?0:s,!0),pe().setInt32(n+0,!St(s),!0)}function Jh(n){return n}function Xh(n,t){const i=t,s=typeof i=="string"?i:void 0;var r=St(s)?0:Ae(s,B.__wbindgen_malloc,B.__wbindgen_realloc),a=de;pe().setInt32(n+4,a,!0),pe().setInt32(n+0,r,!0)}function Qh(n,t){return fe(n,t)}function tu(n,t){throw new Error(fe(n,t))}URL=globalThis.URL;const Y=await P_({"./automerge_wasm_bg.js":{__wbindgen_string_get:Xh,__wbindgen_error_new:jh,__wbindgen_string_new:Qh,__wbindgen_number_new:Jh,__wbindgen_number_get:Yh,__wbindgen_is_undefined:Gh,__wbindgen_boolean_get:Rh,__wbindgen_is_null:$h,__wbindgen_is_string:Vh,__wbindgen_is_function:Nh,__wbindgen_is_object:Zh,__wbindgen_is_array:Fh,__wbindgen_json_serialize:Wh,__wbg_new_8a6f238a6ece86ea:gh,__wbg_stack_0ed75d68575b0f3c:Ph,__wbg_error_7534b8e9a36f1ab4:Wl,__wbindgen_jsval_loose_eq:qh,__wbg_String_8f0eb39a4a4c2f66:zl,__wbindgen_bigint_from_i64:Bh,__wbindgen_bigint_from_u64:zh,__wbg_set_3f1d0b984ed272ed:kh,__wbg_getRandomValues_3c9c0d586e575a16:Jl,__wbg_log_c222819a41e063d3:dh,__wbg_log_1ae1e9f741096e91:uh,__wbg_get_b9b93047fe3cf45b:th,__wbg_length_e2d2a49132c1b256:hh,__wbg_new_78feb108b6472713:mh,__wbg_next_25feadfc0913fea9:wh,__wbg_next_6574e1a8a62d1055:xh,__wbg_done_769e5ede4b31c67b:Vl,__wbg_value_cd1ffa7b1ab794f1:Dh,__wbg_iterator_9a24c88df860dc65:sh,__wbg_get_67b2ba62fc30de12:Ql,__wbg_call_672a4d21634d4a24:Ul,__wbg_new_405e22f390576ce2:ph,__wbg_length_d56737991078581b:lh,__wbg_set_37837023f3d740e8:Eh,__wbg_from_2a5d3e218e67aa85:Yl,__wbg_isArray_a1eab7e0d067391b:oh,__wbg_push_737cfc8c1432c2c6:Sh,__wbg_unshift_c290010f73f04fb1:Ah,__wbg_instanceof_ArrayBuffer_e14585432e3737fc:eh,__wbg_new_c68d7209be747379:vh,__wbg_call_7cccdd69e0791ae2:Fl,__wbg_instanceof_Date_e9a9be8b9cea7890:nh,__wbg_getTime_46267b1c24877e30:Xl,__wbg_new_31a97dac4f10fab7:_h,__wbg_instanceof_Object_7f2dcef8f78644a4:ih,__wbg_assign_3627b8559449930a:Hl,__wbg_defineProperty_a3ddad9901e2d29e:$l,__wbg_entries_3265d4158b33e5dc:Gl,__wbg_freeze_ef6d70cf38e8d948:Kl,__wbg_keys_5c77a08ddc2fb8a6:ah,__wbg_values_fcb8ba8c0aad8b58:Oh,__wbg_new_1ab78df5e132f715:fh,__wbg_apply_eb9e9b97497f91e4:Rl,__wbg_deleteProperty_96363d4a1d977c97:Zl,__wbg_ownKeys_3930041068756f1f:Lh,__wbg_set_bb8cecf6a62b9f46:Ch,__wbg_buffer_609cc3eee51ed158:jl,__wbg_concat_9de968491c4340cf:Nl,__wbg_slice_972c243648c9fd2e:Mh,__wbg_for_4ff07bddd743c5e7:ql,__wbg_toString_66ab719c2a98bdf1:Ih,__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a:bh,__wbg_new_a12002a7f91c75be:yh,__wbg_set_65595bdd868b3009:Th,__wbg_length_a446193dc22c12f8:ch,__wbg_instanceof_Uint8Array_17156bcf118086a9:rh,__wbindgen_debug_string:Hh,__wbindgen_throw:tu,__wbindgen_memory:Kh,__wbindgen_init_externref_table:Uh}},M_),G_=Y.memory,W_=Y.__wbg_syncstate_free,q_=Y.syncstate_sharedHeads,K_=Y.syncstate_lastSentHeads,Y_=Y.syncstate_set_lastSentHeads,J_=Y.syncstate_set_sentHashes,X_=Y.syncstate_clone,Q_=Y.__wbg_automerge_free,tp=Y.automerge_new,ep=Y.automerge_clone,np=Y.automerge_fork,ip=Y.automerge_pendingOps,rp=Y.automerge_commit,op=Y.automerge_merge,sp=Y.automerge_rollback,ap=Y.automerge_keys,cp=Y.automerge_text,lp=Y.automerge_spans,hp=Y.automerge_splice,up=Y.automerge_updateText,dp=Y.automerge_updateSpans,fp=Y.automerge_push,_p=Y.automerge_pushObject,pp=Y.automerge_insert,mp=Y.automerge_splitBlock,gp=Y.automerge_joinBlock,yp=Y.automerge_updateBlock,vp=Y.automerge_getBlock,bp=Y.automerge_insertObject,wp=Y.automerge_put,xp=Y.automerge_putObject,Lp=Y.automerge_increment,Sp=Y.automerge_get,Ep=Y.automerge_getWithType,kp=Y.automerge_objInfo,Tp=Y.automerge_getAll,Cp=Y.automerge_enableFreeze,Mp=Y.automerge_registerDatatype,Pp=Y.automerge_applyPatches,Ip=Y.automerge_applyAndReturnPatches,Ap=Y.automerge_diffIncremental,Dp=Y.automerge_updateDiffCursor,Op=Y.automerge_resetDiffCursor,Bp=Y.automerge_diff,zp=Y.automerge_isolate,Rp=Y.automerge_integrate,Hp=Y.automerge_length,jp=Y.automerge_delete,Up=Y.automerge_save,Fp=Y.automerge_saveIncremental,Np=Y.automerge_saveSince,$p=Y.automerge_saveNoCompress,Zp=Y.automerge_saveAndVerify,Vp=Y.automerge_loadIncremental,Gp=Y.automerge_applyChanges,Wp=Y.automerge_getChanges,qp=Y.automerge_getChangesMeta,Kp=Y.automerge_getChangeByHash,Yp=Y.automerge_getChangeMetaByHash,Jp=Y.automerge_getDecodedChangeByHash,Xp=Y.automerge_getChangesAdded,Qp=Y.automerge_getHeads,tm=Y.automerge_getActorId,em=Y.automerge_getLastLocalChange,nm=Y.automerge_dump,im=Y.automerge_getMissingDeps,rm=Y.automerge_receiveSyncMessage,om=Y.automerge_generateSyncMessage,sm=Y.automerge_toJS,am=Y.automerge_materialize,cm=Y.automerge_getCursor,lm=Y.automerge_getCursorPosition,hm=Y.automerge_emptyChange,um=Y.automerge_mark,dm=Y.automerge_unmark,fm=Y.automerge_marks,_m=Y.automerge_marksAt,pm=Y.automerge_hasOurChanges,mm=Y.automerge_topoHistoryTraversal,gm=Y.automerge_stats,ym=Y.create,vm=Y.load,bm=Y.encodeChange,wm=Y.decodeChange,xm=Y.initSyncState,Lm=Y.importSyncState,Sm=Y.exportSyncState,Em=Y.encodeSyncMessage,km=Y.decodeSyncMessage,Tm=Y.encodeSyncState,Cm=Y.decodeSyncState,Mm=Y.__wbindgen_malloc,Pm=Y.__wbindgen_realloc,Im=Y.__wbindgen_exn_store,Am=Y.__externref_table_alloc,Dm=Y.__wbindgen_export_4,Om=Y.__wbindgen_free,Bm=Y.__externref_table_dealloc,eu=Y.__wbindgen_start,zm=Object.freeze(Object.defineProperty({__proto__:null,__externref_table_alloc:Am,__externref_table_dealloc:Bm,__wbg_automerge_free:Q_,__wbg_syncstate_free:W_,__wbindgen_exn_store:Im,__wbindgen_export_4:Dm,__wbindgen_free:Om,__wbindgen_malloc:Mm,__wbindgen_realloc:Pm,__wbindgen_start:eu,automerge_applyAndReturnPatches:Ip,automerge_applyChanges:Gp,automerge_applyPatches:Pp,automerge_clone:ep,automerge_commit:rp,automerge_delete:jp,automerge_diff:Bp,automerge_diffIncremental:Ap,automerge_dump:nm,automerge_emptyChange:hm,automerge_enableFreeze:Cp,automerge_fork:np,automerge_generateSyncMessage:om,automerge_get:Sp,automerge_getActorId:tm,automerge_getAll:Tp,automerge_getBlock:vp,automerge_getChangeByHash:Kp,automerge_getChangeMetaByHash:Yp,automerge_getChanges:Wp,automerge_getChangesAdded:Xp,automerge_getChangesMeta:qp,automerge_getCursor:cm,automerge_getCursorPosition:lm,automerge_getDecodedChangeByHash:Jp,automerge_getHeads:Qp,automerge_getLastLocalChange:em,automerge_getMissingDeps:im,automerge_getWithType:Ep,automerge_hasOurChanges:pm,automerge_increment:Lp,automerge_insert:pp,automerge_insertObject:bp,automerge_integrate:Rp,automerge_isolate:zp,automerge_joinBlock:gp,automerge_keys:ap,automerge_length:Hp,automerge_loadIncremental:Vp,automerge_mark:um,automerge_marks:fm,automerge_marksAt:_m,automerge_materialize:am,automerge_merge:op,automerge_new:tp,automerge_objInfo:kp,automerge_pendingOps:ip,automerge_push:fp,automerge_pushObject:_p,automerge_put:wp,automerge_putObject:xp,automerge_receiveSyncMessage:rm,automerge_registerDatatype:Mp,automerge_resetDiffCursor:Op,automerge_rollback:sp,automerge_save:Up,automerge_saveAndVerify:Zp,automerge_saveIncremental:Fp,automerge_saveNoCompress:$p,automerge_saveSince:Np,automerge_spans:lp,automerge_splice:hp,automerge_splitBlock:mp,automerge_stats:gm,automerge_text:cp,automerge_toJS:sm,automerge_topoHistoryTraversal:mm,automerge_unmark:dm,automerge_updateBlock:yp,automerge_updateDiffCursor:Dp,automerge_updateSpans:dp,automerge_updateText:up,create:ym,decodeChange:wm,decodeSyncMessage:km,decodeSyncState:Cm,encodeChange:bm,encodeSyncMessage:Em,encodeSyncState:Tm,exportSyncState:Sm,importSyncState:Lm,initSyncState:xm,load:vm,memory:G_,syncstate_clone:X_,syncstate_lastSentHeads:K_,syncstate_set_lastSentHeads:Y_,syncstate_set_sentHashes:J_,syncstate_sharedHeads:q_},Symbol.toStringTag,{value:"Module"}));Ol(zm);eu();const Rm=Object.freeze(Object.defineProperty({__proto__:null,Automerge:Pe,SyncState:_e,__wbg_String_8f0eb39a4a4c2f66:zl,__wbg_apply_eb9e9b97497f91e4:Rl,__wbg_assign_3627b8559449930a:Hl,__wbg_buffer_609cc3eee51ed158:jl,__wbg_call_672a4d21634d4a24:Ul,__wbg_call_7cccdd69e0791ae2:Fl,__wbg_concat_9de968491c4340cf:Nl,__wbg_defineProperty_a3ddad9901e2d29e:$l,__wbg_deleteProperty_96363d4a1d977c97:Zl,__wbg_done_769e5ede4b31c67b:Vl,__wbg_entries_3265d4158b33e5dc:Gl,__wbg_error_7534b8e9a36f1ab4:Wl,__wbg_for_4ff07bddd743c5e7:ql,__wbg_freeze_ef6d70cf38e8d948:Kl,__wbg_from_2a5d3e218e67aa85:Yl,__wbg_getRandomValues_3c9c0d586e575a16:Jl,__wbg_getTime_46267b1c24877e30:Xl,__wbg_get_67b2ba62fc30de12:Ql,__wbg_get_b9b93047fe3cf45b:th,__wbg_instanceof_ArrayBuffer_e14585432e3737fc:eh,__wbg_instanceof_Date_e9a9be8b9cea7890:nh,__wbg_instanceof_Object_7f2dcef8f78644a4:ih,__wbg_instanceof_Uint8Array_17156bcf118086a9:rh,__wbg_isArray_a1eab7e0d067391b:oh,__wbg_iterator_9a24c88df860dc65:sh,__wbg_keys_5c77a08ddc2fb8a6:ah,__wbg_length_a446193dc22c12f8:ch,__wbg_length_d56737991078581b:lh,__wbg_length_e2d2a49132c1b256:hh,__wbg_log_1ae1e9f741096e91:uh,__wbg_log_c222819a41e063d3:dh,__wbg_new_1ab78df5e132f715:fh,__wbg_new_31a97dac4f10fab7:_h,__wbg_new_405e22f390576ce2:ph,__wbg_new_78feb108b6472713:mh,__wbg_new_8a6f238a6ece86ea:gh,__wbg_new_a12002a7f91c75be:yh,__wbg_new_c68d7209be747379:vh,__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a:bh,__wbg_next_25feadfc0913fea9:wh,__wbg_next_6574e1a8a62d1055:xh,__wbg_ownKeys_3930041068756f1f:Lh,__wbg_push_737cfc8c1432c2c6:Sh,__wbg_set_37837023f3d740e8:Eh,__wbg_set_3f1d0b984ed272ed:kh,__wbg_set_65595bdd868b3009:Th,__wbg_set_bb8cecf6a62b9f46:Ch,__wbg_set_wasm:Ol,__wbg_slice_972c243648c9fd2e:Mh,__wbg_stack_0ed75d68575b0f3c:Ph,__wbg_toString_66ab719c2a98bdf1:Ih,__wbg_unshift_c290010f73f04fb1:Ah,__wbg_value_cd1ffa7b1ab794f1:Dh,__wbg_values_fcb8ba8c0aad8b58:Oh,__wbindgen_bigint_from_i64:Bh,__wbindgen_bigint_from_u64:zh,__wbindgen_boolean_get:Rh,__wbindgen_debug_string:Hh,__wbindgen_error_new:jh,__wbindgen_init_externref_table:Uh,__wbindgen_is_array:Fh,__wbindgen_is_function:Nh,__wbindgen_is_null:$h,__wbindgen_is_object:Zh,__wbindgen_is_string:Vh,__wbindgen_is_undefined:Gh,__wbindgen_json_serialize:Wh,__wbindgen_jsval_loose_eq:qh,__wbindgen_memory:Kh,__wbindgen_number_get:Yh,__wbindgen_number_new:Jh,__wbindgen_string_get:Xh,__wbindgen_string_new:Qh,__wbindgen_throw:tu,create:B_,decodeChange:H_,decodeSyncMessage:$_,decodeSyncState:V_,encodeChange:R_,encodeSyncMessage:N_,encodeSyncState:Z_,exportSyncState:F_,importSyncState:U_,initSyncState:j_,load:z_},Symbol.toStringTag,{value:"Module"})),Nr=Symbol.for("_am_meta"),vi=Symbol.for("_am_trace"),bi=Symbol.for("_am_objectId"),As=Symbol.for("_am_isProxy"),nu=Symbol.for("_am_clearCache"),Hm=Symbol.for("_am_uint"),jm=Symbol.for("_am_int"),Um=Symbol.for("_am_f64"),iu=Symbol.for("_am_counter"),ru=Symbol.for("_am_immutableString");class cs{constructor(t){this.value=t||0,Reflect.defineProperty(this,iu,{value:!0})}valueOf(){return this.value}toString(){return this.valueOf().toString()}toJSON(){return this.value}increment(t){throw new Error("Counters should not be incremented outside of a change callback")}decrement(t){throw new Error("Counters should not be decremented outside of a change callback")}}class Fm extends cs{constructor(t,i,s,r,a){super(t),this.context=i,this.path=s,this.objectId=r,this.key=a}increment(t){return t=typeof t=="number"?t:1,this.context.increment(this.objectId,this.key,t),this.value+=t,this.value}decrement(t){return this.increment(typeof t=="number"?-t:-1)}}function Nm(n,t,i,s,r){return new Fm(n,t,i,s,r)}var ou;class su{constructor(t){this[ou]=!0,this.val=t}toString(){return this.val}toJSON(){return this.val}}ou=ru;function Ue(n){if(typeof n=="string"&&/^[0-9]+$/.test(n)&&(n=parseInt(n,10)),typeof n!="number")return n;if(n<0||isNaN(n)||n===1/0||n===-1/0)throw new RangeError("A list index must be positive, but you passed "+n);return n}function re(n,t){const{context:i,objectId:s,path:r}=n,a=i.getWithType(s,t);if(a===null)return;const l=a[0],u=a[1];switch(l){case void 0:return;case"map":return Mi(i,u,[...r,t]);case"list":return Zr(i,u,[...r,t]);case"text":return i.text(u);case"str":return new su(u);case"uint":return u;case"int":return u;case"f64":return u;case"boolean":return u;case"null":return null;case"bytes":return u;case"timestamp":return u;case"counter":return Nm(u,i,r,s,t);default:throw RangeError(`datatype ${l} unimplemented`)}}function Er(n,t,i){const s=typeof n;switch(s){case"object":if(n==null)return[null,"null"];if(n[Hm])return[n.value,"uint"];if(n[jm])return[n.value,"int"];if(n[Um])return[n.value,"f64"];if(n[iu])return[n.value,"counter"];if(n instanceof Date)return[n.getTime(),"timestamp"];if(au(n))return[n.toString(),"str"];if(n instanceof Uint8Array)return[n,"bytes"];if(n instanceof Array)return[n,"list"];if(Object.prototype.toString.call(n)==="[object Object]")return[n,"map"];throw $r(n,i)?new RangeError("Cannot create a reference to an existing document object"):new RangeError(`Cannot assign unknown object: ${n}`);case"boolean":return[n,"boolean"];case"number":return Number.isInteger(n)?[n,"int"]:[n,"f64"];case"string":return[n,"text"];case"undefined":throw new RangeError([`Cannot assign undefined value at ${yc(t)}, `,"because `undefined` is not a valid JSON data type. ","You might consider setting the property's value to `null`, ","or using `delete` to remove it altogether."].join(""));default:throw new RangeError([`Cannot assign ${s} value at ${yc(t)}. `,"All JSON primitive datatypes (object, array, string, number, boolean, null) ",`are supported in an Automerge document; ${s} values are not. `].join(""))}}function $r(n,t){var i,s;return n instanceof Date?!1:!!(n&&((s=(i=n[Nr])===null||i===void 0?void 0:i.handle)===null||s===void 0?void 0:s.__wbg_ptr)===t.__wbg_ptr)}const $m={get(n,t){const{context:i,objectId:s,cache:r}=n;return t===Symbol.toStringTag?n[Symbol.toStringTag]:t===bi?s:t===As?!0:t===vi?n.trace:t===Nr?{handle:i}:(r[t]||(r[t]=re(n,t)),r[t])},set(n,t,i){const{context:s,objectId:r,path:a}=n;if(n.cache={},$r(i,s))throw new RangeError("Cannot create a reference to an existing document object");if(t===vi)return n.trace=i,!0;if(t===nu)return!0;const[l,u]=Er(i,[...a,t],s);switch(u){case"list":{const f=s.putObject(r,t,[]),_=Zr(s,f,[...a,t]);for(let g=0;g<l.length;g++)_[g]=l[g];break}case"text":{s.putObject(r,t,l);break}case"map":{const f=s.putObject(r,t,{}),_=Mi(s,f,[...a,t]);for(const g in l)_[g]=l[g];break}default:s.put(r,t,l,u)}return!0},deleteProperty(n,t){const{context:i,objectId:s}=n;return n.cache={},i.delete(s,t),!0},has(n,t){return this.get(n,t)!==void 0},getOwnPropertyDescriptor(n,t){const i=this.get(n,t);if(typeof i<"u")return{configurable:!0,enumerable:!0,value:i}},ownKeys(n){const{context:t,objectId:i}=n,s=t.keys(i);return[...new Set(s)]}},Zm={get(n,t){const{context:i,objectId:s}=n;return t=Ue(t),t===Symbol.hasInstance?r=>Array.isArray(r):t===Symbol.toStringTag?n[Symbol.toStringTag]:t===bi?s:t===As?!0:t===vi?n.trace:t===Nr?{handle:i}:t==="length"?i.length(s):typeof t=="number"?re(n,t):Gm(n)[t]},set(n,t,i){const{context:s,objectId:r,path:a}=n;if(t=Ue(t),$r(i,s))throw new RangeError("Cannot create a reference to an existing document object");if(t===nu)return!0;if(t===vi)return n.trace=i,!0;if(typeof t=="string")throw new RangeError("list index must be a number");const[l,u]=Er(i,[...a,t],s);switch(u){case"list":{let f;t>=s.length(r)?f=s.insertObject(r,t,[]):f=s.putObject(r,t,[]),Zr(s,f,[...a,t]).splice(0,0,...l);break}case"text":{t>=s.length(r)?s.insertObject(r,t,l):s.putObject(r,t,l);break}case"map":{let f;t>=s.length(r)?f=s.insertObject(r,t,{}):f=s.putObject(r,t,{});const _=Mi(s,f,[...a,t]);for(const g in l)_[g]=l[g];break}default:t>=s.length(r)?s.insert(r,t,l,u):s.put(r,t,l,u)}return!0},deleteProperty(n,t){const{context:i,objectId:s}=n;t=Ue(t);const r=i.get(s,t);if(r!=null&&r[0]=="counter")throw new TypeError("Unsupported operation: deleting a counter from a list");return i.delete(s,t),!0},has(n,t){const{context:i,objectId:s}=n;return t=Ue(t),typeof t=="number"?t<i.length(s):t==="length"},getOwnPropertyDescriptor(n,t){const{context:i,objectId:s}=n;return t==="length"?{writable:!0,value:i.length(s)}:t===bi?{configurable:!1,enumerable:!1,value:s}:(t=Ue(t),{configurable:!0,enumerable:!0,value:re(n,t)})},getPrototypeOf(n){return Object.getPrototypeOf(n)},ownKeys(){const n=[];return n.push("length"),n}};function Mi(n,t,i){const s={context:n,objectId:t,path:i||[],cache:{}},r={};return Object.assign(r,s),new Proxy(r,$m)}function Zr(n,t,i){const s={context:n,objectId:t,path:i||[],cache:{}},r=[];return Object.assign(r,s),new Proxy(r,Zm)}function Vm(n){return Mi(n,"_root",[])}function Gm(n){const{context:t,objectId:i,path:s}=n;return{at(a){return re(n,a)},deleteAt(a,l){return typeof l=="number"?t.splice(i,a,l):t.delete(i,a),this},fill(a,l,u){const[f,_]=Er(a,[...s,l],t),g=t.length(i);l=Ue(l||0),u=Ue(u||g);for(let p=l;p<Math.min(u,g);p++)_==="list"||_==="map"||_==="text"?t.putObject(i,p,f):t.put(i,p,f,_);return this},indexOf(a,l=0){const u=t.length(i);for(let f=l;f<u;f++){const _=t.getWithType(i,f);if(!_)continue;const[g,p]=_;if(!["map","list","text"].includes(g)){if(p===a)return f;continue}if(g==="text"&&typeof a=="string"&&a===re(n,f)||a[bi]===p)return f}return-1},insertAt(a,...l){return this.splice(a,0,...l),this},pop(){const a=t.length(i);if(a==0)return;const l=re(n,a-1);return t.delete(i,a-1),l},push(...a){const l=t.length(i);return this.splice(l,0,...a),t.length(i)},shift(){if(t.length(i)==0)return;const a=re(n,0);return t.delete(i,0),a},splice(a,l,...u){a=Ue(a),typeof l!="number"&&(l=t.length(i)-a),l=Ue(l);for(const g of u)if($r(g,t))throw new RangeError("Cannot create a reference to an existing document object");const f=[];for(let g=0;g<l;g++){const p=re(n,a);p!==void 0&&f.push(p),t.delete(i,a)}const _=u.map((g,p)=>{try{return Er(g,[...s],t)}catch(m){throw m instanceof RangeError?new RangeError(`${m.message} (at index ${p} in the input)`):m}});for(const[g,p]of _){switch(p){case"list":{const m=t.insertObject(i,a,[]);Zr(t,m,[...s,a]).splice(0,0,...g);break}case"text":{t.insertObject(i,a,g);break}case"map":{const m=t.insertObject(i,a,{}),v=Mi(t,m,[...s,a]);for(const b in g)v[b]=g[b];break}default:t.insert(i,a,g,p)}a+=1}return f},unshift(...a){return this.splice(0,0,...a),t.length(i)},entries(){let a=0;return{next:()=>{const u=re(n,a);return u===void 0?{value:void 0,done:!0}:{value:[a++,u],done:!1}},[Symbol.iterator](){return this}}},keys(){let a=0;const l=t.length(i);return{next:()=>a<l?{value:a++,done:!1}:{value:void 0,done:!0},[Symbol.iterator](){return this}}},values(){let a=0;return{next:()=>{const u=re(n,a++);return u===void 0?{value:void 0,done:!0}:{value:u,done:!1}},[Symbol.iterator](){return this}}},toArray(){const a=[];let l;do l=re(n,a.length),l!==void 0&&a.push(l);while(l!==void 0);return a},map(a){return this.toArray().map(a)},toString(){return this.toArray().toString()},toLocaleString(){return this.toArray().toLocaleString()},forEach(a){return this.toArray().forEach(a)},concat(a){return this.toArray().concat(a)},every(a){return this.toArray().every(a)},filter(a){return this.toArray().filter(a)},find(a){let l=0;for(const u of this){if(a(u,l))return u;l+=1}},findIndex(a){let l=0;for(const u of this){if(a(u,l))return l;l+=1}return-1},includes(a){return this.find(l=>l===a)!==void 0},join(a){return this.toArray().join(a)},reduce(a,l){return this.toArray().reduce(a,l)},reduceRight(a,l){return this.toArray().reduceRight(a,l)},lastIndexOf(a,l=1/0){return this.toArray().lastIndexOf(a,l)},slice(a,l){return this.toArray().slice(a,l)},some(a){let l=0;for(const u of this){if(a(u,l))return!0;l+=1}return!1},[Symbol.iterator]:function*(){let a=0,l=re(n,a);for(;l!==void 0;)yield l,a+=1,l=re(n,a)}}}function yc(n){const t=n.map(i=>{if(typeof i=="number")return i.toString();if(typeof i=="string")return i.replace(/~/g,"~0").replace(/\//g,"~1")});return n.length===0?"":"/"+t.join("/")}function au(n){return typeof n=="object"&&n!==null&&Object.prototype.hasOwnProperty.call(n,ru)}function Ut(n,t=!0){if(typeof n!="object")throw new RangeError("must be the document root");const i=Reflect.get(n,Nr);if(i===void 0||i==null||t&&Wm(n)!=="_root")throw new RangeError("must be the document root");return i}function cu(n){return Reflect.get(n,vi)}function Wm(n){return typeof n!="object"||n===null?null:Reflect.get(n,bi)}function Vr(n){return!!Reflect.get(n,As)}var qm=function(n,t){var i={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(i[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(i[s[r]]=n[s[r]]);return i};function Ds(n){return typeof n=="object"?n:{actor:n}}function ve(n){const t=Ds(n),i=!!t.freeze,s=t.patchCallback,r=t.actor,a=ne.create({actor:r});return a.enableFreeze(!!t.freeze),fu(a),a.materialize("/",void 0,{handle:a,heads:void 0,freeze:i,patchCallback:s})}function Km(n,t){const i=Ut(n),s=i.handle;return i.handle.materialize("/",t,Object.assign(Object.assign({},i),{handle:s,heads:t}))}function kr(n,t){const i=Ut(n),s=i.heads,r=Ds(t),a=i.handle.fork(r.actor,s);a.updateDiffCursor();const{heads:l}=i,u=qm(i,["heads"]);return u.patchCallback=r.patchCallback,a.applyPatches(n,Object.assign(Object.assign({},u),{handle:a}))}function Ym(n,t){return wi(ve(t),"from",{},i=>Object.assign(i,n)).newDoc}function lu(n,t,i){if(typeof t=="function")return wi(n,"change",{},t).newDoc;if(typeof i=="function")return typeof t=="string"&&(t={message:t}),wi(n,"change",t,i).newDoc;throw RangeError("Invalid args for change")}function Jm(n,t,i,s){if(typeof i=="function")return wi(n,"changeAt",{},i,t);if(typeof s=="function")return typeof i=="string"&&(i={message:i}),wi(n,"changeAt",i,s,t);throw RangeError("Invalid args for changeAt")}function Pi(n,t,i,s){if(i==null)return n;const r=Ut(n),a=Object.assign(Object.assign({},r),{heads:void 0}),{value:l,patches:u}=r.handle.applyAndReturnPatches(n,a);if(u.length>0){s?.(u,{before:n,after:l,source:t});const f=Ut(l);f.mostRecentPatch={before:Ut(n).heads,after:f.handle.getHeads(),patches:u}}return r.heads=i,l}function wi(n,t,i,s,r){if(typeof s!="function")throw new RangeError("invalid change function");const a=Ut(n);if(n===void 0||a===void 0)throw new RangeError("must be the document root");if(a.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(Vr(n))throw new RangeError("Calls to Automerge.change cannot be nested");let l=a.handle.getHeads();r&&tg(r,l)&&(r=void 0),r&&(a.handle.isolate(r),l=r),"time"in i||(i.time=Math.floor(Date.now()/1e3));try{a.heads=l;const u=Vm(a.handle);if(s(u),a.handle.pendingOps()===0)return a.heads=void 0,r&&a.handle.integrate(),{newDoc:n,newHeads:null};{const f=a.handle.commit(i.message,i.time);return a.handle.integrate(),{newDoc:Pi(n,t,l,i.patchCallback||a.patchCallback),newHeads:f!=null?[f]:null}}}catch(u){throw a.heads=void 0,a.handle.rollback(),u}}function Xm(n,t){t===void 0&&(t={}),typeof t=="string"&&(t={message:t}),"time"in t||(t.time=Math.floor(Date.now()/1e3));const i=Ut(n);if(i.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(Vr(n))throw new RangeError("Calls to Automerge.change cannot be nested");const s=i.handle.getHeads();return i.handle.emptyChange(t.message,t.time),Pi(n,"emptyChange",s)}function Qm(n,t){const i=Ds(t);if(i.patchCallback)return Os(ve(i),n);const s=i.actor,r=i.patchCallback,a=i.unchecked||!1,l=i.allowMissingChanges||!1,u=i.convertImmutableStringsToText||!1,f=ne.load(n,{actor:s,unchecked:a,allowMissingDeps:l,convertImmutableStringsToText:u});return f.enableFreeze(!!i.freeze),fu(f),f.materialize("/",void 0,{handle:f,heads:void 0,patchCallback:r})}function Os(n,t,i){i||(i={});const s=Ut(n);if(s.heads)throw new RangeError("Attempting to change an out of date document - set at: "+cu(n));if(Vr(n))throw new RangeError("Calls to Automerge.change cannot be nested");const r=s.handle.getHeads();return s.handle.loadIncremental(t),Pi(n,"loadIncremental",r,i.patchCallback||s.patchCallback)}function hu(n){return Ut(n).handle.save()}function vc(n,t){const i=Ut(n);if(i.heads)throw new RangeError("Attempting to change an out of date document - set at: "+cu(n));const s=i.handle.getHeads(),r=Ut(t),a=i.handle.getChangesAdded(r.handle);return i.handle.applyChanges(a),Pi(n,"merge",s,i.patchCallback)}function Do(n,t,i){bc(t,"before"),bc(i,"after");const s=Ut(n);return s.mostRecentPatch&&ls(s.mostRecentPatch.before,t)&&ls(s.mostRecentPatch.after,i)?s.mostRecentPatch.patches:s.handle.diff(t,i)}function tg(n,t){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(n[i]!==t[i])return!1;return!0}function bc(n,t){if(!Array.isArray(n))throw new Error(`${t} must be an array`)}function ls(n,t){if(!wc(n)||!wc(t))return n===t;const i=Object.keys(n).sort(),s=Object.keys(t).sort();if(i.length!==s.length)return!1;for(let r=0;r<i.length;r++)if(i[r]!==s[r]||!ls(n[i[r]],t[s[r]]))return!1;return!0}function uu(n){const t=ne.importSyncState(n),i=ne.encodeSyncState(t);return t.free(),i}function du(n){const t=ne.decodeSyncState(n),i=ne.exportSyncState(t);return t.free(),i}function eg(n,t){const i=Ut(n),s=ne.importSyncState(t),r=i.handle.generateSyncMessage(s);return[ne.exportSyncState(s),r]}function ng(n,t,i,s){const r=ne.importSyncState(t);s||(s={});const a=Ut(n);if(a.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(Vr(n))throw new RangeError("Calls to Automerge.change cannot be nested");const l=a.handle.getHeads();a.handle.receiveSyncMessage(r,i);const u=ne.exportSyncState(r);return[Pi(n,"receiveSyncMessage",l,s.patchCallback||a.patchCallback),u,null]}function ig(){return ne.exportSyncState(ne.initSyncState())}function rg(n){return ne.decodeSyncMessage(n)}function Fe(n){const t=Ut(n);return t.heads||t.handle.getHeads()}function wc(n){return typeof n=="object"&&n!==null}function og(n,t){return Ut(n).handle.saveSince(t)}function fu(n){n.registerDatatype("counter",t=>new cs(t),t=>{if(t instanceof cs)return t.value}),n.registerDatatype("str",t=>new su(t),t=>{if(au(t))return t.val})}function sg(n){return Ut(n).handle.topoHistoryTraversal()}function ag(n,t){return Ut(n).handle.getDecodedChangeByHash(t)}function Bs(n){return Ut(n).handle.stats()}C_(Rm);function Gr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var tr={exports:{}},Oo,xc;function cg(){if(xc)return Oo;xc=1;var n=1e3,t=n*60,i=t*60,s=i*24,r=s*7,a=s*365.25;Oo=function(g,p){p=p||{};var m=typeof g;if(m==="string"&&g.length>0)return l(g);if(m==="number"&&isFinite(g))return p.long?f(g):u(g);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(g))};function l(g){if(g=String(g),!(g.length>100)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(g);if(p){var m=parseFloat(p[1]),v=(p[2]||"ms").toLowerCase();switch(v){case"years":case"year":case"yrs":case"yr":case"y":return m*a;case"weeks":case"week":case"w":return m*r;case"days":case"day":case"d":return m*s;case"hours":case"hour":case"hrs":case"hr":case"h":return m*i;case"minutes":case"minute":case"mins":case"min":case"m":return m*t;case"seconds":case"second":case"secs":case"sec":case"s":return m*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return m;default:return}}}}function u(g){var p=Math.abs(g);return p>=s?Math.round(g/s)+"d":p>=i?Math.round(g/i)+"h":p>=t?Math.round(g/t)+"m":p>=n?Math.round(g/n)+"s":g+"ms"}function f(g){var p=Math.abs(g);return p>=s?_(g,p,s,"day"):p>=i?_(g,p,i,"hour"):p>=t?_(g,p,t,"minute"):p>=n?_(g,p,n,"second"):g+" ms"}function _(g,p,m,v){var b=p>=m*1.5;return Math.round(g/m)+" "+v+(b?"s":"")}return Oo}var Bo,Lc;function lg(){if(Lc)return Bo;Lc=1;function n(t){s.debug=s,s.default=s,s.coerce=_,s.disable=u,s.enable=a,s.enabled=f,s.humanize=cg(),s.destroy=g,Object.keys(t).forEach(p=>{s[p]=t[p]}),s.names=[],s.skips=[],s.formatters={};function i(p){let m=0;for(let v=0;v<p.length;v++)m=(m<<5)-m+p.charCodeAt(v),m|=0;return s.colors[Math.abs(m)%s.colors.length]}s.selectColor=i;function s(p){let m,v=null,b,S;function C(...V){if(!C.enabled)return;const A=C,w=Number(new Date),F=w-(m||w);A.diff=F,A.prev=m,A.curr=w,m=w,V[0]=s.coerce(V[0]),typeof V[0]!="string"&&V.unshift("%O");let O=0;V[0]=V[0].replace(/%([a-zA-Z%])/g,(nt,Q)=>{if(nt==="%%")return"%";O++;const N=s.formatters[Q];if(typeof N=="function"){const G=V[O];nt=N.call(A,G),V.splice(O,1),O--}return nt}),s.formatArgs.call(A,V),(A.log||s.log).apply(A,V)}return C.namespace=p,C.useColors=s.useColors(),C.color=s.selectColor(p),C.extend=r,C.destroy=s.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>v!==null?v:(b!==s.namespaces&&(b=s.namespaces,S=s.enabled(p)),S),set:V=>{v=V}}),typeof s.init=="function"&&s.init(C),C}function r(p,m){const v=s(this.namespace+(typeof m>"u"?":":m)+p);return v.log=this.log,v}function a(p){s.save(p),s.namespaces=p,s.names=[],s.skips=[];const m=(typeof p=="string"?p:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const v of m)v[0]==="-"?s.skips.push(v.slice(1)):s.names.push(v)}function l(p,m){let v=0,b=0,S=-1,C=0;for(;v<p.length;)if(b<m.length&&(m[b]===p[v]||m[b]==="*"))m[b]==="*"?(S=b,C=v,b++):(v++,b++);else if(S!==-1)b=S+1,C++,v=C;else return!1;for(;b<m.length&&m[b]==="*";)b++;return b===m.length}function u(){const p=[...s.names,...s.skips.map(m=>"-"+m)].join(",");return s.enable(""),p}function f(p){for(const m of s.skips)if(l(p,m))return!1;for(const m of s.names)if(l(p,m))return!0;return!1}function _(p){return p instanceof Error?p.stack||p.message:p}function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}return Bo=n,Bo}var Sc;function hg(){return Sc||(Sc=1,(function(n,t){var i={};t.formatArgs=r,t.save=a,t.load=l,t.useColors=s,t.storage=u(),t.destroy=(()=>{let _=!1;return()=>{_||(_=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let _;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(_=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(_[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(_){if(_[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+_[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const g="color: "+this.color;_.splice(1,0,g,"color: inherit");let p=0,m=0;_[0].replace(/%[a-zA-Z%]/g,v=>{v!=="%%"&&(p++,v==="%c"&&(m=p))}),_.splice(m,0,g)}t.log=console.debug||console.log||(()=>{});function a(_){try{_?t.storage.setItem("debug",_):t.storage.removeItem("debug")}catch{}}function l(){let _;try{_=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!_&&typeof process<"u"&&"env"in process&&(_=i.DEBUG),_}function u(){try{return localStorage}catch{}}n.exports=lg()(t);const{formatters:f}=n.exports;f.j=function(_){try{return JSON.stringify(_)}catch(g){return"[UnexpectedJSONParseError]: "+g.message}}})(tr,tr.exports)),tr.exports}var ug=hg();const We=Gr(ug);var zo={exports:{}},Ec;function dg(){return Ec||(Ec=1,(function(n){var t=Object.prototype.hasOwnProperty,i="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(i=!1));function r(f,_,g){this.fn=f,this.context=_,this.once=g||!1}function a(f,_,g,p,m){if(typeof g!="function")throw new TypeError("The listener must be a function");var v=new r(g,p||f,m),b=i?i+_:_;return f._events[b]?f._events[b].fn?f._events[b]=[f._events[b],v]:f._events[b].push(v):(f._events[b]=v,f._eventsCount++),f}function l(f,_){--f._eventsCount===0?f._events=new s:delete f._events[_]}function u(){this._events=new s,this._eventsCount=0}u.prototype.eventNames=function(){var _=[],g,p;if(this._eventsCount===0)return _;for(p in g=this._events)t.call(g,p)&&_.push(i?p.slice(1):p);return Object.getOwnPropertySymbols?_.concat(Object.getOwnPropertySymbols(g)):_},u.prototype.listeners=function(_){var g=i?i+_:_,p=this._events[g];if(!p)return[];if(p.fn)return[p.fn];for(var m=0,v=p.length,b=new Array(v);m<v;m++)b[m]=p[m].fn;return b},u.prototype.listenerCount=function(_){var g=i?i+_:_,p=this._events[g];return p?p.fn?1:p.length:0},u.prototype.emit=function(_,g,p,m,v,b){var S=i?i+_:_;if(!this._events[S])return!1;var C=this._events[S],V=arguments.length,A,w;if(C.fn){switch(C.once&&this.removeListener(_,C.fn,void 0,!0),V){case 1:return C.fn.call(C.context),!0;case 2:return C.fn.call(C.context,g),!0;case 3:return C.fn.call(C.context,g,p),!0;case 4:return C.fn.call(C.context,g,p,m),!0;case 5:return C.fn.call(C.context,g,p,m,v),!0;case 6:return C.fn.call(C.context,g,p,m,v,b),!0}for(w=1,A=new Array(V-1);w<V;w++)A[w-1]=arguments[w];C.fn.apply(C.context,A)}else{var F=C.length,O;for(w=0;w<F;w++)switch(C[w].once&&this.removeListener(_,C[w].fn,void 0,!0),V){case 1:C[w].fn.call(C[w].context);break;case 2:C[w].fn.call(C[w].context,g);break;case 3:C[w].fn.call(C[w].context,g,p);break;case 4:C[w].fn.call(C[w].context,g,p,m);break;default:if(!A)for(O=1,A=new Array(V-1);O<V;O++)A[O-1]=arguments[O];C[w].fn.apply(C[w].context,A)}}return!0},u.prototype.on=function(_,g,p){return a(this,_,g,p,!1)},u.prototype.once=function(_,g,p){return a(this,_,g,p,!0)},u.prototype.removeListener=function(_,g,p,m){var v=i?i+_:_;if(!this._events[v])return this;if(!g)return l(this,v),this;var b=this._events[v];if(b.fn)b.fn===g&&(!m||b.once)&&(!p||b.context===p)&&l(this,v);else{for(var S=0,C=[],V=b.length;S<V;S++)(b[S].fn!==g||m&&!b[S].once||p&&b[S].context!==p)&&C.push(b[S]);C.length?this._events[v]=C.length===1?C[0]:C:l(this,v)}return this},u.prototype.removeAllListeners=function(_){var g;return _?(g=i?i+_:_,this._events[g]&&l(this,g)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,n.exports=u})(zo)),zo.exports}var fg=dg();const wn=Gr(fg);function _g(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function pg(){const n=_g();if(n.__xstate__)return n.__xstate__}const mg=n=>{if(typeof window>"u")return;const t=pg();t&&t.register(n)};class kc{constructor(t){this._process=t,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(t){const i={value:t,next:null};if(this._current){this._last.next=i,this._last=i;return}this._current=i,this._last=i,this._active&&this.flush()}flush(){for(;this._current;){const t=this._current;this._process(t.value),this._current=t.next}this._last=null}}const _u=".",gg="",pu="",yg="#",vg="*",mu="xstate.init",bg="xstate.error",hs="xstate.stop";function wg(n,t){return{type:`xstate.after.${n}.${t}`}}function us(n,t){return{type:`xstate.done.state.${n}`,output:t}}function xg(n,t){return{type:`xstate.done.actor.${n}`,output:t,actorId:n}}function gu(n,t){return{type:`xstate.error.actor.${n}`,error:t,actorId:n}}function yu(n){return{type:mu,input:n}}function Ee(n){setTimeout(()=>{throw n})}const Lg=typeof Symbol=="function"&&Symbol.observable||"@@observable";function vu(n,t){const i=Tc(n),s=Tc(t);return typeof s=="string"?typeof i=="string"?s===i:!1:typeof i=="string"?i in s:Object.keys(i).every(r=>r in s?vu(i[r],s[r]):!1)}function zs(n){if(wu(n))return n;const t=[];let i="";for(let s=0;s<n.length;s++){switch(n.charCodeAt(s)){case 92:i+=n[s+1],s++;continue;case 46:t.push(i),i="";continue}i+=n[s]}return t.push(i),t}function Tc(n){if(ey(n))return n.value;if(typeof n!="string")return n;const t=zs(n);return Sg(t)}function Sg(n){if(n.length===1)return n[0];const t={};let i=t;for(let s=0;s<n.length-1;s++)if(s===n.length-2)i[n[s]]=n[s+1];else{const r=i;i={},r[n[s]]=i}return t}function Cc(n,t){const i={},s=Object.keys(n);for(let r=0;r<s.length;r++){const a=s[r];i[a]=t(n[a],a,n,r)}return i}function bu(n){return wu(n)?n:[n]}function Ne(n){return n===void 0?[]:bu(n)}function ds(n,t,i,s){return typeof n=="function"?n({context:t,event:i,self:s}):n}function wu(n){return Array.isArray(n)}function Eg(n){return n.type.startsWith("xstate.error.actor")}function Hn(n){return bu(n).map(t=>typeof t>"u"||typeof t=="string"?{target:t}:t)}function xu(n){if(!(n===void 0||n===gg))return Ne(n)}function fs(n,t,i){const s=typeof n=="object",r=s?n:void 0;return{next:(s?n.next:n)?.bind(r),error:(s?n.error:t)?.bind(r),complete:(s?n.complete:i)?.bind(r)}}function Mc(n,t){return`${t}.${n}`}function Rs(n,t){const i=t.match(/^xstate\.invoke\.(\d+)\.(.*)/);if(!i)return n.implementations.actors[t];const[,s,r]=i,l=n.getStateNodeById(r).config.invoke;return(Array.isArray(l)?l[s]:l).src}function Pc(n,t){return`${n.sessionId}.${t}`}let kg=0;function Tg(n,t){const i=new Map,s=new Map,r=new WeakMap,a=new Set,l={},{clock:u,logger:f}=t,_={schedule:(m,v,b,S,C=Math.random().toString(36).slice(2))=>{const V={source:m,target:v,event:b,delay:S,id:C,startedAt:Date.now()},A=Pc(m,C);p._snapshot._scheduledEvents[A]=V;const w=u.setTimeout(()=>{delete l[A],delete p._snapshot._scheduledEvents[A],p._relay(m,v,b)},S);l[A]=w},cancel:(m,v)=>{const b=Pc(m,v),S=l[b];delete l[b],delete p._snapshot._scheduledEvents[b],S!==void 0&&u.clearTimeout(S)},cancelAll:m=>{for(const v in p._snapshot._scheduledEvents){const b=p._snapshot._scheduledEvents[v];b.source===m&&_.cancel(m,b.id)}}},g=m=>{if(!a.size)return;const v={...m,rootId:n.sessionId};a.forEach(b=>b.next?.(v))},p={_snapshot:{_scheduledEvents:(t?.snapshot&&t.snapshot.scheduler)??{}},_bookId:()=>`x:${kg++}`,_register:(m,v)=>(i.set(m,v),m),_unregister:m=>{i.delete(m.sessionId);const v=r.get(m);v!==void 0&&(s.delete(v),r.delete(m))},get:m=>s.get(m),_set:(m,v)=>{const b=s.get(m);if(b&&b!==v)throw new Error(`Actor with system ID '${m}' already exists.`);s.set(m,v),r.set(v,m)},inspect:m=>{const v=fs(m);return a.add(v),{unsubscribe(){a.delete(v)}}},_sendInspectionEvent:g,_relay:(m,v,b)=>{p._sendInspectionEvent({type:"@xstate.event",sourceRef:m,actorRef:v,event:b}),v._send(b)},scheduler:_,getSnapshot:()=>({_scheduledEvents:{...p._snapshot._scheduledEvents}}),start:()=>{const m=p._snapshot._scheduledEvents;p._snapshot._scheduledEvents={};for(const v in m){const{source:b,target:S,event:C,delay:V,id:A}=m[v];_.schedule(b,S,C,V,A)}},_clock:u,_logger:f};return p}let Ro=!1;const Hs=1;let Qt=(function(n){return n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped",n})({});const Cg={clock:{setTimeout:(n,t)=>setTimeout(n,t),clearTimeout:n=>clearTimeout(n)},logger:console.log.bind(console),devTools:!1};class Mg{constructor(t,i){this.logic=t,this._snapshot=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new kc(this._process.bind(this)),this.observers=new Set,this.eventListeners=new Map,this.logger=void 0,this._processingStatus=Qt.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this.systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const s={...Cg,...i},{clock:r,logger:a,parent:l,syncSnapshot:u,id:f,systemId:_,inspect:g}=s;this.system=l?l.system:Tg(this,{clock:r,logger:a}),g&&!l&&this.system.inspect(fs(g)),this.sessionId=this.system._bookId(),this.id=f??this.sessionId,this.logger=i?.logger??this.system._logger,this.clock=i?.clock??this.system._clock,this._parent=l,this._syncSnapshot=u,this.options=s,this.src=s.src??t,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:p=>{this._deferred.push(p)},system:this.system,stopChild:p=>{if(p._parent!==this)throw new Error(`Cannot stop child actor ${p.id} of ${this.id} because it is not a child`);p._stop()},emit:p=>{const m=this.eventListeners.get(p.type),v=this.eventListeners.get("*");if(!m&&!v)return;const b=[...m?m.values():[],...v?v.values():[]];for(const S of b)try{S(p)}catch(C){Ee(C)}},actionExecutor:p=>{const m=()=>{if(this._actorScope.system._sendInspectionEvent({type:"@xstate.action",actorRef:this,action:{type:p.type,params:p.params}}),!p.exec)return;const v=Ro;try{Ro=!0,p.exec(p.info,p.params)}finally{Ro=v}};this._processingStatus===Qt.Running?m():this._deferred.push(m)}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),_&&(this.systemId=_,this.system._set(_,this)),this._initState(i?.snapshot??i?.state),_&&this._snapshot.status!=="active"&&this.system._unregister(this)}_initState(t){try{this._snapshot=t?this.logic.restoreSnapshot?this.logic.restoreSnapshot(t,this._actorScope):t:this.logic.getInitialSnapshot(this._actorScope,this.options?.input)}catch(i){this._snapshot={status:"error",output:void 0,error:i}}}update(t,i){this._snapshot=t;let s;for(;s=this._deferred.shift();)try{s()}catch(r){this._deferred.length=0,this._snapshot={...t,status:"error",error:r}}switch(this._snapshot.status){case"active":for(const r of this.observers)try{r.next?.(t)}catch(a){Ee(a)}break;case"done":for(const r of this.observers)try{r.next?.(t)}catch(a){Ee(a)}this._stopProcedure(),this._complete(),this._doneEvent=xg(this.id,this._snapshot.output),this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._error(this._snapshot.error);break}this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:i,snapshot:t})}subscribe(t,i,s){const r=fs(t,i,s);if(this._processingStatus!==Qt.Stopped)this.observers.add(r);else switch(this._snapshot.status){case"done":try{r.complete?.()}catch(a){Ee(a)}break;case"error":{const a=this._snapshot.error;if(!r.error)Ee(a);else try{r.error(a)}catch(l){Ee(l)}break}}return{unsubscribe:()=>{this.observers.delete(r)}}}on(t,i){let s=this.eventListeners.get(t);s||(s=new Set,this.eventListeners.set(t,s));const r=i.bind(void 0);return s.add(r),{unsubscribe:()=>{s.delete(r)}}}start(){if(this._processingStatus===Qt.Running)return this;this._syncSnapshot&&this.subscribe({next:s=>{s.status==="active"&&this.system._relay(this,this._parent,{type:`xstate.snapshot.${this.id}`,snapshot:s})},error:()=>{}}),this.system._register(this.sessionId,this),this.systemId&&this.system._set(this.systemId,this),this._processingStatus=Qt.Running;const t=yu(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:t}),this._snapshot.status){case"done":return this.update(this._snapshot,t),this;case"error":return this._error(this._snapshot.error),this}if(this._parent||this.system.start(),this.logic.start)try{this.logic.start(this._snapshot,this._actorScope)}catch(s){return this._snapshot={...this._snapshot,status:"error",error:s},this._error(s),this}return this.update(this._snapshot,t),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(t){let i,s;try{i=this.logic.transition(this._snapshot,t,this._actorScope)}catch(r){s={err:r}}if(s){const{err:r}=s;this._snapshot={...this._snapshot,status:"error",error:r},this._error(r);return}this.update(i,t),t.type===hs&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===Qt.Stopped?this:(this.mailbox.clear(),this._processingStatus===Qt.NotStarted?(this._processingStatus=Qt.Stopped,this):(this.mailbox.enqueue({type:hs}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){for(const t of this.observers)try{t.complete?.()}catch(i){Ee(i)}this.observers.clear()}_reportError(t){if(!this.observers.size){this._parent||Ee(t);return}let i=!1;for(const s of this.observers){const r=s.error;i||=!r;try{r?.(t)}catch(a){Ee(a)}}this.observers.clear(),i&&Ee(t)}_error(t){this._stopProcedure(),this._reportError(t),this._parent&&this.system._relay(this,this._parent,gu(this.id,t))}_stopProcedure(){return this._processingStatus!==Qt.Running?this:(this.system.scheduler.cancelAll(this),this.mailbox.clear(),this.mailbox=new kc(this._process.bind(this)),this._processingStatus=Qt.Stopped,this.system._unregister(this),this)}_send(t){this._processingStatus!==Qt.Stopped&&this.mailbox.enqueue(t)}send(t){this.system._relay(void 0,this,t)}attachDevTools(){const{devTools:t}=this.options;t&&(typeof t=="function"?t:mg)(this)}toJSON(){return{xstate$$type:Hs,id:this.id}}getPersistedSnapshot(t){return this.logic.getPersistedSnapshot(this._snapshot,t)}[Lg](){return this}getSnapshot(){return this._snapshot}}function xi(n,...[t]){return new Mg(n,t)}function Pg(n,t,i,s,{sendId:r}){const a=typeof r=="function"?r(i,s):r;return[t,{sendId:a},void 0]}function Ig(n,t){n.defer(()=>{n.system.scheduler.cancel(n.self,t.sendId)})}function js(n){function t(i,s){}return t.type="xstate.cancel",t.sendId=n,t.resolve=Pg,t.execute=Ig,t}function Ag(n,t,i,s,{id:r,systemId:a,src:l,input:u,syncSnapshot:f}){const _=typeof l=="string"?Rs(t.machine,l):l,g=typeof r=="function"?r(i):r;let p,m;return _&&(m=typeof u=="function"?u({context:t.context,event:i.event,self:n.self}):u,p=xi(_,{id:g,src:l,parent:n.self,syncSnapshot:f,systemId:a,input:m})),[yn(t,{children:{...t.children,[g]:p}}),{id:r,systemId:a,actorRef:p,src:l,input:m},void 0]}function Dg(n,{actorRef:t}){t&&n.defer(()=>{t._processingStatus!==Qt.Stopped&&t.start()})}function Us(...[n,{id:t,systemId:i,input:s,syncSnapshot:r=!1}={}]){function a(l,u){}return a.type="xstate.spawnChild",a.id=t,a.systemId=i,a.src=n,a.input=s,a.syncSnapshot=r,a.resolve=Ag,a.execute=Dg,a}function Og(n,t,i,s,{actorRef:r}){const a=typeof r=="function"?r(i,s):r,l=typeof a=="string"?t.children[a]:a;let u=t.children;return l&&(u={...u},delete u[l.id]),[yn(t,{children:u}),l,void 0]}function Bg(n,t){if(t){if(n.system._unregister(t),t._processingStatus!==Qt.Running){n.stopChild(t);return}n.defer(()=>{n.stopChild(t)})}}function Wr(n){function t(i,s){}return t.type="xstate.stopChild",t.actorRef=n,t.resolve=Og,t.execute=Bg,t}function qr(n,t,i,s){const{machine:r}=s,a=typeof n=="function",l=a?n:r.implementations.guards[typeof n=="string"?n:n.type];if(!a&&!l)throw new Error(`Guard '${typeof n=="string"?n:n.type}' is not implemented.'.`);if(typeof l!="function")return qr(l,t,i,s);const u={context:t,event:i},f=a||typeof n=="string"?void 0:"params"in n?typeof n.params=="function"?n.params({context:t,event:i}):n.params:void 0;return"check"in l?l.check(s,u,l):l(u,f)}const Fs=n=>n.type==="atomic"||n.type==="final";function $n(n){return Object.values(n.states).filter(t=>t.type!=="history")}function Ii(n,t){const i=[];if(t===n)return i;let s=n.parent;for(;s&&s!==t;)i.push(s),s=s.parent;return i}function Tr(n){const t=new Set(n),i=Su(t);for(const s of t)if(s.type==="compound"&&(!i.get(s)||!i.get(s).length))Ic(s).forEach(r=>t.add(r));else if(s.type==="parallel"){for(const r of $n(s))if(r.type!=="history"&&!t.has(r)){const a=Ic(r);for(const l of a)t.add(l)}}for(const s of t){let r=s.parent;for(;r;)t.add(r),r=r.parent}return t}function Lu(n,t){const i=t.get(n);if(!i)return{};if(n.type==="compound"){const r=i[0];if(r){if(Fs(r))return r.key}else return{}}const s={};for(const r of i)s[r.key]=Lu(r,t);return s}function Su(n){const t=new Map;for(const i of n)t.has(i)||t.set(i,[]),i.parent&&(t.has(i.parent)||t.set(i.parent,[]),t.get(i.parent).push(i));return t}function Eu(n,t){const i=Tr(t);return Lu(n,Su(i))}function Ns(n,t){return t.type==="compound"?$n(t).some(i=>i.type==="final"&&n.has(i)):t.type==="parallel"?$n(t).every(i=>Ns(n,i)):t.type==="final"}const Kr=n=>n[0]===yg;function zg(n,t){return n.transitions.get(t)||[...n.transitions.keys()].filter(s=>{if(s===vg)return!0;if(!s.endsWith(".*"))return!1;const r=s.split("."),a=t.split(".");for(let l=0;l<r.length;l++){const u=r[l],f=a[l];if(u==="*")return l===r.length-1;if(u!==f)return!1}return!0}).sort((s,r)=>r.length-s.length).flatMap(s=>n.transitions.get(s))}function Rg(n){const t=n.config.after;if(!t)return[];const i=r=>{const a=wg(r,n.id),l=a.type;return n.entry.push(Vs(a,{id:l,delay:r})),n.exit.push(js(l)),l};return Object.keys(t).flatMap(r=>{const a=t[r],l=typeof a=="string"?{target:a}:a,u=Number.isNaN(+r)?r:+r,f=i(u);return Ne(l).map(_=>({..._,event:f,delay:u}))}).map(r=>{const{delay:a}=r;return{...dn(n,r.event,r),delay:a}})}function dn(n,t,i){const s=xu(i.target),r=i.reenter??!1,a=Ug(n,s),l={...i,actions:Ne(i.actions),guard:i.guard,target:a,source:n,reenter:r,eventType:t,toJSON:()=>({...l,source:`#${n.id}`,target:a?a.map(u=>`#${u.id}`):void 0})};return l}function Hg(n){const t=new Map;if(n.config.on)for(const i of Object.keys(n.config.on)){if(i===pu)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const s=n.config.on[i];t.set(i,Hn(s).map(r=>dn(n,i,r)))}if(n.config.onDone){const i=`xstate.done.state.${n.id}`;t.set(i,Hn(n.config.onDone).map(s=>dn(n,i,s)))}for(const i of n.invoke){if(i.onDone){const s=`xstate.done.actor.${i.id}`;t.set(s,Hn(i.onDone).map(r=>dn(n,s,r)))}if(i.onError){const s=`xstate.error.actor.${i.id}`;t.set(s,Hn(i.onError).map(r=>dn(n,s,r)))}if(i.onSnapshot){const s=`xstate.snapshot.${i.id}`;t.set(s,Hn(i.onSnapshot).map(r=>dn(n,s,r)))}}for(const i of n.after){let s=t.get(i.eventType);s||(s=[],t.set(i.eventType,s)),s.push(i)}return t}function jg(n,t){const i=typeof t=="string"?n.states[t]:t?n.states[t.target]:void 0;if(!i&&t)throw new Error(`Initial state node "${t}" not found on parent state node #${n.id}`);const s={source:n,actions:!t||typeof t=="string"?[]:Ne(t.actions),eventType:null,reenter:!1,target:i?[i]:[],toJSON:()=>({...s,source:`#${n.id}`,target:i?[`#${i.id}`]:[]})};return s}function Ug(n,t){if(t!==void 0)return t.map(i=>{if(typeof i!="string")return i;if(Kr(i))return n.machine.getStateNodeById(i);const s=i[0]===_u;if(s&&!n.parent)return Cr(n,i.slice(1));const r=s?n.key+i:i;if(n.parent)try{return Cr(n.parent,r)}catch(a){throw new Error(`Invalid transition definition for state node '${n.id}':
${a.message}`)}else throw new Error(`Invalid target: "${i}" is not a valid target from the root node. Did you mean ".${i}"?`)})}function ku(n){const t=xu(n.config.target);return t?{target:t.map(i=>typeof i=="string"?Cr(n.parent,i):i)}:n.parent.initial}function _n(n){return n.type==="history"}function Ic(n){const t=Tu(n);for(const i of t)for(const s of Ii(i,n))t.add(s);return t}function Tu(n){const t=new Set;function i(s){if(!t.has(s)){if(t.add(s),s.type==="compound")i(s.initial.target[0]);else if(s.type==="parallel")for(const r of $n(s))i(r)}}return i(n),t}function Zn(n,t){if(Kr(t))return n.machine.getStateNodeById(t);if(!n.states)throw new Error(`Unable to retrieve child state '${t}' from '${n.id}'; no child states exist.`);const i=n.states[t];if(!i)throw new Error(`Child state '${t}' does not exist on '${n.id}'`);return i}function Cr(n,t){if(typeof t=="string"&&Kr(t))try{return n.machine.getStateNodeById(t)}catch{}const i=zs(t).slice();let s=n;for(;i.length;){const r=i.shift();if(!r.length)break;s=Zn(s,r)}return s}function Mr(n,t){if(typeof t=="string"){const r=n.states[t];if(!r)throw new Error(`State '${t}' does not exist on '${n.id}'`);return[n,r]}const i=Object.keys(t),s=i.map(r=>Zn(n,r)).filter(Boolean);return[n.machine.root,n].concat(s,i.reduce((r,a)=>{const l=Zn(n,a);if(!l)return r;const u=Mr(l,t[a]);return r.concat(u)},[]))}function Fg(n,t,i,s){const a=Zn(n,t).next(i,s);return!a||!a.length?n.next(i,s):a}function Ng(n,t,i,s){const r=Object.keys(t),a=Zn(n,r[0]),l=$s(a,t[r[0]],i,s);return!l||!l.length?n.next(i,s):l}function $g(n,t,i,s){const r=[];for(const a of Object.keys(t)){const l=t[a];if(!l)continue;const u=Zn(n,a),f=$s(u,l,i,s);f&&r.push(...f)}return r.length?r:n.next(i,s)}function $s(n,t,i,s){return typeof t=="string"?Fg(n,t,i,s):Object.keys(t).length===1?Ng(n,t,i,s):$g(n,t,i,s)}function Zg(n){return Object.keys(n.states).map(t=>n.states[t]).filter(t=>t.type==="history")}function tn(n,t){let i=n;for(;i.parent&&i.parent!==t;)i=i.parent;return i.parent===t}function Vg(n,t){const i=new Set(n),s=new Set(t);for(const r of i)if(s.has(r))return!0;for(const r of s)if(i.has(r))return!0;return!1}function Cu(n,t,i){const s=new Set;for(const r of n){let a=!1;const l=new Set;for(const u of s)if(Vg(_s([r],t,i),_s([u],t,i)))if(tn(r.source,u.source))l.add(u);else{a=!0;break}if(!a){for(const u of l)s.delete(u);s.add(r)}}return Array.from(s)}function Gg(n){const[t,...i]=n;for(const s of Ii(t,void 0))if(i.every(r=>tn(r,s)))return s}function Zs(n,t){if(!n.target)return[];const i=new Set;for(const s of n.target)if(_n(s))if(t[s.id])for(const r of t[s.id])i.add(r);else for(const r of Zs(ku(s),t))i.add(r);else i.add(s);return[...i]}function Mu(n,t){const i=Zs(n,t);if(!i)return;if(!n.reenter&&i.every(r=>r===n.source||tn(r,n.source)))return n.source;const s=Gg(i.concat(n.source));if(s)return s;if(!n.reenter)return n.source.machine.root}function _s(n,t,i){const s=new Set;for(const r of n)if(r.target?.length){const a=Mu(r,i);r.reenter&&r.source===a&&s.add(a);for(const l of t)tn(l,a)&&s.add(l)}return[...s]}function Wg(n,t){if(n.length!==t.size)return!1;for(const i of n)if(!t.has(i))return!1;return!0}function ps(n,t,i,s,r,a){if(!n.length)return t;const l=new Set(t._nodes);let u=t.historyValue;const f=Cu(n,l,u);let _=t;r||([_,u]=Jg(_,s,i,f,l,u,a,i.actionExecutor)),_=Vn(_,s,i,f.flatMap(p=>p.actions),a,void 0),_=Kg(_,s,i,f,l,a,u,r);const g=[...l];_.status==="done"&&(_=Vn(_,s,i,g.sort((p,m)=>m.order-p.order).flatMap(p=>p.exit),a,void 0));try{return u===t.historyValue&&Wg(t._nodes,l)?_:yn(_,{_nodes:g,historyValue:u})}catch(p){throw p}}function qg(n,t,i,s,r){if(s.output===void 0)return;const a=us(r.id,r.output!==void 0&&r.parent?ds(r.output,n.context,t,i.self):void 0);return ds(s.output,n.context,a,i.self)}function Kg(n,t,i,s,r,a,l,u){let f=n;const _=new Set,g=new Set;Yg(s,l,g,_),u&&g.add(n.machine.root);const p=new Set;for(const m of[..._].sort((v,b)=>v.order-b.order)){r.add(m);const v=[];v.push(...m.entry);for(const b of m.invoke)v.push(Us(b.src,{...b,syncSnapshot:!!b.onSnapshot}));if(g.has(m)){const b=m.initial.actions;v.push(...b)}if(f=Vn(f,t,i,v,a,m.invoke.map(b=>b.id)),m.type==="final"){const b=m.parent;let S=b?.type==="parallel"?b:b?.parent,C=S||m;for(b?.type==="compound"&&a.push(us(b.id,m.output!==void 0?ds(m.output,f.context,t,i.self):void 0));S?.type==="parallel"&&!p.has(S)&&Ns(r,S);)p.add(S),a.push(us(S.id)),C=S,S=S.parent;if(S)continue;f=yn(f,{status:"done",output:qg(f,t,i,f.machine.root,C)})}}return f}function Yg(n,t,i,s){for(const r of n){const a=Mu(r,t);for(const u of r.target||[])!_n(u)&&(r.source!==u||r.source!==a||r.reenter)&&(s.add(u),i.add(u)),Un(u,t,i,s);const l=Zs(r,t);for(const u of l){const f=Ii(u,a);a?.type==="parallel"&&f.push(a),Pu(s,t,i,f,!r.source.parent&&r.reenter?void 0:a)}}}function Un(n,t,i,s){if(_n(n))if(t[n.id]){const r=t[n.id];for(const a of r)s.add(a),Un(a,t,i,s);for(const a of r)Ho(a,n.parent,s,t,i)}else{const r=ku(n);for(const a of r.target)s.add(a),r===n.parent?.initial&&i.add(n.parent),Un(a,t,i,s);for(const a of r.target)Ho(a,n.parent,s,t,i)}else if(n.type==="compound"){const[r]=n.initial.target;_n(r)||(s.add(r),i.add(r)),Un(r,t,i,s),Ho(r,n,s,t,i)}else if(n.type==="parallel")for(const r of $n(n).filter(a=>!_n(a)))[...s].some(a=>tn(a,r))||(_n(r)||(s.add(r),i.add(r)),Un(r,t,i,s))}function Pu(n,t,i,s,r){for(const a of s)if((!r||tn(a,r))&&n.add(a),a.type==="parallel")for(const l of $n(a).filter(u=>!_n(u)))[...n].some(u=>tn(u,l))||(n.add(l),Un(l,t,i,n))}function Ho(n,t,i,s,r){Pu(i,s,r,Ii(n,t))}function Jg(n,t,i,s,r,a,l,u){let f=n;const _=_s(s,r,a);_.sort((p,m)=>m.order-p.order);let g;for(const p of _)for(const m of Zg(p)){let v;m.history==="deep"?v=b=>Fs(b)&&tn(b,p):v=b=>b.parent===p,g??={...a},g[m.id]=Array.from(r).filter(v)}for(const p of _)f=Vn(f,t,i,[...p.exit,...p.invoke.map(m=>Wr(m.id))],l,void 0),r.delete(p);return[f,g||a]}function Xg(n,t){return n.implementations.actions[t]}function Iu(n,t,i,s,r,a){const{machine:l}=n;let u=n;for(const f of s){const _=typeof f=="function",g=_?f:Xg(l,typeof f=="string"?f:f.type),p={context:u.context,event:t,self:i.self,system:i.system},m=_||typeof f=="string"?void 0:"params"in f?typeof f.params=="function"?f.params({context:u.context,event:t}):f.params:void 0;if(!g||!("resolve"in g)){i.actionExecutor({type:typeof f=="string"?f:typeof f=="object"?f.type:f.name||"(anonymous)",info:p,params:m,exec:g});continue}const v=g,[b,S,C]=v.resolve(i,u,p,m,g,r);u=b,"retryResolve"in v&&a?.push([v,S]),"execute"in v&&i.actionExecutor({type:v.type,info:p,params:S,exec:v.execute.bind(null,i,S)}),C&&(u=Iu(u,t,i,C,r,a))}return u}function Vn(n,t,i,s,r,a){const l=a?[]:void 0,u=Iu(n,t,i,s,{internalQueue:r,deferredActorIds:a},l);return l?.forEach(([f,_])=>{f.retryResolve(i,u,_)}),u}function jo(n,t,i,s){let r=n;const a=[];function l(_,g,p){i.system._sendInspectionEvent({type:"@xstate.microstep",actorRef:i.self,event:g,snapshot:_,_transitions:p}),a.push(_)}if(t.type===hs)return r=yn(Ac(r,t,i),{status:"stopped"}),l(r,t,[]),{snapshot:r,microstates:a};let u=t;if(u.type!==mu){const _=u,g=Eg(_),p=Dc(_,r);if(g&&!p.length)return r=yn(n,{status:"error",error:_.error}),l(r,_,[]),{snapshot:r,microstates:a};r=ps(p,n,i,u,!1,s),l(r,_,p)}let f=!0;for(;r.status==="active";){let _=f?Qg(r,u):[];const g=_.length?r:void 0;if(!_.length){if(!s.length)break;u=s.shift(),_=Dc(u,r)}r=ps(_,r,i,u,!1,s),f=r!==g,l(r,u,_)}return r.status!=="active"&&Ac(r,u,i),{snapshot:r,microstates:a}}function Ac(n,t,i){return Vn(n,t,i,Object.values(n.children).map(s=>Wr(s)),[],void 0)}function Dc(n,t){return t.machine.getTransitionData(t,n)}function Qg(n,t){const i=new Set,s=n._nodes.filter(Fs);for(const r of s)t:for(const a of[r].concat(Ii(r,void 0)))if(a.always){for(const l of a.always)if(l.guard===void 0||qr(l.guard,n.context,t,n)){i.add(l);break t}}return Cu(Array.from(i),new Set(n._nodes),n.historyValue)}function ty(n,t){const i=Tr(Mr(n,t));return Eu(n,[...i])}function ey(n){return!!n&&typeof n=="object"&&"machine"in n&&"value"in n}const ny=function(t){return vu(t,this.value)},iy=function(t){return this.tags.has(t)},ry=function(t){const i=this.machine.getTransitionData(this,t);return!!i?.length&&i.some(s=>s.target!==void 0||s.actions.length)},oy=function(){const{_nodes:t,tags:i,machine:s,getMeta:r,toJSON:a,can:l,hasTag:u,matches:f,..._}=this;return{..._,tags:Array.from(i)}},sy=function(){return this._nodes.reduce((t,i)=>(i.meta!==void 0&&(t[i.id]=i.meta),t),{})};function _r(n,t){return{status:n.status,output:n.output,error:n.error,machine:t,context:n.context,_nodes:n._nodes,value:Eu(t.root,n._nodes),tags:new Set(n._nodes.flatMap(i=>i.tags)),children:n.children,historyValue:n.historyValue||{},matches:ny,hasTag:iy,can:ry,getMeta:sy,toJSON:oy}}function yn(n,t={}){return _r({...n,...t},n.machine)}function ay(n){if(typeof n!="object"||n===null)return{};const t={};for(const i in n){const s=n[i];Array.isArray(s)&&(t[i]=s.map(r=>({id:r.id})))}return t}function cy(n,t){const{_nodes:i,tags:s,machine:r,children:a,context:l,can:u,hasTag:f,matches:_,getMeta:g,toJSON:p,...m}=n,v={};for(const S in a){const C=a[S];v[S]={snapshot:C.getPersistedSnapshot(t),src:C.src,systemId:C.systemId,syncSnapshot:C._syncSnapshot}}return{...m,context:Au(l),children:v,historyValue:ay(m.historyValue)}}function Au(n){let t;for(const i in n){const s=n[i];if(s&&typeof s=="object")if("sessionId"in s&&"send"in s&&"ref"in s)t??=Array.isArray(n)?n.slice():{...n},t[i]={xstate$$type:Hs,id:s.id};else{const r=Au(s);r!==s&&(t??=Array.isArray(n)?n.slice():{...n},t[i]=r)}}return t??n}function ly(n,t,i,s,{event:r,id:a,delay:l},{internalQueue:u}){const f=t.machine.implementations.delays;if(typeof r=="string")throw new Error(`Only event objects may be used with raise; use raise({ type: "${r}" }) instead`);const _=typeof r=="function"?r(i,s):r;let g;if(typeof l=="string"){const p=f&&f[l];g=typeof p=="function"?p(i,s):p}else g=typeof l=="function"?l(i,s):l;return typeof g!="number"&&u.push(_),[t,{event:_,id:a,delay:g},void 0]}function hy(n,t){const{event:i,delay:s,id:r}=t;if(typeof s=="number"){n.defer(()=>{const a=n.self;n.system.scheduler.schedule(a,a,i,s,r)});return}}function Vs(n,t){function i(s,r){}return i.type="xstate.raise",i.event=n,i.id=t?.id,i.delay=t?.delay,i.resolve=ly,i.execute=hy,i}function uy(n,{machine:t,context:i},s,r){const a=(l,u)=>{if(typeof l=="string"){const f=Rs(t,l);if(!f)throw new Error(`Actor logic '${l}' not implemented in machine '${t.id}'`);const _=xi(f,{id:u?.id,parent:n.self,syncSnapshot:u?.syncSnapshot,input:typeof u?.input=="function"?u.input({context:i,event:s,self:n.self}):u?.input,src:l,systemId:u?.systemId});return r[_.id]=_,_}else return xi(l,{id:u?.id,parent:n.self,syncSnapshot:u?.syncSnapshot,input:u?.input,src:l,systemId:u?.systemId})};return(l,u)=>{const f=a(l,u);return r[f.id]=f,n.defer(()=>{f._processingStatus!==Qt.Stopped&&f.start()}),f}}function dy(n,t,i,s,{assignment:r}){if(!t.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const a={},l={context:t.context,event:i.event,spawn:uy(n,t,i.event,a),self:n.self,system:n.system};let u={};if(typeof r=="function")u=r(l,s);else for(const _ of Object.keys(r)){const g=r[_];u[_]=typeof g=="function"?g(l,s):g}const f=Object.assign({},t.context,u);return[yn(t,{context:f,children:Object.keys(a).length?{...t.children,...a}:t.children}),void 0,void 0]}function pn(n){function t(i,s){}return t.type="xstate.assign",t.assignment=n,t.resolve=dy,t}const Oc=new WeakMap;function Bn(n,t,i){let s=Oc.get(n);return s?t in s||(s[t]=i()):(s={[t]:i()},Oc.set(n,s)),s[t]}const fy={},ai=n=>typeof n=="string"?{type:n}:typeof n=="function"?"resolve"in n?{type:n.type}:{type:n.name}:n;class Pr{constructor(t,i){if(this.config=t,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=i._parent,this.key=i._key,this.machine=i._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(_u),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?Cc(this.config.states,(s,r)=>new Pr(s,{_parent:this,_key:r,_machine:this.machine})):fy,this.type==="compound"&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=this.config.history===!0?"shallow":this.config.history||!1,this.entry=Ne(this.config.entry).slice(),this.exit=Ne(this.config.exit).slice(),this.meta=this.config.meta,this.output=this.type==="final"||!this.parent?this.config.output:void 0,this.tags=Ne(t.tags).slice()}_initialize(){this.transitions=Hg(this),this.config.always&&(this.always=Hn(this.config.always).map(t=>dn(this,pu,t))),Object.keys(this.states).forEach(t=>{this.states[t]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(ai),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(t=>`#${t.id}`),source:`#${this.id}`,actions:this.initial.actions.map(ai),eventType:null})}:void 0,history:this.history,states:Cc(this.states,t=>t.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(t=>({...t,actions:t.actions.map(ai)})),entry:this.entry.map(ai),exit:this.exit.map(ai),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return Bn(this,"invoke",()=>Ne(this.config.invoke).map((t,i)=>{const{src:s,systemId:r}=t,a=t.id??Mc(this.id,i),l=typeof s=="string"?s:`xstate.invoke.${Mc(this.id,i)}`;return{...t,src:l,id:a,systemId:r,toJSON(){const{onDone:u,onError:f,..._}=t;return{..._,type:"xstate.invoke",src:l,id:a}}}}))}get on(){return Bn(this,"on",()=>[...this.transitions].flatMap(([i,s])=>s.map(r=>[i,r])).reduce((i,[s,r])=>(i[s]=i[s]||[],i[s].push(r),i),{}))}get after(){return Bn(this,"delayedTransitions",()=>Rg(this))}get initial(){return Bn(this,"initial",()=>jg(this,this.config.initial))}next(t,i){const s=i.type,r=[];let a;const l=Bn(this,`candidates-${s}`,()=>zg(this,s));for(const u of l){const{guard:f}=u,_=t.context;let g=!1;try{g=!f||qr(f,_,i,t)}catch(p){const m=typeof f=="string"?f:typeof f=="object"?f.type:void 0;throw new Error(`Unable to evaluate guard ${m?`'${m}' `:""}in transition for event '${s}' in state node '${this.id}':
${p.message}`)}if(g){r.push(...u.actions),a=u;break}}return a?[a]:void 0}get events(){return Bn(this,"events",()=>{const{states:t}=this,i=new Set(this.ownEvents);if(t)for(const s of Object.keys(t)){const r=t[s];if(r.states)for(const a of r.events)i.add(`${a}`)}return Array.from(i)})}get ownEvents(){const t=new Set([...this.transitions.keys()].filter(i=>this.transitions.get(i).some(s=>!(!s.target&&!s.actions.length&&!s.reenter))));return Array.from(t)}}const _y="#";class Gs{constructor(t,i){this.config=t,this.version=void 0,this.schemas=void 0,this.implementations=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.id=t.id||"(machine)",this.implementations={actors:i?.actors??{},actions:i?.actions??{},delays:i?.delays??{},guards:i?.guards??{}},this.version=this.config.version,this.schemas=this.config.schemas,this.transition=this.transition.bind(this),this.getInitialSnapshot=this.getInitialSnapshot.bind(this),this.getPersistedSnapshot=this.getPersistedSnapshot.bind(this),this.restoreSnapshot=this.restoreSnapshot.bind(this),this.start=this.start.bind(this),this.root=new Pr(t,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(t){const{actions:i,guards:s,actors:r,delays:a}=this.implementations;return new Gs(this.config,{actions:{...i,...t.actions},guards:{...s,...t.guards},actors:{...r,...t.actors},delays:{...a,...t.delays}})}resolveState(t){const i=ty(this.root,t.value),s=Tr(Mr(this.root,i));return _r({_nodes:[...s],context:t.context||{},children:{},status:Ns(s,this.root)?"done":t.status||"active",output:t.output,error:t.error,historyValue:t.historyValue},this)}transition(t,i,s){return jo(t,i,s,[]).snapshot}microstep(t,i,s){return jo(t,i,s,[]).microstates}getTransitionData(t,i){return $s(this.root,t.value,t,i)||[]}getPreInitialState(t,i,s){const{context:r}=this.config,a=_r({context:typeof r!="function"&&r?r:{},_nodes:[this.root],children:{},status:"active"},this);return typeof r=="function"?Vn(a,i,t,[pn(({spawn:u,event:f,self:_})=>r({spawn:u,input:f.input,self:_}))],s,void 0):a}getInitialSnapshot(t,i){const s=yu(i),r=[],a=this.getPreInitialState(t,s,r),l=ps([{target:[...Tu(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],a,t,s,!0,r),{snapshot:u}=jo(l,s,t,r);return u}start(t){Object.values(t.children).forEach(i=>{i.getSnapshot().status==="active"&&i.start()})}getStateNodeById(t){const i=zs(t),s=i.slice(1),r=Kr(i[0])?i[0].slice(_y.length):i[0],a=this.idMap.get(r);if(!a)throw new Error(`Child state node '#${r}' does not exist on machine '${this.id}'`);return Cr(a,s)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedSnapshot(t,i){return cy(t,i)}restoreSnapshot(t,i){const s={},r=t.children;Object.keys(r).forEach(p=>{const m=r[p],v=m.snapshot,b=m.src,S=typeof b=="string"?Rs(this,b):b;if(!S)return;const C=xi(S,{id:p,parent:i.self,syncSnapshot:m.syncSnapshot,snapshot:v,src:b,systemId:m.systemId});s[p]=C});function a(p,m){if(m instanceof Pr)return m;try{return p.machine.getStateNodeById(m.id)}catch{}}function l(p,m){if(!m||typeof m!="object")return{};const v={};for(const b in m){const S=m[b];for(const C of S){const V=a(p,C);V&&(v[b]??=[],v[b].push(V))}}return v}const u=l(this.root,t.historyValue),f=_r({...t,children:s,_nodes:Array.from(Tr(Mr(this.root,t.value))),historyValue:u},this),_=new Set;function g(p,m){if(!_.has(p)){_.add(p);for(const v in p){const b=p[v];if(b&&typeof b=="object"){if("xstate$$type"in b&&b.xstate$$type===Hs){p[v]=m[b.id];continue}g(b,m)}}}}return g(f.context,s),f}}function py(n,t,i,s,{event:r}){const a=typeof r=="function"?r(i,s):r;return[t,{event:a},void 0]}function my(n,{event:t}){n.defer(()=>n.emit(t))}function Du(n){function t(i,s){}return t.type="xstate.emit",t.event=n,t.resolve=py,t.execute=my,t}let ms=(function(n){return n.Parent="#_parent",n.Internal="#_internal",n})({});function gy(n,t,i,s,{to:r,event:a,id:l,delay:u},f){const _=t.machine.implementations.delays;if(typeof a=="string")throw new Error(`Only event objects may be used with sendTo; use sendTo({ type: "${a}" }) instead`);const g=typeof a=="function"?a(i,s):a;let p;if(typeof u=="string"){const b=_&&_[u];p=typeof b=="function"?b(i,s):b}else p=typeof u=="function"?u(i,s):u;const m=typeof r=="function"?r(i,s):r;let v;if(typeof m=="string"){if(m===ms.Parent?v=n.self._parent:m===ms.Internal?v=n.self:m.startsWith("#_")?v=t.children[m.slice(2)]:v=f.deferredActorIds?.includes(m)?m:t.children[m],!v)throw new Error(`Unable to send event to actor '${m}' from machine '${t.machine.id}'.`)}else v=m||n.self;return[t,{to:v,targetId:typeof m=="string"?m:void 0,event:g,id:l,delay:p},void 0]}function yy(n,t,i){typeof i.to=="string"&&(i.to=t.children[i.to])}function vy(n,t){n.defer(()=>{const{to:i,event:s,delay:r,id:a}=t;if(typeof r=="number"){n.system.scheduler.schedule(n.self,i,s,r,a);return}n.system._relay(n.self,i,s.type===bg?gu(n.self.id,s.data):s)})}function Ws(n,t,i){function s(r,a){}return s.type="xstate.sendTo",s.to=n,s.event=t,s.id=i?.id,s.delay=i?.delay,s.resolve=gy,s.retryResolve=yy,s.execute=vy,s}function by(n,t){return Ws(ms.Parent,n,t)}function wy(n,t,i,s,{collect:r}){const a=[],l=function(f){a.push(f)};return l.assign=(...u)=>{a.push(pn(...u))},l.cancel=(...u)=>{a.push(js(...u))},l.raise=(...u)=>{a.push(Vs(...u))},l.sendTo=(...u)=>{a.push(Ws(...u))},l.sendParent=(...u)=>{a.push(by(...u))},l.spawnChild=(...u)=>{a.push(Us(...u))},l.stopChild=(...u)=>{a.push(Wr(...u))},l.emit=(...u)=>{a.push(Du(...u))},r({context:i.context,event:i.event,enqueue:l,check:u=>qr(u,t.context,i.event,t),self:n.self,system:n.system},s),[t,void 0,a]}function xy(n){function t(i,s){}return t.type="xstate.enqueueActions",t.collect=n,t.resolve=wy,t}function Ly(n,t,i,s,{value:r,label:a}){return[t,{value:typeof r=="function"?r(i,s):r,label:a},void 0]}function Sy({logger:n},{value:t,label:i}){i?n(i,t):n(t)}function Ey(n=({context:i,event:s})=>({context:i,event:s}),t){function i(s,r){}return i.type="xstate.log",i.value=n,i.label=t,i.resolve=Ly,i.execute=Sy,i}function ky(n,t){const i=Ne(t);if(!i.includes(n.type)){const s=i.length===1?`type "${i[0]}"`:`one of types "${i.join('", "')}"`;throw new Error(`Expected event ${JSON.stringify(n)} to have ${s}`)}}function Ty(n,t){return new Gs(n,t)}function Cy({schemas:n,actors:t,actions:i,guards:s,delays:r}){return{assign:pn,sendTo:Ws,raise:Vs,log:Ey,cancel:js,stopChild:Wr,enqueueActions:xy,emit:Du,spawnChild:Us,createStateConfig:a=>a,createAction:a=>a,createMachine:a=>Ty({...a,schemas:n},{actors:t,actions:i,guards:s,delays:r})}}const My={timeout:1/0};function Py(n,t,i){const s={...My,...i};return new Promise((r,a)=>{const{signal:l}=s;if(l?.aborted){a(l.reason);return}let u=!1;const f=s.timeout===1/0?void 0:setTimeout(()=>{_(),a(new Error(`Timeout of ${s.timeout} ms exceeded`))},s.timeout),_=()=>{clearTimeout(f),u=!0,m?.unsubscribe(),p&&l.removeEventListener("abort",p)};function g(v){t(v)&&(_(),r(v))}let p,m;g(n.getSnapshot()),!u&&(l&&(p=()=>{_(),a(l.reason)},l.addEventListener("abort",p)),m=n.subscribe({next:g,error:v=>{_(),a(v)},complete:()=>{_(),a(new Error("Actor terminated without satisfying predicate"))}}),u&&m.unsubscribe())})}let er;const Iy=new Uint8Array(16);function Ay(){if(!er&&(er=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!er))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return er(Iy)}const Dy=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Yr(n){return typeof n=="string"&&Dy.test(n)}const Zt=[];for(let n=0;n<256;++n)Zt.push((n+256).toString(16).slice(1));function Ou(n,t=0){return Zt[n[t+0]]+Zt[n[t+1]]+Zt[n[t+2]]+Zt[n[t+3]]+"-"+Zt[n[t+4]]+Zt[n[t+5]]+"-"+Zt[n[t+6]]+Zt[n[t+7]]+"-"+Zt[n[t+8]]+Zt[n[t+9]]+"-"+Zt[n[t+10]]+Zt[n[t+11]]+Zt[n[t+12]]+Zt[n[t+13]]+Zt[n[t+14]]+Zt[n[t+15]]}function Oy(n,t=0){const i=Ou(n,t);if(!Yr(i))throw TypeError("Stringified UUID is invalid");return i}function By(n){if(!Yr(n))throw TypeError("Invalid UUID");let t;const i=new Uint8Array(16);return i[0]=(t=parseInt(n.slice(0,8),16))>>>24,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=t&255,i[4]=(t=parseInt(n.slice(9,13),16))>>>8,i[5]=t&255,i[6]=(t=parseInt(n.slice(14,18),16))>>>8,i[7]=t&255,i[8]=(t=parseInt(n.slice(19,23),16))>>>8,i[9]=t&255,i[10]=(t=parseInt(n.slice(24,36),16))/0x10000000000&255,i[11]=t/0x100000000&255,i[12]=t>>>24&255,i[13]=t>>>16&255,i[14]=t>>>8&255,i[15]=t&255,i}const zy=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Bc={randomUUID:zy};function Bu(n,t,i){if(Bc.randomUUID&&!t&&!n)return Bc.randomUUID();n=n||{};const s=n.random||(n.rng||Ay)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t){i=i||0;for(let r=0;r<16;++r)t[i+r]=s[r];return t}return Ou(s)}var ye={},Lt={},Vt={},Uo={},ci={},zc;function Ry(){return zc||(zc=1,Object.defineProperty(ci,"__esModule",{value:!0}),ci.crypto=void 0,ci.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0),ci}var Rc;function zu(){return Rc||(Rc=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.wrapXOFConstructorWithOpts=n.wrapConstructorWithOpts=n.wrapConstructor=n.Hash=n.nextTick=n.swap32IfBE=n.byteSwapIfBE=n.swap8IfBE=n.isLE=void 0,n.isBytes=i,n.anumber=s,n.abytes=r,n.ahash=a,n.aexists=l,n.aoutput=u,n.u8=f,n.u32=_,n.clean=g,n.createView=p,n.rotr=m,n.rotl=v,n.byteSwap=b,n.byteSwap32=S,n.bytesToHex=A,n.hexToBytes=O,n.asyncLoop=nt,n.utf8ToBytes=Q,n.bytesToUtf8=N,n.toBytes=G,n.kdfInputToBytes=J,n.concatBytes=ot,n.checkOpts=E,n.createHasher=H,n.createOptHasher=R,n.createXOFer=j,n.randomBytes=q;const t=Ry();function i(T){return T instanceof Uint8Array||ArrayBuffer.isView(T)&&T.constructor.name==="Uint8Array"}function s(T){if(!Number.isSafeInteger(T)||T<0)throw new Error("positive integer expected, got "+T)}function r(T,...I){if(!i(T))throw new Error("Uint8Array expected");if(I.length>0&&!I.includes(T.length))throw new Error("Uint8Array expected of length "+I+", got length="+T.length)}function a(T){if(typeof T!="function"||typeof T.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");s(T.outputLen),s(T.blockLen)}function l(T,I=!0){if(T.destroyed)throw new Error("Hash instance has been destroyed");if(I&&T.finished)throw new Error("Hash#digest() has already been called")}function u(T,I){r(T);const $=I.outputLen;if(T.length<$)throw new Error("digestInto() expects output buffer of length at least "+$)}function f(T){return new Uint8Array(T.buffer,T.byteOffset,T.byteLength)}function _(T){return new Uint32Array(T.buffer,T.byteOffset,Math.floor(T.byteLength/4))}function g(...T){for(let I=0;I<T.length;I++)T[I].fill(0)}function p(T){return new DataView(T.buffer,T.byteOffset,T.byteLength)}function m(T,I){return T<<32-I|T>>>I}function v(T,I){return T<<I|T>>>32-I>>>0}n.isLE=new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]===68;function b(T){return T<<24&0xff000000|T<<8&0xff0000|T>>>8&65280|T>>>24&255}n.swap8IfBE=n.isLE?T=>T:T=>b(T),n.byteSwapIfBE=n.swap8IfBE;function S(T){for(let I=0;I<T.length;I++)T[I]=b(T[I]);return T}n.swap32IfBE=n.isLE?T=>T:S;const C=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",V=Array.from({length:256},(T,I)=>I.toString(16).padStart(2,"0"));function A(T){if(r(T),C)return T.toHex();let I="";for(let $=0;$<T.length;$++)I+=V[T[$]];return I}const w={_0:48,_9:57,A:65,F:70,a:97,f:102};function F(T){if(T>=w._0&&T<=w._9)return T-w._0;if(T>=w.A&&T<=w.F)return T-(w.A-10);if(T>=w.a&&T<=w.f)return T-(w.a-10)}function O(T){if(typeof T!="string")throw new Error("hex string expected, got "+typeof T);if(C)return Uint8Array.fromHex(T);const I=T.length,$=I/2;if(I%2)throw new Error("hex string expected, got unpadded hex of length "+I);const tt=new Uint8Array($);for(let ht=0,_t=0;ht<$;ht++,_t+=2){const gt=F(T.charCodeAt(_t)),ct=F(T.charCodeAt(_t+1));if(gt===void 0||ct===void 0){const Ct=T[_t]+T[_t+1];throw new Error('hex string expected, got non-hex character "'+Ct+'" at index '+_t)}tt[ht]=gt*16+ct}return tt}const K=async()=>{};n.nextTick=K;async function nt(T,I,$){let tt=Date.now();for(let ht=0;ht<T;ht++){$(ht);const _t=Date.now()-tt;_t>=0&&_t<I||(await (0,n.nextTick)(),tt+=_t)}}function Q(T){if(typeof T!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(T))}function N(T){return new TextDecoder().decode(T)}function G(T){return typeof T=="string"&&(T=Q(T)),r(T),T}function J(T){return typeof T=="string"&&(T=Q(T)),r(T),T}function ot(...T){let I=0;for(let tt=0;tt<T.length;tt++){const ht=T[tt];r(ht),I+=ht.length}const $=new Uint8Array(I);for(let tt=0,ht=0;tt<T.length;tt++){const _t=T[tt];$.set(_t,ht),ht+=_t.length}return $}function E(T,I){if(I!==void 0&&{}.toString.call(I)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(T,I)}class Z{}n.Hash=Z;function H(T){const I=tt=>T().update(G(tt)).digest(),$=T();return I.outputLen=$.outputLen,I.blockLen=$.blockLen,I.create=()=>T(),I}function R(T){const I=(tt,ht)=>T(ht).update(G(tt)).digest(),$=T({});return I.outputLen=$.outputLen,I.blockLen=$.blockLen,I.create=tt=>T(tt),I}function j(T){const I=(tt,ht)=>T(ht).update(G(tt)).digest(),$=T({});return I.outputLen=$.outputLen,I.blockLen=$.blockLen,I.create=tt=>T(tt),I}n.wrapConstructor=H,n.wrapConstructorWithOpts=R,n.wrapXOFConstructorWithOpts=j;function q(T=32){if(t.crypto&&typeof t.crypto.getRandomValues=="function")return t.crypto.getRandomValues(new Uint8Array(T));if(t.crypto&&typeof t.crypto.randomBytes=="function")return Uint8Array.from(t.crypto.randomBytes(T));throw new Error("crypto.getRandomValues must be defined")}})(Uo)),Uo}var Hc;function Hy(){if(Hc)return Vt;Hc=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.SHA512_IV=Vt.SHA384_IV=Vt.SHA224_IV=Vt.SHA256_IV=Vt.HashMD=void 0,Vt.setBigUint64=t,Vt.Chi=i,Vt.Maj=s;const n=zu();function t(a,l,u,f){if(typeof a.setBigUint64=="function")return a.setBigUint64(l,u,f);const _=BigInt(32),g=BigInt(0xffffffff),p=Number(u>>_&g),m=Number(u&g),v=f?4:0,b=f?0:4;a.setUint32(l+v,p,f),a.setUint32(l+b,m,f)}function i(a,l,u){return a&l^~a&u}function s(a,l,u){return a&l^a&u^l&u}class r extends n.Hash{constructor(l,u,f,_){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=l,this.outputLen=u,this.padOffset=f,this.isLE=_,this.buffer=new Uint8Array(l),this.view=(0,n.createView)(this.buffer)}update(l){(0,n.aexists)(this),l=(0,n.toBytes)(l),(0,n.abytes)(l);const{view:u,buffer:f,blockLen:_}=this,g=l.length;for(let p=0;p<g;){const m=Math.min(_-this.pos,g-p);if(m===_){const v=(0,n.createView)(l);for(;_<=g-p;p+=_)this.process(v,p);continue}f.set(l.subarray(p,p+m),this.pos),this.pos+=m,p+=m,this.pos===_&&(this.process(u,0),this.pos=0)}return this.length+=l.length,this.roundClean(),this}digestInto(l){(0,n.aexists)(this),(0,n.aoutput)(l,this),this.finished=!0;const{buffer:u,view:f,blockLen:_,isLE:g}=this;let{pos:p}=this;u[p++]=128,(0,n.clean)(this.buffer.subarray(p)),this.padOffset>_-p&&(this.process(f,0),p=0);for(let C=p;C<_;C++)u[C]=0;t(f,_-8,BigInt(this.length*8),g),this.process(f,0);const m=(0,n.createView)(l),v=this.outputLen;if(v%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const b=v/4,S=this.get();if(b>S.length)throw new Error("_sha2: outputLen bigger than state");for(let C=0;C<b;C++)m.setUint32(4*C,S[C],g)}digest(){const{buffer:l,outputLen:u}=this;this.digestInto(l);const f=l.slice(0,u);return this.destroy(),f}_cloneInto(l){l||(l=new this.constructor),l.set(...this.get());const{blockLen:u,buffer:f,length:_,finished:g,destroyed:p,pos:m}=this;return l.destroyed=p,l.finished=g,l.length=_,l.pos=m,_%u&&l.buffer.set(f),l}clone(){return this._cloneInto()}}return Vt.HashMD=r,Vt.SHA256_IV=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),Vt.SHA224_IV=Uint32Array.from([0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]),Vt.SHA384_IV=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),Vt.SHA512_IV=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),Vt}var ut={},jc;function jy(){if(jc)return ut;jc=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.toBig=ut.shrSL=ut.shrSH=ut.rotrSL=ut.rotrSH=ut.rotrBL=ut.rotrBH=ut.rotr32L=ut.rotr32H=ut.rotlSL=ut.rotlSH=ut.rotlBL=ut.rotlBH=ut.add5L=ut.add5H=ut.add4L=ut.add4H=ut.add3L=ut.add3H=void 0,ut.add=V,ut.fromBig=i,ut.split=s;const n=BigInt(2**32-1),t=BigInt(32);function i(N,G=!1){return G?{h:Number(N&n),l:Number(N>>t&n)}:{h:Number(N>>t&n)|0,l:Number(N&n)|0}}function s(N,G=!1){const J=N.length;let ot=new Uint32Array(J),E=new Uint32Array(J);for(let Z=0;Z<J;Z++){const{h:H,l:R}=i(N[Z],G);[ot[Z],E[Z]]=[H,R]}return[ot,E]}const r=(N,G)=>BigInt(N>>>0)<<t|BigInt(G>>>0);ut.toBig=r;const a=(N,G,J)=>N>>>J;ut.shrSH=a;const l=(N,G,J)=>N<<32-J|G>>>J;ut.shrSL=l;const u=(N,G,J)=>N>>>J|G<<32-J;ut.rotrSH=u;const f=(N,G,J)=>N<<32-J|G>>>J;ut.rotrSL=f;const _=(N,G,J)=>N<<64-J|G>>>J-32;ut.rotrBH=_;const g=(N,G,J)=>N>>>J-32|G<<64-J;ut.rotrBL=g;const p=(N,G)=>G;ut.rotr32H=p;const m=(N,G)=>N;ut.rotr32L=m;const v=(N,G,J)=>N<<J|G>>>32-J;ut.rotlSH=v;const b=(N,G,J)=>G<<J|N>>>32-J;ut.rotlSL=b;const S=(N,G,J)=>G<<J-32|N>>>64-J;ut.rotlBH=S;const C=(N,G,J)=>N<<J-32|G>>>64-J;ut.rotlBL=C;function V(N,G,J,ot){const E=(G>>>0)+(ot>>>0);return{h:N+J+(E/2**32|0)|0,l:E|0}}const A=(N,G,J)=>(N>>>0)+(G>>>0)+(J>>>0);ut.add3L=A;const w=(N,G,J,ot)=>G+J+ot+(N/2**32|0)|0;ut.add3H=w;const F=(N,G,J,ot)=>(N>>>0)+(G>>>0)+(J>>>0)+(ot>>>0);ut.add4L=F;const O=(N,G,J,ot,E)=>G+J+ot+E+(N/2**32|0)|0;ut.add4H=O;const K=(N,G,J,ot,E)=>(N>>>0)+(G>>>0)+(J>>>0)+(ot>>>0)+(E>>>0);ut.add5L=K;const nt=(N,G,J,ot,E,Z)=>G+J+ot+E+Z+(N/2**32|0)|0;ut.add5H=nt;const Q={fromBig:i,split:s,toBig:r,shrSH:a,shrSL:l,rotrSH:u,rotrSL:f,rotrBH:_,rotrBL:g,rotr32H:p,rotr32L:m,rotlSH:v,rotlSL:b,rotlBH:S,rotlBL:C,add:V,add3L:A,add3H:w,add4L:F,add4H:O,add5H:nt,add5L:K};return ut.default=Q,ut}var Uc;function Uy(){if(Uc)return Lt;Uc=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.sha512_224=Lt.sha512_256=Lt.sha384=Lt.sha512=Lt.sha224=Lt.sha256=Lt.SHA512_256=Lt.SHA512_224=Lt.SHA384=Lt.SHA512=Lt.SHA224=Lt.SHA256=void 0;const n=Hy(),t=jy(),i=zu(),s=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),r=new Uint32Array(64);class a extends n.HashMD{constructor(w=32){super(64,w,8,!1),this.A=n.SHA256_IV[0]|0,this.B=n.SHA256_IV[1]|0,this.C=n.SHA256_IV[2]|0,this.D=n.SHA256_IV[3]|0,this.E=n.SHA256_IV[4]|0,this.F=n.SHA256_IV[5]|0,this.G=n.SHA256_IV[6]|0,this.H=n.SHA256_IV[7]|0}get(){const{A:w,B:F,C:O,D:K,E:nt,F:Q,G:N,H:G}=this;return[w,F,O,K,nt,Q,N,G]}set(w,F,O,K,nt,Q,N,G){this.A=w|0,this.B=F|0,this.C=O|0,this.D=K|0,this.E=nt|0,this.F=Q|0,this.G=N|0,this.H=G|0}process(w,F){for(let E=0;E<16;E++,F+=4)r[E]=w.getUint32(F,!1);for(let E=16;E<64;E++){const Z=r[E-15],H=r[E-2],R=(0,i.rotr)(Z,7)^(0,i.rotr)(Z,18)^Z>>>3,j=(0,i.rotr)(H,17)^(0,i.rotr)(H,19)^H>>>10;r[E]=j+r[E-7]+R+r[E-16]|0}let{A:O,B:K,C:nt,D:Q,E:N,F:G,G:J,H:ot}=this;for(let E=0;E<64;E++){const Z=(0,i.rotr)(N,6)^(0,i.rotr)(N,11)^(0,i.rotr)(N,25),H=ot+Z+(0,n.Chi)(N,G,J)+s[E]+r[E]|0,j=((0,i.rotr)(O,2)^(0,i.rotr)(O,13)^(0,i.rotr)(O,22))+(0,n.Maj)(O,K,nt)|0;ot=J,J=G,G=N,N=Q+H|0,Q=nt,nt=K,K=O,O=H+j|0}O=O+this.A|0,K=K+this.B|0,nt=nt+this.C|0,Q=Q+this.D|0,N=N+this.E|0,G=G+this.F|0,J=J+this.G|0,ot=ot+this.H|0,this.set(O,K,nt,Q,N,G,J,ot)}roundClean(){(0,i.clean)(r)}destroy(){this.set(0,0,0,0,0,0,0,0),(0,i.clean)(this.buffer)}}Lt.SHA256=a;class l extends a{constructor(){super(28),this.A=n.SHA224_IV[0]|0,this.B=n.SHA224_IV[1]|0,this.C=n.SHA224_IV[2]|0,this.D=n.SHA224_IV[3]|0,this.E=n.SHA224_IV[4]|0,this.F=n.SHA224_IV[5]|0,this.G=n.SHA224_IV[6]|0,this.H=n.SHA224_IV[7]|0}}Lt.SHA224=l;const u=t.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(A=>BigInt(A))),f=u[0],_=u[1],g=new Uint32Array(80),p=new Uint32Array(80);class m extends n.HashMD{constructor(w=64){super(128,w,16,!1),this.Ah=n.SHA512_IV[0]|0,this.Al=n.SHA512_IV[1]|0,this.Bh=n.SHA512_IV[2]|0,this.Bl=n.SHA512_IV[3]|0,this.Ch=n.SHA512_IV[4]|0,this.Cl=n.SHA512_IV[5]|0,this.Dh=n.SHA512_IV[6]|0,this.Dl=n.SHA512_IV[7]|0,this.Eh=n.SHA512_IV[8]|0,this.El=n.SHA512_IV[9]|0,this.Fh=n.SHA512_IV[10]|0,this.Fl=n.SHA512_IV[11]|0,this.Gh=n.SHA512_IV[12]|0,this.Gl=n.SHA512_IV[13]|0,this.Hh=n.SHA512_IV[14]|0,this.Hl=n.SHA512_IV[15]|0}get(){const{Ah:w,Al:F,Bh:O,Bl:K,Ch:nt,Cl:Q,Dh:N,Dl:G,Eh:J,El:ot,Fh:E,Fl:Z,Gh:H,Gl:R,Hh:j,Hl:q}=this;return[w,F,O,K,nt,Q,N,G,J,ot,E,Z,H,R,j,q]}set(w,F,O,K,nt,Q,N,G,J,ot,E,Z,H,R,j,q){this.Ah=w|0,this.Al=F|0,this.Bh=O|0,this.Bl=K|0,this.Ch=nt|0,this.Cl=Q|0,this.Dh=N|0,this.Dl=G|0,this.Eh=J|0,this.El=ot|0,this.Fh=E|0,this.Fl=Z|0,this.Gh=H|0,this.Gl=R|0,this.Hh=j|0,this.Hl=q|0}process(w,F){for(let $=0;$<16;$++,F+=4)g[$]=w.getUint32(F),p[$]=w.getUint32(F+=4);for(let $=16;$<80;$++){const tt=g[$-15]|0,ht=p[$-15]|0,_t=t.rotrSH(tt,ht,1)^t.rotrSH(tt,ht,8)^t.shrSH(tt,ht,7),gt=t.rotrSL(tt,ht,1)^t.rotrSL(tt,ht,8)^t.shrSL(tt,ht,7),ct=g[$-2]|0,Ct=p[$-2]|0,qt=t.rotrSH(ct,Ct,19)^t.rotrBH(ct,Ct,61)^t.shrSH(ct,Ct,6),Ke=t.rotrSL(ct,Ct,19)^t.rotrBL(ct,Ct,61)^t.shrSL(ct,Ct,6),z=t.add4L(gt,Ke,p[$-7],p[$-16]),et=t.add4H(z,_t,qt,g[$-7],g[$-16]);g[$]=et|0,p[$]=z|0}let{Ah:O,Al:K,Bh:nt,Bl:Q,Ch:N,Cl:G,Dh:J,Dl:ot,Eh:E,El:Z,Fh:H,Fl:R,Gh:j,Gl:q,Hh:T,Hl:I}=this;for(let $=0;$<80;$++){const tt=t.rotrSH(E,Z,14)^t.rotrSH(E,Z,18)^t.rotrBH(E,Z,41),ht=t.rotrSL(E,Z,14)^t.rotrSL(E,Z,18)^t.rotrBL(E,Z,41),_t=E&H^~E&j,gt=Z&R^~Z&q,ct=t.add5L(I,ht,gt,_[$],p[$]),Ct=t.add5H(ct,T,tt,_t,f[$],g[$]),qt=ct|0,Ke=t.rotrSH(O,K,28)^t.rotrBH(O,K,34)^t.rotrBH(O,K,39),z=t.rotrSL(O,K,28)^t.rotrBL(O,K,34)^t.rotrBL(O,K,39),et=O&nt^O&N^nt&N,at=K&Q^K&G^Q&G;T=j|0,I=q|0,j=H|0,q=R|0,H=E|0,R=Z|0,{h:E,l:Z}=t.add(J|0,ot|0,Ct|0,qt|0),J=N|0,ot=G|0,N=nt|0,G=Q|0,nt=O|0,Q=K|0;const dt=t.add3L(qt,z,at);O=t.add3H(dt,Ct,Ke,et),K=dt|0}({h:O,l:K}=t.add(this.Ah|0,this.Al|0,O|0,K|0)),{h:nt,l:Q}=t.add(this.Bh|0,this.Bl|0,nt|0,Q|0),{h:N,l:G}=t.add(this.Ch|0,this.Cl|0,N|0,G|0),{h:J,l:ot}=t.add(this.Dh|0,this.Dl|0,J|0,ot|0),{h:E,l:Z}=t.add(this.Eh|0,this.El|0,E|0,Z|0),{h:H,l:R}=t.add(this.Fh|0,this.Fl|0,H|0,R|0),{h:j,l:q}=t.add(this.Gh|0,this.Gl|0,j|0,q|0),{h:T,l:I}=t.add(this.Hh|0,this.Hl|0,T|0,I|0),this.set(O,K,nt,Q,N,G,J,ot,E,Z,H,R,j,q,T,I)}roundClean(){(0,i.clean)(g,p)}destroy(){(0,i.clean)(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}Lt.SHA512=m;class v extends m{constructor(){super(48),this.Ah=n.SHA384_IV[0]|0,this.Al=n.SHA384_IV[1]|0,this.Bh=n.SHA384_IV[2]|0,this.Bl=n.SHA384_IV[3]|0,this.Ch=n.SHA384_IV[4]|0,this.Cl=n.SHA384_IV[5]|0,this.Dh=n.SHA384_IV[6]|0,this.Dl=n.SHA384_IV[7]|0,this.Eh=n.SHA384_IV[8]|0,this.El=n.SHA384_IV[9]|0,this.Fh=n.SHA384_IV[10]|0,this.Fl=n.SHA384_IV[11]|0,this.Gh=n.SHA384_IV[12]|0,this.Gl=n.SHA384_IV[13]|0,this.Hh=n.SHA384_IV[14]|0,this.Hl=n.SHA384_IV[15]|0}}Lt.SHA384=v;const b=Uint32Array.from([0x8c3d37c8,0x19544da2,0x73e19966,0x89dcd4d6,0x1dfab7ae,0x32ff9c82,0x679dd514,0x582f9fcf,0xf6d2b69,0x7bd44da8,0x77e36f73,0x4c48942,0x3f9d85a8,0x6a1d36c8,0x1112e6ad,0x91d692a1]),S=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class C extends m{constructor(){super(28),this.Ah=b[0]|0,this.Al=b[1]|0,this.Bh=b[2]|0,this.Bl=b[3]|0,this.Ch=b[4]|0,this.Cl=b[5]|0,this.Dh=b[6]|0,this.Dl=b[7]|0,this.Eh=b[8]|0,this.El=b[9]|0,this.Fh=b[10]|0,this.Fl=b[11]|0,this.Gh=b[12]|0,this.Gl=b[13]|0,this.Hh=b[14]|0,this.Hl=b[15]|0}}Lt.SHA512_224=C;class V extends m{constructor(){super(32),this.Ah=S[0]|0,this.Al=S[1]|0,this.Bh=S[2]|0,this.Bl=S[3]|0,this.Ch=S[4]|0,this.Cl=S[5]|0,this.Dh=S[6]|0,this.Dl=S[7]|0,this.Eh=S[8]|0,this.El=S[9]|0,this.Fh=S[10]|0,this.Fl=S[11]|0,this.Gh=S[12]|0,this.Gl=S[13]|0,this.Hh=S[14]|0,this.Hl=S[15]|0}}return Lt.SHA512_256=V,Lt.sha256=(0,i.createHasher)(()=>new a),Lt.sha224=(0,i.createHasher)(()=>new l),Lt.sha512=(0,i.createHasher)(()=>new m),Lt.sha384=(0,i.createHasher)(()=>new v),Lt.sha512_256=(0,i.createHasher)(()=>new V),Lt.sha512_224=(0,i.createHasher)(()=>new C),Lt}var Fc;function Fy(){if(Fc)return ye;Fc=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.sha224=ye.SHA224=ye.sha256=ye.SHA256=void 0;const n=Uy();return ye.SHA256=n.SHA256,ye.sha256=n.sha256,ye.SHA224=n.SHA224,ye.sha224=n.sha224,ye}var Fo,Nc;function Ny(){if(Nc)return Fo;Nc=1;function n(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),s=0;s<i.length;s++)i[s]=255;for(var r=0;r<t.length;r++){var a=t.charAt(r),l=a.charCodeAt(0);if(i[l]!==255)throw new TypeError(a+" is ambiguous");i[l]=r}var u=t.length,f=t.charAt(0),_=Math.log(u)/Math.log(256),g=Math.log(256)/Math.log(u);function p(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(b.length===0)return"";for(var S=0,C=0,V=0,A=b.length;V!==A&&b[V]===0;)V++,S++;for(var w=(A-V)*g+1>>>0,F=new Uint8Array(w);V!==A;){for(var O=b[V],K=0,nt=w-1;(O!==0||K<C)&&nt!==-1;nt--,K++)O+=256*F[nt]>>>0,F[nt]=O%u>>>0,O=O/u>>>0;if(O!==0)throw new Error("Non-zero carry");C=K,V++}for(var Q=w-C;Q!==w&&F[Q]===0;)Q++;for(var N=f.repeat(S);Q<w;++Q)N+=t.charAt(F[Q]);return N}function m(b){if(typeof b!="string")throw new TypeError("Expected String");if(b.length===0)return new Uint8Array;for(var S=0,C=0,V=0;b[S]===f;)C++,S++;for(var A=(b.length-S)*_+1>>>0,w=new Uint8Array(A);b[S];){var F=b.charCodeAt(S);if(F>255)return;var O=i[F];if(O===255)return;for(var K=0,nt=A-1;(O!==0||K<V)&&nt!==-1;nt--,K++)O+=u*w[nt]>>>0,w[nt]=O%256>>>0,O=O/256>>>0;if(O!==0)throw new Error("Non-zero carry");V=K,S++}for(var Q=A-V;Q!==A&&w[Q]===0;)Q++;for(var N=new Uint8Array(C+(A-Q)),G=C;Q!==A;)N[G++]=w[Q++];return N}function v(b){var S=m(b);if(S)return S;throw new Error("Non-base"+u+" character")}return{encode:p,decodeUnsafe:m,decode:v}}return Fo=n,Fo}var No,$c;function $y(){return $c||($c=1,No=Ny()("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")),No}var $o,Zc;function Zy(){if(Zc)return $o;Zc=1;var n=$y();return $o=function(t){function i(l){var u=Uint8Array.from(l),f=t(u),_=u.length+4,g=new Uint8Array(_);return g.set(u,0),g.set(f.subarray(0,4),u.length),n.encode(g,_)}function s(l){var u=l.slice(0,-4),f=l.slice(-4),_=t(u);if(!(f[0]^_[0]|f[1]^_[1]|f[2]^_[2]|f[3]^_[3]))return u}function r(l){var u=n.decodeUnsafe(l);if(u)return s(u)}function a(l){var u=n.decode(l),f=s(u);if(!f)throw new Error("Invalid checksum");return f}return{encode:i,decode:a,decodeUnsafe:r}},$o}var Zo,Vc;function Vy(){if(Vc)return Zo;Vc=1;var{sha256:n}=Fy(),t=Zy();function i(s){return n(n(s))}return Zo=t(i),Zo}var Gy=Vy();const xn=Gr(Gy),Wy=n=>{if(n.length%2!==0)throw new Error("Hex string must have an even length");const t=new Uint8Array(n.length/2);for(let i=0;i<n.length;i+=2)t[i>>1]=parseInt(n.slice(i,i+2),16);return t},Ru=n=>Array.from(n,t=>t.toString(16).padStart(2,"0")).join(""),Ir="automerge:",Li=n=>{const[t,i,...s]=n.split("#");if(s.length>0)throw new Error("Invalid URL: contains multiple heads sections");const r=new RegExp(`^${Ir}(\\w+)$`),[,a]=t.match(r)||[],l=a,u=Fu(l);if(!u)throw new Error("Invalid document URL: "+n);if(i===void 0)return{binaryDocumentId:u,documentId:l};const f=i===""?[]:i.split("|"),_=f.map(g=>{try{return Ru(xn.decode(g))}catch{throw new Error(`Invalid head in URL: ${g}`)}});return{binaryDocumentId:u,hexHeads:_,documentId:l,heads:f}},Hu=n=>{if(n instanceof Uint8Array||typeof n=="string")return Ir+(n instanceof Uint8Array?Ar(n):n);const{documentId:t,heads:i=void 0}=n;if(t===void 0)throw new Error("Invalid documentId: "+t);const s=t instanceof Uint8Array?Ar(t):t;let r=`${Ir}${s}`;return i!==void 0&&(i.forEach(a=>{try{xn.decode(a)}catch{throw new Error(`Invalid head: ${a}`)}}),r+="#"+i.join("|")),r},ju=n=>{if(typeof n!="string"||!n||!n.startsWith(Ir))return!1;try{const{documentId:t,heads:i}=Li(n);return!(!Uu(t)||i&&!i.every(s=>{try{return xn.decode(s),!0}catch{return!1}}))}catch{return!1}},Uu=n=>{if(typeof n!="string")return!1;const t=Fu(n);if(t===void 0)return!1;const i=Oy(t);return Yr(i)},qy=n=>typeof n=="string"&&Yr(n),Ky=()=>{const n=Bu(null,new Uint8Array(16));return Hu({documentId:n})},Fu=n=>xn.decodeUnsafe(n),Ar=n=>xn.encode(n),De=n=>n.map(t=>xn.encode(Wy(t))),an=n=>n.map(t=>Ru(xn.decode(t))),nr=n=>{if(n instanceof Uint8Array)return Ar(n);if(ju(n))return Li(n).documentId;if(Uu(n))return n;if(qy(n)){console.warn("Future versions will not support UUIDs as document IDs; use Automerge URLs instead.");const t=By(n);return Ar(t)}throw new Error(`Invalid AutomergeUrl: '${n}'`)};let gs;try{gs=new TextDecoder}catch{}let rt,gn,U=0;const Yy=105,Jy=57342,Xy=57343,Gc=57337,Wc=6,zn={};let li=11281e4,He=1681e4,yt={},Pt,Dr,Or=0,Si=0,jt,he,Bt=[],ys=[],ee,Yt,ui,qc={useRecords:!1,mapsAsObjects:!0},Ei=!1,Nu=2;try{new Function("")}catch{Nu=1/0}class ki{constructor(t){if(t&&((t.keyMap||t._keyMap)&&!t.useRecords&&(t.useRecords=!1,t.mapsAsObjects=!0),t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.getStructures&&(t.getShared=t.getStructures),t.getShared&&!t.structures&&((t.structures=[]).uninitialized=!0),t.keyMap)){this.mapKey=new Map;for(let[i,s]of Object.entries(t.keyMap))this.mapKey.set(s,i)}Object.assign(this,t)}decodeKey(t){return this.keyMap&&this.mapKey.get(t)||t}encodeKey(t){return this.keyMap&&this.keyMap.hasOwnProperty(t)?this.keyMap[t]:t}encodeKeys(t){if(!this._keyMap)return t;let i=new Map;for(let[s,r]of Object.entries(t))i.set(this._keyMap.hasOwnProperty(s)?this._keyMap[s]:s,r);return i}decodeKeys(t){if(!this._keyMap||t.constructor.name!="Map")return t;if(!this._mapKey){this._mapKey=new Map;for(let[s,r]of Object.entries(this._keyMap))this._mapKey.set(r,s)}let i={};return t.forEach((s,r)=>i[ue(this._mapKey.has(r)?this._mapKey.get(r):r)]=s),i}mapDecode(t,i){let s=this.decode(t);if(this._keyMap)switch(s.constructor.name){case"Array":return s.map(r=>this.decodeKeys(r))}return s}decode(t,i){if(rt)return Gu(()=>(xs(),this?this.decode(t,i):ki.prototype.decode.call(qc,t,i)));gn=i>-1?i:t.length,U=0,Si=0,Dr=null,jt=null,rt=t;try{Yt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(s){throw rt=null,t instanceof Uint8Array?s:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof ki){if(yt=this,ee=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return Pt=this.structures,ir();(!Pt||Pt.length>0)&&(Pt=[])}else yt=qc,(!Pt||Pt.length>0)&&(Pt=[]),ee=null;return ir()}decodeMultiple(t,i){let s,r=0;try{let a=t.length;Ei=!0;let l=this?this.decode(t,a):Ys.decode(t,a);if(i){if(i(l)===!1)return;for(;U<a;)if(r=U,i(ir())===!1)return}else{for(s=[l];U<a;)r=U,s.push(ir());return s}}catch(a){throw a.lastPosition=r,a.values=s,a}finally{Ei=!1,xs()}}}function ir(){try{let n=vt();if(jt){if(U>=jt.postBundlePosition){let t=new Error("Unexpected bundle position");throw t.incomplete=!0,t}U=jt.postBundlePosition,jt=null}if(U==gn)Pt=null,rt=null,he&&(he=null);else if(U>gn){let t=new Error("Unexpected end of CBOR data");throw t.incomplete=!0,t}else if(!Ei)throw new Error("Data read, but end of buffer not reached");return n}catch(n){throw xs(),(n instanceof RangeError||n.message.startsWith("Unexpected end of buffer"))&&(n.incomplete=!0),n}}function vt(){let n=rt[U++],t=n>>5;if(n=n&31,n>23)switch(n){case 24:n=rt[U++];break;case 25:if(t==7)return nv();n=Yt.getUint16(U),U+=2;break;case 26:if(t==7){let i=Yt.getFloat32(U);if(yt.useFloat32>2){let s=Ks[(rt[U]&127)<<1|rt[U+1]>>7];return U+=4,(s*i+(i>0?.5:-.5)>>0)/s}return U+=4,i}n=Yt.getUint32(U),U+=4;break;case 27:if(t==7){let i=Yt.getFloat64(U);return U+=8,i}if(t>1){if(Yt.getUint32(U)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");n=Yt.getUint32(U+4)}else yt.int64AsNumber?(n=Yt.getUint32(U)*0x100000000,n+=Yt.getUint32(U+4)):n=Yt.getBigUint64(U);U+=8;break;case 31:switch(t){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let i=[],s,r=0;for(;(s=vt())!=zn;){if(r>=li)throw new Error(`Array length exceeds ${li}`);i[r++]=s}return t==4?i:t==3?i.join(""):Buffer.concat(i);case 5:let a;if(yt.mapsAsObjects){let l={},u=0;if(yt.keyMap)for(;(a=vt())!=zn;){if(u++>=He)throw new Error(`Property count exceeds ${He}`);l[ue(yt.decodeKey(a))]=vt()}else for(;(a=vt())!=zn;){if(u++>=He)throw new Error(`Property count exceeds ${He}`);l[ue(a)]=vt()}return l}else{ui&&(yt.mapsAsObjects=!0,ui=!1);let l=new Map;if(yt.keyMap){let u=0;for(;(a=vt())!=zn;){if(u++>=He)throw new Error(`Map size exceeds ${He}`);l.set(yt.decodeKey(a),vt())}}else{let u=0;for(;(a=vt())!=zn;){if(u++>=He)throw new Error(`Map size exceeds ${He}`);l.set(a,vt())}}return l}case 7:return zn;default:throw new Error("Invalid major type for indefinite length "+t)}default:throw new Error("Unknown token "+n)}switch(t){case 0:return n;case 1:return~n;case 2:return ev(n);case 3:if(Si>=U)return Dr.slice(U-Or,(U+=n)-Or);if(Si==0&&gn<140&&n<32){let r=n<16?$u(n):tv(n);if(r!=null)return r}return Qy(n);case 4:if(n>=li)throw new Error(`Array length exceeds ${li}`);let i=new Array(n);for(let r=0;r<n;r++)i[r]=vt();return i;case 5:if(n>=He)throw new Error(`Map size exceeds ${li}`);if(yt.mapsAsObjects){let r={};if(yt.keyMap)for(let a=0;a<n;a++)r[ue(yt.decodeKey(vt()))]=vt();else for(let a=0;a<n;a++)r[ue(vt())]=vt();return r}else{ui&&(yt.mapsAsObjects=!0,ui=!1);let r=new Map;if(yt.keyMap)for(let a=0;a<n;a++)r.set(yt.decodeKey(vt()),vt());else for(let a=0;a<n;a++)r.set(vt(),vt());return r}case 6:if(n>=Gc){let r=Pt[n&8191];if(r)return r.read||(r.read=vs(r)),r.read();if(n<65536){if(n==Xy){let a=Fn(),l=vt(),u=vt();ws(l,u);let f={};if(yt.keyMap)for(let _=2;_<a;_++){let g=yt.decodeKey(u[_-2]);f[ue(g)]=vt()}else for(let _=2;_<a;_++){let g=u[_-2];f[ue(g)]=vt()}return f}else if(n==Jy){let a=Fn(),l=vt();for(let u=2;u<a;u++)ws(l++,vt());return vt()}else if(n==Gc)return cv();if(yt.getShared&&(qs(),r=Pt[n&8191],r))return r.read||(r.read=vs(r)),r.read()}}let s=Bt[n];if(s)return s.handlesRead?s(vt):s(vt());{let r=vt();for(let a=0;a<ys.length;a++){let l=ys[a](n,r);if(l!==void 0)return l}return new vn(r,n)}case 7:switch(n){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let r=(ee||hn())[n];if(r!==void 0)return r;throw new Error("Unknown token "+n)}default:if(isNaN(n)){let r=new Error("Unexpected end of CBOR data");throw r.incomplete=!0,r}throw new Error("Unknown CBOR token "+n)}}const Kc=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function vs(n){if(!n)throw new Error("Structure is required in record definition");function t(){let i=rt[U++];if(i=i&31,i>23)switch(i){case 24:i=rt[U++];break;case 25:i=Yt.getUint16(U),U+=2;break;case 26:i=Yt.getUint32(U),U+=4;break;default:throw new Error("Expected array header, but got "+rt[U-1])}let s=this.compiledReader;for(;s;){if(s.propertyCount===i)return s(vt);s=s.next}if(this.slowReads++>=Nu){let a=this.length==i?this:this.slice(0,i);return s=yt.keyMap?new Function("r","return {"+a.map(l=>yt.decodeKey(l)).map(l=>Kc.test(l)?ue(l)+":r()":"["+JSON.stringify(l)+"]:r()").join(",")+"}"):new Function("r","return {"+a.map(l=>Kc.test(l)?ue(l)+":r()":"["+JSON.stringify(l)+"]:r()").join(",")+"}"),this.compiledReader&&(s.next=this.compiledReader),s.propertyCount=i,this.compiledReader=s,s(vt)}let r={};if(yt.keyMap)for(let a=0;a<i;a++)r[ue(yt.decodeKey(this[a]))]=vt();else for(let a=0;a<i;a++)r[ue(this[a])]=vt();return r}return n.slowReads=0,t}function ue(n){if(typeof n=="string")return n==="__proto__"?"__proto_":n;if(typeof n=="number"||typeof n=="boolean"||typeof n=="bigint")return n.toString();if(n==null)return n+"";throw new Error("Invalid property name type "+typeof n)}let Qy=bs;function bs(n){let t;if(n<16&&(t=$u(n)))return t;if(n>64&&gs)return gs.decode(rt.subarray(U,U+=n));const i=U+n,s=[];for(t="";U<i;){const r=rt[U++];if((r&128)===0)s.push(r);else if((r&224)===192){const a=rt[U++]&63;s.push((r&31)<<6|a)}else if((r&240)===224){const a=rt[U++]&63,l=rt[U++]&63;s.push((r&31)<<12|a<<6|l)}else if((r&248)===240){const a=rt[U++]&63,l=rt[U++]&63,u=rt[U++]&63;let f=(r&7)<<18|a<<12|l<<6|u;f>65535&&(f-=65536,s.push(f>>>10&1023|55296),f=56320|f&1023),s.push(f)}else s.push(r);s.length>=4096&&(t+=Nt.apply(String,s),s.length=0)}return s.length>0&&(t+=Nt.apply(String,s)),t}let Nt=String.fromCharCode;function tv(n){let t=U,i=new Array(n);for(let s=0;s<n;s++){const r=rt[U++];if((r&128)>0){U=t;return}i[s]=r}return Nt.apply(String,i)}function $u(n){if(n<4)if(n<2){if(n===0)return"";{let t=rt[U++];if((t&128)>1){U-=1;return}return Nt(t)}}else{let t=rt[U++],i=rt[U++];if((t&128)>0||(i&128)>0){U-=2;return}if(n<3)return Nt(t,i);let s=rt[U++];if((s&128)>0){U-=3;return}return Nt(t,i,s)}else{let t=rt[U++],i=rt[U++],s=rt[U++],r=rt[U++];if((t&128)>0||(i&128)>0||(s&128)>0||(r&128)>0){U-=4;return}if(n<6){if(n===4)return Nt(t,i,s,r);{let a=rt[U++];if((a&128)>0){U-=5;return}return Nt(t,i,s,r,a)}}else if(n<8){let a=rt[U++],l=rt[U++];if((a&128)>0||(l&128)>0){U-=6;return}if(n<7)return Nt(t,i,s,r,a,l);let u=rt[U++];if((u&128)>0){U-=7;return}return Nt(t,i,s,r,a,l,u)}else{let a=rt[U++],l=rt[U++],u=rt[U++],f=rt[U++];if((a&128)>0||(l&128)>0||(u&128)>0||(f&128)>0){U-=8;return}if(n<10){if(n===8)return Nt(t,i,s,r,a,l,u,f);{let _=rt[U++];if((_&128)>0){U-=9;return}return Nt(t,i,s,r,a,l,u,f,_)}}else if(n<12){let _=rt[U++],g=rt[U++];if((_&128)>0||(g&128)>0){U-=10;return}if(n<11)return Nt(t,i,s,r,a,l,u,f,_,g);let p=rt[U++];if((p&128)>0){U-=11;return}return Nt(t,i,s,r,a,l,u,f,_,g,p)}else{let _=rt[U++],g=rt[U++],p=rt[U++],m=rt[U++];if((_&128)>0||(g&128)>0||(p&128)>0||(m&128)>0){U-=12;return}if(n<14){if(n===12)return Nt(t,i,s,r,a,l,u,f,_,g,p,m);{let v=rt[U++];if((v&128)>0){U-=13;return}return Nt(t,i,s,r,a,l,u,f,_,g,p,m,v)}}else{let v=rt[U++],b=rt[U++];if((v&128)>0||(b&128)>0){U-=14;return}if(n<15)return Nt(t,i,s,r,a,l,u,f,_,g,p,m,v,b);let S=rt[U++];if((S&128)>0){U-=15;return}return Nt(t,i,s,r,a,l,u,f,_,g,p,m,v,b,S)}}}}}function ev(n){return yt.copyBuffers?Uint8Array.prototype.slice.call(rt,U,U+=n):rt.subarray(U,U+=n)}let Zu=new Float32Array(1),rr=new Uint8Array(Zu.buffer,0,4);function nv(){let n=rt[U++],t=rt[U++],i=(n&127)>>2;if(i===31)return t||n&3?NaN:n&128?-1/0:1/0;if(i===0){let s=((n&3)<<8|t)/0x1000000;return n&128?-s:s}return rr[3]=n&128|(i>>1)+56,rr[2]=(n&7)<<5|t>>3,rr[1]=t<<5,rr[0]=0,Zu[0]}new Array(4096);class vn{constructor(t,i){this.value=t,this.tag=i}}Bt[0]=n=>new Date(n);Bt[1]=n=>new Date(Math.round(n*1e3));Bt[2]=n=>{let t=BigInt(0);for(let i=0,s=n.byteLength;i<s;i++)t=BigInt(n[i])+(t<<BigInt(8));return t};Bt[3]=n=>BigInt(-1)-Bt[2](n);Bt[4]=n=>+(n[1]+"e"+n[0]);Bt[5]=n=>n[1]*Math.exp(n[0]*Math.log(2));const ws=(n,t)=>{n=n-57344;let i=Pt[n];i&&i.isShared&&((Pt.restoreStructures||(Pt.restoreStructures=[]))[n]=i),Pt[n]=t,t.read=vs(t)};Bt[Yy]=n=>{let t=n.length,i=n[1];ws(n[0],i);let s={};for(let r=2;r<t;r++){let a=i[r-2];s[ue(a)]=n[r]}return s};Bt[14]=n=>jt?jt[0].slice(jt.position0,jt.position0+=n):new vn(n,14);Bt[15]=n=>jt?jt[1].slice(jt.position1,jt.position1+=n):new vn(n,15);let iv={Error,RegExp};Bt[27]=n=>(iv[n[0]]||Error)(n[1],n[2]);const Vu=n=>{if(rt[U++]!=132){let i=new Error("Packed values structure must be followed by a 4 element array");throw rt.length<U&&(i.incomplete=!0),i}let t=n();if(!t||!t.length){let i=new Error("Packed values structure must be followed by a 4 element array");throw i.incomplete=!0,i}return ee=ee?t.concat(ee.slice(t.length)):t,ee.prefixes=n(),ee.suffixes=n(),n()};Vu.handlesRead=!0;Bt[51]=Vu;Bt[Wc]=n=>{if(!ee)if(yt.getShared)qs();else return new vn(n,Wc);if(typeof n=="number")return ee[16+(n>=0?2*n:-2*n-1)];let t=new Error("No support for non-integer packed references yet");throw n===void 0&&(t.incomplete=!0),t};Bt[28]=n=>{he||(he=new Map,he.id=0);let t=he.id++,i=U,s=rt[U],r;s>>5==4?r=[]:r={};let a={target:r};he.set(t,a);let l=n();return a.used?(Object.getPrototypeOf(r)!==Object.getPrototypeOf(l)&&(U=i,r=l,he.set(t,{target:r}),l=n()),Object.assign(r,l)):(a.target=l,l)};Bt[28].handlesRead=!0;Bt[29]=n=>{let t=he.get(n);return t.used=!0,t.target};Bt[258]=n=>new Set(n);(Bt[259]=n=>(yt.mapsAsObjects&&(yt.mapsAsObjects=!1,ui=!0),n())).handlesRead=!0;function Rn(n,t){return typeof n=="string"?n+t:n instanceof Array?n.concat(t):Object.assign({},n,t)}function hn(){if(!ee)if(yt.getShared)qs();else throw new Error("No packed values available");return ee}const rv=0x53687264;ys.push((n,t)=>{if(n>=225&&n<=255)return Rn(hn().prefixes[n-224],t);if(n>=28704&&n<=32767)return Rn(hn().prefixes[n-28672],t);if(n>=0x70001000&&n<=0x7fffffff)return Rn(hn().prefixes[n-0x70000000],t);if(n>=216&&n<=223)return Rn(t,hn().suffixes[n-216]);if(n>=27647&&n<=28671)return Rn(t,hn().suffixes[n-27639]);if(n>=0x6c000400&&n<=0x6fffffff)return Rn(t,hn().suffixes[n-0x6c000000]);if(n==rv)return{packedValues:ee,structures:Pt.slice(0),version:t};if(n==55799)return t});const ov=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,Yc=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],sv=[64,68,69,70,71,72,77,78,79,85,86];for(let n=0;n<Yc.length;n++)av(Yc[n],sv[n]);function av(n,t){let i="get"+n.name.slice(0,-5),s;typeof n=="function"?s=n.BYTES_PER_ELEMENT:n=null;for(let r=0;r<2;r++){if(!r&&s==1)continue;let a=s==2?1:s==4?2:s==8?3:0;Bt[r?t:t-4]=s==1||r==ov?l=>{if(!n)throw new Error("Could not find typed array for code "+t);return!yt.copyBuffers&&(s===1||s===2&&!(l.byteOffset&1)||s===4&&!(l.byteOffset&3)||s===8&&!(l.byteOffset&7))?new n(l.buffer,l.byteOffset,l.byteLength>>a):new n(Uint8Array.prototype.slice.call(l,0).buffer)}:l=>{if(!n)throw new Error("Could not find typed array for code "+t);let u=new DataView(l.buffer,l.byteOffset,l.byteLength),f=l.length>>a,_=new n(f),g=u[i];for(let p=0;p<f;p++)_[p]=g.call(u,p<<a,r);return _}}}function cv(){let n=Fn(),t=U+vt();for(let s=2;s<n;s++){let r=Fn();U+=r}let i=U;return U=t,jt=[bs(Fn()),bs(Fn())],jt.position0=0,jt.position1=0,jt.postBundlePosition=U,U=i,vt()}function Fn(){let n=rt[U++]&31;if(n>23)switch(n){case 24:n=rt[U++];break;case 25:n=Yt.getUint16(U),U+=2;break;case 26:n=Yt.getUint32(U),U+=4;break}return n}function qs(){if(yt.getShared){let n=Gu(()=>(rt=null,yt.getShared()))||{},t=n.structures||[];yt.sharedVersion=n.version,ee=yt.sharedValues=n.packedValues,Pt===!0?yt.structures=Pt=t:Pt.splice.apply(Pt,[0,t.length].concat(t))}}function Gu(n){let t=gn,i=U,s=Or,r=Si,a=Dr,l=he,u=jt,f=new Uint8Array(rt.slice(0,gn)),_=Pt,g=yt,p=Ei,m=n();return gn=t,U=i,Or=s,Si=r,Dr=a,he=l,jt=u,rt=f,Ei=p,Pt=_,yt=g,Yt=new DataView(rt.buffer,rt.byteOffset,rt.byteLength),m}function xs(){rt=null,he=null,Pt=null}const Ks=new Array(147);for(let n=0;n<256;n++)Ks[n]=+("1e"+Math.floor(45.15-n*.30103));let Ys=new ki({useRecords:!1});const Wu=Ys.decode;Ys.decodeMultiple;let pr;try{pr=new TextEncoder}catch{}let Ls,qu;const Jr=typeof globalThis=="object"&&globalThis.Buffer,Ai=typeof Jr<"u",Vo=Ai?Jr.allocUnsafeSlow:Uint8Array,Jc=Ai?Jr:Uint8Array,Xc=256,Qc=Ai?0x100000000:0x7fd00000;let Go,P,kt,k=0,Qe,Ht=null;const lv=61440,hv=/[\u0080-\uFFFF]/,ie=Symbol("record-id");class Ku extends ki{constructor(t){super(t),this.offset=0;let i,s,r,a,l;t=t||{};let u=Jc.prototype.utf8Write?function(E,Z,H){return P.utf8Write(E,Z,H)}:pr&&pr.encodeInto?function(E,Z){return pr.encodeInto(E,P.subarray(Z)).written}:!1,f=this,_=t.structures||t.saveStructures,g=t.maxSharedStructures;if(g==null&&(g=_?128:0),g>8190)throw new Error("Maximum maxSharedStructure is 8190");let p=t.sequential;p&&(g=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let m,v,b=t.sharedValues,S;if(b){S=Object.create(null);for(let E=0,Z=b.length;E<Z;E++)S[b[E]]=E}let C=[],V=0,A=0;this.mapEncode=function(E,Z){if(this._keyMap&&!this._mapped)switch(E.constructor.name){case"Array":E=E.map(H=>this.encodeKeys(H));break}return this.encode(E,Z)},this.encode=function(E,Z){if(P||(P=new Vo(8192),kt=new DataView(P.buffer,0,8192),k=0),Qe=P.length-10,Qe-k<2048?(P=new Vo(P.length),kt=new DataView(P.buffer,0,P.length),Qe=P.length-10,k=0):Z===nl&&(k=k+7&0x7ffffff8),i=k,f.useSelfDescribedHeader&&(kt.setUint32(k,0xd9d9f700),k+=3),l=f.structuredClone?new Map:null,f.bundleStrings&&typeof E!="string"?(Ht=[],Ht.size=1/0):Ht=null,s=f.structures,s){if(s.uninitialized){let R=f.getShared()||{};f.structures=s=R.structures||[],f.sharedVersion=R.version;let j=f.sharedValues=R.packedValues;if(j){S={};for(let q=0,T=j.length;q<T;q++)S[j[q]]=q}}let H=s.length;if(H>g&&!p&&(H=g),!s.transitions){s.transitions=Object.create(null);for(let R=0;R<H;R++){let j=s[R];if(!j)continue;let q,T=s.transitions;for(let I=0,$=j.length;I<$;I++){T[ie]===void 0&&(T[ie]=R);let tt=j[I];q=T[tt],q||(q=T[tt]=Object.create(null)),T=q}T[ie]=R|1048576}}p||(s.nextId=H)}if(r&&(r=!1),a=s||[],v=S,t.pack){let H=new Map;if(H.values=[],H.encoder=f,H.maxValues=t.maxPrivatePackedValues||(S?16:1/0),H.objectMap=S||!1,H.samplingPackedValues=m,mr(E,H),H.values.length>0){P[k++]=216,P[k++]=51,Ce(4);let R=H.values;w(R),Ce(0),Ce(0),v=Object.create(S||null);for(let j=0,q=R.length;j<q;j++)v[R[j]]=j}}Go=Z&qo;try{if(Go)return;if(w(E),Ht&&el(i,w),f.offset=k,l&&l.idsToInsert){k+=l.idsToInsert.length*2,k>Qe&&O(k),f.offset=k;let H=fv(P.subarray(i,k),l.idsToInsert);return l=null,H}return Z&nl?(P.start=i,P.end=k,P):P.subarray(i,k)}finally{if(s){if(A<10&&A++,s.length>g&&(s.length=g),V>1e4)s.transitions=null,A=0,V=0,C.length>0&&(C=[]);else if(C.length>0&&!p){for(let H=0,R=C.length;H<R;H++)C[H][ie]=void 0;C=[]}}if(r&&f.saveShared){f.structures.length>g&&(f.structures=f.structures.slice(0,g));let H=P.subarray(i,k);return f.updateSharedData()===!1?f.encode(E):H}Z&_v&&(k=i)}},this.findCommonStringsToPack=()=>(m=new Map,S||(S=Object.create(null)),E=>{let Z=E&&E.threshold||4,H=this.pack?E.maxPrivatePackedValues||16:0;b||(b=this.sharedValues=[]);for(let[R,j]of m)j.count>Z&&(S[R]=H++,b.push(R),r=!0);for(;this.saveShared&&this.updateSharedData()===!1;);m=null});const w=E=>{k>Qe&&(P=O(k));var Z=typeof E,H;if(Z==="string"){if(v){let T=v[E];if(T>=0){T<16?P[k++]=T+224:(P[k++]=198,T&1?w(15-T>>1):w(T-16>>1));return}else if(m&&!t.pack){let I=m.get(E);I?I.count++:m.set(E,{count:1})}}let R=E.length;if(Ht&&R>=4&&R<1024){if((Ht.size+=R)>lv){let I,$=(Ht[0]?Ht[0].length*3+Ht[1].length:0)+10;k+$>Qe&&(P=O(k+$)),P[k++]=217,P[k++]=223,P[k++]=249,P[k++]=Ht.position?132:130,P[k++]=26,I=k-i,k+=4,Ht.position&&el(i,w),Ht=["",""],Ht.size=0,Ht.position=I}let T=hv.test(E);Ht[T?0:1]+=E,P[k++]=T?206:207,w(R);return}let j;R<32?j=1:R<256?j=2:R<65536?j=3:j=5;let q=R*3;if(k+q>Qe&&(P=O(k+q)),R<64||!u){let T,I,$,tt=k+j;for(T=0;T<R;T++)I=E.charCodeAt(T),I<128?P[tt++]=I:I<2048?(P[tt++]=I>>6|192,P[tt++]=I&63|128):(I&64512)===55296&&(($=E.charCodeAt(T+1))&64512)===56320?(I=65536+((I&1023)<<10)+($&1023),T++,P[tt++]=I>>18|240,P[tt++]=I>>12&63|128,P[tt++]=I>>6&63|128,P[tt++]=I&63|128):(P[tt++]=I>>12|224,P[tt++]=I>>6&63|128,P[tt++]=I&63|128);H=tt-k-j}else H=u(E,k+j,q);H<24?P[k++]=96|H:H<256?(j<2&&P.copyWithin(k+2,k+1,k+1+H),P[k++]=120,P[k++]=H):H<65536?(j<3&&P.copyWithin(k+3,k+2,k+2+H),P[k++]=121,P[k++]=H>>8,P[k++]=H&255):(j<5&&P.copyWithin(k+5,k+3,k+3+H),P[k++]=122,kt.setUint32(k,H),k+=4),k+=H}else if(Z==="number")if(!this.alwaysUseFloat&&E>>>0===E)E<24?P[k++]=E:E<256?(P[k++]=24,P[k++]=E):E<65536?(P[k++]=25,P[k++]=E>>8,P[k++]=E&255):(P[k++]=26,kt.setUint32(k,E),k+=4);else if(!this.alwaysUseFloat&&E>>0===E)E>=-24?P[k++]=31-E:E>=-256?(P[k++]=56,P[k++]=~E):E>=-65536?(P[k++]=57,kt.setUint16(k,~E),k+=2):(P[k++]=58,kt.setUint32(k,~E),k+=4);else{let R;if((R=this.useFloat32)>0&&E<0x100000000&&E>=-0x80000000){P[k++]=250,kt.setFloat32(k,E);let j;if(R<4||(j=E*Ks[(P[k]&127)<<1|P[k+1]>>7])>>0===j){k+=4;return}else k--}P[k++]=251,kt.setFloat64(k,E),k+=8}else if(Z==="object")if(!E)P[k++]=246;else{if(l){let j=l.get(E);if(j){if(P[k++]=216,P[k++]=29,P[k++]=25,!j.references){let q=l.idsToInsert||(l.idsToInsert=[]);j.references=[],q.push(j)}j.references.push(k-i),k+=2;return}else l.set(E,{offset:k-i})}let R=E.constructor;if(R===Object)F(E);else if(R===Array){H=E.length,H<24?P[k++]=128|H:Ce(H);for(let j=0;j<H;j++)w(E[j])}else if(R===Map)if((this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)&&(P[k++]=217,P[k++]=1,P[k++]=3),H=E.size,H<24?P[k++]=160|H:H<256?(P[k++]=184,P[k++]=H):H<65536?(P[k++]=185,P[k++]=H>>8,P[k++]=H&255):(P[k++]=186,kt.setUint32(k,H),k+=4),f.keyMap)for(let[j,q]of E)w(f.encodeKey(j)),w(q);else for(let[j,q]of E)w(j),w(q);else{for(let j=0,q=Ls.length;j<q;j++){let T=qu[j];if(E instanceof T){let I=Ls[j],$=I.tag;$==null&&($=I.getTag&&I.getTag.call(this,E)),$<24?P[k++]=192|$:$<256?(P[k++]=216,P[k++]=$):$<65536?(P[k++]=217,P[k++]=$>>8,P[k++]=$&255):$>-1&&(P[k++]=218,kt.setUint32(k,$),k+=4),I.encode.call(this,E,w,O);return}}if(E[Symbol.iterator]){if(Go){let j=new Error("Iterable should be serialized as iterator");throw j.iteratorNotHandled=!0,j}P[k++]=159;for(let j of E)w(j);P[k++]=255;return}if(E[Symbol.asyncIterator]||Wo(E)){let j=new Error("Iterable/blob should be serialized as iterator");throw j.iteratorNotHandled=!0,j}if(this.useToJSON&&E.toJSON){const j=E.toJSON();if(j!==E)return w(j)}F(E)}}else if(Z==="boolean")P[k++]=E?245:244;else if(Z==="bigint"){if(E<BigInt(1)<<BigInt(64)&&E>=0)P[k++]=27,kt.setBigUint64(k,E);else if(E>-(BigInt(1)<<BigInt(64))&&E<0)P[k++]=59,kt.setBigUint64(k,-E-BigInt(1));else if(this.largeBigIntToFloat)P[k++]=251,kt.setFloat64(k,Number(E));else{E>=BigInt(0)?P[k++]=194:(P[k++]=195,E=BigInt(-1)-E);let R=[];for(;E;)R.push(Number(E&BigInt(255))),E>>=BigInt(8);Ss(new Uint8Array(R.reverse()),O);return}k+=8}else if(Z==="undefined")P[k++]=247;else throw new Error("Unknown type: "+Z)},F=this.useRecords===!1?this.variableMapSize?E=>{let Z=Object.keys(E),H=Object.values(E),R=Z.length;if(R<24?P[k++]=160|R:R<256?(P[k++]=184,P[k++]=R):R<65536?(P[k++]=185,P[k++]=R>>8,P[k++]=R&255):(P[k++]=186,kt.setUint32(k,R),k+=4),f.keyMap)for(let j=0;j<R;j++)w(f.encodeKey(Z[j])),w(H[j]);else for(let j=0;j<R;j++)w(Z[j]),w(H[j])}:E=>{P[k++]=185;let Z=k-i;k+=2;let H=0;if(f.keyMap)for(let R in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(R))&&(w(f.encodeKey(R)),w(E[R]),H++);else for(let R in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(R))&&(w(R),w(E[R]),H++);P[Z+++i]=H>>8,P[Z+i]=H&255}:(E,Z)=>{let H,R=a.transitions||(a.transitions=Object.create(null)),j=0,q=0,T,I;if(this.keyMap){I=Object.keys(E).map(tt=>this.encodeKey(tt)),q=I.length;for(let tt=0;tt<q;tt++){let ht=I[tt];H=R[ht],H||(H=R[ht]=Object.create(null),j++),R=H}}else for(let tt in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(tt))&&(H=R[tt],H||(R[ie]&1048576&&(T=R[ie]&65535),H=R[tt]=Object.create(null),j++),R=H,q++);let $=R[ie];if($!==void 0)$&=65535,P[k++]=217,P[k++]=$>>8|224,P[k++]=$&255;else if(I||(I=R.__keys__||(R.__keys__=Object.keys(E))),T===void 0?($=a.nextId++,$||($=0,a.nextId=1),$>=Xc&&(a.nextId=($=g)+1)):$=T,a[$]=I,$<g){P[k++]=217,P[k++]=$>>8|224,P[k++]=$&255,R=a.transitions;for(let tt=0;tt<q;tt++)(R[ie]===void 0||R[ie]&1048576)&&(R[ie]=$),R=R[I[tt]];R[ie]=$|1048576,r=!0}else{if(R[ie]=$,kt.setUint32(k,0xd9dfff00),k+=3,j&&(V+=A*j),C.length>=Xc-g&&(C.shift()[ie]=void 0),C.push(R),Ce(q+2),w(57344+$),w(I),Z)return;for(let tt in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(tt))&&w(E[tt]);return}if(q<24?P[k++]=128|q:Ce(q),!Z)for(let tt in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(tt))&&w(E[tt])},O=E=>{let Z;if(E>0x1000000){if(E-i>Qc)throw new Error("Encoded buffer would be larger than maximum buffer size");Z=Math.min(Qc,Math.round(Math.max((E-i)*(E>0x4000000?1.25:2),4194304)/4096)*4096)}else Z=(Math.max(E-i<<2,P.length-1)>>12)+1<<12;let H=new Vo(Z);return kt=new DataView(H.buffer,0,Z),P.copy?P.copy(H,0,i,E):H.set(P.slice(i,E)),k-=i,i=0,Qe=H.length-10,P=H};let K=100,nt=1e3;this.encodeAsIterable=function(E,Z){return J(E,Z,Q)},this.encodeAsAsyncIterable=function(E,Z){return J(E,Z,ot)};function*Q(E,Z,H){let R=E.constructor;if(R===Object){let j=f.useRecords!==!1;j?F(E,!0):tl(Object.keys(E).length,160);for(let q in E){let T=E[q];j||w(q),T&&typeof T=="object"?Z[q]?yield*Q(T,Z[q]):yield*N(T,Z,q):w(T)}}else if(R===Array){let j=E.length;Ce(j);for(let q=0;q<j;q++){let T=E[q];T&&(typeof T=="object"||k-i>K)?Z.element?yield*Q(T,Z.element):yield*N(T,Z,"element"):w(T)}}else if(E[Symbol.iterator]&&!E.buffer){P[k++]=159;for(let j of E)j&&(typeof j=="object"||k-i>K)?Z.element?yield*Q(j,Z.element):yield*N(j,Z,"element"):w(j);P[k++]=255}else Wo(E)?(tl(E.size,64),yield P.subarray(i,k),yield E,G()):E[Symbol.asyncIterator]?(P[k++]=159,yield P.subarray(i,k),yield E,G(),P[k++]=255):w(E);H&&k>i?yield P.subarray(i,k):k-i>K&&(yield P.subarray(i,k),G())}function*N(E,Z,H){let R=k-i;try{w(E),k-i>K&&(yield P.subarray(i,k),G())}catch(j){if(j.iteratorNotHandled)Z[H]={},k=i+R,yield*Q.call(this,E,Z[H]);else throw j}}function G(){K=nt,f.encode(null,qo)}function J(E,Z,H){return Z&&Z.chunkThreshold?K=nt=Z.chunkThreshold:K=100,E&&typeof E=="object"?(f.encode(null,qo),H(E,f.iterateProperties||(f.iterateProperties={}),!0)):[f.encode(E)]}async function*ot(E,Z){for(let H of Q(E,Z,!0)){let R=H.constructor;if(R===Jc||R===Uint8Array)yield H;else if(Wo(H)){let j=H.stream().getReader(),q;for(;!(q=await j.read()).done;)yield q.value}else if(H[Symbol.asyncIterator])for await(let j of H)G(),j?yield*ot(j,Z.async||(Z.async={})):yield f.encode(j);else yield H}}}useBuffer(t){P=t,kt=new DataView(P.buffer,P.byteOffset,P.byteLength),k=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let t=this.sharedVersion||0;this.sharedVersion=t+1;let i=this.structures.slice(0),s=new Yu(i,this.sharedValues,this.sharedVersion),r=this.saveShared(s,a=>(a&&a.version||0)==t);return r===!1?(s=this.getShared()||{},this.structures=s.structures||[],this.sharedValues=s.packedValues,this.sharedVersion=s.version,this.structures.nextId=this.structures.length):i.forEach((a,l)=>this.structures[l]=a),r}}function tl(n,t){n<24?P[k++]=t|n:n<256?(P[k++]=t|24,P[k++]=n):n<65536?(P[k++]=t|25,P[k++]=n>>8,P[k++]=n&255):(P[k++]=t|26,kt.setUint32(k,n),k+=4)}class Yu{constructor(t,i,s){this.structures=t,this.packedValues=i,this.version=s}}function Ce(n){n<24?P[k++]=128|n:n<256?(P[k++]=152,P[k++]=n):n<65536?(P[k++]=153,P[k++]=n>>8,P[k++]=n&255):(P[k++]=154,kt.setUint32(k,n),k+=4)}const uv=typeof Blob>"u"?function(){}:Blob;function Wo(n){if(n instanceof uv)return!0;let t=n[Symbol.toStringTag];return t==="Blob"||t==="File"}function mr(n,t){switch(typeof n){case"string":if(n.length>3){if(t.objectMap[n]>-1||t.values.length>=t.maxValues)return;let s=t.get(n);if(s)++s.count==2&&t.values.push(n);else if(t.set(n,{count:1}),t.samplingPackedValues){let r=t.samplingPackedValues.get(n);r?r.count++:t.samplingPackedValues.set(n,{count:1})}}break;case"object":if(n)if(n instanceof Array)for(let s=0,r=n.length;s<r;s++)mr(n[s],t);else{let s=!t.encoder.useRecords;for(var i in n)n.hasOwnProperty(i)&&(s&&mr(i,t),mr(n[i],t))}break;case"function":console.log(n)}}const dv=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;qu=[Date,Set,Error,RegExp,vn,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?function(){}:BigInt64Array,Float32Array,Float64Array,Yu];Ls=[{tag:1,encode(n,t){let i=n.getTime()/1e3;(this.useTimestamp32||n.getMilliseconds()===0)&&i>=0&&i<0x100000000?(P[k++]=26,kt.setUint32(k,i),k+=4):(P[k++]=251,kt.setFloat64(k,i),k+=8)}},{tag:258,encode(n,t){let i=Array.from(n);t(i)}},{tag:27,encode(n,t){t([n.name,n.message])}},{tag:27,encode(n,t){t(["RegExp",n.source,n.flags])}},{getTag(n){return n.tag},encode(n,t){t(n.value)}},{encode(n,t,i){Ss(n,i)}},{getTag(n){if(n.constructor===Uint8Array&&(this.tagUint8Array||Ai&&this.tagUint8Array!==!1))return 64},encode(n,t,i){Ss(n,i)}},ke(68,1),ke(69,2),ke(70,4),ke(71,8),ke(72,1),ke(77,2),ke(78,4),ke(79,8),ke(85,4),ke(86,8),{encode(n,t){let i=n.packedValues||[],s=n.structures||[];if(i.values.length>0){P[k++]=216,P[k++]=51,Ce(4);let r=i.values;t(r),Ce(0),Ce(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let a=0,l=r.length;a<l;a++)packedObjectMap[r[a]]=a}if(s){kt.setUint32(k,0xd9dffe00),k+=3;let r=s.slice(0);r.unshift(57344),r.push(new vn(n.version,0x53687264)),t(r)}else t(new vn(n.version,0x53687264))}}];function ke(n,t){return!dv&&t>1&&(n-=4),{tag:n,encode:function(s,r){let a=s.byteLength,l=s.byteOffset||0,u=s.buffer||s;r(Ai?Jr.from(u,l,a):new Uint8Array(u,l,a))}}}function Ss(n,t){let i=n.byteLength;i<24?P[k++]=64+i:i<256?(P[k++]=88,P[k++]=i):i<65536?(P[k++]=89,P[k++]=i>>8,P[k++]=i&255):(P[k++]=90,kt.setUint32(k,i),k+=4),k+i>=P.length&&t(k+i),P.set(n.buffer?n:new Uint8Array(n),k),k+=i}function fv(n,t){let i,s=t.length*2,r=n.length-s;t.sort((a,l)=>a.offset>l.offset?1:-1);for(let a=0;a<t.length;a++){let l=t[a];l.id=a;for(let u of l.references)n[u++]=a>>8,n[u]=a&255}for(;i=t.pop();){let a=i.offset;n.copyWithin(a+s,a,r),s-=2;let l=a+s;n[l++]=216,n[l++]=28,r=a}return n}function el(n,t){kt.setUint32(Ht.position+n,k-Ht.position-n+1);let i=Ht;Ht=null,t(i[0]),t(i[1])}let Js=new Ku({useRecords:!1});Js.encode;Js.encodeAsIterable;Js.encodeAsAsyncIterable;const nl=512,_v=1024,qo=2048;function Ju(n){return new Ku({tagUint8Array:!1,useRecords:!1}).encode(n)}function pv(n){return Wu(n)}const mv=(n,t)=>n.length===t.length&&n.every((i,s)=>i===t[s]),Xs=(n,t)=>mv(n,t),gv=async(n,t)=>{let i;const s=new Promise((r,a)=>{i=setTimeout(()=>a(new yv(`withTimeout: timed out after ${t}ms`)),t)});try{return await Promise.race([n,s])}finally{clearTimeout(i)}};class yv extends Error{constructor(t){super(t),this.name="TimeoutError"}}class Br extends wn{documentId;#e;#t;#i;#n=ve();#r=6e4;#o={};#c=new Map;constructor(t,i={}){super(),this.documentId=t,"timeoutDelay"in i&&i.timeoutDelay&&(this.#r=i.timeoutDelay),"heads"in i&&(this.#i=i.heads);const s=ve();this.#e=We(`automerge-repo:dochandle:${this.documentId.slice(0,5)}`);const r=this.#r,a=Cy({actions:{onUpdate:pn(({context:l,event:u})=>{const f=l.doc;ky(u,rl);const{callback:_}=u.payload;return{doc:_(f)}}),onDelete:pn(()=>(this.emit("delete",{handle:this}),{doc:ve()})),onUnavailable:pn(()=>({doc:ve()})),onUnload:pn(()=>({doc:ve()}))}}).createMachine({initial:"idle",context:{documentId:t,doc:s},on:{UPDATE:{actions:"onUpdate"},UNLOAD:".unloaded",DELETE:".deleted"},states:{idle:{on:{BEGIN:"loading"}},loading:{on:{REQUEST:"requesting",DOC_READY:"ready"},after:{[r]:"unavailable"}},requesting:{on:{DOC_UNAVAILABLE:"unavailable",DOC_READY:"ready"},after:{[r]:"unavailable"}},unavailable:{entry:"onUnavailable",on:{DOC_READY:"ready"}},ready:{},unloaded:{entry:"onUnload",on:{RELOAD:"loading"}},deleted:{entry:"onDelete",type:"final"}}});this.#t=xi(a),this.#t.subscribe(l=>{const u=this.#n,f=l.context.doc;this.#e(`→ ${l.value} %o`,f),this.#f(u,f)}),this.#t.start(),this.begin()}get #a(){return this.#t?.getSnapshot().context.doc}get #s(){return this.#t?.getSnapshot().value}#u(t){const i=Array.isArray(t)?t:[t];return Py(this.#t,s=>i.some(r=>s.matches(r)),{timeout:this.#r*2})}#h(t){let i=null;if(this.#t.send({type:rl,payload:{callback:s=>{try{return t(s)}catch(r){return i=r,s}}}}),i)throw i}#f(t,i){const s=Fe(t),r=Fe(i);if(!Xs(De(r),De(s))){this.emit("heads-changed",{handle:this,doc:i});const l=Do(i,s,r);l.length>0&&this.emit("change",{handle:this,doc:i,patches:l,patchInfo:{before:t,after:i,source:"change"}}),this.isReady()||this.#t.send({type:il})}this.#n=i}get url(){return Hu({documentId:this.documentId,heads:this.#i})}isReady=()=>this.inState(["ready"]);isUnloaded=()=>this.inState(["unloaded"]);isDeleted=()=>this.inState(["deleted"]);isUnavailable=()=>this.inState(["unavailable"]);inState=t=>t.some(i=>this.#t.getSnapshot().matches(i));get state(){return this.#t.getSnapshot().value}async whenReady(t=["ready"]){try{await gv(this.#u(t),this.#r)}catch(i){throw console.log(`error waiting for ${this.documentId} to be in one of states: ${t.join(", ")}`),i}}doc(){if(!this.isReady())throw new Error("DocHandle is not ready");return this.#i?Km(this.#a,an(this.#i)):this.#a}docSync(){return console.warn("docSync is deprecated. Use doc() instead. This function will be removed as part of the 2.0 release."),this.doc()}heads(){if(!this.isReady())throw new Error("DocHandle is not ready");return this.#i?this.#i:De(Fe(this.#a))}begin(){this.#t.send({type:wv})}history(){if(this.isReady())return sg(this.#a).map(t=>De([t]))}view(t){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before calling view().`);const i=JSON.stringify(t),s=this.#c.get(i);if(s)return s;const r=new Br(this.documentId,{heads:t,timeoutDelay:this.#r});return r.update(()=>kr(this.#a)),r.doneLoading(),this.#c.set(i,r),r}diff(t,i){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before calling diff().`);const s=this.#a;if(!s)throw new Error("Document not available");if(t instanceof Br){if(!t.isReady())throw new Error("Cannot diff against a handle that isn't ready");const l=t.heads();if(!l)throw new Error("Other document's heads not available");const u=vc(kr(s),t.doc());return Do(u,an(this.heads()),an(l))}const r=i?t:this.heads()||[],a=i||t;return Do(s,an(r),an(a))}metadata(t){if(this.isReady())return t||(t=this.heads()[0]),ag(this.#a,an([t])[0])||void 0}update(t){this.#h(t)}doneLoading(){this.#t.send({type:il})}setSyncInfo(t,i){this.#o[t]=i,this.emit("remote-heads",{storageId:t,heads:i.lastHeads,timestamp:i.lastSyncTimestamp})}getRemoteHeads(t){return this.#o[t]?.lastHeads}getSyncInfo(t){return this.#o[t]}change(t,i={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is in ${this.state} and not ready. Check \`handle.isReady()\` before accessing the document.`);if(this.#i)throw new Error(`DocHandle#${this.documentId} is in view-only mode at specific heads. Use clone() to create a new document from this state.`);this.#h(s=>lu(s,i,t))}changeAt(t,i,s={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before accessing the document.`);if(this.#i)throw new Error(`DocHandle#${this.documentId} is in view-only mode at specific heads. Use clone() to create a new document from this state.`);let r;return this.#h(a=>{const l=Jm(a,an(t),s,i);return r=l.newHeads?De(l.newHeads):void 0,l.newDoc}),r}isReadOnly(){return!!this.#i}merge(t){if(!this.isReady()||!t.isReady())throw new Error("Both handles must be ready to merge");if(this.#i)throw new Error(`DocHandle#${this.documentId} is in view-only mode at specific heads. Use clone() to create a new document from this state.`);const i=t.doc();this.update(s=>vc(s,i))}unavailable(){this.#t.send({type:kv})}request(){this.#s==="loading"&&this.#t.send({type:xv})}unload(){this.#t.send({type:Lv})}reload(){this.#t.send({type:Sv})}delete(){this.#t.send({type:Ev})}broadcast(t){this.emit("ephemeral-message-outbound",{handle:this,data:new Uint8Array(Ju(t))})}metrics(){return Bs(this.#a)}}const vv={REQUESTING:"requesting",READY:"ready",UNLOADED:"unloaded",DELETED:"deleted",UNAVAILABLE:"unavailable"},{REQUESTING:or,READY:Me,UNLOADED:bv,DELETED:sr,UNAVAILABLE:oe}=vv,wv="BEGIN",xv="REQUEST",il="DOC_READY",rl="UPDATE",Lv="UNLOAD",Sv="RELOAD",Ev="DELETE",kv="DOC_UNAVAILABLE";class Tv extends wn{#e=new Map;#t=new Set;#i=new Map;#n=new Set;#r=new Map;#o=We("automerge-repo:remote-heads-subscriptions");subscribeToRemotes(t){this.#o("subscribeToRemotes",t);const i=[];for(const s of t)this.#t.has(s)||(this.#t.add(s),i.push(s));i.length>0&&this.emit("change-remote-subs",{add:i,peers:Array.from(this.#n)})}unsubscribeFromRemotes(t){this.#o("subscribeToRemotes",t);const i=[];for(const s of t)this.#t.has(s)&&(this.#t.delete(s),this.#i.has(s)||i.push(s));i.length>0&&this.emit("change-remote-subs",{remove:i,peers:Array.from(this.#n)})}handleControlMessage(t){const i=[],s=[],r=[];if(this.#o("handleControlMessage",t),t.add)for(const a of t.add){let l=this.#i.get(a);(this.#t.has(a)||l)&&r.push(a),l||(l=new Set,this.#i.set(a,l),this.#t.has(a)||i.push(a)),l.add(t.senderId)}if(t.remove)for(const a of t.remove){const l=this.#i.get(a);l&&(l.delete(t.senderId),l.size==0&&!this.#t.has(a)&&s.push(a))}(i.length>0||s.length>0)&&this.emit("change-remote-subs",{peers:Array.from(this.#n),add:i,remove:s});for(const a of r){const l=this.#r.get(t.senderId);if(l)for(const u of l){const f=this.#e.get(u);if(!f)continue;const _=f.get(a);_&&this.emit("notify-remote-heads",{targetId:t.senderId,documentId:u,heads:_.lastHeads,timestamp:_.lastSyncTimestamp,storageId:a})}}}handleRemoteHeads(t){this.#o("handleRemoteHeads",t);const i=this.#a(t);for(const s of i)this.#t.has(s.storageId)&&this.emit("remote-heads-changed",s);for(const s of i)for(const r of this.#n)r!==t.senderId&&this.emit("notify-remote-heads",{targetId:r,documentId:s.documentId,heads:s.remoteHeads,timestamp:s.timestamp,storageId:s.storageId});for(const s of i){const r=this.#i.get(s.storageId);if(r)for(const a of r)this.#c(a,s.documentId)&&this.emit("notify-remote-heads",{targetId:a,documentId:s.documentId,heads:s.remoteHeads,timestamp:s.timestamp,storageId:s.storageId})}}handleImmediateRemoteHeadsChanged(t,i,s){this.#o("handleLocalHeadsChanged",t,i,s);const r=this.#e.get(t),a=Date.now();if(!r)this.#e.set(t,new Map([[i,{lastSyncTimestamp:a,lastHeads:s}]]));else{const u=r.get(i);(!u||u.lastSyncTimestamp<Date.now())&&r.set(i,{lastSyncTimestamp:Date.now(),lastHeads:s})}const l=this.#i.get(i);if(l)for(const u of l)this.#c(u,t)&&this.emit("notify-remote-heads",{targetId:u,documentId:t,heads:s,timestamp:a,storageId:i})}addGenerousPeer(t){this.#o("addGenerousPeer",t),this.#n.add(t),this.#t.size>0&&this.emit("change-remote-subs",{add:Array.from(this.#t),peers:[t]});for(const[i,s]of this.#e)for(const[r,{lastHeads:a,lastSyncTimestamp:l}]of s)this.emit("notify-remote-heads",{targetId:t,documentId:i,heads:a,timestamp:l,storageId:r})}removePeer(t){this.#o("removePeer",t);const i=[];this.#n.delete(t),this.#r.delete(t);for(const[s,r]of this.#i)r.has(t)&&(r.delete(t),r.size==0&&(i.push(s),this.#i.delete(s)));i.length>0&&this.emit("change-remote-subs",{remove:i,peers:Array.from(this.#n)})}subscribePeerToDoc(t,i){let s=this.#r.get(t);s||(s=new Set,this.#r.set(t,s)),s.add(i);const r=this.#e.get(i);if(r)for(const[a,l]of r){const u=this.#i.get(a);u&&u.has(t)&&this.emit("notify-remote-heads",{targetId:t,documentId:i,heads:l.lastHeads,timestamp:l.lastSyncTimestamp,storageId:a})}}#c(t,i){const s=this.#r.get(t);return s&&s.has(i)}#a(t){const i=[],{documentId:s,newHeads:r}=t;for(const[a,{heads:l,timestamp:u}]of Object.entries(r)){if(!this.#t.has(a)&&!this.#i.has(a))continue;let f=this.#e.get(s);f||(f=new Map,this.#e.set(s,f));const _=f.get(a);_&&_.lastSyncTimestamp>=u||(f.set(a,{lastSyncTimestamp:u,lastHeads:l}),i.push({documentId:s,storageId:a,remoteHeads:l,timestamp:u}))}return i}}const Es=(n,t)=>{let i=Date.now(),s,r;return function(...a){s=i+t-Date.now(),clearTimeout(r),r=setTimeout(()=>{n(...a),i=Date.now()},s)}},Cv=n=>Pv(n)||Qu(n)||Xu(n)||Mv(n)||Iv(n)||Av(n),Mv=n=>n.type==="doc-unavailable",Xu=n=>n.type==="request",Pv=n=>n.type==="sync",Qu=n=>n.type==="ephemeral",Iv=n=>n.type==="remote-subscription-change",Av=n=>n.type==="remote-heads-changed",Dv=n=>`${n.senderId}:${n.sessionId}`;class Ov extends wn{peerId;peerMetadata;#e;#t={};#i=0;#n=Math.random().toString(36).slice(2);#r={};adapters=[];constructor(t,i,s){super(),this.peerId=i,this.peerMetadata=s,this.#e=We(`automerge-repo:network:${this.peerId}`),t.forEach(r=>this.addNetworkAdapter(r))}disconnect(){this.adapters.forEach(t=>t.disconnect())}reconnect(){this.adapters.forEach(t=>t.connect(this.peerId))}addNetworkAdapter(t){this.adapters.push(t),t.on("peer-candidate",({peerId:i,peerMetadata:s})=>{this.#e(`peer candidate: ${i} `),this.#t[i]||(this.#t[i]=t),this.emit("peer",{peerId:i,peerMetadata:s})}),t.on("peer-disconnected",({peerId:i})=>{this.#e(`peer disconnected: ${i} `),delete this.#t[i],this.emit("peer-disconnected",{peerId:i})}),t.on("message",i=>{if(!Cv(i)){this.#e(`invalid message: ${JSON.stringify(i)}`);return}if(this.#e(`message from ${i.senderId}`),Qu(i)){const s=Dv(i);(this.#r[s]===void 0||i.count>this.#r[s])&&(this.#r[s]=i.count,this.emit("message",i));return}this.emit("message",i)}),t.on("close",()=>{this.#e("adapter closed"),Object.entries(this.#t).forEach(([i,s])=>{s===t&&delete this.#t[i]}),this.adapters=this.adapters.filter(i=>i!==t)}),this.peerMetadata.then(i=>{t.connect(this.peerId,i)}).catch(i=>{this.#e("error connecting to network",i)})}removeNetworkAdapter(t){this.adapters=this.adapters.filter(i=>i!==t),t.disconnect()}send(t){const i=this.#t[t.targetId];if(!i){this.#e(`Tried to send message but peer not found: ${t.targetId}`);return}const r=(a=>a.type==="ephemeral"?"count"in a?a:{...a,count:++this.#i,sessionId:this.#n,senderId:this.peerId}:{...a,senderId:this.peerId})(t);this.#e("sending message %o",r),i.send(r)}isReady=()=>this.adapters.every(t=>t.isReady());whenReady=async()=>Promise.all(this.adapters.map(t=>t.whenReady()))}function td(n){let t=0;n.forEach(r=>{t+=r.length});const i=new Uint8Array(t);let s=0;return n.forEach(r=>{i.set(r,s),s+=r.length}),i}var gr={exports:{}},Bv=gr.exports,ol;function zv(){return ol||(ol=1,(function(n){(function(t,i){var s={};i(s);var r=s.default;for(var a in s)r[a]=s[a];n.exports=r})(Bv,function(t){t.__esModule=!0,t.digestLength=32,t.blockSize=64;var i=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]);function s(m,v,b,S,C){for(var V,A,w,F,O,K,nt,Q,N,G,J,ot,E;C>=64;){for(V=v[0],A=v[1],w=v[2],F=v[3],O=v[4],K=v[5],nt=v[6],Q=v[7],G=0;G<16;G++)J=S+G*4,m[G]=(b[J]&255)<<24|(b[J+1]&255)<<16|(b[J+2]&255)<<8|b[J+3]&255;for(G=16;G<64;G++)N=m[G-2],ot=(N>>>17|N<<15)^(N>>>19|N<<13)^N>>>10,N=m[G-15],E=(N>>>7|N<<25)^(N>>>18|N<<14)^N>>>3,m[G]=(ot+m[G-7]|0)+(E+m[G-16]|0);for(G=0;G<64;G++)ot=(((O>>>6|O<<26)^(O>>>11|O<<21)^(O>>>25|O<<7))+(O&K^~O&nt)|0)+(Q+(i[G]+m[G]|0)|0)|0,E=((V>>>2|V<<30)^(V>>>13|V<<19)^(V>>>22|V<<10))+(V&A^V&w^A&w)|0,Q=nt,nt=K,K=O,O=F+ot|0,F=w,w=A,A=V,V=ot+E|0;v[0]+=V,v[1]+=A,v[2]+=w,v[3]+=F,v[4]+=O,v[5]+=K,v[6]+=nt,v[7]+=Q,S+=64,C-=64}return S}var r=(function(){function m(){this.digestLength=t.digestLength,this.blockSize=t.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return m.prototype.reset=function(){return this.state[0]=0x6a09e667,this.state[1]=0xbb67ae85,this.state[2]=0x3c6ef372,this.state[3]=0xa54ff53a,this.state[4]=0x510e527f,this.state[5]=0x9b05688c,this.state[6]=0x1f83d9ab,this.state[7]=0x5be0cd19,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},m.prototype.clean=function(){for(var v=0;v<this.buffer.length;v++)this.buffer[v]=0;for(var v=0;v<this.temp.length;v++)this.temp[v]=0;this.reset()},m.prototype.update=function(v,b){if(b===void 0&&(b=v.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var S=0;if(this.bytesHashed+=b,this.bufferLength>0){for(;this.bufferLength<64&&b>0;)this.buffer[this.bufferLength++]=v[S++],b--;this.bufferLength===64&&(s(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(b>=64&&(S=s(this.temp,this.state,v,S,b),b%=64);b>0;)this.buffer[this.bufferLength++]=v[S++],b--;return this},m.prototype.finish=function(v){if(!this.finished){var b=this.bytesHashed,S=this.bufferLength,C=b/0x20000000|0,V=b<<3,A=b%64<56?64:128;this.buffer[S]=128;for(var w=S+1;w<A-8;w++)this.buffer[w]=0;this.buffer[A-8]=C>>>24&255,this.buffer[A-7]=C>>>16&255,this.buffer[A-6]=C>>>8&255,this.buffer[A-5]=C>>>0&255,this.buffer[A-4]=V>>>24&255,this.buffer[A-3]=V>>>16&255,this.buffer[A-2]=V>>>8&255,this.buffer[A-1]=V>>>0&255,s(this.temp,this.state,this.buffer,0,A),this.finished=!0}for(var w=0;w<8;w++)v[w*4+0]=this.state[w]>>>24&255,v[w*4+1]=this.state[w]>>>16&255,v[w*4+2]=this.state[w]>>>8&255,v[w*4+3]=this.state[w]>>>0&255;return this},m.prototype.digest=function(){var v=new Uint8Array(this.digestLength);return this.finish(v),v},m.prototype._saveState=function(v){for(var b=0;b<this.state.length;b++)v[b]=this.state[b]},m.prototype._restoreState=function(v,b){for(var S=0;S<this.state.length;S++)this.state[S]=v[S];this.bytesHashed=b,this.finished=!1,this.bufferLength=0},m})();t.Hash=r;var a=(function(){function m(v){this.inner=new r,this.outer=new r,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var b=new Uint8Array(this.blockSize);if(v.length>this.blockSize)new r().update(v).finish(b).clean();else for(var S=0;S<v.length;S++)b[S]=v[S];for(var S=0;S<b.length;S++)b[S]^=54;this.inner.update(b);for(var S=0;S<b.length;S++)b[S]^=106;this.outer.update(b),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(var S=0;S<b.length;S++)b[S]=0}return m.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},m.prototype.clean=function(){for(var v=0;v<this.istate.length;v++)this.ostate[v]=this.istate[v]=0;this.inner.clean(),this.outer.clean()},m.prototype.update=function(v){return this.inner.update(v),this},m.prototype.finish=function(v){return this.outer.finished?this.outer.finish(v):(this.inner.finish(v),this.outer.update(v,this.digestLength).finish(v)),this},m.prototype.digest=function(){var v=new Uint8Array(this.digestLength);return this.finish(v),v},m})();t.HMAC=a;function l(m){var v=new r().update(m),b=v.digest();return v.clean(),b}t.hash=l,t.default=l;function u(m,v){var b=new a(m).update(v),S=b.digest();return b.clean(),S}t.hmac=u;function f(m,v,b,S){var C=S[0];if(C===0)throw new Error("hkdf: cannot expand more");v.reset(),C>1&&v.update(m),b&&v.update(b),v.update(S),v.finish(m),S[0]++}var _=new Uint8Array(t.digestLength);function g(m,v,b,S){v===void 0&&(v=_),S===void 0&&(S=32);for(var C=new Uint8Array([1]),V=u(v,m),A=new a(V),w=new Uint8Array(A.digestLength),F=w.length,O=new Uint8Array(S),K=0;K<S;K++)F===w.length&&(f(w,A,b,C),F=0),O[K]=w[F++];return A.clean(),w.fill(0),C.fill(0),O}t.hkdf=g;function p(m,v,b,S){for(var C=new a(m),V=C.digestLength,A=new Uint8Array(4),w=new Uint8Array(V),F=new Uint8Array(V),O=new Uint8Array(S),K=0;K*V<S;K++){var nt=K+1;A[0]=nt>>>24&255,A[1]=nt>>>16&255,A[2]=nt>>>8&255,A[3]=nt>>>0&255,C.reset(),C.update(v),C.update(A),C.finish(F);for(var Q=0;Q<V;Q++)w[Q]=F[Q];for(var Q=2;Q<=b;Q++){C.reset(),C.update(F).finish(F);for(var N=0;N<V;N++)w[N]^=F[N]}for(var Q=0;Q<V&&K*V+Q<S;Q++)O[K*V+Q]=w[Q]}for(var K=0;K<V;K++)w[K]=F[K]=0;for(var K=0;K<4;K++)A[K]=0;return C.clean(),O}t.pbkdf2=p})})(gr)),gr.exports}var Rv=zv();function ed(n){const t=Rv.hash(n);return jv(t)}function Hv(n){const t=new TextEncoder,i=td(n.map(s=>t.encode(s)));return ed(i)}function jv(n){return Array.from(n,t=>t.toString(16).padStart(2,"0")).join("")}class Uv extends wn{#e;#t=new Map;#i=new Map;#n=!1;#r=We("automerge-repo:storage-subsystem");constructor(t){super(),this.#e=t}async id(){const t=await this.#e.load(["storage-adapter-id"]);let i;return t?i=new TextDecoder().decode(t):(i=Bu(),await this.#e.save(["storage-adapter-id"],new TextEncoder().encode(i))),i}async load(t,i){const s=[t,i];return await this.#e.load(s)}async save(t,i,s){const r=[t,i];await this.#e.save(r,s)}async remove(t,i){const s=[t,i];await this.#e.remove(s)}async loadDocData(t){const i=await this.#e.loadRange([t,"snapshot"]),s=await this.#e.loadRange([t,"incremental"]),r=[],a=[];for(const l of i)l.data!==void 0&&(a.push({key:l.key,type:"snapshot",size:l.data.length}),r.push(l.data));for(const l of s)l.data!==void 0&&(a.push({key:l.key,type:"incremental",size:l.data.length}),r.push(l.data));return this.#i.set(t,a),r.length===0?null:td(r)}async loadDoc(t){const i=await this.loadDocData(t);if(!i)return null;const s=performance.now(),r=Os(ve(),i),a=performance.now();return this.emit("document-loaded",{documentId:t,durationMillis:a-s,...Bs(r)}),this.#t.set(t,Fe(r)),r}async saveDoc(t,i){if(!this.#a(t,i))return;const s=this.#i.get(t)??[];this.#s(s)?await this.#c(t,i,s):await this.#o(t,i),this.#t.set(t,Fe(i))}async removeDoc(t){await this.#e.removeRange([t,"snapshot"]),await this.#e.removeRange([t,"incremental"]),await this.#e.removeRange([t,"sync-state"])}async #o(t,i){const s=og(i,this.#t.get(t)??[]);if(s&&s.length>0){const r=[t,"incremental",ed(s)];this.#r(`Saving incremental ${r} for document ${t}`),await this.#e.save(r,s),this.#i.has(t)||this.#i.set(t,[]),this.#i.get(t).push({key:r,type:"incremental",size:s.length}),this.#t.set(t,Fe(i))}else return Promise.resolve()}async #c(t,i,s){this.#n=!0;const r=hu(i),a=Hv(Fe(i)),l=[t,"snapshot",a],u=new Set(s.map(_=>_.key).filter(_=>_[2]!==a));this.#r(`Saving snapshot ${l} for document ${t}`),this.#r(`deleting old chunks ${Array.from(u)}`),await this.#e.save(l,r);for(const _ of u)await this.#e.remove(_);const f=this.#i.get(t)?.filter(_=>!u.has(_.key))??[];f.push({key:l,type:"snapshot",size:r.length}),this.#i.set(t,f),this.#n=!1}async loadSyncState(t,i){const s=[t,"sync-state",i];try{const r=await this.#e.load(s);return r?du(r):void 0}catch{this.#r(`Error loading sync state for ${t} from ${i}`);return}}async saveSyncState(t,i,s){const r=[t,"sync-state",i];await this.#e.save(r,uu(s))}#a(t,i){const s=this.#t.get(t);if(!s)return!0;const r=Fe(i);return!Xs(De(r),De(s))}#s(t){if(this.#n)return!1;let i=0,s=0;for(const r of t)r.type==="snapshot"?i+=r.size:s+=r.size;return i<1024||s>=i}}class nd extends wn{}class Fv extends nd{#e;syncDebounceRate=100;#t=[];#i={};#n={};#r={};#o=[];#c;#a=!1;#s;#u;constructor({handle:t,peerId:i,onLoadSyncState:s}){super(),this.#c=i,this.#s=t,this.#u=s??(()=>Promise.resolve(void 0));const r=t.documentId.slice(0,5);this.#e=We(`automerge-repo:docsync:${r}`),t.on("change",Es(()=>this.#h(),this.syncDebounceRate)),t.on("ephemeral-message-outbound",a=>this.#f(a)),(async()=>this.#v())()}get peerStates(){return this.#n}get documentId(){return this.#s.documentId}async #h(){try{await this.#s.whenReady();const t=this.#s.doc();this.#t.forEach(i=>this.#g(i,t))}catch{console.log("sync with peers threw an exception")}}async #f({data:t}){this.#e("broadcastToPeers",this.#t),this.#t.forEach(i=>this.#l(i,t))}#l(t,i){this.#e(`sendEphemeralMessage ->${t}`);const s={type:"ephemeral",targetId:t,documentId:this.#s.documentId,data:i};this.emit("message",s)}#_(t,i){this.#p(t),t in this.#n||(this.#n[t]="unknown");const s=this.#r[t];if(s){i(s);return}let r=this.#i[t];r||(this.#u(t).then(a=>{this.#b(t,a??ig())}).catch(a=>{this.#e(`Error loading sync state for ${t}: ${a}`)}),r=this.#i[t]=[]),r.push(i)}#p(t){this.#t.includes(t)||(this.#t.push(t),this.emit("open-doc",{documentId:this.documentId,peerId:t}))}#b(t,i){const s=this.#i[t];if(s)for(const r of s)r(i);delete this.#i[t],this.#r[t]=i}#m(t,i){this.#r[t]=i,this.emit("sync-state",{peerId:t,syncState:i,documentId:this.#s.documentId})}#g(t,i){this.#e(`sendSyncMessage ->${t}`),this.#_(t,s=>{const[r,a]=eg(i,s);if(a){this.#m(t,r);const l=Fe(i).length===0;!this.#s.isReady()&&l&&r.sharedHeads.length===0&&!Object.values(this.#n).includes("has")&&this.#n[t]==="unknown"?this.emit("message",{type:"request",targetId:t,documentId:this.#s.documentId,data:a}):this.emit("message",{type:"sync",targetId:t,data:a,documentId:this.#s.documentId}),l||(this.#n[t]="has")}})}hasPeer(t){return this.#t.includes(t)}async beginSync(t){this.#s.whenReady([Me,or,oe]).then(()=>{this.#a=!0,this.#d()}).catch(s=>{console.log("caught whenready",s),this.#a=!0,this.#d()}),this.#t.some(s=>this.#n[s]=="has")&&await this.#s.whenReady(),t.forEach(s=>{this.#_(s,r=>{const a=du(uu(r));this.#m(s,a),this.#s.whenReady([Me,or,oe]).then(()=>{const l=this.#s.isReady()?this.#s.doc():ve(),u=t.every(_=>this.#n[_]in["unavailable","wants"]);l===void 0&&u||this.#g(s,l??ve())}).catch(l=>{this.#e(`Error loading doc for ${s}: ${l}`)})})})}endSync(t){this.#e(`removing peer ${t}`),this.#t=this.#t.filter(i=>i!==t),delete this.#n[t],this.#d()}receiveMessage(t){switch(t.type){case"sync":case"request":this.receiveSyncMessage(t);break;case"ephemeral":this.receiveEphemeralMessage(t);break;case"doc-unavailable":this.#n[t.senderId]="unavailable",this.#d();break;default:throw new Error(`unknown message type: ${t}`)}}receiveEphemeralMessage(t){if(t.documentId!==this.#s.documentId)throw new Error("channelId doesn't match documentId");const{senderId:i,data:s}=t,r=Wu(new Uint8Array(s));this.#s.emit("ephemeral-message",{handle:this.#s,senderId:i,message:r}),this.#t.forEach(a=>{a!==i&&this.emit("message",{...t,targetId:a})})}receiveSyncMessage(t){if(t.documentId!==this.#s.documentId)throw new Error("channelId doesn't match documentId");if(!this.#s.inState([Me,or,oe])){this.#o.push({message:t,received:new Date});return}this.#v(),this.#y(t)}#y(t){Xu(t)&&(this.#n[t.senderId]="wants"),this.#d(),rg(t.data).heads.length>0&&(this.#n[t.senderId]="has"),this.#_(t.senderId,i=>{this.#s.update(s=>{const r=performance.now(),[a,l]=ng(s,i,t.data),u=performance.now();return this.emit("metrics",{type:"receive-sync-message",documentId:this.#s.documentId,durationMillis:u-r,...Bs(s)}),this.#m(t.senderId,l),this.#g(t.senderId,s),a}),this.#d()})}#d(){this.#a&&this.#s.inState([or,oe])&&this.#t.every(t=>this.#n[t]==="unavailable"||this.#n[t]==="wants")&&(this.#t.filter(t=>this.#n[t]==="wants").forEach(t=>{this.#n[t]="unavailable";const i={type:"doc-unavailable",documentId:this.#s.documentId,targetId:t};this.emit("message",i)}),this.#s.unavailable())}#v(){for(const t of this.#o)this.#y(t.message);this.#o=[]}metrics(){return{peers:this.#t,size:this.#s.metrics()}}}const ar=We("automerge-repo:collectionsync");class Nv extends nd{repo;#e=new Set;docSynchronizers={};#t={};#i;constructor(t,i=[]){super(),this.repo=t,this.#i=i.map(s=>Li(s).documentId)}#n(t){return this.docSynchronizers[t.documentId]||(this.docSynchronizers[t.documentId]=this.#r(t)),this.docSynchronizers[t.documentId]}#r(t){const i=new Fv({handle:t,peerId:this.repo.networkSubsystem.peerId,onLoadSyncState:async s=>{if(!this.repo.storageSubsystem)return;const{storageId:r,isEphemeral:a}=this.repo.peerMetadataByPeerId[s]||{};if(!(!r||a))return this.repo.storageSubsystem.loadSyncState(t.documentId,r)}});return i.on("message",s=>this.emit("message",s)),i.on("open-doc",s=>this.emit("open-doc",s)),i.on("sync-state",s=>this.emit("sync-state",s)),i.on("metrics",s=>this.emit("metrics",s)),i}async #o(t){const i=Array.from(this.#e),s=[];for(const r of i)await this.repo.sharePolicy(r,t)&&s.push(r);return s}async receiveMessage(t){ar(`onSyncMessage: ${t.senderId}, ${t.documentId}, ${"data"in t?t.data.byteLength+"bytes":""}`);const i=t.documentId;if(!i)throw new Error("received a message with an invalid documentId");if(this.#i.includes(i)){this.emit("metrics",{type:"doc-denied",documentId:i}),this.emit("message",{type:"doc-unavailable",documentId:i,targetId:t.senderId});return}this.#t[i]=!0;const s=await this.repo.find(i,{allowableStates:["ready","unavailable","requesting"]}),r=this.#n(s);r.receiveMessage(t);const a=await this.#o(i);r.beginSync(a.filter(l=>!r.hasPeer(l)))}addDocument(t){if(this.#t[t.documentId])return;const i=this.#n(t);this.#o(t.documentId).then(s=>{i.beginSync(s)})}removeDocument(t){ar(`removing document ${t}`);const i=this.docSynchronizers[t];i!==void 0&&this.peers.forEach(s=>i.endSync(s)),delete this.docSynchronizers[t],delete this.#t[t]}addPeer(t){if(ar(`adding ${t} & synchronizing with them`),!this.#e.has(t)){this.#e.add(t);for(const i of Object.values(this.docSynchronizers)){const{documentId:s}=i;this.repo.sharePolicy(t,s).then(r=>{r&&i.beginSync([t])})}}}removePeer(t){ar(`removing peer ${t}`),this.#e.delete(t);for(const i of Object.values(this.docSynchronizers))i.endSync(t)}get peers(){return Array.from(this.#e)}metrics(){return Object.fromEntries(Object.entries(this.docSynchronizers).map(([t,i])=>[t,i.metrics()]))}}function sl(n,t){let i=!1;return new Promise((s,r)=>{t?.addEventListener("abort",()=>{i||r(new DOMException("Operation aborted","AbortError"))},{once:!0}),n.then(a=>{s(a)}).catch(a=>{r(a)}).finally(()=>{i=!0})})}function $v(){return"peer-"+Math.random().toString(36).slice(4)}class Zv extends wn{#e;networkSubsystem;storageSubsystem;#t;#i;#n={};synchronizer;sharePolicy=async()=>!0;peerMetadataByPeerId={};#r=new Tv;#o=!1;#c={};#a={};constructor({storage:t,network:i=[],peerId:s=$v(),sharePolicy:r,isEphemeral:a=t===void 0,enableRemoteHeadsGossiping:l=!1,denylist:u=[],saveDebounceRate:f=100}={}){super(),this.#o=l,this.#e=We("automerge-repo:repo"),this.sharePolicy=r??this.sharePolicy,this.on("delete-document",({documentId:m})=>{this.synchronizer.removeDocument(m),_&&_.removeDoc(m).catch(v=>{this.#e("error deleting document",{documentId:m,err:v})})}),this.synchronizer=new Nv(this,u),this.synchronizer.on("message",m=>{this.#e(`sending ${m.type} message to ${m.targetId}`),p.send(m)}),this.synchronizer.on("metrics",m=>this.emit("doc-metrics",m)),this.#o&&this.synchronizer.on("open-doc",({peerId:m,documentId:v})=>{this.#r.subscribePeerToDoc(m,v)});const _=t?new Uv(t):void 0;_&&_.on("document-loaded",m=>this.emit("doc-metrics",{type:"doc-loaded",...m})),this.storageSubsystem=_,this.#t=f,this.storageSubsystem?this.#i=({handle:m,doc:v})=>{let b=this.#a[m.documentId];b||(b=Es(({doc:S,handle:C})=>{this.storageSubsystem.saveDoc(C.documentId,S)},this.#t),this.#a[m.documentId]=b),b({handle:m,doc:v})}:this.#i=()=>{};const g=(async()=>({storageId:await _?.id(),isEphemeral:a}))(),p=new Ov(i,s,g);this.networkSubsystem=p,p.on("peer",async({peerId:m,peerMetadata:v})=>{this.#e("peer connected",{peerId:m}),v&&(this.peerMetadataByPeerId[m]={...v}),this.sharePolicy(m).then(b=>{b&&this.#o&&this.#r.addGenerousPeer(m)}).catch(b=>{console.log("error in share policy",{err:b})}),this.synchronizer.addPeer(m)}),p.on("peer-disconnected",({peerId:m})=>{this.synchronizer.removePeer(m),this.#r.removePeer(m)}),p.on("message",async m=>{this.#u(m)}),this.synchronizer.on("sync-state",m=>{this.#f(m);const v=this.#n[m.documentId],{storageId:b}=this.peerMetadataByPeerId[m.peerId]||{};if(!b)return;const S=v.getSyncInfo(b)?.lastHeads;m.syncState.theirHeads&&(!S||!Xs(S,De(m.syncState.theirHeads)))&&m.syncState.theirHeads&&(v.setSyncInfo(b,{lastHeads:De(m.syncState.theirHeads),lastSyncTimestamp:Date.now()}),b&&this.#o&&this.#r.handleImmediateRemoteHeadsChanged(m.documentId,b,De(m.syncState.theirHeads)))}),this.#o&&(this.#r.on("notify-remote-heads",m=>{this.networkSubsystem.send({type:"remote-heads-changed",targetId:m.targetId,documentId:m.documentId,newHeads:{[m.storageId]:{heads:m.heads,timestamp:m.timestamp}}})}),this.#r.on("change-remote-subs",m=>{this.#e("change-remote-subs",m);for(const v of m.peers)this.networkSubsystem.send({type:"remote-subscription-change",targetId:v,add:m.add,remove:m.remove})}),this.#r.on("remote-heads-changed",({documentId:m,storageId:v,remoteHeads:b,timestamp:S})=>{this.#n[m].setSyncInfo(v,{lastHeads:b,lastSyncTimestamp:S})}))}#s(t){this.storageSubsystem&&(t.listeners("heads-changed").some(s=>s===this.#i)||t.on("heads-changed",this.#i)),this.synchronizer.addDocument(t)}#u(t){switch(t.type){case"remote-subscription-change":this.#o&&this.#r.handleControlMessage(t);break;case"remote-heads-changed":this.#o&&this.#r.handleRemoteHeads(t);break;case"sync":case"request":case"ephemeral":case"doc-unavailable":this.synchronizer.receiveMessage(t).catch(i=>{console.log("error receiving message",{err:i,message:t})})}}#h={};#f(t){if(!this.storageSubsystem)return;const{storageId:i,isEphemeral:s}=this.peerMetadataByPeerId[t.peerId]||{};if(!i||s)return;let r=this.#h[i];r||(r=this.#h[i]=Es(({documentId:a,syncState:l})=>{this.storageSubsystem.saveSyncState(a,i,l)},this.#t)),r(t)}#l({documentId:t}){if(this.#n[t])return this.#n[t];if(!t)throw new Error(`Invalid documentId ${t}`);const i=new Br(t);return this.#n[t]=i,i}get handles(){return this.#n}get peers(){return this.synchronizer.peers}getStorageIdOfPeer(t){return this.peerMetadataByPeerId[t]?.storageId}create(t){const{documentId:i}=Li(Ky()),s=this.#l({documentId:i});return this.#s(s),s.update(()=>{let r;return t?r=Ym(t):r=Xm(ve()),r}),s.doneLoading(),s}clone(t){if(!t.isReady())throw new Error(`Cloned handle is not yet in ready state.
        (Try await handle.whenReady() first.)`);const i=t.doc(),s=this.create();return s.update(()=>kr(i)),s}findWithProgress(t,i={}){const{signal:s}=i,{documentId:r,heads:a}=ju(t)?Li(t):{documentId:nr(t),heads:void 0};if(this.#n[r]){const p=this.#n[r];if(p.state===oe)return{state:"unavailable",error:new Error(`Document ${t} is unavailable`),handle:p};if(p.state===sr)return{state:"failed",error:new Error(`Document ${t} was deleted`),handle:p};if(p.state===Me)return{state:"ready",handle:a?p.view(a):p}}const l=this.#c[r];if(l){const p=this.#n[r];if(p&&(p.state===Me||p.state===oe||p.state===sr||p.state==="loading"))return l}const u=this.#l({documentId:r}),f={state:"loading",progress:0,handle:u},_={subscribers:new Set,currentProgress:void 0,notify:p=>{_.currentProgress=p,_.subscribers.forEach(m=>m(p)),this.#c[r]=p},peek:()=>_.currentProgress||f,subscribe:p=>(_.subscribers.add(p),()=>_.subscribers.delete(p))};_.notify(f),this.#_(t,r,u,_,s?sl(new Promise(()=>{}),s):new Promise(()=>{}));const g={...f,peek:_.peek,subscribe:_.subscribe};return this.#c[r]=g,g}async #_(t,i,s,r,a){try{r.notify({state:"loading",progress:25,handle:s});const l=await (this.storageSubsystem?this.storageSubsystem.loadDoc(s.documentId):Promise.resolve(null)),u=await Promise.race([l,a]);if(u?(s.update(()=>u),s.doneLoading(),r.notify({state:"loading",progress:50,handle:s})):(await Promise.race([this.networkSubsystem.whenReady(),a]),s.request(),r.notify({state:"loading",progress:75,handle:s})),this.#s(s),await Promise.race([s.whenReady([Me,oe]),a]),s.state===oe){const f={state:"unavailable",handle:s};r.notify(f);return}if(s.state===sr)throw new Error(`Document ${t} was deleted`);r.notify({state:"ready",handle:s})}catch(l){r.notify({state:"failed",error:l instanceof Error?l:new Error(String(l)),handle:this.#l({documentId:i})})}}async find(t,i={}){const{allowableStates:s=["ready"],signal:r}=i;if(r?.aborted)throw new Error("Operation aborted");const a=this.findWithProgress(t,{signal:r});if("subscribe"in a)return this.#s(a.handle),new Promise((l,u)=>{const f=a.subscribe(_=>{s.includes(_.handle.state)?(f(),l(_.handle)):_.state==="unavailable"?(f(),u(new Error(`Document ${t} is unavailable`))):_.state==="failed"&&(f(),u(_.error))})});if(a.handle.state===Me)return a.handle;if(await a.handle.whenReady([Me,oe]),a.handle.state==="unavailable"&&!s.includes(oe))throw new Error(`Document ${t} is unavailable`);return a.handle}async #p(t){if(this.#n[t])return this.#n[t];const i=this.#l({documentId:t}),s=await (this.storageSubsystem?this.storageSubsystem.loadDoc(i.documentId):Promise.resolve(null));return s?(i.update(()=>s),i.doneLoading()):(await this.networkSubsystem.whenReady(),i.request()),this.#s(i),i}async findClassic(t,i={}){const s=nr(t),{allowableStates:r,signal:a}=i;return sl((async()=>{const l=await this.#p(s);if(!r&&(await l.whenReady([Me,oe]),l.state===oe&&!a?.aborted))throw new Error(`Document ${t} is unavailable`);return l})(),a)}delete(t){const i=nr(t);this.#l({documentId:i}).delete(),delete this.#n[i],delete this.#c[i],delete this.#a[i],this.emit("delete-document",{documentId:i})}async export(t){const i=nr(t),r=this.#l({documentId:i}).doc();return hu(r)}import(t,i){const s=i?.docId;if(s!=null){const r=this.#l({documentId:s});return r.update(a=>Os(a,t)),this.#s(r),r}else{const r=Qm(t),a=this.create();return a.update(()=>kr(r)),a}}subscribeToRemotes=t=>{this.#o?(this.#e("subscribeToRemotes",{remotes:t}),this.#r.subscribeToRemotes(t)):this.#e("WARN: subscribeToRemotes called but remote heads gossiping is not enabled")};storageId=async()=>{if(this.storageSubsystem)return this.storageSubsystem.id()};async flush(t){if(!this.storageSubsystem)return;const i=t?t.map(s=>this.#n[s]):Object.values(this.#n);await Promise.all(i.map(async s=>this.storageSubsystem.saveDoc(s.documentId,s.doc())))}async removeFromCache(t){if(!this.#n[t]){this.#e(`WARN: removeFromCache called but handle not found in handleCache for documentId: ${t}`);return}const i=this.#l({documentId:t});await i.whenReady([Me,bv,sr,oe]),i.doc()?(i.isReady()?i.unload():this.#e(`WARN: removeFromCache called but handle for documentId: ${t} in unexpected state: ${i.state}`),delete this.#n[t],delete this.#c[t],delete this.#a[t],this.synchronizer.removeDocument(t)):this.#e(`WARN: removeFromCache called but doc undefined for documentId: ${t}`)}shutdown(){return this.networkSubsystem.adapters.forEach(t=>{t.disconnect()}),this.flush()}metrics(){return{documents:this.synchronizer.metrics()}}}class Vv extends wn{peerId;peerMetadata}var jn=null;typeof WebSocket<"u"?jn=WebSocket:typeof MozWebSocket<"u"?jn=MozWebSocket:typeof global<"u"?jn=global.WebSocket||global.MozWebSocket:typeof window<"u"?jn=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(jn=self.WebSocket||self.MozWebSocket);const Ko=jn,Gv=n=>n.type==="peer",Wv=n=>n.type==="error",qv="1";function je(n,t="Assertion failed"){if(n===!1||n===null||n===void 0){const i=new Error(Kv(t));throw i.stack=Yv(i.stack,"assert.ts"),i}}const Kv=n=>n.split(`
`).map(t=>t.trim()).join(`
`),Yv=(n="",t)=>n.split(`
`).filter(i=>!i.includes(t)).join(`
`),Jv=n=>{const{buffer:t,byteOffset:i,byteLength:s}=n;return t.slice(i,i+s)};class Xv extends Vv{socket}class Qv extends Xv{url;retryInterval;#e=!1;#t;#i=new Promise(t=>{this.#t=t});isReady(){return this.#e}whenReady(){return this.#i}#n(){this.#e||(this.#e=!0,this.#t?.())}#r;#o=We("automerge-repo:websocket:browser");remotePeerId;constructor(t,i=5e3){super(),this.url=t,this.retryInterval=i,this.#o=this.#o.extend(t)}connect(t,i){!this.socket||!this.peerId?(this.#o("connecting"),this.peerId=t,this.peerMetadata=i??{}):(this.#o("reconnecting"),je(t===this.peerId),this.socket.removeEventListener("open",this.onOpen),this.socket.removeEventListener("close",this.onClose),this.socket.removeEventListener("message",this.onMessage),this.socket.removeEventListener("error",this.onError)),this.#r||(this.#r=setInterval(()=>{this.connect(t,i)},this.retryInterval)),this.socket=new Ko(this.url),this.socket.binaryType="arraybuffer",this.socket.addEventListener("open",this.onOpen),this.socket.addEventListener("close",this.onClose),this.socket.addEventListener("message",this.onMessage),this.socket.addEventListener("error",this.onError),setTimeout(()=>this.#n(),1e3),this.join()}onOpen=()=>{this.#o("open"),clearInterval(this.#r),this.#r=void 0,this.join()};onClose=()=>{this.#o("close"),this.remotePeerId&&this.emit("peer-disconnected",{peerId:this.remotePeerId}),this.retryInterval>0&&!this.#r&&setTimeout(()=>(je(this.peerId),this.connect(this.peerId,this.peerMetadata)),this.retryInterval)};onMessage=t=>{this.receiveMessage(t.data)};onError=t=>{if("error"in t&&t.error.code!=="ECONNREFUSED")throw t.error;this.#o("Connection failed, retrying...")};join(){je(this.peerId),je(this.socket),this.socket.readyState===Ko.OPEN&&this.send(t0(this.peerId,this.peerMetadata))}disconnect(){je(this.peerId),je(this.socket);const t=this.socket;t&&(t.removeEventListener("open",this.onOpen),t.removeEventListener("close",this.onClose),t.removeEventListener("message",this.onMessage),t.removeEventListener("error",this.onError),t.close()),clearInterval(this.#r),this.remotePeerId&&this.emit("peer-disconnected",{peerId:this.remotePeerId}),this.socket=void 0}send(t){if("data"in t&&t.data?.byteLength===0)throw new Error("Tried to send a zero-length message");if(je(this.peerId),!this.socket){this.#o("Tried to send on a disconnected socket.");return}if(this.socket.readyState!==Ko.OPEN)throw new Error(`Websocket not ready (${this.socket.readyState})`);const i=Ju(t);this.socket.send(Jv(i))}peerCandidate(t,i){je(this.socket),this.#n(),this.remotePeerId=t,this.emit("peer-candidate",{peerId:t,peerMetadata:i})}receiveMessage(t){let i;try{i=pv(new Uint8Array(t))}catch(s){this.#o("error decoding message:",s);return}if(je(this.socket),t.byteLength===0)throw new Error("received a zero-length message");if(Gv(i)){const{peerMetadata:s}=i;this.#o(`peer: ${i.senderId}`),this.peerCandidate(i.senderId,s)}else Wv(i)?this.#o(`error: ${i.message}`):this.emit("message",i)}}function t0(n,t){return{type:"join",senderId:n,peerMetadata:t,supportedProtocolVersions:[qv]}}We("WebsocketServer");class e0{database;store;dbPromise;constructor(t="automerge",i="documents"){this.database=t,this.store=i,this.dbPromise=this.createDatabasePromise()}createDatabasePromise(){return new Promise((t,i)=>{const s=indexedDB.open(this.database,1);s.onerror=()=>{i(s.error)},s.onupgradeneeded=r=>{r.target.result.createObjectStore(this.store)},s.onsuccess=r=>{const a=r.target.result;t(a)}})}async load(t){const s=(await this.dbPromise).transaction(this.store),a=s.objectStore(this.store).get(t);return new Promise((l,u)=>{s.onerror=()=>{u(a.error)},a.onsuccess=f=>{const _=f.target.result;_&&typeof _=="object"&&"binary"in _?l(_.binary):l(void 0)}})}async save(t,i){const r=(await this.dbPromise).transaction(this.store,"readwrite");return r.objectStore(this.store).put({key:t,binary:i},t),new Promise((l,u)=>{r.onerror=()=>{u(r.error)},r.oncomplete=()=>{l()}})}async remove(t){const s=(await this.dbPromise).transaction(this.store,"readwrite");return s.objectStore(this.store).delete(t),new Promise((a,l)=>{s.onerror=()=>{l(s.error)},s.oncomplete=()=>{a()}})}async loadRange(t){const i=await this.dbPromise,s=t,r=[...t,"￿"],a=IDBKeyRange.bound(s,r),l=i.transaction(this.store),f=l.objectStore(this.store).openCursor(a),_=[];return new Promise((g,p)=>{l.onerror=()=>{p(f.error)},f.onsuccess=m=>{const v=m.target.result;v?(_.push({data:v.value.binary,key:v.key}),v.continue()):g(_)}})}async removeRange(t){const i=await this.dbPromise,s=t,r=[...t,"￿"],a=IDBKeyRange.bound(s,r),l=i.transaction(this.store,"readwrite");return l.objectStore(this.store).delete(a),new Promise((f,_)=>{l.onerror=()=>{_(l.error)},l.oncomplete=()=>{f()}})}}var di={exports:{}};var n0=di.exports,al;function i0(){return al||(al=1,(function(n,t){(function(i,s){s(t)})(n0,function(i){var s="1.9.4";function r(e){var o,c,h,d;for(c=1,h=arguments.length;c<h;c++){d=arguments[c];for(o in d)e[o]=d[o]}return e}var a=Object.create||(function(){function e(){}return function(o){return e.prototype=o,new e}})();function l(e,o){var c=Array.prototype.slice;if(e.bind)return e.bind.apply(e,c.call(arguments,1));var h=c.call(arguments,2);return function(){return e.apply(o,h.length?h.concat(c.call(arguments)):arguments)}}var u=0;function f(e){return"_leaflet_id"in e||(e._leaflet_id=++u),e._leaflet_id}function _(e,o,c){var h,d,y,x;return x=function(){h=!1,d&&(y.apply(c,d),d=!1)},y=function(){h?d=arguments:(e.apply(c,arguments),setTimeout(x,o),h=!0)},y}function g(e,o,c){var h=o[1],d=o[0],y=h-d;return e===h&&c?e:((e-d)%y+y)%y+d}function p(){return!1}function m(e,o){if(o===!1)return e;var c=Math.pow(10,o===void 0?6:o);return Math.round(e*c)/c}function v(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function b(e){return v(e).split(/\s+/)}function S(e,o){Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?a(e.options):{});for(var c in o)e.options[c]=o[c];return e.options}function C(e,o,c){var h=[];for(var d in e)h.push(encodeURIComponent(c?d.toUpperCase():d)+"="+encodeURIComponent(e[d]));return(!o||o.indexOf("?")===-1?"?":"&")+h.join("&")}var V=/\{ *([\w_ -]+) *\}/g;function A(e,o){return e.replace(V,function(c,h){var d=o[h];if(d===void 0)throw new Error("No value provided for variable "+c);return typeof d=="function"&&(d=d(o)),d})}var w=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function F(e,o){for(var c=0;c<e.length;c++)if(e[c]===o)return c;return-1}var O="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function K(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var nt=0;function Q(e){var o=+new Date,c=Math.max(0,16-(o-nt));return nt=o+c,window.setTimeout(e,c)}var N=window.requestAnimationFrame||K("RequestAnimationFrame")||Q,G=window.cancelAnimationFrame||K("CancelAnimationFrame")||K("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function J(e,o,c){if(c&&N===Q)e.call(o);else return N.call(window,l(e,o))}function ot(e){e&&G.call(window,e)}var E={__proto__:null,extend:r,create:a,bind:l,get lastId(){return u},stamp:f,throttle:_,wrapNum:g,falseFn:p,formatNum:m,trim:v,splitWords:b,setOptions:S,getParamString:C,template:A,isArray:w,indexOf:F,emptyImageUrl:O,requestFn:N,cancelFn:G,requestAnimFrame:J,cancelAnimFrame:ot};function Z(){}Z.extend=function(e){var o=function(){S(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},c=o.__super__=this.prototype,h=a(c);h.constructor=o,o.prototype=h;for(var d in this)Object.prototype.hasOwnProperty.call(this,d)&&d!=="prototype"&&d!=="__super__"&&(o[d]=this[d]);return e.statics&&r(o,e.statics),e.includes&&(H(e.includes),r.apply(null,[h].concat(e.includes))),r(h,e),delete h.statics,delete h.includes,h.options&&(h.options=c.options?a(c.options):{},r(h.options,e.options)),h._initHooks=[],h.callInitHooks=function(){if(!this._initHooksCalled){c.callInitHooks&&c.callInitHooks.call(this),this._initHooksCalled=!0;for(var y=0,x=h._initHooks.length;y<x;y++)h._initHooks[y].call(this)}},o},Z.include=function(e){var o=this.prototype.options;return r(this.prototype,e),e.options&&(this.prototype.options=o,this.mergeOptions(e.options)),this},Z.mergeOptions=function(e){return r(this.prototype.options,e),this},Z.addInitHook=function(e){var o=Array.prototype.slice.call(arguments,1),c=typeof e=="function"?e:function(){this[e].apply(this,o)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(c),this};function H(e){if(!(typeof L>"u"||!L||!L.Mixin)){e=w(e)?e:[e];for(var o=0;o<e.length;o++)e[o]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var R={on:function(e,o,c){if(typeof e=="object")for(var h in e)this._on(h,e[h],o);else{e=b(e);for(var d=0,y=e.length;d<y;d++)this._on(e[d],o,c)}return this},off:function(e,o,c){if(!arguments.length)delete this._events;else if(typeof e=="object")for(var h in e)this._off(h,e[h],o);else{e=b(e);for(var d=arguments.length===1,y=0,x=e.length;y<x;y++)d?this._off(e[y]):this._off(e[y],o,c)}return this},_on:function(e,o,c,h){if(typeof o!="function"){console.warn("wrong listener type: "+typeof o);return}if(this._listens(e,o,c)===!1){c===this&&(c=void 0);var d={fn:o,ctx:c};h&&(d.once=!0),this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(d)}},_off:function(e,o,c){var h,d,y;if(this._events&&(h=this._events[e],!!h)){if(arguments.length===1){if(this._firingCount)for(d=0,y=h.length;d<y;d++)h[d].fn=p;delete this._events[e];return}if(typeof o!="function"){console.warn("wrong listener type: "+typeof o);return}var x=this._listens(e,o,c);if(x!==!1){var M=h[x];this._firingCount&&(M.fn=p,this._events[e]=h=h.slice()),h.splice(x,1)}}},fire:function(e,o,c){if(!this.listens(e,c))return this;var h=r({},o,{type:e,target:this,sourceTarget:o&&o.sourceTarget||this});if(this._events){var d=this._events[e];if(d){this._firingCount=this._firingCount+1||1;for(var y=0,x=d.length;y<x;y++){var M=d[y],D=M.fn;M.once&&this.off(e,D,M.ctx),D.call(M.ctx||this,h)}this._firingCount--}}return c&&this._propagateEvent(h),this},listens:function(e,o,c,h){typeof e!="string"&&console.warn('"string" type argument expected');var d=o;typeof o!="function"&&(h=!!o,d=void 0,c=void 0);var y=this._events&&this._events[e];if(y&&y.length&&this._listens(e,d,c)!==!1)return!0;if(h){for(var x in this._eventParents)if(this._eventParents[x].listens(e,o,c,h))return!0}return!1},_listens:function(e,o,c){if(!this._events)return!1;var h=this._events[e]||[];if(!o)return!!h.length;c===this&&(c=void 0);for(var d=0,y=h.length;d<y;d++)if(h[d].fn===o&&h[d].ctx===c)return d;return!1},once:function(e,o,c){if(typeof e=="object")for(var h in e)this._on(h,e[h],o,!0);else{e=b(e);for(var d=0,y=e.length;d<y;d++)this._on(e[d],o,c,!0)}return this},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[f(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[f(e)],this},_propagateEvent:function(e){for(var o in this._eventParents)this._eventParents[o].fire(e.type,r({layer:e.target,propagatedFrom:e.target},e),!0)}};R.addEventListener=R.on,R.removeEventListener=R.clearAllEventListeners=R.off,R.addOneTimeEventListener=R.once,R.fireEvent=R.fire,R.hasEventListeners=R.listens;var j=Z.extend(R);function q(e,o,c){this.x=c?Math.round(e):e,this.y=c?Math.round(o):o}var T=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};q.prototype={clone:function(){return new q(this.x,this.y)},add:function(e){return this.clone()._add(I(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(I(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new q(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new q(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=T(this.x),this.y=T(this.y),this},distanceTo:function(e){e=I(e);var o=e.x-this.x,c=e.y-this.y;return Math.sqrt(o*o+c*c)},equals:function(e){return e=I(e),e.x===this.x&&e.y===this.y},contains:function(e){return e=I(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+m(this.x)+", "+m(this.y)+")"}};function I(e,o,c){return e instanceof q?e:w(e)?new q(e[0],e[1]):e==null?e:typeof e=="object"&&"x"in e&&"y"in e?new q(e.x,e.y):new q(e,o,c)}function $(e,o){if(e)for(var c=o?[e,o]:e,h=0,d=c.length;h<d;h++)this.extend(c[h])}$.prototype={extend:function(e){var o,c;if(!e)return this;if(e instanceof q||typeof e[0]=="number"||"x"in e)o=c=I(e);else if(e=tt(e),o=e.min,c=e.max,!o||!c)return this;return!this.min&&!this.max?(this.min=o.clone(),this.max=c.clone()):(this.min.x=Math.min(o.x,this.min.x),this.max.x=Math.max(c.x,this.max.x),this.min.y=Math.min(o.y,this.min.y),this.max.y=Math.max(c.y,this.max.y)),this},getCenter:function(e){return I((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return I(this.min.x,this.max.y)},getTopRight:function(){return I(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var o,c;return typeof e[0]=="number"||e instanceof q?e=I(e):e=tt(e),e instanceof $?(o=e.min,c=e.max):o=c=e,o.x>=this.min.x&&c.x<=this.max.x&&o.y>=this.min.y&&c.y<=this.max.y},intersects:function(e){e=tt(e);var o=this.min,c=this.max,h=e.min,d=e.max,y=d.x>=o.x&&h.x<=c.x,x=d.y>=o.y&&h.y<=c.y;return y&&x},overlaps:function(e){e=tt(e);var o=this.min,c=this.max,h=e.min,d=e.max,y=d.x>o.x&&h.x<c.x,x=d.y>o.y&&h.y<c.y;return y&&x},isValid:function(){return!!(this.min&&this.max)},pad:function(e){var o=this.min,c=this.max,h=Math.abs(o.x-c.x)*e,d=Math.abs(o.y-c.y)*e;return tt(I(o.x-h,o.y-d),I(c.x+h,c.y+d))},equals:function(e){return e?(e=tt(e),this.min.equals(e.getTopLeft())&&this.max.equals(e.getBottomRight())):!1}};function tt(e,o){return!e||e instanceof $?e:new $(e,o)}function ht(e,o){if(e)for(var c=o?[e,o]:e,h=0,d=c.length;h<d;h++)this.extend(c[h])}ht.prototype={extend:function(e){var o=this._southWest,c=this._northEast,h,d;if(e instanceof gt)h=e,d=e;else if(e instanceof ht){if(h=e._southWest,d=e._northEast,!h||!d)return this}else return e?this.extend(ct(e)||_t(e)):this;return!o&&!c?(this._southWest=new gt(h.lat,h.lng),this._northEast=new gt(d.lat,d.lng)):(o.lat=Math.min(h.lat,o.lat),o.lng=Math.min(h.lng,o.lng),c.lat=Math.max(d.lat,c.lat),c.lng=Math.max(d.lng,c.lng)),this},pad:function(e){var o=this._southWest,c=this._northEast,h=Math.abs(o.lat-c.lat)*e,d=Math.abs(o.lng-c.lng)*e;return new ht(new gt(o.lat-h,o.lng-d),new gt(c.lat+h,c.lng+d))},getCenter:function(){return new gt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new gt(this.getNorth(),this.getWest())},getSouthEast:function(){return new gt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){typeof e[0]=="number"||e instanceof gt||"lat"in e?e=ct(e):e=_t(e);var o=this._southWest,c=this._northEast,h,d;return e instanceof ht?(h=e.getSouthWest(),d=e.getNorthEast()):h=d=e,h.lat>=o.lat&&d.lat<=c.lat&&h.lng>=o.lng&&d.lng<=c.lng},intersects:function(e){e=_t(e);var o=this._southWest,c=this._northEast,h=e.getSouthWest(),d=e.getNorthEast(),y=d.lat>=o.lat&&h.lat<=c.lat,x=d.lng>=o.lng&&h.lng<=c.lng;return y&&x},overlaps:function(e){e=_t(e);var o=this._southWest,c=this._northEast,h=e.getSouthWest(),d=e.getNorthEast(),y=d.lat>o.lat&&h.lat<c.lat,x=d.lng>o.lng&&h.lng<c.lng;return y&&x},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,o){return e?(e=_t(e),this._southWest.equals(e.getSouthWest(),o)&&this._northEast.equals(e.getNorthEast(),o)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function _t(e,o){return e instanceof ht?e:new ht(e,o)}function gt(e,o,c){if(isNaN(e)||isNaN(o))throw new Error("Invalid LatLng object: ("+e+", "+o+")");this.lat=+e,this.lng=+o,c!==void 0&&(this.alt=+c)}gt.prototype={equals:function(e,o){if(!e)return!1;e=ct(e);var c=Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng));return c<=(o===void 0?1e-9:o)},toString:function(e){return"LatLng("+m(this.lat,e)+", "+m(this.lng,e)+")"},distanceTo:function(e){return qt.distance(this,ct(e))},wrap:function(){return qt.wrapLatLng(this)},toBounds:function(e){var o=180*e/0x2637f09,c=o/Math.cos(Math.PI/180*this.lat);return _t([this.lat-o,this.lng-c],[this.lat+o,this.lng+c])},clone:function(){return new gt(this.lat,this.lng,this.alt)}};function ct(e,o,c){return e instanceof gt?e:w(e)&&typeof e[0]!="object"?e.length===3?new gt(e[0],e[1],e[2]):e.length===2?new gt(e[0],e[1]):null:e==null?e:typeof e=="object"&&"lat"in e?new gt(e.lat,"lng"in e?e.lng:e.lon,e.alt):o===void 0?null:new gt(e,o,c)}var Ct={latLngToPoint:function(e,o){var c=this.projection.project(e),h=this.scale(o);return this.transformation._transform(c,h)},pointToLatLng:function(e,o){var c=this.scale(o),h=this.transformation.untransform(e,c);return this.projection.unproject(h)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var o=this.projection.bounds,c=this.scale(e),h=this.transformation.transform(o.min,c),d=this.transformation.transform(o.max,c);return new $(h,d)},infinite:!1,wrapLatLng:function(e){var o=this.wrapLng?g(e.lng,this.wrapLng,!0):e.lng,c=this.wrapLat?g(e.lat,this.wrapLat,!0):e.lat,h=e.alt;return new gt(c,o,h)},wrapLatLngBounds:function(e){var o=e.getCenter(),c=this.wrapLatLng(o),h=o.lat-c.lat,d=o.lng-c.lng;if(h===0&&d===0)return e;var y=e.getSouthWest(),x=e.getNorthEast(),M=new gt(y.lat-h,y.lng-d),D=new gt(x.lat-h,x.lng-d);return new ht(M,D)}},qt=r({},Ct,{wrapLng:[-180,180],R:6371e3,distance:function(e,o){var c=Math.PI/180,h=e.lat*c,d=o.lat*c,y=Math.sin((o.lat-e.lat)*c/2),x=Math.sin((o.lng-e.lng)*c/2),M=y*y+Math.cos(h)*Math.cos(d)*x*x,D=2*Math.atan2(Math.sqrt(M),Math.sqrt(1-M));return this.R*D}}),Ke=6378137,z={R:Ke,MAX_LATITUDE:85.0511287798,project:function(e){var o=Math.PI/180,c=this.MAX_LATITUDE,h=Math.max(Math.min(c,e.lat),-c),d=Math.sin(h*o);return new q(this.R*e.lng*o,this.R*Math.log((1+d)/(1-d))/2)},unproject:function(e){var o=180/Math.PI;return new gt((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*o,e.x*o/this.R)},bounds:(function(){var e=Ke*Math.PI;return new $([-e,-e],[e,e])})()};function et(e,o,c,h){if(w(e)){this._a=e[0],this._b=e[1],this._c=e[2],this._d=e[3];return}this._a=e,this._b=o,this._c=c,this._d=h}et.prototype={transform:function(e,o){return this._transform(e.clone(),o)},_transform:function(e,o){return o=o||1,e.x=o*(this._a*e.x+this._b),e.y=o*(this._c*e.y+this._d),e},untransform:function(e,o){return o=o||1,new q((e.x/o-this._b)/this._a,(e.y/o-this._d)/this._c)}};function at(e,o,c,h){return new et(e,o,c,h)}var dt=r({},qt,{code:"EPSG:3857",projection:z,transformation:(function(){var e=.5/(Math.PI*z.R);return at(e,.5,-e,.5)})()}),zt=r({},dt,{code:"EPSG:900913"});function Rt(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Jt(e,o){var c="",h,d,y,x,M,D;for(h=0,y=e.length;h<y;h++){for(M=e[h],d=0,x=M.length;d<x;d++)D=M[d],c+=(d?"L":"M")+D.x+" "+D.y;c+=o?st.svg?"z":"x":""}return c||"M0 0"}var Ye=document.documentElement.style,Di="ActiveXObject"in window,Ed=Di&&!document.addEventListener,ra="msLaunchUri"in navigator&&!("documentMode"in document),Xr=we("webkit"),oa=we("android"),sa=we("android 2")||we("android 3"),kd=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Td=oa&&we("Google")&&kd<537&&!("AudioNode"in window),Qr=!!window.opera,aa=!ra&&we("chrome"),ca=we("gecko")&&!Xr&&!Qr&&!Di,Cd=!aa&&we("safari"),la=we("phantom"),ha="OTransition"in Ye,Md=navigator.platform.indexOf("Win")===0,ua=Di&&"transition"in Ye,to="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!sa,da="MozPerspective"in Ye,Pd=!window.L_DISABLE_3D&&(ua||to||da)&&!ha&&!la,qn=typeof orientation<"u"||we("mobile"),Id=qn&&Xr,Ad=qn&&to,fa=!window.PointerEvent&&window.MSPointerEvent,_a=!!(window.PointerEvent||fa),pa="ontouchstart"in window||!!window.TouchEvent,Dd=!window.L_NO_TOUCH&&(pa||_a),Od=qn&&Qr,Bd=qn&&ca,zd=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Rd=(function(){var e=!1;try{var o=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",p,o),window.removeEventListener("testPassiveEventSupport",p,o)}catch{}return e})(),Hd=(function(){return!!document.createElement("canvas").getContext})(),eo=!!(document.createElementNS&&Rt("svg").createSVGRect),jd=!!eo&&(function(){var e=document.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),Ud=!eo&&(function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var o=e.firstChild;return o.style.behavior="url(#default#VML)",o&&typeof o.adj=="object"}catch{return!1}})(),Fd=navigator.platform.indexOf("Mac")===0,Nd=navigator.platform.indexOf("Linux")===0;function we(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var st={ie:Di,ielt9:Ed,edge:ra,webkit:Xr,android:oa,android23:sa,androidStock:Td,opera:Qr,chrome:aa,gecko:ca,safari:Cd,phantom:la,opera12:ha,win:Md,ie3d:ua,webkit3d:to,gecko3d:da,any3d:Pd,mobile:qn,mobileWebkit:Id,mobileWebkit3d:Ad,msPointer:fa,pointer:_a,touch:Dd,touchNative:pa,mobileOpera:Od,mobileGecko:Bd,retina:zd,passiveEvents:Rd,canvas:Hd,svg:eo,vml:Ud,inlineSvg:jd,mac:Fd,linux:Nd},ma=st.msPointer?"MSPointerDown":"pointerdown",ga=st.msPointer?"MSPointerMove":"pointermove",ya=st.msPointer?"MSPointerUp":"pointerup",va=st.msPointer?"MSPointerCancel":"pointercancel",no={touchstart:ma,touchmove:ga,touchend:ya,touchcancel:va},ba={touchstart:qd,touchmove:Oi,touchend:Oi,touchcancel:Oi},Sn={},wa=!1;function $d(e,o,c){return o==="touchstart"&&Wd(),ba[o]?(c=ba[o].bind(this,c),e.addEventListener(no[o],c,!1),c):(console.warn("wrong event specified:",o),p)}function Zd(e,o,c){if(!no[o]){console.warn("wrong event specified:",o);return}e.removeEventListener(no[o],c,!1)}function Vd(e){Sn[e.pointerId]=e}function Gd(e){Sn[e.pointerId]&&(Sn[e.pointerId]=e)}function xa(e){delete Sn[e.pointerId]}function Wd(){wa||(document.addEventListener(ma,Vd,!0),document.addEventListener(ga,Gd,!0),document.addEventListener(ya,xa,!0),document.addEventListener(va,xa,!0),wa=!0)}function Oi(e,o){if(o.pointerType!==(o.MSPOINTER_TYPE_MOUSE||"mouse")){o.touches=[];for(var c in Sn)o.touches.push(Sn[c]);o.changedTouches=[o],e(o)}}function qd(e,o){o.MSPOINTER_TYPE_TOUCH&&o.pointerType===o.MSPOINTER_TYPE_TOUCH&&$t(o),Oi(e,o)}function Kd(e){var o={},c,h;for(h in e)c=e[h],o[h]=c&&c.bind?c.bind(e):c;return e=o,o.type="dblclick",o.detail=2,o.isTrusted=!1,o._simulated=!0,o}var Yd=200;function Jd(e,o){e.addEventListener("dblclick",o);var c=0,h;function d(y){if(y.detail!==1){h=y.detail;return}if(!(y.pointerType==="mouse"||y.sourceCapabilities&&!y.sourceCapabilities.firesTouchEvents)){var x=Ta(y);if(!(x.some(function(D){return D instanceof HTMLLabelElement&&D.attributes.for})&&!x.some(function(D){return D instanceof HTMLInputElement||D instanceof HTMLSelectElement}))){var M=Date.now();M-c<=Yd?(h++,h===2&&o(Kd(y))):h=1,c=M}}}return e.addEventListener("click",d),{dblclick:o,simDblclick:d}}function Xd(e,o){e.removeEventListener("dblclick",o.dblclick),e.removeEventListener("click",o.simDblclick)}var io=Ri(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Kn=Ri(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),La=Kn==="webkitTransition"||Kn==="OTransition"?Kn+"End":"transitionend";function Sa(e){return typeof e=="string"?document.getElementById(e):e}function Yn(e,o){var c=e.style[o]||e.currentStyle&&e.currentStyle[o];if((!c||c==="auto")&&document.defaultView){var h=document.defaultView.getComputedStyle(e,null);c=h?h[o]:null}return c==="auto"?null:c}function wt(e,o,c){var h=document.createElement(e);return h.className=o||"",c&&c.appendChild(h),h}function Mt(e){var o=e.parentNode;o&&o.removeChild(e)}function Bi(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function En(e){var o=e.parentNode;o&&o.lastChild!==e&&o.appendChild(e)}function kn(e){var o=e.parentNode;o&&o.firstChild!==e&&o.insertBefore(e,o.firstChild)}function ro(e,o){if(e.classList!==void 0)return e.classList.contains(o);var c=zi(e);return c.length>0&&new RegExp("(^|\\s)"+o+"(\\s|$)").test(c)}function pt(e,o){if(e.classList!==void 0)for(var c=b(o),h=0,d=c.length;h<d;h++)e.classList.add(c[h]);else if(!ro(e,o)){var y=zi(e);oo(e,(y?y+" ":"")+o)}}function It(e,o){e.classList!==void 0?e.classList.remove(o):oo(e,v((" "+zi(e)+" ").replace(" "+o+" "," ")))}function oo(e,o){e.className.baseVal===void 0?e.className=o:e.className.baseVal=o}function zi(e){return e.correspondingElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function ae(e,o){"opacity"in e.style?e.style.opacity=o:"filter"in e.style&&Qd(e,o)}function Qd(e,o){var c=!1,h="DXImageTransform.Microsoft.Alpha";try{c=e.filters.item(h)}catch{if(o===1)return}o=Math.round(o*100),c?(c.Enabled=o!==100,c.Opacity=o):e.style.filter+=" progid:"+h+"(opacity="+o+")"}function Ri(e){for(var o=document.documentElement.style,c=0;c<e.length;c++)if(e[c]in o)return e[c];return!1}function en(e,o,c){var h=o||new q(0,0);e.style[io]=(st.ie3d?"translate("+h.x+"px,"+h.y+"px)":"translate3d("+h.x+"px,"+h.y+"px,0)")+(c?" scale("+c+")":"")}function At(e,o){e._leaflet_pos=o,st.any3d?en(e,o):(e.style.left=o.x+"px",e.style.top=o.y+"px")}function nn(e){return e._leaflet_pos||new q(0,0)}var Jn,Xn,so;if("onselectstart"in document)Jn=function(){ft(window,"selectstart",$t)},Xn=function(){Et(window,"selectstart",$t)};else{var Qn=Ri(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Jn=function(){if(Qn){var e=document.documentElement.style;so=e[Qn],e[Qn]="none"}},Xn=function(){Qn&&(document.documentElement.style[Qn]=so,so=void 0)}}function ao(){ft(window,"dragstart",$t)}function co(){Et(window,"dragstart",$t)}var Hi,lo;function ho(e){for(;e.tabIndex===-1;)e=e.parentNode;e.style&&(ji(),Hi=e,lo=e.style.outlineStyle,e.style.outlineStyle="none",ft(window,"keydown",ji))}function ji(){Hi&&(Hi.style.outlineStyle=lo,Hi=void 0,lo=void 0,Et(window,"keydown",ji))}function Ea(e){do e=e.parentNode;while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function uo(e){var o=e.getBoundingClientRect();return{x:o.width/e.offsetWidth||1,y:o.height/e.offsetHeight||1,boundingClientRect:o}}var tf={__proto__:null,TRANSFORM:io,TRANSITION:Kn,TRANSITION_END:La,get:Sa,getStyle:Yn,create:wt,remove:Mt,empty:Bi,toFront:En,toBack:kn,hasClass:ro,addClass:pt,removeClass:It,setClass:oo,getClass:zi,setOpacity:ae,testProp:Ri,setTransform:en,setPosition:At,getPosition:nn,get disableTextSelection(){return Jn},get enableTextSelection(){return Xn},disableImageDrag:ao,enableImageDrag:co,preventOutline:ho,restoreOutline:ji,getSizedParentNode:Ea,getScale:uo};function ft(e,o,c,h){if(o&&typeof o=="object")for(var d in o)_o(e,d,o[d],c);else{o=b(o);for(var y=0,x=o.length;y<x;y++)_o(e,o[y],c,h)}return this}var xe="_leaflet_events";function Et(e,o,c,h){if(arguments.length===1)ka(e),delete e[xe];else if(o&&typeof o=="object")for(var d in o)po(e,d,o[d],c);else if(o=b(o),arguments.length===2)ka(e,function(M){return F(o,M)!==-1});else for(var y=0,x=o.length;y<x;y++)po(e,o[y],c,h);return this}function ka(e,o){for(var c in e[xe]){var h=c.split(/\d/)[0];(!o||o(h))&&po(e,h,null,null,c)}}var fo={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function _o(e,o,c,h){var d=o+f(c)+(h?"_"+f(h):"");if(e[xe]&&e[xe][d])return this;var y=function(M){return c.call(h||e,M||window.event)},x=y;!st.touchNative&&st.pointer&&o.indexOf("touch")===0?y=$d(e,o,y):st.touch&&o==="dblclick"?y=Jd(e,y):"addEventListener"in e?o==="touchstart"||o==="touchmove"||o==="wheel"||o==="mousewheel"?e.addEventListener(fo[o]||o,y,st.passiveEvents?{passive:!1}:!1):o==="mouseenter"||o==="mouseleave"?(y=function(M){M=M||window.event,go(e,M)&&x(M)},e.addEventListener(fo[o],y,!1)):e.addEventListener(o,x,!1):e.attachEvent("on"+o,y),e[xe]=e[xe]||{},e[xe][d]=y}function po(e,o,c,h,d){d=d||o+f(c)+(h?"_"+f(h):"");var y=e[xe]&&e[xe][d];if(!y)return this;!st.touchNative&&st.pointer&&o.indexOf("touch")===0?Zd(e,o,y):st.touch&&o==="dblclick"?Xd(e,y):"removeEventListener"in e?e.removeEventListener(fo[o]||o,y,!1):e.detachEvent("on"+o,y),e[xe][d]=null}function rn(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function mo(e){return _o(e,"wheel",rn),this}function ti(e){return ft(e,"mousedown touchstart dblclick contextmenu",rn),e._leaflet_disable_click=!0,this}function $t(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function on(e){return $t(e),rn(e),this}function Ta(e){if(e.composedPath)return e.composedPath();for(var o=[],c=e.target;c;)o.push(c),c=c.parentNode;return o}function Ca(e,o){if(!o)return new q(e.clientX,e.clientY);var c=uo(o),h=c.boundingClientRect;return new q((e.clientX-h.left)/c.x-o.clientLeft,(e.clientY-h.top)/c.y-o.clientTop)}var ef=st.linux&&st.chrome?window.devicePixelRatio:st.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ma(e){return st.edge?e.wheelDeltaY/2:e.deltaY&&e.deltaMode===0?-e.deltaY/ef:e.deltaY&&e.deltaMode===1?-e.deltaY*20:e.deltaY&&e.deltaMode===2?-e.deltaY*60:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?-e.detail*20:e.detail?e.detail/-32765*60:0}function go(e,o){var c=o.relatedTarget;if(!c)return!0;try{for(;c&&c!==e;)c=c.parentNode}catch{return!1}return c!==e}var nf={__proto__:null,on:ft,off:Et,stopPropagation:rn,disableScrollPropagation:mo,disableClickPropagation:ti,preventDefault:$t,stop:on,getPropagationPath:Ta,getMousePosition:Ca,getWheelDelta:Ma,isExternalTarget:go,addListener:ft,removeListener:Et},Pa=j.extend({run:function(e,o,c,h){this.stop(),this._el=e,this._inProgress=!0,this._duration=c||.25,this._easeOutPower=1/Math.max(h||.5,.2),this._startPos=nn(e),this._offset=o.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=J(this._animate,this),this._step()},_step:function(e){var o=+new Date-this._startTime,c=this._duration*1e3;o<c?this._runFrame(this._easeOut(o/c),e):(this._runFrame(1),this._complete())},_runFrame:function(e,o){var c=this._startPos.add(this._offset.multiplyBy(e));o&&c._round(),At(this._el,c),this.fire("step")},_complete:function(){ot(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),bt=j.extend({options:{crs:dt,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,o){o=S(this,o),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=l(this._onResize,this),this._initEvents(),o.maxBounds&&this.setMaxBounds(o.maxBounds),o.zoom!==void 0&&(this._zoom=this._limitZoom(o.zoom)),o.center&&o.zoom!==void 0&&this.setView(ct(o.center),o.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Kn&&st.any3d&&!st.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ft(this._proxy,La,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,o,c){if(o=o===void 0?this._zoom:this._limitZoom(o),e=this._limitCenter(ct(e),o,this.options.maxBounds),c=c||{},this._stop(),this._loaded&&!c.reset&&c!==!0){c.animate!==void 0&&(c.zoom=r({animate:c.animate},c.zoom),c.pan=r({animate:c.animate,duration:c.duration},c.pan));var h=this._zoom!==o?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,o,c.zoom):this._tryAnimatedPan(e,c.pan);if(h)return clearTimeout(this._sizeTimer),this}return this._resetView(e,o,c.pan&&c.pan.noMoveStart),this},setZoom:function(e,o){return this._loaded?this.setView(this.getCenter(),e,{zoom:o}):(this._zoom=e,this)},zoomIn:function(e,o){return e=e||(st.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,o)},zoomOut:function(e,o){return e=e||(st.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,o)},setZoomAround:function(e,o,c){var h=this.getZoomScale(o),d=this.getSize().divideBy(2),y=e instanceof q?e:this.latLngToContainerPoint(e),x=y.subtract(d).multiplyBy(1-1/h),M=this.containerPointToLatLng(d.add(x));return this.setView(M,o,{zoom:c})},_getBoundsCenterZoom:function(e,o){o=o||{},e=e.getBounds?e.getBounds():_t(e);var c=I(o.paddingTopLeft||o.padding||[0,0]),h=I(o.paddingBottomRight||o.padding||[0,0]),d=this.getBoundsZoom(e,!1,c.add(h));if(d=typeof o.maxZoom=="number"?Math.min(o.maxZoom,d):d,d===1/0)return{center:e.getCenter(),zoom:d};var y=h.subtract(c).divideBy(2),x=this.project(e.getSouthWest(),d),M=this.project(e.getNorthEast(),d),D=this.unproject(x.add(M).divideBy(2).add(y),d);return{center:D,zoom:d}},fitBounds:function(e,o){if(e=_t(e),!e.isValid())throw new Error("Bounds are not valid.");var c=this._getBoundsCenterZoom(e,o);return this.setView(c.center,c.zoom,o)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,o){return this.setView(e,this._zoom,{pan:o})},panBy:function(e,o){if(e=I(e).round(),o=o||{},!e.x&&!e.y)return this.fire("moveend");if(o.animate!==!0&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Pa,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),o.noMoveStart||this.fire("movestart"),o.animate!==!1){pt(this._mapPane,"leaflet-pan-anim");var c=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,c,o.duration||.25,o.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,o,c){if(c=c||{},c.animate===!1||!st.any3d)return this.setView(e,o,c);this._stop();var h=this.project(this.getCenter()),d=this.project(e),y=this.getSize(),x=this._zoom;e=ct(e),o=o===void 0?x:o;var M=Math.max(y.x,y.y),D=M*this.getZoomScale(x,o),W=d.distanceTo(h)||1,it=1.42,lt=it*it;function mt(Dt){var Ji=Dt?-1:1,Vf=Dt?D:M,Gf=D*D-M*M+Ji*lt*lt*W*W,Wf=2*Vf*lt*W,Co=Gf/Wf,hc=Math.sqrt(Co*Co+1)-Co,qf=hc<1e-9?-18:Math.log(hc);return qf}function Kt(Dt){return(Math.exp(Dt)-Math.exp(-Dt))/2}function Ft(Dt){return(Math.exp(Dt)+Math.exp(-Dt))/2}function le(Dt){return Kt(Dt)/Ft(Dt)}var Xt=mt(0);function An(Dt){return M*(Ft(Xt)/Ft(Xt+it*Dt))}function Ff(Dt){return M*(Ft(Xt)*le(Xt+it*Dt)-Kt(Xt))/lt}function Nf(Dt){return 1-Math.pow(1-Dt,1.5)}var $f=Date.now(),cc=(mt(1)-Xt)/it,Zf=c.duration?1e3*c.duration:1e3*cc*.8;function lc(){var Dt=(Date.now()-$f)/Zf,Ji=Nf(Dt)*cc;Dt<=1?(this._flyToFrame=J(lc,this),this._move(this.unproject(h.add(d.subtract(h).multiplyBy(Ff(Ji)/W)),x),this.getScaleZoom(M/An(Ji),x),{flyTo:!0})):this._move(e,o)._moveEnd(!0)}return this._moveStart(!0,c.noMoveStart),lc.call(this),this},flyToBounds:function(e,o){var c=this._getBoundsCenterZoom(e,o);return this.flyTo(c.center,c.zoom,o)},setMaxBounds:function(e){return e=_t(e),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),e.isValid()?(this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(e){var o=this.options.minZoom;return this.options.minZoom=e,this._loaded&&o!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var o=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&o!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,o){this._enforcingBounds=!0;var c=this.getCenter(),h=this._limitCenter(c,this._zoom,_t(e));return c.equals(h)||this.panTo(h,o),this._enforcingBounds=!1,this},panInside:function(e,o){o=o||{};var c=I(o.paddingTopLeft||o.padding||[0,0]),h=I(o.paddingBottomRight||o.padding||[0,0]),d=this.project(this.getCenter()),y=this.project(e),x=this.getPixelBounds(),M=tt([x.min.add(c),x.max.subtract(h)]),D=M.getSize();if(!M.contains(y)){this._enforcingBounds=!0;var W=y.subtract(M.getCenter()),it=M.extend(y).getSize().subtract(D);d.x+=W.x<0?-it.x:it.x,d.y+=W.y<0?-it.y:it.y,this.panTo(this.unproject(d),o),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=r({animate:!1,pan:!0},e===!0?{animate:!0}:e);var o=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var c=this.getSize(),h=o.divideBy(2).round(),d=c.divideBy(2).round(),y=h.subtract(d);return!y.x&&!y.y?this:(e.animate&&e.pan?this.panBy(y):(e.pan&&this._rawPanBy(y),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(l(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:o,newSize:c}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=r({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var o=l(this._handleGeolocationResponse,this),c=l(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(o,c,e):navigator.geolocation.getCurrentPosition(o,c,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var o=e.code,c=e.message||(o===1?"permission denied":o===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:o,message:"Geolocation error: "+c+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var o=e.coords.latitude,c=e.coords.longitude,h=new gt(o,c),d=h.toBounds(e.coords.accuracy*2),y=this._locateOptions;if(y.setView){var x=this.getBoundsZoom(d);this.setView(h,y.maxZoom?Math.min(x,y.maxZoom):x)}var M={latlng:h,bounds:d,timestamp:e.timestamp};for(var D in e.coords)typeof e.coords[D]=="number"&&(M[D]=e.coords[D]);this.fire("locationfound",M)}},addHandler:function(e,o){if(!o)return this;var c=this[e]=new o(this);return this._handlers.push(c),this.options[e]&&c.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Mt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(ot(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var e;for(e in this._layers)this._layers[e].remove();for(e in this._panes)Mt(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,o){var c="leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),h=wt("div",c,o||this._mapPane);return e&&(this._panes[e]=h),h},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds(),o=this.unproject(e.getBottomLeft()),c=this.unproject(e.getTopRight());return new ht(o,c)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,o,c){e=_t(e),c=I(c||[0,0]);var h=this.getZoom()||0,d=this.getMinZoom(),y=this.getMaxZoom(),x=e.getNorthWest(),M=e.getSouthEast(),D=this.getSize().subtract(c),W=tt(this.project(M,h),this.project(x,h)).getSize(),it=st.any3d?this.options.zoomSnap:1,lt=D.x/W.x,mt=D.y/W.y,Kt=o?Math.max(lt,mt):Math.min(lt,mt);return h=this.getScaleZoom(Kt,h),it&&(h=Math.round(h/(it/100))*(it/100),h=o?Math.ceil(h/it)*it:Math.floor(h/it)*it),Math.max(d,Math.min(y,h))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new q(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,o){var c=this._getTopLeftPoint(e,o);return new $(c,c.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(e===void 0?this.getZoom():e)},getPane:function(e){return typeof e=="string"?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,o){var c=this.options.crs;return o=o===void 0?this._zoom:o,c.scale(e)/c.scale(o)},getScaleZoom:function(e,o){var c=this.options.crs;o=o===void 0?this._zoom:o;var h=c.zoom(e*c.scale(o));return isNaN(h)?1/0:h},project:function(e,o){return o=o===void 0?this._zoom:o,this.options.crs.latLngToPoint(ct(e),o)},unproject:function(e,o){return o=o===void 0?this._zoom:o,this.options.crs.pointToLatLng(I(e),o)},layerPointToLatLng:function(e){var o=I(e).add(this.getPixelOrigin());return this.unproject(o)},latLngToLayerPoint:function(e){var o=this.project(ct(e))._round();return o._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(ct(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(_t(e))},distance:function(e,o){return this.options.crs.distance(ct(e),ct(o))},containerPointToLayerPoint:function(e){return I(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return I(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var o=this.containerPointToLayerPoint(I(e));return this.layerPointToLatLng(o)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(ct(e)))},mouseEventToContainerPoint:function(e){return Ca(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var o=this._container=Sa(e);if(o){if(o._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");ft(o,"scroll",this._onScroll,this),this._containerId=f(o)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&st.any3d,pt(e,"leaflet-container"+(st.touch?" leaflet-touch":"")+(st.retina?" leaflet-retina":"")+(st.ielt9?" leaflet-oldie":"")+(st.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var o=Yn(e,"position");o!=="absolute"&&o!=="relative"&&o!=="fixed"&&o!=="sticky"&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),At(this._mapPane,new q(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(pt(e.markerPane,"leaflet-zoom-hide"),pt(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,o,c){At(this._mapPane,new q(0,0));var h=!this._loaded;this._loaded=!0,o=this._limitZoom(o),this.fire("viewprereset");var d=this._zoom!==o;this._moveStart(d,c)._move(e,o)._moveEnd(d),this.fire("viewreset"),h&&this.fire("load")},_moveStart:function(e,o){return e&&this.fire("zoomstart"),o||this.fire("movestart"),this},_move:function(e,o,c,h){o===void 0&&(o=this._zoom);var d=this._zoom!==o;return this._zoom=o,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),h?c&&c.pinch&&this.fire("zoom",c):((d||c&&c.pinch)&&this.fire("zoom",c),this.fire("move",c)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return ot(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){At(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[f(this._container)]=this;var o=e?Et:ft;o(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&o(window,"resize",this._onResize,this),st.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){ot(this._resizeRequest),this._resizeRequest=J(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,o){for(var c=[],h,d=o==="mouseout"||o==="mouseover",y=e.target||e.srcElement,x=!1;y;){if(h=this._targets[f(y)],h&&(o==="click"||o==="preclick")&&this._draggableMoved(h)){x=!0;break}if(h&&h.listens(o,!0)&&(d&&!go(y,e)||(c.push(h),d))||y===this._container)break;y=y.parentNode}return!c.length&&!x&&!d&&this.listens(o,!0)&&(c=[this]),c},_isClickDisabled:function(e){for(;e&&e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var o=e.target||e.srcElement;if(!(!this._loaded||o._leaflet_disable_events||e.type==="click"&&this._isClickDisabled(o))){var c=e.type;c==="mousedown"&&ho(o),this._fireDOMEvent(e,c)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,o,c){if(e.type==="click"){var h=r({},e);h.type="preclick",this._fireDOMEvent(h,h.type,c)}var d=this._findEventTargets(e,o);if(c){for(var y=[],x=0;x<c.length;x++)c[x].listens(o,!0)&&y.push(c[x]);d=y.concat(d)}if(d.length){o==="contextmenu"&&$t(e);var M=d[0],D={originalEvent:e};if(e.type!=="keypress"&&e.type!=="keydown"&&e.type!=="keyup"){var W=M.getLatLng&&(!M._radius||M._radius<=10);D.containerPoint=W?this.latLngToContainerPoint(M.getLatLng()):this.mouseEventToContainerPoint(e),D.layerPoint=this.containerPointToLayerPoint(D.containerPoint),D.latlng=W?M.getLatLng():this.layerPointToLatLng(D.layerPoint)}for(x=0;x<d.length;x++)if(d[x].fire(o,D,!0),D.originalEvent._stopped||d[x].options.bubblingMouseEvents===!1&&F(this._mouseEvents,o)!==-1)return}},_draggableMoved:function(e){return e=e.dragging&&e.dragging.enabled()?e:this,e.dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,o=this._handlers.length;e<o;e++)this._handlers[e].disable()},whenReady:function(e,o){return this._loaded?e.call(o||this,{target:this}):this.on("load",e,o),this},_getMapPanePos:function(){return nn(this._mapPane)||new q(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,o){var c=e&&o!==void 0?this._getNewPixelOrigin(e,o):this.getPixelOrigin();return c.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,o){var c=this.getSize()._divideBy(2);return this.project(e,o)._subtract(c)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,o,c){var h=this._getNewPixelOrigin(c,o);return this.project(e,o)._subtract(h)},_latLngBoundsToNewLayerBounds:function(e,o,c){var h=this._getNewPixelOrigin(c,o);return tt([this.project(e.getSouthWest(),o)._subtract(h),this.project(e.getNorthWest(),o)._subtract(h),this.project(e.getSouthEast(),o)._subtract(h),this.project(e.getNorthEast(),o)._subtract(h)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,o,c){if(!c)return e;var h=this.project(e,o),d=this.getSize().divideBy(2),y=new $(h.subtract(d),h.add(d)),x=this._getBoundsOffset(y,c,o);return Math.abs(x.x)<=1&&Math.abs(x.y)<=1?e:this.unproject(h.add(x),o)},_limitOffset:function(e,o){if(!o)return e;var c=this.getPixelBounds(),h=new $(c.min.add(e),c.max.add(e));return e.add(this._getBoundsOffset(h,o))},_getBoundsOffset:function(e,o,c){var h=tt(this.project(o.getNorthEast(),c),this.project(o.getSouthWest(),c)),d=h.min.subtract(e.min),y=h.max.subtract(e.max),x=this._rebound(d.x,-y.x),M=this._rebound(d.y,-y.y);return new q(x,M)},_rebound:function(e,o){return e+o>0?Math.round(e-o)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(o))},_limitZoom:function(e){var o=this.getMinZoom(),c=this.getMaxZoom(),h=st.any3d?this.options.zoomSnap:1;return h&&(e=Math.round(e/h)*h),Math.max(o,Math.min(c,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){It(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,o){var c=this._getCenterOffset(e)._trunc();return(o&&o.animate)!==!0&&!this.getSize().contains(c)?!1:(this.panBy(c,o),!0)},_createAnimProxy:function(){var e=this._proxy=wt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",function(o){var c=io,h=this._proxy.style[c];en(this._proxy,this.project(o.center,o.zoom),this.getZoomScale(o.zoom,1)),h===this._proxy.style[c]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Mt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),o=this.getZoom();en(this._proxy,this.project(e,o),this.getZoomScale(o,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,o,c){if(this._animatingZoom)return!0;if(c=c||{},!this._zoomAnimated||c.animate===!1||this._nothingToAnimate()||Math.abs(o-this._zoom)>this.options.zoomAnimationThreshold)return!1;var h=this.getZoomScale(o),d=this._getCenterOffset(e)._divideBy(1-1/h);return c.animate!==!0&&!this.getSize().contains(d)?!1:(J(function(){this._moveStart(!0,c.noMoveStart||!1)._animateZoom(e,o,!0)},this),!0)},_animateZoom:function(e,o,c,h){this._mapPane&&(c&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=o,pt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:o,noUpdate:h}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(l(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&It(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function rf(e,o){return new bt(e,o)}var me=Z.extend({options:{position:"topright"},initialize:function(e){S(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var o=this._map;return o&&o.removeControl(this),this.options.position=e,o&&o.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var o=this._container=this.onAdd(e),c=this.getPosition(),h=e._controlCorners[c];return pt(o,"leaflet-control"),c.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Mt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),ei=function(e){return new me(e)};bt.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},o="leaflet-",c=this._controlContainer=wt("div",o+"control-container",this._container);function h(d,y){var x=o+d+" "+o+y;e[d+y]=wt("div",x,c)}h("top","left"),h("top","right"),h("bottom","left"),h("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)Mt(this._controlCorners[e]);Mt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Ia=me.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,o,c,h){return c<h?-1:h<c?1:0}},initialize:function(e,o,c){S(this,c),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var h in e)this._addLayer(e[h],h);for(h in o)this._addLayer(o[h],h,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var o=0;o<this._layers.length;o++)this._layers[o].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return me.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,o){return this._addLayer(e,o),this._map?this._update():this},addOverlay:function(e,o){return this._addLayer(e,o,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var o=this._getLayer(f(e));return o&&this._layers.splice(this._layers.indexOf(o),1),this._map?this._update():this},expand:function(){pt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(pt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):It(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return It(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",o=this._container=wt("div",e),c=this.options.collapsed;o.setAttribute("aria-haspopup",!0),ti(o),mo(o);var h=this._section=wt("section",e+"-list");c&&(this._map.on("click",this.collapse,this),ft(o,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var d=this._layersLink=wt("a",e+"-toggle",o);d.href="#",d.title="Layers",d.setAttribute("role","button"),ft(d,{keydown:function(y){y.keyCode===13&&this._expandSafely()},click:function(y){$t(y),this._expandSafely()}},this),c||this.expand(),this._baseLayersList=wt("div",e+"-base",h),this._separator=wt("div",e+"-separator",h),this._overlaysList=wt("div",e+"-overlays",h),o.appendChild(h)},_getLayer:function(e){for(var o=0;o<this._layers.length;o++)if(this._layers[o]&&f(this._layers[o].layer)===e)return this._layers[o]},_addLayer:function(e,o,c){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:o,overlay:c}),this.options.sortLayers&&this._layers.sort(l(function(h,d){return this.options.sortFunction(h.layer,d.layer,h.name,d.name)},this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Bi(this._baseLayersList),Bi(this._overlaysList),this._layerControlInputs=[];var e,o,c,h,d=0;for(c=0;c<this._layers.length;c++)h=this._layers[c],this._addItem(h),o=o||h.overlay,e=e||!h.overlay,d+=h.overlay?0:1;return this.options.hideSingleBase&&(e=e&&d>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=o&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var o=this._getLayer(f(e.target)),c=o.overlay?e.type==="add"?"overlayadd":"overlayremove":e.type==="add"?"baselayerchange":null;c&&this._map.fire(c,o)},_createRadioElement:function(e,o){var c='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(o?' checked="checked"':"")+"/>",h=document.createElement("div");return h.innerHTML=c,h.firstChild},_addItem:function(e){var o=document.createElement("label"),c=this._map.hasLayer(e.layer),h;e.overlay?(h=document.createElement("input"),h.type="checkbox",h.className="leaflet-control-layers-selector",h.defaultChecked=c):h=this._createRadioElement("leaflet-base-layers_"+f(this),c),this._layerControlInputs.push(h),h.layerId=f(e.layer),ft(h,"click",this._onInputClick,this);var d=document.createElement("span");d.innerHTML=" "+e.name;var y=document.createElement("span");o.appendChild(y),y.appendChild(h),y.appendChild(d);var x=e.overlay?this._overlaysList:this._baseLayersList;return x.appendChild(o),this._checkDisabledLayers(),o},_onInputClick:function(){if(!this._preventClick){var e=this._layerControlInputs,o,c,h=[],d=[];this._handlingClick=!0;for(var y=e.length-1;y>=0;y--)o=e[y],c=this._getLayer(o.layerId).layer,o.checked?h.push(c):o.checked||d.push(c);for(y=0;y<d.length;y++)this._map.hasLayer(d[y])&&this._map.removeLayer(d[y]);for(y=0;y<h.length;y++)this._map.hasLayer(h[y])||this._map.addLayer(h[y]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var e=this._layerControlInputs,o,c,h=this._map.getZoom(),d=e.length-1;d>=0;d--)o=e[d],c=this._getLayer(o.layerId).layer,o.disabled=c.options.minZoom!==void 0&&h<c.options.minZoom||c.options.maxZoom!==void 0&&h>c.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var e=this._section;this._preventClick=!0,ft(e,"click",$t),this.expand();var o=this;setTimeout(function(){Et(e,"click",$t),o._preventClick=!1})}}),of=function(e,o,c){return new Ia(e,o,c)},yo=me.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var o="leaflet-control-zoom",c=wt("div",o+" leaflet-bar"),h=this.options;return this._zoomInButton=this._createButton(h.zoomInText,h.zoomInTitle,o+"-in",c,this._zoomIn),this._zoomOutButton=this._createButton(h.zoomOutText,h.zoomOutTitle,o+"-out",c,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),c},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,o,c,h,d){var y=wt("a",c,h);return y.innerHTML=e,y.href="#",y.title=o,y.setAttribute("role","button"),y.setAttribute("aria-label",o),ti(y),ft(y,"click",on),ft(y,"click",d,this),ft(y,"click",this._refocusOnMap,this),y},_updateDisabled:function(){var e=this._map,o="leaflet-disabled";It(this._zoomInButton,o),It(this._zoomOutButton,o),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(pt(this._zoomOutButton,o),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(pt(this._zoomInButton,o),this._zoomInButton.setAttribute("aria-disabled","true"))}});bt.mergeOptions({zoomControl:!0}),bt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new yo,this.addControl(this.zoomControl))});var sf=function(e){return new yo(e)},Aa=me.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var o="leaflet-control-scale",c=wt("div",o),h=this.options;return this._addScales(h,o+"-line",c),e.on(h.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),c},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,o,c){e.metric&&(this._mScale=wt("div",o,c)),e.imperial&&(this._iScale=wt("div",o,c))},_update:function(){var e=this._map,o=e.getSize().y/2,c=e.distance(e.containerPointToLatLng([0,o]),e.containerPointToLatLng([this.options.maxWidth,o]));this._updateScales(c)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var o=this._getRoundNum(e),c=o<1e3?o+" m":o/1e3+" km";this._updateScale(this._mScale,c,o/e)},_updateImperial:function(e){var o=e*3.2808399,c,h,d;o>5280?(c=o/5280,h=this._getRoundNum(c),this._updateScale(this._iScale,h+" mi",h/c)):(d=this._getRoundNum(o),this._updateScale(this._iScale,d+" ft",d/o))},_updateScale:function(e,o,c){e.style.width=Math.round(this.options.maxWidth*c)+"px",e.innerHTML=o},_getRoundNum:function(e){var o=Math.pow(10,(Math.floor(e)+"").length-1),c=e/o;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:1,o*c}}),af=function(e){return new Aa(e)},cf='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',vo=me.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(st.inlineSvg?cf+" ":"")+"Leaflet</a>"},initialize:function(e){S(this,e),this._attributions={}},onAdd:function(e){e.attributionControl=this,this._container=wt("div","leaflet-control-attribution"),ti(this._container);for(var o in e._layers)e._layers[o].getAttribution&&this.addAttribution(e._layers[o].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",function(){this.removeAttribution(e.layer.getAttribution())},this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var o in this._attributions)this._attributions[o]&&e.push(o);var c=[];this.options.prefix&&c.push(this.options.prefix),e.length&&c.push(e.join(", ")),this._container.innerHTML=c.join(' <span aria-hidden="true">|</span> ')}}});bt.mergeOptions({attributionControl:!0}),bt.addInitHook(function(){this.options.attributionControl&&new vo().addTo(this)});var lf=function(e){return new vo(e)};me.Layers=Ia,me.Zoom=yo,me.Scale=Aa,me.Attribution=vo,ei.layers=of,ei.zoom=sf,ei.scale=af,ei.attribution=lf;var Le=Z.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Le.addTo=function(e,o){return e.addHandler(o,this),this};var hf={Events:R},Da=st.touch?"touchstart mousedown":"mousedown",Je=j.extend({options:{clickTolerance:3},initialize:function(e,o,c,h){S(this,h),this._element=e,this._dragStartTarget=o||e,this._preventOutline=c},enable:function(){this._enabled||(ft(this._dragStartTarget,Da,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Je._dragging===this&&this.finishDrag(!0),Et(this._dragStartTarget,Da,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!ro(this._element,"leaflet-zoom-anim"))){if(e.touches&&e.touches.length!==1){Je._dragging===this&&this.finishDrag();return}if(!(Je._dragging||e.shiftKey||e.which!==1&&e.button!==1&&!e.touches)&&(Je._dragging=this,this._preventOutline&&ho(this._element),ao(),Jn(),!this._moving)){this.fire("down");var o=e.touches?e.touches[0]:e,c=Ea(this._element);this._startPoint=new q(o.clientX,o.clientY),this._startPos=nn(this._element),this._parentScale=uo(c);var h=e.type==="mousedown";ft(document,h?"mousemove":"touchmove",this._onMove,this),ft(document,h?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(e){if(this._enabled){if(e.touches&&e.touches.length>1){this._moved=!0;return}var o=e.touches&&e.touches.length===1?e.touches[0]:e,c=new q(o.clientX,o.clientY)._subtract(this._startPoint);!c.x&&!c.y||Math.abs(c.x)+Math.abs(c.y)<this.options.clickTolerance||(c.x/=this._parentScale.x,c.y/=this._parentScale.y,$t(e),this._moved||(this.fire("dragstart"),this._moved=!0,pt(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),pt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(c),this._moving=!0,this._lastEvent=e,this._updatePosition())}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),At(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){It(document.body,"leaflet-dragging"),this._lastTarget&&(It(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Et(document,"mousemove touchmove",this._onMove,this),Et(document,"mouseup touchend touchcancel",this._onUp,this),co(),Xn();var o=this._moved&&this._moving;this._moving=!1,Je._dragging=!1,o&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)})}});function Oa(e,o,c){var h,d=[1,4,2,8],y,x,M,D,W,it,lt,mt;for(y=0,it=e.length;y<it;y++)e[y]._code=sn(e[y],o);for(M=0;M<4;M++){for(lt=d[M],h=[],y=0,it=e.length,x=it-1;y<it;x=y++)D=e[y],W=e[x],D._code&lt?W._code&lt||(mt=Ui(W,D,lt,o,c),mt._code=sn(mt,o),h.push(mt)):(W._code&lt&&(mt=Ui(W,D,lt,o,c),mt._code=sn(mt,o),h.push(mt)),h.push(D));e=h}return e}function Ba(e,o){var c,h,d,y,x,M,D,W,it;if(!e||e.length===0)throw new Error("latlngs not passed");ce(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var lt=ct([0,0]),mt=_t(e),Kt=mt.getNorthWest().distanceTo(mt.getSouthWest())*mt.getNorthEast().distanceTo(mt.getNorthWest());Kt<1700&&(lt=bo(e));var Ft=e.length,le=[];for(c=0;c<Ft;c++){var Xt=ct(e[c]);le.push(o.project(ct([Xt.lat-lt.lat,Xt.lng-lt.lng])))}for(M=D=W=0,c=0,h=Ft-1;c<Ft;h=c++)d=le[c],y=le[h],x=d.y*y.x-y.y*d.x,D+=(d.x+y.x)*x,W+=(d.y+y.y)*x,M+=x*3;M===0?it=le[0]:it=[D/M,W/M];var An=o.unproject(I(it));return ct([An.lat+lt.lat,An.lng+lt.lng])}function bo(e){for(var o=0,c=0,h=0,d=0;d<e.length;d++){var y=ct(e[d]);o+=y.lat,c+=y.lng,h++}return ct([o/h,c/h])}var uf={__proto__:null,clipPolygon:Oa,polygonCenter:Ba,centroid:bo};function za(e,o){if(!o||!e.length)return e.slice();var c=o*o;return e=_f(e,c),e=ff(e,c),e}function Ra(e,o,c){return Math.sqrt(ni(e,o,c,!0))}function df(e,o,c){return ni(e,o,c)}function ff(e,o){var c=e.length,h=typeof Uint8Array<"u"?Uint8Array:Array,d=new h(c);d[0]=d[c-1]=1,wo(e,d,o,0,c-1);var y,x=[];for(y=0;y<c;y++)d[y]&&x.push(e[y]);return x}function wo(e,o,c,h,d){var y=0,x,M,D;for(M=h+1;M<=d-1;M++)D=ni(e[M],e[h],e[d],!0),D>y&&(x=M,y=D);y>c&&(o[x]=1,wo(e,o,c,h,x),wo(e,o,c,x,d))}function _f(e,o){for(var c=[e[0]],h=1,d=0,y=e.length;h<y;h++)pf(e[h],e[d])>o&&(c.push(e[h]),d=h);return d<y-1&&c.push(e[y-1]),c}var Ha;function ja(e,o,c,h,d){var y=h?Ha:sn(e,c),x=sn(o,c),M,D,W;for(Ha=x;;){if(!(y|x))return[e,o];if(y&x)return!1;M=y||x,D=Ui(e,o,M,c,d),W=sn(D,c),M===y?(e=D,y=W):(o=D,x=W)}}function Ui(e,o,c,h,d){var y=o.x-e.x,x=o.y-e.y,M=h.min,D=h.max,W,it;return c&8?(W=e.x+y*(D.y-e.y)/x,it=D.y):c&4?(W=e.x+y*(M.y-e.y)/x,it=M.y):c&2?(W=D.x,it=e.y+x*(D.x-e.x)/y):c&1&&(W=M.x,it=e.y+x*(M.x-e.x)/y),new q(W,it,d)}function sn(e,o){var c=0;return e.x<o.min.x?c|=1:e.x>o.max.x&&(c|=2),e.y<o.min.y?c|=4:e.y>o.max.y&&(c|=8),c}function pf(e,o){var c=o.x-e.x,h=o.y-e.y;return c*c+h*h}function ni(e,o,c,h){var d=o.x,y=o.y,x=c.x-d,M=c.y-y,D=x*x+M*M,W;return D>0&&(W=((e.x-d)*x+(e.y-y)*M)/D,W>1?(d=c.x,y=c.y):W>0&&(d+=x*W,y+=M*W)),x=e.x-d,M=e.y-y,h?x*x+M*M:new q(d,y)}function ce(e){return!w(e[0])||typeof e[0][0]!="object"&&typeof e[0][0]<"u"}function Ua(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ce(e)}function Fa(e,o){var c,h,d,y,x,M,D,W;if(!e||e.length===0)throw new Error("latlngs not passed");ce(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var it=ct([0,0]),lt=_t(e),mt=lt.getNorthWest().distanceTo(lt.getSouthWest())*lt.getNorthEast().distanceTo(lt.getNorthWest());mt<1700&&(it=bo(e));var Kt=e.length,Ft=[];for(c=0;c<Kt;c++){var le=ct(e[c]);Ft.push(o.project(ct([le.lat-it.lat,le.lng-it.lng])))}for(c=0,h=0;c<Kt-1;c++)h+=Ft[c].distanceTo(Ft[c+1])/2;if(h===0)W=Ft[0];else for(c=0,y=0;c<Kt-1;c++)if(x=Ft[c],M=Ft[c+1],d=x.distanceTo(M),y+=d,y>h){D=(y-h)/d,W=[M.x-D*(M.x-x.x),M.y-D*(M.y-x.y)];break}var Xt=o.unproject(I(W));return ct([Xt.lat+it.lat,Xt.lng+it.lng])}var mf={__proto__:null,simplify:za,pointToSegmentDistance:Ra,closestPointOnSegment:df,clipSegment:ja,_getEdgeIntersection:Ui,_getBitCode:sn,_sqClosestPointOnSegment:ni,isFlat:ce,_flat:Ua,polylineCenter:Fa},xo={project:function(e){return new q(e.lng,e.lat)},unproject:function(e){return new gt(e.y,e.x)},bounds:new $([-180,-90],[180,90])},Lo={R:6378137,R_MINOR:6356752.314245179,bounds:new $([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(e){var o=Math.PI/180,c=this.R,h=e.lat*o,d=this.R_MINOR/c,y=Math.sqrt(1-d*d),x=y*Math.sin(h),M=Math.tan(Math.PI/4-h/2)/Math.pow((1-x)/(1+x),y/2);return h=-c*Math.log(Math.max(M,1e-10)),new q(e.lng*o*c,h)},unproject:function(e){for(var o=180/Math.PI,c=this.R,h=this.R_MINOR/c,d=Math.sqrt(1-h*h),y=Math.exp(-e.y/c),x=Math.PI/2-2*Math.atan(y),M=0,D=.1,W;M<15&&Math.abs(D)>1e-7;M++)W=d*Math.sin(x),W=Math.pow((1-W)/(1+W),d/2),D=Math.PI/2-2*Math.atan(y*W)-x,x+=D;return new gt(x*o,e.x*o/c)}},gf={__proto__:null,LonLat:xo,Mercator:Lo,SphericalMercator:z},yf=r({},qt,{code:"EPSG:3395",projection:Lo,transformation:(function(){var e=.5/(Math.PI*Lo.R);return at(e,.5,-e,.5)})()}),Na=r({},qt,{code:"EPSG:4326",projection:xo,transformation:at(1/180,1,-1/180,.5)}),vf=r({},Ct,{projection:xo,transformation:at(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,o){var c=o.lng-e.lng,h=o.lat-e.lat;return Math.sqrt(c*c+h*h)},infinite:!0});Ct.Earth=qt,Ct.EPSG3395=yf,Ct.EPSG3857=dt,Ct.EPSG900913=zt,Ct.EPSG4326=Na,Ct.Simple=vf;var ge=j.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[f(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[f(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var o=e.target;if(o.hasLayer(this)){if(this._map=o,this._zoomAnimated=o._zoomAnimated,this.getEvents){var c=this.getEvents();o.on(c,this),this.once("remove",function(){o.off(c,this)},this)}this.onAdd(o),this.fire("add"),o.fire("layeradd",{layer:this})}}});bt.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var o=f(e);return this._layers[o]?this:(this._layers[o]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e),this)},removeLayer:function(e){var o=f(e);return this._layers[o]?(this._loaded&&e.onRemove(this),delete this._layers[o],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return f(e)in this._layers},eachLayer:function(e,o){for(var c in this._layers)e.call(o,this._layers[c]);return this},_addLayers:function(e){e=e?w(e)?e:[e]:[];for(var o=0,c=e.length;o<c;o++)this.addLayer(e[o])},_addZoomLimit:function(e){(!isNaN(e.options.maxZoom)||!isNaN(e.options.minZoom))&&(this._zoomBoundLayers[f(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var o=f(e);this._zoomBoundLayers[o]&&(delete this._zoomBoundLayers[o],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,o=-1/0,c=this._getZoomSpan();for(var h in this._zoomBoundLayers){var d=this._zoomBoundLayers[h].options;e=d.minZoom===void 0?e:Math.min(e,d.minZoom),o=d.maxZoom===void 0?o:Math.max(o,d.maxZoom)}this._layersMaxZoom=o===-1/0?void 0:o,this._layersMinZoom=e===1/0?void 0:e,c!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Tn=ge.extend({initialize:function(e,o){S(this,o),this._layers={};var c,h;if(e)for(c=0,h=e.length;c<h;c++)this.addLayer(e[c])},addLayer:function(e){var o=this.getLayerId(e);return this._layers[o]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var o=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[o]&&this._map.removeLayer(this._layers[o]),delete this._layers[o],this},hasLayer:function(e){var o=typeof e=="number"?e:this.getLayerId(e);return o in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var o=Array.prototype.slice.call(arguments,1),c,h;for(c in this._layers)h=this._layers[c],h[e]&&h[e].apply(h,o);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,o){for(var c in this._layers)e.call(o,this._layers[c]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return f(e)}}),bf=function(e,o){return new Tn(e,o)},Oe=Tn.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),Tn.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),Tn.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new ht;for(var o in this._layers){var c=this._layers[o];e.extend(c.getBounds?c.getBounds():c.getLatLng())}return e}}),wf=function(e,o){return new Oe(e,o)},Cn=Z.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){S(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,o){var c=this._getIconUrl(e);if(!c){if(e==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var h=this._createImg(c,o&&o.tagName==="IMG"?o:null);return this._setIconStyles(h,e),(this.options.crossOrigin||this.options.crossOrigin==="")&&(h.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),h},_setIconStyles:function(e,o){var c=this.options,h=c[o+"Size"];typeof h=="number"&&(h=[h,h]);var d=I(h),y=I(o==="shadow"&&c.shadowAnchor||c.iconAnchor||d&&d.divideBy(2,!0));e.className="leaflet-marker-"+o+" "+(c.className||""),y&&(e.style.marginLeft=-y.x+"px",e.style.marginTop=-y.y+"px"),d&&(e.style.width=d.x+"px",e.style.height=d.y+"px")},_createImg:function(e,o){return o=o||document.createElement("img"),o.src=e,o},_getIconUrl:function(e){return st.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function xf(e){return new Cn(e)}var ii=Cn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return typeof ii.imagePath!="string"&&(ii.imagePath=this._detectIconPath()),(this.options.imagePath||ii.imagePath)+Cn.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var o=function(c,h,d){var y=h.exec(c);return y&&y[d]};return e=o(e,/^url\((['"])?(.+)\1\)$/,2),e&&o(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=wt("div","leaflet-default-icon-path",document.body),o=Yn(e,"background-image")||Yn(e,"backgroundImage");if(document.body.removeChild(e),o=this._stripUrl(o),o)return o;var c=document.querySelector('link[href$="leaflet.css"]');return c?c.href.substring(0,c.href.length-11-1):""}}),$a=Le.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new Je(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),pt(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&It(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var o=this._marker,c=o._map,h=this._marker.options.autoPanSpeed,d=this._marker.options.autoPanPadding,y=nn(o._icon),x=c.getPixelBounds(),M=c.getPixelOrigin(),D=tt(x.min._subtract(M).add(d),x.max._subtract(M).subtract(d));if(!D.contains(y)){var W=I((Math.max(D.max.x,y.x)-D.max.x)/(x.max.x-D.max.x)-(Math.min(D.min.x,y.x)-D.min.x)/(x.min.x-D.min.x),(Math.max(D.max.y,y.y)-D.max.y)/(x.max.y-D.max.y)-(Math.min(D.min.y,y.y)-D.min.y)/(x.min.y-D.min.y)).multiplyBy(h);c.panBy(W,{animate:!1}),this._draggable._newPos._add(W),this._draggable._startPos._add(W),At(o._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=J(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(ot(this._panRequest),this._panRequest=J(this._adjustPan.bind(this,e)))},_onDrag:function(e){var o=this._marker,c=o._shadow,h=nn(o._icon),d=o._map.layerPointToLatLng(h);c&&At(c,h),o._latlng=d,e.latlng=d,e.oldLatLng=this._oldLatLng,o.fire("move",e).fire("drag",e)},_onDragEnd:function(e){ot(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),Fi=ge.extend({options:{icon:new ii,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,o){S(this,o),this._latlng=ct(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var o=this._latlng;return this._latlng=ct(e),this.update(),this.fire("move",{oldLatLng:o,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,o="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),c=e.icon.createIcon(this._icon),h=!1;c!==this._icon&&(this._icon&&this._removeIcon(),h=!0,e.title&&(c.title=e.title),c.tagName==="IMG"&&(c.alt=e.alt||"")),pt(c,o),e.keyboard&&(c.tabIndex="0",c.setAttribute("role","button")),this._icon=c,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ft(c,"focus",this._panOnFocus,this);var d=e.icon.createShadow(this._shadow),y=!1;d!==this._shadow&&(this._removeShadow(),y=!0),d&&(pt(d,o),d.alt=""),this._shadow=d,e.opacity<1&&this._updateOpacity(),h&&this.getPane().appendChild(this._icon),this._initInteraction(),d&&y&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Et(this._icon,"focus",this._panOnFocus,this),Mt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Mt(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&At(this._icon,e),this._shadow&&At(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var o=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(o)},_initInteraction:function(){if(this.options.interactive&&(pt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),$a)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new $a(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&ae(this._icon,e),this._shadow&&ae(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var o=this.options.icon.options,c=o.iconSize?I(o.iconSize):I(0,0),h=o.iconAnchor?I(o.iconAnchor):I(0,0);e.panInside(this._latlng,{paddingTopLeft:h,paddingBottomRight:c.subtract(h)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Lf(e,o){return new Fi(e,o)}var Xe=ge.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return S(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Ni=Xe.extend({options:{fill:!0,radius:10},initialize:function(e,o){S(this,o),this._latlng=ct(e),this._radius=this.options.radius},setLatLng:function(e){var o=this._latlng;return this._latlng=ct(e),this.redraw(),this.fire("move",{oldLatLng:o,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var o=e&&e.radius||this._radius;return Xe.prototype.setStyle.call(this,e),this.setRadius(o),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,o=this._radiusY||e,c=this._clickTolerance(),h=[e+c,o+c];this._pxBounds=new $(this._point.subtract(h),this._point.add(h))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Sf(e,o){return new Ni(e,o)}var So=Ni.extend({initialize:function(e,o,c){if(typeof o=="number"&&(o=r({},c,{radius:o})),S(this,o),this._latlng=ct(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new ht(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:Xe.prototype.setStyle,_project:function(){var e=this._latlng.lng,o=this._latlng.lat,c=this._map,h=c.options.crs;if(h.distance===qt.distance){var d=Math.PI/180,y=this._mRadius/qt.R/d,x=c.project([o+y,e]),M=c.project([o-y,e]),D=x.add(M).divideBy(2),W=c.unproject(D).lat,it=Math.acos((Math.cos(y*d)-Math.sin(o*d)*Math.sin(W*d))/(Math.cos(o*d)*Math.cos(W*d)))/d;(isNaN(it)||it===0)&&(it=y/Math.cos(Math.PI/180*o)),this._point=D.subtract(c.getPixelOrigin()),this._radius=isNaN(it)?0:D.x-c.project([W,e-it]).x,this._radiusY=D.y-x.y}else{var lt=h.unproject(h.project(this._latlng).subtract([this._mRadius,0]));this._point=c.latLngToLayerPoint(this._latlng),this._radius=this._point.x-c.latLngToLayerPoint(lt).x}this._updateBounds()}});function Ef(e,o,c){return new So(e,o,c)}var Be=Xe.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,o){S(this,o),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var o=1/0,c=null,h=ni,d,y,x=0,M=this._parts.length;x<M;x++)for(var D=this._parts[x],W=1,it=D.length;W<it;W++){d=D[W-1],y=D[W];var lt=h(e,d,y,!0);lt<o&&(o=lt,c=h(e,d,y))}return c&&(c.distance=Math.sqrt(o)),c},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Fa(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(e,o){return o=o||this._defaultShape(),e=ct(e),o.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new ht,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return ce(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var o=[],c=ce(e),h=0,d=e.length;h<d;h++)c?(o[h]=ct(e[h]),this._bounds.extend(o[h])):o[h]=this._convertLatLngs(e[h]);return o},_project:function(){var e=new $;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),o=new q(e,e);this._rawPxBounds&&(this._pxBounds=new $([this._rawPxBounds.min.subtract(o),this._rawPxBounds.max.add(o)]))},_projectLatlngs:function(e,o,c){var h=e[0]instanceof gt,d=e.length,y,x;if(h){for(x=[],y=0;y<d;y++)x[y]=this._map.latLngToLayerPoint(e[y]),c.extend(x[y]);o.push(x)}else for(y=0;y<d;y++)this._projectLatlngs(e[y],o,c)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}var o=this._parts,c,h,d,y,x,M,D;for(c=0,d=0,y=this._rings.length;c<y;c++)for(D=this._rings[c],h=0,x=D.length;h<x-1;h++)M=ja(D[h],D[h+1],e,h,!0),M&&(o[d]=o[d]||[],o[d].push(M[0]),(M[1]!==D[h+1]||h===x-2)&&(o[d].push(M[1]),d++))}},_simplifyPoints:function(){for(var e=this._parts,o=this.options.smoothFactor,c=0,h=e.length;c<h;c++)e[c]=za(e[c],o)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,o){var c,h,d,y,x,M,D=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(c=0,y=this._parts.length;c<y;c++)for(M=this._parts[c],h=0,x=M.length,d=x-1;h<x;d=h++)if(!(!o&&h===0)&&Ra(e,M[d],M[h])<=D)return!0;return!1}});function kf(e,o){return new Be(e,o)}Be._flat=Ua;var Mn=Be.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ba(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(e){var o=Be.prototype._convertLatLngs.call(this,e),c=o.length;return c>=2&&o[0]instanceof gt&&o[0].equals(o[c-1])&&o.pop(),o},_setLatLngs:function(e){Be.prototype._setLatLngs.call(this,e),ce(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ce(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,o=this.options.weight,c=new q(o,o);if(e=new $(e.min.subtract(c),e.max.add(c)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}for(var h=0,d=this._rings.length,y;h<d;h++)y=Oa(this._rings[h],e,!0),y.length&&this._parts.push(y)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var o=!1,c,h,d,y,x,M,D,W;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(y=0,D=this._parts.length;y<D;y++)for(c=this._parts[y],x=0,W=c.length,M=W-1;x<W;M=x++)h=c[x],d=c[M],h.y>e.y!=d.y>e.y&&e.x<(d.x-h.x)*(e.y-h.y)/(d.y-h.y)+h.x&&(o=!o);return o||Be.prototype._containsPoint.call(this,e,!0)}});function Tf(e,o){return new Mn(e,o)}var ze=Oe.extend({initialize:function(e,o){S(this,o),this._layers={},e&&this.addData(e)},addData:function(e){var o=w(e)?e:e.features,c,h,d;if(o){for(c=0,h=o.length;c<h;c++)d=o[c],(d.geometries||d.geometry||d.features||d.coordinates)&&this.addData(d);return this}var y=this.options;if(y.filter&&!y.filter(e))return this;var x=$i(e,y);return x?(x.feature=Gi(e),x.defaultOptions=x.options,this.resetStyle(x),y.onEachFeature&&y.onEachFeature(e,x),this.addLayer(x)):this},resetStyle:function(e){return e===void 0?this.eachLayer(this.resetStyle,this):(e.options=r({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer(function(o){this._setLayerStyle(o,e)},this)},_setLayerStyle:function(e,o){e.setStyle&&(typeof o=="function"&&(o=o(e.feature)),e.setStyle(o))}});function $i(e,o){var c=e.type==="Feature"?e.geometry:e,h=c?c.coordinates:null,d=[],y=o&&o.pointToLayer,x=o&&o.coordsToLatLng||Eo,M,D,W,it;if(!h&&!c)return null;switch(c.type){case"Point":return M=x(h),Za(y,e,M,o);case"MultiPoint":for(W=0,it=h.length;W<it;W++)M=x(h[W]),d.push(Za(y,e,M,o));return new Oe(d);case"LineString":case"MultiLineString":return D=Zi(h,c.type==="LineString"?0:1,x),new Be(D,o);case"Polygon":case"MultiPolygon":return D=Zi(h,c.type==="Polygon"?1:2,x),new Mn(D,o);case"GeometryCollection":for(W=0,it=c.geometries.length;W<it;W++){var lt=$i({geometry:c.geometries[W],type:"Feature",properties:e.properties},o);lt&&d.push(lt)}return new Oe(d);case"FeatureCollection":for(W=0,it=c.features.length;W<it;W++){var mt=$i(c.features[W],o);mt&&d.push(mt)}return new Oe(d);default:throw new Error("Invalid GeoJSON object.")}}function Za(e,o,c,h){return e?e(o,c):new Fi(c,h&&h.markersInheritOptions&&h)}function Eo(e){return new gt(e[1],e[0],e[2])}function Zi(e,o,c){for(var h=[],d=0,y=e.length,x;d<y;d++)x=o?Zi(e[d],o-1,c):(c||Eo)(e[d]),h.push(x);return h}function ko(e,o){return e=ct(e),e.alt!==void 0?[m(e.lng,o),m(e.lat,o),m(e.alt,o)]:[m(e.lng,o),m(e.lat,o)]}function Vi(e,o,c,h){for(var d=[],y=0,x=e.length;y<x;y++)d.push(o?Vi(e[y],ce(e[y])?0:o-1,c,h):ko(e[y],h));return!o&&c&&d.length>0&&d.push(d[0].slice()),d}function Pn(e,o){return e.feature?r({},e.feature,{geometry:o}):Gi(o)}function Gi(e){return e.type==="Feature"||e.type==="FeatureCollection"?e:{type:"Feature",properties:{},geometry:e}}var To={toGeoJSON:function(e){return Pn(this,{type:"Point",coordinates:ko(this.getLatLng(),e)})}};Fi.include(To),So.include(To),Ni.include(To),Be.include({toGeoJSON:function(e){var o=!ce(this._latlngs),c=Vi(this._latlngs,o?1:0,!1,e);return Pn(this,{type:(o?"Multi":"")+"LineString",coordinates:c})}}),Mn.include({toGeoJSON:function(e){var o=!ce(this._latlngs),c=o&&!ce(this._latlngs[0]),h=Vi(this._latlngs,c?2:o?1:0,!0,e);return o||(h=[h]),Pn(this,{type:(c?"Multi":"")+"Polygon",coordinates:h})}}),Tn.include({toMultiPoint:function(e){var o=[];return this.eachLayer(function(c){o.push(c.toGeoJSON(e).geometry.coordinates)}),Pn(this,{type:"MultiPoint",coordinates:o})},toGeoJSON:function(e){var o=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(o==="MultiPoint")return this.toMultiPoint(e);var c=o==="GeometryCollection",h=[];return this.eachLayer(function(d){if(d.toGeoJSON){var y=d.toGeoJSON(e);if(c)h.push(y.geometry);else{var x=Gi(y);x.type==="FeatureCollection"?h.push.apply(h,x.features):h.push(x)}}}),c?Pn(this,{geometries:h,type:"GeometryCollection"}):{type:"FeatureCollection",features:h}}});function Va(e,o){return new ze(e,o)}var Cf=Va,Wi=ge.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,o,c){this._url=e,this._bounds=_t(o),S(this,c)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(pt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Mt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&En(this._image),this},bringToBack:function(){return this._map&&kn(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=_t(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e=this._url.tagName==="IMG",o=this._image=e?this._url:wt("img");if(pt(o,"leaflet-image-layer"),this._zoomAnimated&&pt(o,"leaflet-zoom-animated"),this.options.className&&pt(o,this.options.className),o.onselectstart=p,o.onmousemove=p,o.onload=l(this.fire,this,"load"),o.onerror=l(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(o.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e){this._url=o.src;return}o.src=this._url,o.alt=this.options.alt},_animateZoom:function(e){var o=this._map.getZoomScale(e.zoom),c=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;en(this._image,c,o)},_reset:function(){var e=this._image,o=new $(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),c=o.getSize();At(e,o.min),e.style.width=c.x+"px",e.style.height=c.y+"px"},_updateOpacity:function(){ae(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),Mf=function(e,o,c){return new Wi(e,o,c)},Ga=Wi.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e=this._url.tagName==="VIDEO",o=this._image=e?this._url:wt("video");if(pt(o,"leaflet-image-layer"),this._zoomAnimated&&pt(o,"leaflet-zoom-animated"),this.options.className&&pt(o,this.options.className),o.onselectstart=p,o.onmousemove=p,o.onloadeddata=l(this.fire,this,"load"),e){for(var c=o.getElementsByTagName("source"),h=[],d=0;d<c.length;d++)h.push(c[d].src);this._url=c.length>0?h:[o.src];return}w(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(o.style,"objectFit")&&(o.style.objectFit="fill"),o.autoplay=!!this.options.autoplay,o.loop=!!this.options.loop,o.muted=!!this.options.muted,o.playsInline=!!this.options.playsInline;for(var y=0;y<this._url.length;y++){var x=wt("source");x.src=this._url[y],o.appendChild(x)}}});function Pf(e,o,c){return new Ga(e,o,c)}var Wa=Wi.extend({_initImage:function(){var e=this._image=this._url;pt(e,"leaflet-image-layer"),this._zoomAnimated&&pt(e,"leaflet-zoom-animated"),this.options.className&&pt(e,this.options.className),e.onselectstart=p,e.onmousemove=p}});function If(e,o,c){return new Wa(e,o,c)}var Se=ge.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(e,o){e&&(e instanceof gt||w(e))?(this._latlng=ct(e),S(this,o)):(S(this,e),this._source=o),this.options.content&&(this._content=this.options.content)},openOn:function(e){return e=arguments.length?e:this._source._map,e.hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&ae(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&ae(this._container,1),this.bringToFront(),this.options.interactive&&(pt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(ae(this._container,0),this._removeTimeout=setTimeout(l(Mt,void 0,this._container),200)):Mt(this._container),this.options.interactive&&(It(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=ct(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&En(this._container),this},bringToBack:function(){return this._map&&kn(this._container),this},_prepareOpen:function(e){var o=this._source;if(!o._map)return!1;if(o instanceof Oe){o=null;var c=this._source._layers;for(var h in c)if(c[h]._map){o=c[h];break}if(!o)return!1;this._source=o}if(!e)if(o.getCenter)e=o.getCenter();else if(o.getLatLng)e=o.getLatLng();else if(o.getBounds)e=o.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,o=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof o=="string")e.innerHTML=o;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(o)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),o=I(this.options.offset),c=this._getAnchor();this._zoomAnimated?At(this._container,e.add(c)):o=o.add(e).add(c);var h=this._containerBottom=-o.y,d=this._containerLeft=-Math.round(this._containerWidth/2)+o.x;this._container.style.bottom=h+"px",this._container.style.left=d+"px"}},_getAnchor:function(){return[0,0]}});bt.include({_initOverlay:function(e,o,c,h){var d=o;return d instanceof e||(d=new e(h).setContent(o)),c&&d.setLatLng(c),d}}),ge.include({_initOverlay:function(e,o,c,h){var d=c;return d instanceof e?(S(d,h),d._source=this):(d=o&&!h?o:new e(h,this),d.setContent(c)),d}});var qi=Se.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return e=arguments.length?e:this._source._map,!e.hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,Se.prototype.openOn.call(this,e)},onAdd:function(e){Se.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Xe||this._source.on("preclick",rn))},onRemove:function(e){Se.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Xe||this._source.off("preclick",rn))},getEvents:function(){var e=Se.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",o=this._container=wt("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),c=this._wrapper=wt("div",e+"-content-wrapper",o);if(this._contentNode=wt("div",e+"-content",c),ti(o),mo(this._contentNode),ft(o,"contextmenu",rn),this._tipContainer=wt("div",e+"-tip-container",o),this._tip=wt("div",e+"-tip",this._tipContainer),this.options.closeButton){var h=this._closeButton=wt("a",e+"-close-button",o);h.setAttribute("role","button"),h.setAttribute("aria-label","Close popup"),h.href="#close",h.innerHTML='<span aria-hidden="true">&#215;</span>',ft(h,"click",function(d){$t(d),this.close()},this)}},_updateLayout:function(){var e=this._contentNode,o=e.style;o.width="",o.whiteSpace="nowrap";var c=e.offsetWidth;c=Math.min(c,this.options.maxWidth),c=Math.max(c,this.options.minWidth),o.width=c+1+"px",o.whiteSpace="",o.height="";var h=e.offsetHeight,d=this.options.maxHeight,y="leaflet-popup-scrolled";d&&h>d?(o.height=d+"px",pt(e,y)):It(e,y),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var o=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),c=this._getAnchor();At(this._container,o.add(c))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var e=this._map,o=parseInt(Yn(this._container,"marginBottom"),10)||0,c=this._container.offsetHeight+o,h=this._containerWidth,d=new q(this._containerLeft,-c-this._containerBottom);d._add(nn(this._container));var y=e.layerPointToContainerPoint(d),x=I(this.options.autoPanPadding),M=I(this.options.autoPanPaddingTopLeft||x),D=I(this.options.autoPanPaddingBottomRight||x),W=e.getSize(),it=0,lt=0;y.x+h+D.x>W.x&&(it=y.x+h-W.x+D.x),y.x-it-M.x<0&&(it=y.x-M.x),y.y+c+D.y>W.y&&(lt=y.y+c-W.y+D.y),y.y-lt-M.y<0&&(lt=y.y-M.y),(it||lt)&&(this.options.keepInView&&(this._autopanning=!0),e.fire("autopanstart").panBy([it,lt]))}},_getAnchor:function(){return I(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Af=function(e,o){return new qi(e,o)};bt.mergeOptions({closePopupOnClick:!0}),bt.include({openPopup:function(e,o,c){return this._initOverlay(qi,e,o,c).openOn(this),this},closePopup:function(e){return e=arguments.length?e:this._popup,e&&e.close(),this}}),ge.include({bindPopup:function(e,o){return this._popup=this._initOverlay(qi,this._popup,e,o),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&(this instanceof Oe||(this._popup._source=this),this._popup._prepareOpen(e||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(!(!this._popup||!this._map)){on(e);var o=e.layer||e.target;if(this._popup._source===o&&!(o instanceof Xe)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng);return}this._popup._source=o,this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){e.originalEvent.keyCode===13&&this._openPopup(e)}});var Ki=Se.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){Se.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){Se.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=Se.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip",o=e+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=wt("div",o),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+f(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var o,c,h=this._map,d=this._container,y=h.latLngToContainerPoint(h.getCenter()),x=h.layerPointToContainerPoint(e),M=this.options.direction,D=d.offsetWidth,W=d.offsetHeight,it=I(this.options.offset),lt=this._getAnchor();M==="top"?(o=D/2,c=W):M==="bottom"?(o=D/2,c=0):M==="center"?(o=D/2,c=W/2):M==="right"?(o=0,c=W/2):M==="left"?(o=D,c=W/2):x.x<y.x?(M="right",o=0,c=W/2):(M="left",o=D+(it.x+lt.x)*2,c=W/2),e=e.subtract(I(o,c,!0)).add(it).add(lt),It(d,"leaflet-tooltip-right"),It(d,"leaflet-tooltip-left"),It(d,"leaflet-tooltip-top"),It(d,"leaflet-tooltip-bottom"),pt(d,"leaflet-tooltip-"+M),At(d,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&ae(this._container,e)},_animateZoom:function(e){var o=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(o)},_getAnchor:function(){return I(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Df=function(e,o){return new Ki(e,o)};bt.include({openTooltip:function(e,o,c){return this._initOverlay(Ki,e,o,c).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),ge.include({bindTooltip:function(e,o){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Ki,this._tooltip,e,o),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(!(!e&&this._tooltipHandlersAdded)){var o=e?"off":"on",c={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?c.add=this._openTooltip:(c.mouseover=this._openTooltip,c.mouseout=this.closeTooltip,c.click=this._openTooltip,this._map?this._addFocusListeners():c.add=this._addFocusListeners),this._tooltip.options.sticky&&(c.mousemove=this._moveTooltip),this[o](c),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&(this instanceof Oe||(this._tooltip._source=this),this._tooltip._prepareOpen(e)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(e){var o=typeof e.getElement=="function"&&e.getElement();o&&(ft(o,"focus",function(){this._tooltip._source=e,this.openTooltip()},this),ft(o,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(e){var o=typeof e.getElement=="function"&&e.getElement();o&&o.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(e){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var o=this;this._map.once("moveend",function(){o._openOnceFlag=!1,o._openTooltip(e)});return}this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0)}},_moveTooltip:function(e){var o=e.latlng,c,h;this._tooltip.options.sticky&&e.originalEvent&&(c=this._map.mouseEventToContainerPoint(e.originalEvent),h=this._map.containerPointToLayerPoint(c),o=this._map.layerPointToLatLng(h)),this._tooltip.setLatLng(o)}});var qa=Cn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var o=e&&e.tagName==="DIV"?e:document.createElement("div"),c=this.options;if(c.html instanceof Element?(Bi(o),o.appendChild(c.html)):o.innerHTML=c.html!==!1?c.html:"",c.bgPos){var h=I(c.bgPos);o.style.backgroundPosition=-h.x+"px "+-h.y+"px"}return this._setIconStyles(o,"icon"),o},createShadow:function(){return null}});function Of(e){return new qa(e)}Cn.Default=ii;var ri=ge.extend({options:{tileSize:256,opacity:1,updateWhenIdle:st.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){S(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),Mt(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(En(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(kn(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=_(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof q?e:new q(e,e)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var o=this.getPane().children,c=-e(-1/0,1/0),h=0,d=o.length,y;h<d;h++)y=o[h].style.zIndex,o[h]!==this._container&&y&&(c=e(c,+y));isFinite(c)&&(this.options.zIndex=c+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!st.ielt9){ae(this._container,this.options.opacity);var e=+new Date,o=!1,c=!1;for(var h in this._tiles){var d=this._tiles[h];if(!(!d.current||!d.loaded)){var y=Math.min(1,(e-d.loaded)/200);ae(d.el,y),y<1?o=!0:(d.active?c=!0:this._onOpaqueTile(d),d.active=!0)}}c&&!this._noPrune&&this._pruneTiles(),o&&(ot(this._fadeFrame),this._fadeFrame=J(this._updateOpacity,this))}},_onOpaqueTile:p,_initContainer:function(){this._container||(this._container=wt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,o=this.options.maxZoom;if(e!==void 0){for(var c in this._levels)c=Number(c),this._levels[c].el.children.length||c===e?(this._levels[c].el.style.zIndex=o-Math.abs(e-c),this._onUpdateLevel(c)):(Mt(this._levels[c].el),this._removeTilesAtZoom(c),this._onRemoveLevel(c),delete this._levels[c]);var h=this._levels[e],d=this._map;return h||(h=this._levels[e]={},h.el=wt("div","leaflet-tile-container leaflet-zoom-animated",this._container),h.el.style.zIndex=o,h.origin=d.project(d.unproject(d.getPixelOrigin()),e).round(),h.zoom=e,this._setZoomTransform(h,d.getCenter(),d.getZoom()),p(h.el.offsetWidth),this._onCreateLevel(h)),this._level=h,h}},_onUpdateLevel:p,_onRemoveLevel:p,_onCreateLevel:p,_pruneTiles:function(){if(this._map){var e,o,c=this._map.getZoom();if(c>this.options.maxZoom||c<this.options.minZoom){this._removeAllTiles();return}for(e in this._tiles)o=this._tiles[e],o.retain=o.current;for(e in this._tiles)if(o=this._tiles[e],o.current&&!o.active){var h=o.coords;this._retainParent(h.x,h.y,h.z,h.z-5)||this._retainChildren(h.x,h.y,h.z,h.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}},_removeTilesAtZoom:function(e){for(var o in this._tiles)this._tiles[o].coords.z===e&&this._removeTile(o)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)Mt(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,o,c,h){var d=Math.floor(e/2),y=Math.floor(o/2),x=c-1,M=new q(+d,+y);M.z=+x;var D=this._tileCoordsToKey(M),W=this._tiles[D];return W&&W.active?(W.retain=!0,!0):(W&&W.loaded&&(W.retain=!0),x>h?this._retainParent(d,y,x,h):!1)},_retainChildren:function(e,o,c,h){for(var d=2*e;d<2*e+2;d++)for(var y=2*o;y<2*o+2;y++){var x=new q(d,y);x.z=c+1;var M=this._tileCoordsToKey(x),D=this._tiles[M];if(D&&D.active){D.retain=!0;continue}else D&&D.loaded&&(D.retain=!0);c+1<h&&this._retainChildren(d,y,c+1,h)}},_resetView:function(e){var o=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),o,o)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var o=this.options;return o.minNativeZoom!==void 0&&e<o.minNativeZoom?o.minNativeZoom:o.maxNativeZoom!==void 0&&o.maxNativeZoom<e?o.maxNativeZoom:e},_setView:function(e,o,c,h){var d=Math.round(o);this.options.maxZoom!==void 0&&d>this.options.maxZoom||this.options.minZoom!==void 0&&d<this.options.minZoom?d=void 0:d=this._clampZoom(d);var y=this.options.updateWhenZooming&&d!==this._tileZoom;(!h||y)&&(this._tileZoom=d,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),d!==void 0&&this._update(e),c||this._pruneTiles(),this._noPrune=!!c),this._setZoomTransforms(e,o)},_setZoomTransforms:function(e,o){for(var c in this._levels)this._setZoomTransform(this._levels[c],e,o)},_setZoomTransform:function(e,o,c){var h=this._map.getZoomScale(c,e.zoom),d=e.origin.multiplyBy(h).subtract(this._map._getNewPixelOrigin(o,c)).round();st.any3d?en(e.el,d,h):At(e.el,d)},_resetGrid:function(){var e=this._map,o=e.options.crs,c=this._tileSize=this.getTileSize(),h=this._tileZoom,d=this._map.getPixelWorldBounds(this._tileZoom);d&&(this._globalTileRange=this._pxBoundsToTileRange(d)),this._wrapX=o.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,o.wrapLng[0]],h).x/c.x),Math.ceil(e.project([0,o.wrapLng[1]],h).x/c.y)],this._wrapY=o.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([o.wrapLat[0],0],h).y/c.x),Math.ceil(e.project([o.wrapLat[1],0],h).y/c.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(e){var o=this._map,c=o._animatingZoom?Math.max(o._animateToZoom,o.getZoom()):o.getZoom(),h=o.getZoomScale(c,this._tileZoom),d=o.project(e,this._tileZoom).floor(),y=o.getSize().divideBy(h*2);return new $(d.subtract(y),d.add(y))},_update:function(e){var o=this._map;if(o){var c=this._clampZoom(o.getZoom());if(e===void 0&&(e=o.getCenter()),this._tileZoom!==void 0){var h=this._getTiledPixelBounds(e),d=this._pxBoundsToTileRange(h),y=d.getCenter(),x=[],M=this.options.keepBuffer,D=new $(d.getBottomLeft().subtract([M,-M]),d.getTopRight().add([M,-M]));if(!(isFinite(d.min.x)&&isFinite(d.min.y)&&isFinite(d.max.x)&&isFinite(d.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var W in this._tiles){var it=this._tiles[W].coords;(it.z!==this._tileZoom||!D.contains(new q(it.x,it.y)))&&(this._tiles[W].current=!1)}if(Math.abs(c-this._tileZoom)>1){this._setView(e,c);return}for(var lt=d.min.y;lt<=d.max.y;lt++)for(var mt=d.min.x;mt<=d.max.x;mt++){var Kt=new q(mt,lt);if(Kt.z=this._tileZoom,!!this._isValidTile(Kt)){var Ft=this._tiles[this._tileCoordsToKey(Kt)];Ft?Ft.current=!0:x.push(Kt)}}if(x.sort(function(Xt,An){return Xt.distanceTo(y)-An.distanceTo(y)}),x.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var le=document.createDocumentFragment();for(mt=0;mt<x.length;mt++)this._addTile(x[mt],le);this._level.el.appendChild(le)}}}},_isValidTile:function(e){var o=this._map.options.crs;if(!o.infinite){var c=this._globalTileRange;if(!o.wrapLng&&(e.x<c.min.x||e.x>c.max.x)||!o.wrapLat&&(e.y<c.min.y||e.y>c.max.y))return!1}if(!this.options.bounds)return!0;var h=this._tileCoordsToBounds(e);return _t(this.options.bounds).overlaps(h)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var o=this._map,c=this.getTileSize(),h=e.scaleBy(c),d=h.add(c),y=o.unproject(h,e.z),x=o.unproject(d,e.z);return[y,x]},_tileCoordsToBounds:function(e){var o=this._tileCoordsToNwSe(e),c=new ht(o[0],o[1]);return this.options.noWrap||(c=this._map.wrapLatLngBounds(c)),c},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var o=e.split(":"),c=new q(+o[0],+o[1]);return c.z=+o[2],c},_removeTile:function(e){var o=this._tiles[e];o&&(Mt(o.el),delete this._tiles[e],this.fire("tileunload",{tile:o.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){pt(e,"leaflet-tile");var o=this.getTileSize();e.style.width=o.x+"px",e.style.height=o.y+"px",e.onselectstart=p,e.onmousemove=p,st.ielt9&&this.options.opacity<1&&ae(e,this.options.opacity)},_addTile:function(e,o){var c=this._getTilePos(e),h=this._tileCoordsToKey(e),d=this.createTile(this._wrapCoords(e),l(this._tileReady,this,e));this._initTile(d),this.createTile.length<2&&J(l(this._tileReady,this,e,null,d)),At(d,c),this._tiles[h]={el:d,coords:e,current:!0},o.appendChild(d),this.fire("tileloadstart",{tile:d,coords:e})},_tileReady:function(e,o,c){o&&this.fire("tileerror",{error:o,tile:c,coords:e});var h=this._tileCoordsToKey(e);c=this._tiles[h],c&&(c.loaded=+new Date,this._map._fadeAnimated?(ae(c.el,0),ot(this._fadeFrame),this._fadeFrame=J(this._updateOpacity,this)):(c.active=!0,this._pruneTiles()),o||(pt(c.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:c.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),st.ielt9||!this._map._fadeAnimated?J(this._pruneTiles,this):setTimeout(l(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var o=new q(this._wrapX?g(e.x,this._wrapX):e.x,this._wrapY?g(e.y,this._wrapY):e.y);return o.z=e.z,o},_pxBoundsToTileRange:function(e){var o=this.getTileSize();return new $(e.min.unscaleBy(o).floor(),e.max.unscaleBy(o).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function Bf(e){return new ri(e)}var In=ri.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,o){this._url=e,o=S(this,o),o.detectRetina&&st.retina&&o.maxZoom>0?(o.tileSize=Math.floor(o.tileSize/2),o.zoomReverse?(o.zoomOffset--,o.minZoom=Math.min(o.maxZoom,o.minZoom+1)):(o.zoomOffset++,o.maxZoom=Math.max(o.minZoom,o.maxZoom-1)),o.minZoom=Math.max(0,o.minZoom)):o.zoomReverse?o.minZoom=Math.min(o.maxZoom,o.minZoom):o.maxZoom=Math.max(o.minZoom,o.maxZoom),typeof o.subdomains=="string"&&(o.subdomains=o.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,o){return this._url===e&&o===void 0&&(o=!0),this._url=e,o||this.redraw(),this},createTile:function(e,o){var c=document.createElement("img");return ft(c,"load",l(this._tileOnLoad,this,o,c)),ft(c,"error",l(this._tileOnError,this,o,c)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(c.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(c.referrerPolicy=this.options.referrerPolicy),c.alt="",c.src=this.getTileUrl(e),c},getTileUrl:function(e){var o={r:st.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var c=this._globalTileRange.max.y-e.y;this.options.tms&&(o.y=c),o["-y"]=c}return A(this._url,r(o,this.options))},_tileOnLoad:function(e,o){st.ielt9?setTimeout(l(e,this,null,o),0):e(null,o)},_tileOnError:function(e,o,c){var h=this.options.errorTileUrl;h&&o.getAttribute("src")!==h&&(o.src=h),e(c,o)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,o=this.options.maxZoom,c=this.options.zoomReverse,h=this.options.zoomOffset;return c&&(e=o-e),e+h},_getSubdomain:function(e){var o=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[o]},_abortLoading:function(){var e,o;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&(o=this._tiles[e].el,o.onload=p,o.onerror=p,!o.complete)){o.src=O;var c=this._tiles[e].coords;Mt(o),delete this._tiles[e],this.fire("tileabort",{tile:o,coords:c})}},_removeTile:function(e){var o=this._tiles[e];if(o)return o.el.setAttribute("src",O),ri.prototype._removeTile.call(this,e)},_tileReady:function(e,o,c){if(!(!this._map||c&&c.getAttribute("src")===O))return ri.prototype._tileReady.call(this,e,o,c)}});function Ka(e,o){return new In(e,o)}var Ya=In.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,o){this._url=e;var c=r({},this.defaultWmsParams);for(var h in o)h in this.options||(c[h]=o[h]);o=S(this,o);var d=o.detectRetina&&st.retina?2:1,y=this.getTileSize();c.width=y.x*d,c.height=y.y*d,this.wmsParams=c},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var o=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[o]=this._crs.code,In.prototype.onAdd.call(this,e)},getTileUrl:function(e){var o=this._tileCoordsToNwSe(e),c=this._crs,h=tt(c.project(o[0]),c.project(o[1])),d=h.min,y=h.max,x=(this._wmsVersion>=1.3&&this._crs===Na?[d.y,d.x,y.y,y.x]:[d.x,d.y,y.x,y.y]).join(","),M=In.prototype.getTileUrl.call(this,e);return M+C(this.wmsParams,M,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+x},setParams:function(e,o){return r(this.wmsParams,e),o||this.redraw(),this}});function zf(e,o){return new Ya(e,o)}In.WMS=Ya,Ka.wms=zf;var Re=ge.extend({options:{padding:.1},initialize:function(e){S(this,e),f(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),pt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,o){var c=this._map.getZoomScale(o,this._zoom),h=this._map.getSize().multiplyBy(.5+this.options.padding),d=this._map.project(this._center,o),y=h.multiplyBy(-c).add(d).subtract(this._map._getNewPixelOrigin(e,o));st.any3d?en(this._container,y,c):At(this._container,y)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var e in this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,o=this._map.getSize(),c=this._map.containerPointToLayerPoint(o.multiplyBy(-e)).round();this._bounds=new $(c,c.add(o.multiplyBy(1+e*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Ja=Re.extend({options:{tolerance:0},getEvents:function(){var e=Re.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Re.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");ft(e,"mousemove",this._onMouseMove,this),ft(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ft(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){ot(this._redrawRequest),delete this._ctx,Mt(this._container),Et(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var e;this._redrawBounds=null;for(var o in this._layers)e=this._layers[o],e._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Re.prototype._update.call(this);var e=this._bounds,o=this._container,c=e.getSize(),h=st.retina?2:1;At(o,e.min),o.width=h*c.x,o.height=h*c.y,o.style.width=c.x+"px",o.style.height=c.y+"px",st.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){Re.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[f(e)]=e;var o=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=o),this._drawLast=o,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var o=e._order,c=o.next,h=o.prev;c?c.prev=h:this._drawLast=h,h?h.next=c:this._drawFirst=c,delete e._order,delete this._layers[f(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if(typeof e.options.dashArray=="string"){var o=e.options.dashArray.split(/[, ]+/),c=[],h,d;for(d=0;d<o.length;d++){if(h=Number(o[d]),isNaN(h))return;c.push(h)}e.options._dashArray=c}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||J(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var o=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new $,this._redrawBounds.extend(e._pxBounds.min.subtract([o,o])),this._redrawBounds.extend(e._pxBounds.max.add([o,o]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var o=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,o.x,o.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,o=this._redrawBounds;if(this._ctx.save(),o){var c=o.getSize();this._ctx.beginPath(),this._ctx.rect(o.min.x,o.min.y,c.x,c.y),this._ctx.clip()}this._drawing=!0;for(var h=this._drawFirst;h;h=h.next)e=h.layer,(!o||e._pxBounds&&e._pxBounds.intersects(o))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,o){if(this._drawing){var c,h,d,y,x=e._parts,M=x.length,D=this._ctx;if(M){for(D.beginPath(),c=0;c<M;c++){for(h=0,d=x[c].length;h<d;h++)y=x[c][h],D[h?"lineTo":"moveTo"](y.x,y.y);o&&D.closePath()}this._fillStroke(D,e)}}},_updateCircle:function(e){if(!(!this._drawing||e._empty())){var o=e._point,c=this._ctx,h=Math.max(Math.round(e._radius),1),d=(Math.max(Math.round(e._radiusY),1)||h)/h;d!==1&&(c.save(),c.scale(1,d)),c.beginPath(),c.arc(o.x,o.y/d,h,0,Math.PI*2,!1),d!==1&&c.restore(),this._fillStroke(c,e)}},_fillStroke:function(e,o){var c=o.options;c.fill&&(e.globalAlpha=c.fillOpacity,e.fillStyle=c.fillColor||c.color,e.fill(c.fillRule||"evenodd")),c.stroke&&c.weight!==0&&(e.setLineDash&&e.setLineDash(o.options&&o.options._dashArray||[]),e.globalAlpha=c.opacity,e.lineWidth=c.weight,e.strokeStyle=c.color,e.lineCap=c.lineCap,e.lineJoin=c.lineJoin,e.stroke())},_onClick:function(e){for(var o=this._map.mouseEventToLayerPoint(e),c,h,d=this._drawFirst;d;d=d.next)c=d.layer,c.options.interactive&&c._containsPoint(o)&&(!(e.type==="click"||e.type==="preclick")||!this._map._draggableMoved(c))&&(h=c);this._fireEvent(h?[h]:!1,e)},_onMouseMove:function(e){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var o=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,o)}},_handleMouseOut:function(e){var o=this._hoveredLayer;o&&(It(this._container,"leaflet-interactive"),this._fireEvent([o],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,o){if(!this._mouseHoverThrottled){for(var c,h,d=this._drawFirst;d;d=d.next)c=d.layer,c.options.interactive&&c._containsPoint(o)&&(h=c);h!==this._hoveredLayer&&(this._handleMouseOut(e),h&&(pt(this._container,"leaflet-interactive"),this._fireEvent([h],e,"mouseover"),this._hoveredLayer=h)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,e),this._mouseHoverThrottled=!0,setTimeout(l(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(e,o,c){this._map._fireDOMEvent(o,c||o.type,e)},_bringToFront:function(e){var o=e._order;if(o){var c=o.next,h=o.prev;if(c)c.prev=h;else return;h?h.next=c:c&&(this._drawFirst=c),o.prev=this._drawLast,this._drawLast.next=o,o.next=null,this._drawLast=o,this._requestRedraw(e)}},_bringToBack:function(e){var o=e._order;if(o){var c=o.next,h=o.prev;if(h)h.next=c;else return;c?c.prev=h:h&&(this._drawLast=h),o.prev=null,o.next=this._drawFirst,this._drawFirst.prev=o,this._drawFirst=o,this._requestRedraw(e)}}});function Xa(e){return st.canvas?new Ja(e):null}var oi=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch{}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),Rf={_initContainer:function(){this._container=wt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Re.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var o=e._container=oi("shape");pt(o,"leaflet-vml-shape "+(this.options.className||"")),o.coordsize="1 1",e._path=oi("path"),o.appendChild(e._path),this._updateStyle(e),this._layers[f(e)]=e},_addPath:function(e){var o=e._container;this._container.appendChild(o),e.options.interactive&&e.addInteractiveTarget(o)},_removePath:function(e){var o=e._container;Mt(o),e.removeInteractiveTarget(o),delete this._layers[f(e)]},_updateStyle:function(e){var o=e._stroke,c=e._fill,h=e.options,d=e._container;d.stroked=!!h.stroke,d.filled=!!h.fill,h.stroke?(o||(o=e._stroke=oi("stroke")),d.appendChild(o),o.weight=h.weight+"px",o.color=h.color,o.opacity=h.opacity,h.dashArray?o.dashStyle=w(h.dashArray)?h.dashArray.join(" "):h.dashArray.replace(/( *, *)/g," "):o.dashStyle="",o.endcap=h.lineCap.replace("butt","flat"),o.joinstyle=h.lineJoin):o&&(d.removeChild(o),e._stroke=null),h.fill?(c||(c=e._fill=oi("fill")),d.appendChild(c),c.color=h.fillColor||h.color,c.opacity=h.fillOpacity):c&&(d.removeChild(c),e._fill=null)},_updateCircle:function(e){var o=e._point.round(),c=Math.round(e._radius),h=Math.round(e._radiusY||c);this._setPath(e,e._empty()?"M0 0":"AL "+o.x+","+o.y+" "+c+","+h+" 0,"+65535*360)},_setPath:function(e,o){e._path.v=o},_bringToFront:function(e){En(e._container)},_bringToBack:function(e){kn(e._container)}},Yi=st.vml?oi:Rt,si=Re.extend({_initContainer:function(){this._container=Yi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Yi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Mt(this._container),Et(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Re.prototype._update.call(this);var e=this._bounds,o=e.getSize(),c=this._container;(!this._svgSize||!this._svgSize.equals(o))&&(this._svgSize=o,c.setAttribute("width",o.x),c.setAttribute("height",o.y)),At(c,e.min),c.setAttribute("viewBox",[e.min.x,e.min.y,o.x,o.y].join(" ")),this.fire("update")}},_initPath:function(e){var o=e._path=Yi("path");e.options.className&&pt(o,e.options.className),e.options.interactive&&pt(o,"leaflet-interactive"),this._updateStyle(e),this._layers[f(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){Mt(e._path),e.removeInteractiveTarget(e._path),delete this._layers[f(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var o=e._path,c=e.options;o&&(c.stroke?(o.setAttribute("stroke",c.color),o.setAttribute("stroke-opacity",c.opacity),o.setAttribute("stroke-width",c.weight),o.setAttribute("stroke-linecap",c.lineCap),o.setAttribute("stroke-linejoin",c.lineJoin),c.dashArray?o.setAttribute("stroke-dasharray",c.dashArray):o.removeAttribute("stroke-dasharray"),c.dashOffset?o.setAttribute("stroke-dashoffset",c.dashOffset):o.removeAttribute("stroke-dashoffset")):o.setAttribute("stroke","none"),c.fill?(o.setAttribute("fill",c.fillColor||c.color),o.setAttribute("fill-opacity",c.fillOpacity),o.setAttribute("fill-rule",c.fillRule||"evenodd")):o.setAttribute("fill","none"))},_updatePoly:function(e,o){this._setPath(e,Jt(e._parts,o))},_updateCircle:function(e){var o=e._point,c=Math.max(Math.round(e._radius),1),h=Math.max(Math.round(e._radiusY),1)||c,d="a"+c+","+h+" 0 1,0 ",y=e._empty()?"M0 0":"M"+(o.x-c)+","+o.y+d+c*2+",0 "+d+-c*2+",0 ";this._setPath(e,y)},_setPath:function(e,o){e._path.setAttribute("d",o)},_bringToFront:function(e){En(e._path)},_bringToBack:function(e){kn(e._path)}});st.vml&&si.include(Rf);function Qa(e){return st.svg||st.vml?new si(e):null}bt.include({getRenderer:function(e){var o=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return o||(o=this._renderer=this._createRenderer()),this.hasLayer(o)||this.addLayer(o),o},_getPaneRenderer:function(e){if(e==="overlayPane"||e===void 0)return!1;var o=this._paneRenderers[e];return o===void 0&&(o=this._createRenderer({pane:e}),this._paneRenderers[e]=o),o},_createRenderer:function(e){return this.options.preferCanvas&&Xa(e)||Qa(e)}});var tc=Mn.extend({initialize:function(e,o){Mn.prototype.initialize.call(this,this._boundsToLatLngs(e),o)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return e=_t(e),[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function Hf(e,o){return new tc(e,o)}si.create=Yi,si.pointsToPath=Jt,ze.geometryToLayer=$i,ze.coordsToLatLng=Eo,ze.coordsToLatLngs=Zi,ze.latLngToCoords=ko,ze.latLngsToCoords=Vi,ze.getFeature=Pn,ze.asFeature=Gi,bt.mergeOptions({boxZoom:!0});var ec=Le.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){ft(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Et(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Mt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||e.which!==1&&e.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Jn(),ao(),this._startPoint=this._map.mouseEventToContainerPoint(e),ft(document,{contextmenu:on,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=wt("div","leaflet-zoom-box",this._container),pt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var o=new $(this._point,this._startPoint),c=o.getSize();At(this._box,o.min),this._box.style.width=c.x+"px",this._box.style.height=c.y+"px"},_finish:function(){this._moved&&(Mt(this._box),It(this._container,"leaflet-crosshair")),Xn(),co(),Et(document,{contextmenu:on,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if(!(e.which!==1&&e.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(l(this._resetState,this),0);var o=new ht(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(o).fire("boxzoomend",{boxZoomBounds:o})}},_onKeyDown:function(e){e.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});bt.addInitHook("addHandler","boxZoom",ec),bt.mergeOptions({doubleClickZoom:!0});var nc=Le.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var o=this._map,c=o.getZoom(),h=o.options.zoomDelta,d=e.originalEvent.shiftKey?c-h:c+h;o.options.doubleClickZoom==="center"?o.setZoom(d):o.setZoomAround(e.containerPoint,d)}});bt.addInitHook("addHandler","doubleClickZoom",nc),bt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var ic=Le.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new Je(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}pt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){It(this._map._container,"leaflet-grab"),It(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var o=_t(this._map.options.maxBounds);this._offsetLimit=tt(this._map.latLngToContainerPoint(o.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(o.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var o=this._lastTime=+new Date,c=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(c),this._times.push(o),this._prunePositions(o)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),o=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=o.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,o){return e-(e-o)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var e=this._draggable._newPos.subtract(this._draggable._startPos),o=this._offsetLimit;e.x<o.min.x&&(e.x=this._viscousLimit(e.x,o.min.x)),e.y<o.min.y&&(e.y=this._viscousLimit(e.y,o.min.y)),e.x>o.max.x&&(e.x=this._viscousLimit(e.x,o.max.x)),e.y>o.max.y&&(e.y=this._viscousLimit(e.y,o.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,o=Math.round(e/2),c=this._initialWorldOffset,h=this._draggable._newPos.x,d=(h-o+c)%e+o-c,y=(h+o+c)%e-o-c,x=Math.abs(d+c)<Math.abs(y+c)?d:y;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=x},_onDragEnd:function(e){var o=this._map,c=o.options,h=!c.inertia||e.noInertia||this._times.length<2;if(o.fire("dragend",e),h)o.fire("moveend");else{this._prunePositions(+new Date);var d=this._lastPos.subtract(this._positions[0]),y=(this._lastTime-this._times[0])/1e3,x=c.easeLinearity,M=d.multiplyBy(x/y),D=M.distanceTo([0,0]),W=Math.min(c.inertiaMaxSpeed,D),it=M.multiplyBy(W/D),lt=W/(c.inertiaDeceleration*x),mt=it.multiplyBy(-lt/2).round();!mt.x&&!mt.y?o.fire("moveend"):(mt=o._limitOffset(mt,o.options.maxBounds),J(function(){o.panBy(mt,{duration:lt,easeLinearity:x,noMoveStart:!0,animate:!0})}))}}});bt.addInitHook("addHandler","dragging",ic),bt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var rc=Le.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),ft(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Et(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,o=document.documentElement,c=e.scrollTop||o.scrollTop,h=e.scrollLeft||o.scrollLeft;this._map._container.focus(),window.scrollTo(h,c)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var o=this._panKeys={},c=this.keyCodes,h,d;for(h=0,d=c.left.length;h<d;h++)o[c.left[h]]=[-1*e,0];for(h=0,d=c.right.length;h<d;h++)o[c.right[h]]=[e,0];for(h=0,d=c.down.length;h<d;h++)o[c.down[h]]=[0,e];for(h=0,d=c.up.length;h<d;h++)o[c.up[h]]=[0,-1*e]},_setZoomDelta:function(e){var o=this._zoomKeys={},c=this.keyCodes,h,d;for(h=0,d=c.zoomIn.length;h<d;h++)o[c.zoomIn[h]]=e;for(h=0,d=c.zoomOut.length;h<d;h++)o[c.zoomOut[h]]=-e},_addHooks:function(){ft(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Et(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var o=e.keyCode,c=this._map,h;if(o in this._panKeys){if(!c._panAnim||!c._panAnim._inProgress)if(h=this._panKeys[o],e.shiftKey&&(h=I(h).multiplyBy(3)),c.options.maxBounds&&(h=c._limitOffset(I(h),c.options.maxBounds)),c.options.worldCopyJump){var d=c.wrapLatLng(c.unproject(c.project(c.getCenter()).add(h)));c.panTo(d)}else c.panBy(h)}else if(o in this._zoomKeys)c.setZoom(c.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[o]);else if(o===27&&c._popup&&c._popup.options.closeOnEscapeKey)c.closePopup();else return;on(e)}}});bt.addInitHook("addHandler","keyboard",rc),bt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var oc=Le.extend({addHooks:function(){ft(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Et(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var o=Ma(e),c=this._map.options.wheelDebounceTime;this._delta+=o,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var h=Math.max(c-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(l(this._performZoom,this),h),on(e)},_performZoom:function(){var e=this._map,o=e.getZoom(),c=this._map.options.zoomSnap||0;e._stop();var h=this._delta/(this._map.options.wheelPxPerZoomLevel*4),d=4*Math.log(2/(1+Math.exp(-Math.abs(h))))/Math.LN2,y=c?Math.ceil(d/c)*c:d,x=e._limitZoom(o+(this._delta>0?y:-y))-o;this._delta=0,this._startTime=null,x&&(e.options.scrollWheelZoom==="center"?e.setZoom(o+x):e.setZoomAround(this._lastMousePos,o+x))}});bt.addInitHook("addHandler","scrollWheelZoom",oc);var jf=600;bt.mergeOptions({tapHold:st.touchNative&&st.safari&&st.mobile,tapTolerance:15});var sc=Le.extend({addHooks:function(){ft(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Et(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),e.touches.length===1){var o=e.touches[0];this._startPos=this._newPos=new q(o.clientX,o.clientY),this._holdTimeout=setTimeout(l(function(){this._cancel(),this._isTapValid()&&(ft(document,"touchend",$t),ft(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",o))},this),jf),ft(document,"touchend touchcancel contextmenu",this._cancel,this),ft(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){Et(document,"touchend",$t),Et(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),Et(document,"touchend touchcancel contextmenu",this._cancel,this),Et(document,"touchmove",this._onMove,this)},_onMove:function(e){var o=e.touches[0];this._newPos=new q(o.clientX,o.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,o){var c=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:o.screenX,screenY:o.screenY,clientX:o.clientX,clientY:o.clientY});c._simulated=!0,o.target.dispatchEvent(c)}});bt.addInitHook("addHandler","tapHold",sc),bt.mergeOptions({touchZoom:st.touch,bounceAtZoomLimits:!0});var ac=Le.extend({addHooks:function(){pt(this._map._container,"leaflet-touch-zoom"),ft(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){It(this._map._container,"leaflet-touch-zoom"),Et(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var o=this._map;if(!(!e.touches||e.touches.length!==2||o._animatingZoom||this._zooming)){var c=o.mouseEventToContainerPoint(e.touches[0]),h=o.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=o.getSize()._divideBy(2),this._startLatLng=o.containerPointToLatLng(this._centerPoint),o.options.touchZoom!=="center"&&(this._pinchStartLatLng=o.containerPointToLatLng(c.add(h)._divideBy(2))),this._startDist=c.distanceTo(h),this._startZoom=o.getZoom(),this._moved=!1,this._zooming=!0,o._stop(),ft(document,"touchmove",this._onTouchMove,this),ft(document,"touchend touchcancel",this._onTouchEnd,this),$t(e)}},_onTouchMove:function(e){if(!(!e.touches||e.touches.length!==2||!this._zooming)){var o=this._map,c=o.mouseEventToContainerPoint(e.touches[0]),h=o.mouseEventToContainerPoint(e.touches[1]),d=c.distanceTo(h)/this._startDist;if(this._zoom=o.getScaleZoom(d,this._startZoom),!o.options.bounceAtZoomLimits&&(this._zoom<o.getMinZoom()&&d<1||this._zoom>o.getMaxZoom()&&d>1)&&(this._zoom=o._limitZoom(this._zoom)),o.options.touchZoom==="center"){if(this._center=this._startLatLng,d===1)return}else{var y=c._add(h)._divideBy(2)._subtract(this._centerPoint);if(d===1&&y.x===0&&y.y===0)return;this._center=o.unproject(o.project(this._pinchStartLatLng,this._zoom).subtract(y),this._zoom)}this._moved||(o._moveStart(!0,!1),this._moved=!0),ot(this._animRequest);var x=l(o._move,o,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=J(x,this,!0),$t(e)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,ot(this._animRequest),Et(document,"touchmove",this._onTouchMove,this),Et(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});bt.addInitHook("addHandler","touchZoom",ac),bt.BoxZoom=ec,bt.DoubleClickZoom=nc,bt.Drag=ic,bt.Keyboard=rc,bt.ScrollWheelZoom=oc,bt.TapHold=sc,bt.TouchZoom=ac,i.Bounds=$,i.Browser=st,i.CRS=Ct,i.Canvas=Ja,i.Circle=So,i.CircleMarker=Ni,i.Class=Z,i.Control=me,i.DivIcon=qa,i.DivOverlay=Se,i.DomEvent=nf,i.DomUtil=tf,i.Draggable=Je,i.Evented=j,i.FeatureGroup=Oe,i.GeoJSON=ze,i.GridLayer=ri,i.Handler=Le,i.Icon=Cn,i.ImageOverlay=Wi,i.LatLng=gt,i.LatLngBounds=ht,i.Layer=ge,i.LayerGroup=Tn,i.LineUtil=mf,i.Map=bt,i.Marker=Fi,i.Mixin=hf,i.Path=Xe,i.Point=q,i.PolyUtil=uf,i.Polygon=Mn,i.Polyline=Be,i.Popup=qi,i.PosAnimation=Pa,i.Projection=gf,i.Rectangle=tc,i.Renderer=Re,i.SVG=si,i.SVGOverlay=Wa,i.TileLayer=In,i.Tooltip=Ki,i.Transformation=et,i.Util=E,i.VideoOverlay=Ga,i.bind=l,i.bounds=tt,i.canvas=Xa,i.circle=Ef,i.circleMarker=Sf,i.control=ei,i.divIcon=Of,i.extend=r,i.featureGroup=wf,i.geoJSON=Va,i.geoJson=Cf,i.gridLayer=Bf,i.icon=xf,i.imageOverlay=Mf,i.latLng=ct,i.latLngBounds=_t,i.layerGroup=bf,i.map=rf,i.marker=Lf,i.point=I,i.polygon=Tf,i.polyline=kf,i.popup=Af,i.rectangle=Hf,i.setOptions=S,i.stamp=f,i.svg=Qa,i.svgOverlay=If,i.tileLayer=Ka,i.tooltip=Df,i.transformation=at,i.version=s,i.videoOverlay=Pf;var Uf=window.L;i.noConflict=function(){return window.L=Uf,this},window.L=i})})(di,di.exports)),di.exports}var xt=i0();const te=Gr(xt);(function(n,t,i){function s(r,a){for(;(r=r.parentElement)&&!r.classList.contains(a););return r}L.drawVersion="1.0.4",L.Draw={},L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},finish:{title:"Finish drawing",text:"Finish"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker",circlemarker:"Draw a circlemarker"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},radius:"Radius"},circlemarker:{tooltip:{start:"Click map to place circle marker."}},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}}}},edit:{toolbar:{actions:{save:{title:"Save changes",text:"Save"},cancel:{title:"Cancel editing, discards all changes",text:"Cancel"},clearAll:{title:"Clear all layers",text:"Clear All"}},buttons:{edit:"Edit layers",editDisabled:"No layers to edit",remove:"Delete layers",removeDisabled:"No layers to delete"}},handlers:{edit:{tooltip:{text:"Drag handles or markers to edit features.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove."}}}}},L.Draw.Event={},L.Draw.Event.CREATED="draw:created",L.Draw.Event.EDITED="draw:edited",L.Draw.Event.DELETED="draw:deleted",L.Draw.Event.DRAWSTART="draw:drawstart",L.Draw.Event.DRAWSTOP="draw:drawstop",L.Draw.Event.DRAWVERTEX="draw:drawvertex",L.Draw.Event.EDITSTART="draw:editstart",L.Draw.Event.EDITMOVE="draw:editmove",L.Draw.Event.EDITRESIZE="draw:editresize",L.Draw.Event.EDITVERTEX="draw:editvertex",L.Draw.Event.EDITSTOP="draw:editstop",L.Draw.Event.DELETESTART="draw:deletestart",L.Draw.Event.DELETESTOP="draw:deletestop",L.Draw.Event.TOOLBAROPENED="draw:toolbaropened",L.Draw.Event.TOOLBARCLOSED="draw:toolbarclosed",L.Draw.Event.MARKERCONTEXT="draw:markercontext",L.Draw=L.Draw||{},L.Draw.Feature=L.Handler.extend({initialize:function(r,a){this._map=r,this._container=r._container,this._overlayPane=r._panes.overlayPane,this._popupPane=r._panes.popupPane,a&&a.shapeOptions&&(a.shapeOptions=L.Util.extend({},this.options.shapeOptions,a.shapeOptions)),L.setOptions(this,a);var l=L.version.split(".");parseInt(l[0],10)===1&&parseInt(l[1],10)>=2?L.Draw.Feature.include(L.Evented.prototype):L.Draw.Feature.include(L.Mixin.Events)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DRAWSTART,{layerType:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DRAWSTOP,{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var r=this._map;r&&(L.DomUtil.disableTextSelection(),r.getContainer().focus(),this._tooltip=new L.Draw.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(r){L.setOptions(this,r)},_fireCreatedEvent:function(r){this._map.fire(L.Draw.Event.CREATED,{layer:r,layerType:this.type})},_cancelDrawing:function(r){r.keyCode===27&&(this._map.fire("draw:canceled",{layerType:this.type}),this.disable())}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,feet:!0,nautic:!1,showLength:!0,zIndexOffset:2e3,factor:1,maxPoints:0},initialize:function(r,a){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,a&&a.drawError&&(a.drawError=L.Util.extend({},this.options.drawError,a.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,r,a)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mouseout",this._onMouseOut,this).on("mousemove",this._onMouseMove,this).on("mousedown",this._onMouseDown,this).on("mouseup",this._onMouseUp,this).addTo(this._map),this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("touchstart",this._onTouch,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("touchstart",this._onTouch,this).off("click",this._onTouch,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var r=this._markers.pop(),a=this._poly,l=a.getLatLngs(),u=l.splice(-1,1)[0];this._poly.setLatLngs(l),this._markerGroup.removeLayer(r),a.getLatLngs().length<2&&this._map.removeLayer(a),this._vertexChanged(u,!1)}},addVertex:function(r){if(this._markers.length>=2&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(r))return void this._showErrorTooltip();this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(r)),this._poly.addLatLng(r),this._poly.getLatLngs().length===2&&this._map.addLayer(this._poly),this._vertexChanged(r,!0)},completeShape:function(){this._markers.length<=1||!this._shapeIsValid()||(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_finishShape:function(){var r=this._poly._defaultShape?this._poly._defaultShape():this._poly.getLatLngs(),a=this._poly.newLatLngIntersects(r[r.length-1]);if(!this.options.allowIntersection&&a||!this._shapeIsValid())return void this._showErrorTooltip();this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._markers!==null&&this._updateGuide()},_onMouseMove:function(r){var a=this._map.mouseEventToLayerPoint(r.originalEvent),l=this._map.layerPointToLatLng(a);this._currentLatLng=l,this._updateTooltip(l),this._updateGuide(a),this._mouseMarker.setLatLng(l),L.DomEvent.preventDefault(r.originalEvent)},_vertexChanged:function(r,a){this._map.fire(L.Draw.Event.DRAWVERTEX,{layers:this._markerGroup}),this._updateFinishHandler(),this._updateRunningMeasure(r,a),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(r){if(!this._clickHandled&&!this._touchHandled&&!this._disableMarkers){this._onMouseMove(r),this._clickHandled=!0,this._disableNewMarkers();var a=r.originalEvent,l=a.clientX,u=a.clientY;this._startPoint.call(this,l,u)}},_startPoint:function(r,a){this._mouseDownOrigin=L.point(r,a)},_onMouseUp:function(r){var a=r.originalEvent,l=a.clientX,u=a.clientY;this._endPoint.call(this,l,u,r),this._clickHandled=null},_endPoint:function(r,a,l){if(this._mouseDownOrigin){var u=L.point(r,a).distanceTo(this._mouseDownOrigin),f=this._calculateFinishDistance(l.latlng);this.options.maxPoints>1&&this.options.maxPoints==this._markers.length+1?(this.addVertex(l.latlng),this._finishShape()):f<10&&L.Browser.touch?this._finishShape():Math.abs(u)<9*(n.devicePixelRatio||1)&&this.addVertex(l.latlng),this._enableNewMarkers()}this._mouseDownOrigin=null},_onTouch:function(r){var a,l,u=r.originalEvent;!u.touches||!u.touches[0]||this._clickHandled||this._touchHandled||this._disableMarkers||(a=u.touches[0].clientX,l=u.touches[0].clientY,this._disableNewMarkers(),this._touchHandled=!0,this._startPoint.call(this,a,l),this._endPoint.call(this,a,l,r),this._touchHandled=null),this._clickHandled=null},_onMouseOut:function(){this._tooltip&&this._tooltip._onMouseOut.call(this._tooltip)},_calculateFinishDistance:function(r){var a;if(this._markers.length>0){var l;if(this.type===L.Draw.Polyline.TYPE)l=this._markers[this._markers.length-1];else{if(this.type!==L.Draw.Polygon.TYPE)return 1/0;l=this._markers[0]}var u=this._map.latLngToContainerPoint(l.getLatLng()),f=new L.Marker(r,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset}),_=this._map.latLngToContainerPoint(f.getLatLng());a=u.distanceTo(_)}else a=1/0;return a},_updateFinishHandler:function(){var r=this._markers.length;r>1&&this._markers[r-1].on("click",this._finishShape,this),r>2&&this._markers[r-2].off("click",this._finishShape,this)},_createMarker:function(r){var a=new L.Marker(r,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(a),a},_updateGuide:function(r){var a=this._markers?this._markers.length:0;a>0&&(r=r||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[a-1].getLatLng()),r))},_updateTooltip:function(r){var a=this._getTooltipText();r&&this._tooltip.updatePosition(r),this._errorShown||this._tooltip.updateContent(a)},_drawGuide:function(r,a){var l,u,f,_=Math.floor(Math.sqrt(Math.pow(a.x-r.x,2)+Math.pow(a.y-r.y,2))),g=this.options.guidelineDistance,p=this.options.maxGuideLineLength,m=_>p?_-p:g;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));m<_;m+=this.options.guidelineDistance)l=m/_,u={x:Math.floor(r.x*(1-l)+l*a.x),y:Math.floor(r.y*(1-l)+l*a.y)},f=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),f.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(f,u)},_updateGuideColor:function(r){if(this._guidesContainer)for(var a=0,l=this._guidesContainer.childNodes.length;a<l;a++)this._guidesContainer.childNodes[a].style.backgroundColor=r},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var r,a,l=this.options.showLength;return this._markers.length===0?r={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(a=l?this._getMeasurementString():"",r=this._markers.length===1?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:a}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:a}),r},_updateRunningMeasure:function(r,a){var l,u,f=this._markers.length;this._markers.length===1?this._measurementRunningTotal=0:(l=f-(a?2:1),u=L.GeometryUtil.isVersion07x()?r.distanceTo(this._markers[l].getLatLng())*(this.options.factor||1):this._map.distance(r,this._markers[l].getLatLng())*(this.options.factor||1),this._measurementRunningTotal+=u*(a?1:-1))},_getMeasurementString:function(){var r,a=this._currentLatLng,l=this._markers[this._markers.length-1].getLatLng();return r=L.GeometryUtil.isVersion07x()?l&&a&&a.distanceTo?this._measurementRunningTotal+a.distanceTo(l)*(this.options.factor||1):this._measurementRunningTotal||0:l&&a?this._measurementRunningTotal+this._map.distance(a,l)*(this.options.factor||1):this._measurementRunningTotal||0,L.GeometryUtil.readableDistance(r,this.options.metric,this.options.feet,this.options.nautic,this.options.precision)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_disableNewMarkers:function(){this._disableMarkers=!0},_enableNewMarkers:function(){setTimeout(function(){this._disableMarkers=!1}.bind(this),50)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var r=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,r)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,showLength:!1,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0,feet:!0,nautic:!1,precision:{}},initialize:function(r,a){L.Draw.Polyline.prototype.initialize.call(this,r,a),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var r=this._markers.length;r===1&&this._markers[0].on("click",this._finishShape,this),r>2&&(this._markers[r-1].on("dblclick",this._finishShape,this),r>3&&this._markers[r-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var r,a;return this._markers.length===0?r=L.drawLocal.draw.handlers.polygon.tooltip.start:this._markers.length<3?(r=L.drawLocal.draw.handlers.polygon.tooltip.cont,a=this._getMeasurementString()):(r=L.drawLocal.draw.handlers.polygon.tooltip.end,a=this._getMeasurementString()),{text:r,subtext:a}},_getMeasurementString:function(){var r=this._area,a="";return r||this.options.showLength?(this.options.showLength&&(a=L.Draw.Polyline.prototype._getMeasurementString.call(this)),r&&(a+="<br>"+L.GeometryUtil.readableArea(r,this.options.metric,this.options.precision)),a):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(r,a){var l;!this.options.allowIntersection&&this.options.showArea&&(l=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(l)),L.Draw.Polyline.prototype._vertexChanged.call(this,r,a)},_cleanUpShape:function(){var r=this._markers.length;r>0&&(this._markers[0].off("click",this._finishShape,this),r>2&&this._markers[r-1].off("dblclick",this._finishShape,this))}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(r,a){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,r,a)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this).on("touchstart",this._onMouseDown,this).on("touchmove",this._onMouseMove,this),t.addEventListener("touchstart",L.DomEvent.preventDefault,{passive:!1}))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this).off("touchstart",this._onMouseDown,this).off("touchmove",this._onMouseMove,this),L.DomEvent.off(t,"mouseup",this._onMouseUp,this),L.DomEvent.off(t,"touchend",this._onMouseUp,this),t.removeEventListener("touchstart",L.DomEvent.preventDefault),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(r){this._isDrawing=!0,this._startLatLng=r.latlng,L.DomEvent.on(t,"mouseup",this._onMouseUp,this).on(t,"touchend",this._onMouseUp,this).preventDefault(r.originalEvent)},_onMouseMove:function(r){var a=r.latlng;this._tooltip.updatePosition(a),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(a))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showArea:!0,metric:!0},initialize:function(r,a){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,r,a)},disable:function(){this._enabled&&(this._isCurrentlyTwoClickDrawing=!1,L.Draw.SimpleShape.prototype.disable.call(this))},_onMouseUp:function(r){if(!this._shape&&!this._isCurrentlyTwoClickDrawing)return void(this._isCurrentlyTwoClickDrawing=!0);this._isCurrentlyTwoClickDrawing&&!s(r.target,"leaflet-pane")||L.Draw.SimpleShape.prototype._onMouseUp.call(this)},_drawShape:function(r){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,r)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,r),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var r=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,r)},_getTooltipText:function(){var r,a,l,u=L.Draw.SimpleShape.prototype._getTooltipText.call(this),f=this._shape,_=this.options.showArea;return f&&(r=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),a=L.GeometryUtil.geodesicArea(r),l=_?L.GeometryUtil.readableArea(a,this.options.metric):""),{text:u.text,subtext:l}}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(r,a){this.type=L.Draw.Marker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.marker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,r,a)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:this._initialLabelText}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onTouch,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._map.off("click",this._onClick,this).off("click",this._onTouch,this),this._marker&&(this._marker.off("click",this._onClick,this),this._map.removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(r){var a=r.latlng;this._tooltip.updatePosition(a),this._mouseMarker.setLatLng(a),this._marker?(a=this._mouseMarker.getLatLng(),this._marker.setLatLng(a)):(this._marker=this._createMarker(a),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_createMarker:function(r){return new L.Marker(r,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset})},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_onTouch:function(r){this._onMouseMove(r),this._onClick()},_fireCreatedEvent:function(){var r=new L.Marker.Touch(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,r)}}),L.Draw.CircleMarker=L.Draw.Marker.extend({statics:{TYPE:"circlemarker"},options:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,zIndexOffset:2e3},initialize:function(r,a){this.type=L.Draw.CircleMarker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circlemarker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,r,a)},_fireCreatedEvent:function(){var r=new L.CircleMarker(this._marker.getLatLng(),this.options);L.Draw.Feature.prototype._fireCreatedEvent.call(this,r)},_createMarker:function(r){return new L.CircleMarker(r,this.options)}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0,feet:!0,nautic:!1},initialize:function(r,a){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,r,a)},_drawShape:function(r){if(L.GeometryUtil.isVersion07x())var a=this._startLatLng.distanceTo(r);else var a=this._map.distance(this._startLatLng,r);this._shape?this._shape.setRadius(a):(this._shape=new L.Circle(this._startLatLng,a,this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var r=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,r)},_onMouseMove:function(r){var a,l=r.latlng,u=this.options.showRadius,f=this.options.metric;if(this._tooltip.updatePosition(l),this._isDrawing){this._drawShape(l),a=this._shape.getRadius().toFixed(1);var _="";u&&(_=L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(a,f,this.options.feet,this.options.nautic)),this._tooltip.updateContent({text:this._endLabelText,subtext:_})}}}),L.Edit=L.Edit||{},L.Edit.Marker=L.Handler.extend({initialize:function(r,a){this._marker=r,L.setOptions(this,a)},addHooks:function(){var r=this._marker;r.dragging.enable(),r.on("dragend",this._onDragEnd,r),this._toggleMarkerHighlight()},removeHooks:function(){var r=this._marker;r.dragging.disable(),r.off("dragend",this._onDragEnd,r),this._toggleMarkerHighlight()},_onDragEnd:function(r){var a=r.target;a.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:a})},_toggleMarkerHighlight:function(){var r=this._marker._icon;r&&(r.style.display="none",L.DomUtil.hasClass(r,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(r,"leaflet-edit-marker-selected"),this._offsetMarker(r,-4)):(L.DomUtil.addClass(r,"leaflet-edit-marker-selected"),this._offsetMarker(r,4)),r.style.display="")},_offsetMarker:function(r,a){var l=parseInt(r.style.marginTop,10)-a,u=parseInt(r.style.marginLeft,10)-a;r.style.marginTop=l+"px",r.style.marginLeft=u+"px"}}),L.Marker.addInitHook(function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({initialize:function(r){this.latlngs=[r._latlngs],r._holes&&(this.latlngs=this.latlngs.concat(r._holes)),this._poly=r,this._poly.on("revert-edited",this._updateLatLngs,this)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._poly._latlngs)?this._poly._latlngs:this._poly._latlngs[0]:this._poly._latlngs},_eachVertexHandler:function(r){for(var a=0;a<this._verticesHandlers.length;a++)r(this._verticesHandlers[a])},addHooks:function(){this._initHandlers(),this._eachVertexHandler(function(r){r.addHooks()})},removeHooks:function(){this._eachVertexHandler(function(r){r.removeHooks()})},updateMarkers:function(){this._eachVertexHandler(function(r){r.updateMarkers()})},_initHandlers:function(){this._verticesHandlers=[];for(var r=0;r<this.latlngs.length;r++)this._verticesHandlers.push(new L.Edit.PolyVerticesEdit(this._poly,this.latlngs[r],this._poly.options.poly))},_updateLatLngs:function(r){this.latlngs=[r.layer._latlngs],r.layer._holes&&(this.latlngs=this.latlngs.concat(r.layer._holes))}}),L.Edit.PolyVerticesEdit=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),drawError:{color:"#b00b00",timeout:1e3}},initialize:function(r,a,l){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this._poly=r,l&&l.drawError&&(l.drawError=L.Util.extend({},this.options.drawError,l.drawError)),this._latlngs=a,L.setOptions(this,l)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]:this._latlngs},addHooks:function(){var r=this._poly,a=r._path;r instanceof L.Polygon||(r.options.fill=!1,r.options.editing&&(r.options.editing.fill=!1)),a&&r.options.editing&&r.options.editing.className&&(r.options.original.className&&r.options.original.className.split(" ").forEach(function(l){L.DomUtil.removeClass(a,l)}),r.options.editing.className.split(" ").forEach(function(l){L.DomUtil.addClass(a,l)})),r.setStyle(r.options.editing),this._poly._map&&(this._map=this._poly._map,this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var r=this._poly,a=r._path;a&&r.options.editing&&r.options.editing.className&&(r.options.editing.className.split(" ").forEach(function(l){L.DomUtil.removeClass(a,l)}),r.options.original.className&&r.options.original.className.split(" ").forEach(function(l){L.DomUtil.addClass(a,l)})),r.setStyle(r.options.original),r._map&&(r._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var r,a,l,u,f=this._defaultShape();for(r=0,l=f.length;r<l;r++)u=this._createMarker(f[r],r),u.on("click",this._onMarkerClick,this),u.on("contextmenu",this._onContextMenu,this),this._markers.push(u);var _,g;for(r=0,a=l-1;r<l;a=r++)(r!==0||L.Polygon&&this._poly instanceof L.Polygon)&&(_=this._markers[a],g=this._markers[r],this._createMiddleMarker(_,g),this._updatePrevNext(_,g))},_createMarker:function(r,a){var l=new L.Marker.Touch(r,{draggable:!0,icon:this.options.icon});return l._origLatLng=r,l._index=a,l.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._fireEdit,this).on("touchmove",this._onTouchMove,this).on("touchend",this._fireEdit,this).on("MSPointerMove",this._onTouchMove,this).on("MSPointerUp",this._fireEdit,this),this._markerGroup.addLayer(l),l},_onMarkerDragStart:function(){this._poly.fire("editstart")},_spliceLatLngs:function(){var r=this._defaultShape(),a=[].splice.apply(r,arguments);return this._poly._convertLatLngs(r,!0),this._poly.redraw(),a},_removeMarker:function(r){var a=r._index;this._markerGroup.removeLayer(r),this._markers.splice(a,1),this._spliceLatLngs(a,1),this._updateIndexes(a,-1),r.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("touchmove",this._onMarkerDrag,this).off("touchend",this._fireEdit,this).off("click",this._onMarkerClick,this).off("MSPointerMove",this._onTouchMove,this).off("MSPointerUp",this._fireEdit,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit"),this._poly._map.fire(L.Draw.Event.EDITVERTEX,{layers:this._markerGroup,poly:this._poly})},_onMarkerDrag:function(r){var a=r.target,l=this._poly,u=L.LatLngUtil.cloneLatLng(a._origLatLng);if(L.extend(a._origLatLng,a._latlng),l.options.poly){var f=l._map._editTooltip;if(!l.options.poly.allowIntersection&&l.intersects()){L.extend(a._origLatLng,u),a.setLatLng(u);var _=l.options.color;l.setStyle({color:this.options.drawError.color}),f&&f.updateContent({text:L.drawLocal.draw.handlers.polyline.error}),setTimeout(function(){l.setStyle({color:_}),f&&f.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext})},1e3)}}a._middleLeft&&a._middleLeft.setLatLng(this._getMiddleLatLng(a._prev,a)),a._middleRight&&a._middleRight.setLatLng(this._getMiddleLatLng(a,a._next)),this._poly._bounds._southWest=L.latLng(1/0,1/0),this._poly._bounds._northEast=L.latLng(-1/0,-1/0);var g=this._poly.getLatLngs();this._poly._convertLatLngs(g,!0),this._poly.redraw(),this._poly.fire("editdrag")},_onMarkerClick:function(r){var a=L.Polygon&&this._poly instanceof L.Polygon?4:3,l=r.target;this._defaultShape().length<a||(this._removeMarker(l),this._updatePrevNext(l._prev,l._next),l._middleLeft&&this._markerGroup.removeLayer(l._middleLeft),l._middleRight&&this._markerGroup.removeLayer(l._middleRight),l._prev&&l._next?this._createMiddleMarker(l._prev,l._next):l._prev?l._next||(l._prev._middleRight=null):l._next._middleLeft=null,this._fireEdit())},_onContextMenu:function(r){var a=r.target;this._poly,this._poly._map.fire(L.Draw.Event.MARKERCONTEXT,{marker:a,layers:this._markerGroup,poly:this._poly}),L.DomEvent.stopPropagation},_onTouchMove:function(r){var a=this._map.mouseEventToLayerPoint(r.originalEvent.touches[0]),l=this._map.layerPointToLatLng(a),u=r.target;L.extend(u._origLatLng,l),u._middleLeft&&u._middleLeft.setLatLng(this._getMiddleLatLng(u._prev,u)),u._middleRight&&u._middleRight.setLatLng(this._getMiddleLatLng(u,u._next)),this._poly.redraw(),this.updateMarkers()},_updateIndexes:function(r,a){this._markerGroup.eachLayer(function(l){l._index>r&&(l._index+=a)})},_createMiddleMarker:function(r,a){var l,u,f,_=this._getMiddleLatLng(r,a),g=this._createMarker(_);g.setOpacity(.6),r._middleRight=a._middleLeft=g,u=function(){g.off("touchmove",u,this);var p=a._index;g._index=p,g.off("click",l,this).on("click",this._onMarkerClick,this),_.lat=g.getLatLng().lat,_.lng=g.getLatLng().lng,this._spliceLatLngs(p,0,_),this._markers.splice(p,0,g),g.setOpacity(1),this._updateIndexes(p,1),a._index++,this._updatePrevNext(r,g),this._updatePrevNext(g,a),this._poly.fire("editstart")},f=function(){g.off("dragstart",u,this),g.off("dragend",f,this),g.off("touchmove",u,this),this._createMiddleMarker(r,g),this._createMiddleMarker(g,a)},l=function(){u.call(this),f.call(this),this._fireEdit()},g.on("click",l,this).on("dragstart",u,this).on("dragend",f,this).on("touchmove",u,this),this._markerGroup.addLayer(g)},_updatePrevNext:function(r,a){r&&(r._next=a),a&&(a._prev=r)},_getMiddleLatLng:function(r,a){var l=this._poly._map,u=l.project(r.getLatLng()),f=l.project(a.getLatLng());return l.unproject(u._add(f)._divideBy(2))}}),L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))}),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"}),touchMoveIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move leaflet-touch-icon"}),touchResizeIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize leaflet-touch-icon"})},initialize:function(r,a){L.Browser.touch&&(this.options.moveIcon=this.options.touchMoveIcon,this.options.resizeIcon=this.options.touchResizeIcon),this._shape=r,L.Util.setOptions(this,a)},addHooks:function(){var r=this._shape;this._shape._map&&(this._map=this._shape._map,r.setStyle(r.options.editing),r._map&&(this._map=r._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup)))},removeHooks:function(){var r=this._shape;if(r.setStyle(r.options.original),r._map){this._unbindMarker(this._moveMarker);for(var a=0,l=this._resizeMarkers.length;a<l;a++)this._unbindMarker(this._resizeMarkers[a]);this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(r,a){var l=new L.Marker.Touch(r,{draggable:!0,icon:a,zIndexOffset:10});return this._bindMarker(l),this._markerGroup.addLayer(l),l},_bindMarker:function(r){r.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this).on("touchstart",this._onTouchStart,this).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onTouchEnd,this).on("MSPointerUp",this._onTouchEnd,this)},_unbindMarker:function(r){r.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this).off("touchstart",this._onTouchStart,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onTouchEnd,this).off("MSPointerUp",this._onTouchEnd,this)},_onMarkerDragStart:function(r){r.target.setOpacity(0),this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit")},_onMarkerDrag:function(r){var a=r.target,l=a.getLatLng();a===this._moveMarker?this._move(l):this._resize(l),this._shape.redraw(),this._shape.fire("editdrag")},_onMarkerDragEnd:function(r){r.target.setOpacity(1),this._fireEdit()},_onTouchStart:function(r){if(L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,r),typeof this._getCorners=="function"){var a=this._getCorners(),l=r.target,u=l._cornerIndex;l.setOpacity(0),this._oppositeCorner=a[(u+2)%4],this._toggleCornerMarkers(0,u)}this._shape.fire("editstart")},_onTouchMove:function(r){var a=this._map.mouseEventToLayerPoint(r.originalEvent.touches[0]),l=this._map.layerPointToLatLng(a);return r.target===this._moveMarker?this._move(l):this._resize(l),this._shape.redraw(),!1},_onTouchEnd:function(r){r.target.setOpacity(1),this.updateMarkers(),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var r=this._shape.getBounds(),a=r.getCenter();this._moveMarker=this._createMarker(a,this.options.moveIcon)},_createResizeMarker:function(){var r=this._getCorners();this._resizeMarkers=[];for(var a=0,l=r.length;a<l;a++)this._resizeMarkers.push(this._createMarker(r[a],this.options.resizeIcon)),this._resizeMarkers[a]._cornerIndex=a},_onMarkerDragStart:function(r){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,r);var a=this._getCorners(),l=r.target,u=l._cornerIndex;this._oppositeCorner=a[(u+2)%4],this._toggleCornerMarkers(0,u)},_onMarkerDragEnd:function(r){var a,l,u=r.target;u===this._moveMarker&&(a=this._shape.getBounds(),l=a.getCenter(),u.setLatLng(l)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,r)},_move:function(r){for(var a,l=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),u=this._shape.getBounds(),f=u.getCenter(),_=[],g=0,p=l.length;g<p;g++)a=[l[g].lat-f.lat,l[g].lng-f.lng],_.push([r.lat+a[0],r.lng+a[1]]);this._shape.setLatLngs(_),this._repositionCornerMarkers(),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})},_resize:function(r){var a;this._shape.setBounds(L.latLngBounds(r,this._oppositeCorner)),a=this._shape.getBounds(),this._moveMarker.setLatLng(a.getCenter()),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})},_getCorners:function(){var r=this._shape.getBounds();return[r.getNorthWest(),r.getNorthEast(),r.getSouthEast(),r.getSouthWest()]},_toggleCornerMarkers:function(r){for(var a=0,l=this._resizeMarkers.length;a<l;a++)this._resizeMarkers[a].setOpacity(r)},_repositionCornerMarkers:function(){for(var r=this._getCorners(),a=0,l=this._resizeMarkers.length;a<l;a++)this._resizeMarkers[a].setLatLng(r[a])}}),L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.CircleMarker=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var r=this._shape.getLatLng();this._moveMarker=this._createMarker(r,this.options.moveIcon)},_createResizeMarker:function(){this._resizeMarkers=[]},_move:function(r){if(this._resizeMarkers.length){var a=this._getResizeMarkerPoint(r);this._resizeMarkers[0].setLatLng(a)}this._shape.setLatLng(r),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})}}),L.CircleMarker.addInitHook(function(){L.Edit.CircleMarker&&(this.editing=new L.Edit.CircleMarker(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})}),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.CircleMarker.extend({_createResizeMarker:function(){var r=this._shape.getLatLng(),a=this._getResizeMarkerPoint(r);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(a,this.options.resizeIcon))},_getResizeMarkerPoint:function(r){var a=this._shape._radius*Math.cos(Math.PI/4),l=this._map.project(r);return this._map.unproject([l.x+a,l.y-a])},_resize:function(r){var a=this._moveMarker.getLatLng();L.GeometryUtil.isVersion07x()?radius=a.distanceTo(r):radius=this._map.distance(a,r),this._shape.setRadius(radius),this._map.editTooltip&&this._map._editTooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.subtext+"<br />"+L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(radius,!0,this.options.feet,this.options.nautic)}),this._shape.setRadius(radius),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})}}),L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable())}),L.Map.mergeOptions({touchExtend:!0}),L.Map.TouchExtend=L.Handler.extend({initialize:function(r){this._map=r,this._container=r._container,this._pane=r._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.on(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.on(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.on(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.on(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.on(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.on(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.on(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.on(this._container,"touchleave",this._onTouchLeave,this))},removeHooks:function(){L.DomEvent.off(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.off(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.off(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.off(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.off(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.off(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.off(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.off(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.off(this._container,"touchleave",this._onTouchLeave,this))},_touchEvent:function(r,a){var l={};if(r.touches!==void 0){if(!r.touches.length)return;l=r.touches[0]}else if(r.pointerType!=="touch"||(l=r,!this._filterClick(r)))return;var u=this._map.mouseEventToContainerPoint(l),f=this._map.mouseEventToLayerPoint(l),_=this._map.layerPointToLatLng(f);this._map.fire(a,{latlng:_,layerPoint:f,containerPoint:u,pageX:l.pageX,pageY:l.pageY,originalEvent:r})},_filterClick:function(r){var a=r.timeStamp||r.originalEvent.timeStamp,l=L.DomEvent._lastClick&&a-L.DomEvent._lastClick;return l&&l>100&&l<500||r.target._simulatedClick&&!r._simulated?(L.DomEvent.stop(r),!1):(L.DomEvent._lastClick=a,!0)},_onTouchStart:function(r){this._map._loaded&&this._touchEvent(r,"touchstart")},_onTouchEnd:function(r){this._map._loaded&&this._touchEvent(r,"touchend")},_onTouchCancel:function(r){if(this._map._loaded){var a="touchcancel";this._detectIE()&&(a="pointercancel"),this._touchEvent(r,a)}},_onTouchLeave:function(r){this._map._loaded&&this._touchEvent(r,"touchleave")},_onTouchMove:function(r){this._map._loaded&&this._touchEvent(r,"touchmove")},_detectIE:function(){var r=n.navigator.userAgent,a=r.indexOf("MSIE ");if(a>0)return parseInt(r.substring(a+5,r.indexOf(".",a)),10);if(r.indexOf("Trident/")>0){var l=r.indexOf("rv:");return parseInt(r.substring(l+3,r.indexOf(".",l)),10)}var u=r.indexOf("Edge/");return u>0&&parseInt(r.substring(u+5,r.indexOf(".",u)),10)}}),L.Map.addInitHook("addHandler","touchExtend",L.Map.TouchExtend),L.Marker.Touch=L.Marker.extend({_initInteraction:function(){return this.addInteractiveTarget?L.Marker.prototype._initInteraction.apply(this):this._initInteractionLegacy()},_initInteractionLegacy:function(){if(this.options.clickable){var r=this._icon,a=["dblclick","mousedown","mouseover","mouseout","contextmenu","touchstart","touchend","touchmove"];this._detectIE?a.concat(["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"]):a.concat(["touchcancel"]),L.DomUtil.addClass(r,"leaflet-clickable"),L.DomEvent.on(r,"click",this._onMouseClick,this),L.DomEvent.on(r,"keypress",this._onKeyPress,this);for(var l=0;l<a.length;l++)L.DomEvent.on(r,a[l],this._fireMouseEvent,this);L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_detectIE:function(){var r=n.navigator.userAgent,a=r.indexOf("MSIE ");if(a>0)return parseInt(r.substring(a+5,r.indexOf(".",a)),10);if(r.indexOf("Trident/")>0){var l=r.indexOf("rv:");return parseInt(r.substring(l+3,r.indexOf(".",l)),10)}var u=r.indexOf("Edge/");return u>0&&parseInt(r.substring(u+5,r.indexOf(".",u)),10)}}),L.LatLngUtil={cloneLatLngs:function(r){for(var a=[],l=0,u=r.length;l<u;l++)Array.isArray(r[l])?a.push(L.LatLngUtil.cloneLatLngs(r[l])):a.push(this.cloneLatLng(r[l]));return a},cloneLatLng:function(r){return L.latLng(r.lat,r.lng)}},(function(){var r={km:2,ha:2,m:0,mi:2,ac:2,yd:0,ft:0,nm:2};L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(a){var l,u,f=a.length,_=0,g=Math.PI/180;if(f>2){for(var p=0;p<f;p++)l=a[p],u=a[(p+1)%f],_+=(u.lng-l.lng)*g*(2+Math.sin(l.lat*g)+Math.sin(u.lat*g));_=6378137*_*6378137/2}return Math.abs(_)},formattedNumber:function(a,l){var u=parseFloat(a).toFixed(l),f=L.drawLocal.format&&L.drawLocal.format.numeric,_=f&&f.delimiters,g=_&&_.thousands,p=_&&_.decimal;if(g||p){var m=u.split(".");u=g?m[0].replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+g):m[0],p=p||".",m.length>1&&(u=u+p+m[1])}return u},readableArea:function(a,l,g){var f,_,g=L.Util.extend({},r,g);return l?(_=["ha","m"],type=typeof l,type==="string"?_=[l]:type!=="boolean"&&(_=l),f=a>=1e6&&_.indexOf("km")!==-1?L.GeometryUtil.formattedNumber(1e-6*a,g.km)+" km\xb2":a>=1e4&&_.indexOf("ha")!==-1?L.GeometryUtil.formattedNumber(1e-4*a,g.ha)+" ha":L.GeometryUtil.formattedNumber(a,g.m)+" m\xb2"):(a/=.836127,f=a>=3097600?L.GeometryUtil.formattedNumber(a/3097600,g.mi)+" mi\xb2":a>=4840?L.GeometryUtil.formattedNumber(a/4840,g.ac)+" acres":L.GeometryUtil.formattedNumber(a,g.yd)+" yd\xb2"),f},readableDistance:function(a,l,u,f,p){var g,p=L.Util.extend({},r,p);switch(l?typeof l=="string"?l:"metric":u?"feet":f?"nauticalMile":"yards"){case"metric":g=a>1e3?L.GeometryUtil.formattedNumber(a/1e3,p.km)+" km":L.GeometryUtil.formattedNumber(a,p.m)+" m";break;case"feet":a*=3.28083,g=L.GeometryUtil.formattedNumber(a,p.ft)+" ft";break;case"nauticalMile":a*=.53996,g=L.GeometryUtil.formattedNumber(a/1e3,p.nm)+" nm";break;case"yards":default:a*=1.09361,g=a>1760?L.GeometryUtil.formattedNumber(a/1760,p.mi)+" miles":L.GeometryUtil.formattedNumber(a,p.yd)+" yd"}return g},isVersion07x:function(){var a=L.version.split(".");return parseInt(a[0],10)===0&&parseInt(a[1],10)===7}})})(),L.Util.extend(L.LineUtil,{segmentsIntersect:function(r,a,l,u){return this._checkCounterclockwise(r,l,u)!==this._checkCounterclockwise(a,l,u)&&this._checkCounterclockwise(r,a,l)!==this._checkCounterclockwise(r,a,u)},_checkCounterclockwise:function(r,a,l){return(l.y-r.y)*(a.x-r.x)>(a.y-r.y)*(l.x-r.x)}}),L.Polyline.include({intersects:function(){var r,a,l,u=this._getProjectedPoints(),f=u?u.length:0;if(this._tooFewPointsForIntersection())return!1;for(r=f-1;r>=3;r--)if(a=u[r-1],l=u[r],this._lineSegmentsIntersectsRange(a,l,r-2))return!0;return!1},newLatLngIntersects:function(r,a){return!!this._map&&this.newPointIntersects(this._map.latLngToLayerPoint(r),a)},newPointIntersects:function(r,a){var l=this._getProjectedPoints(),u=l?l.length:0,f=l?l[u-1]:null,_=u-2;return!this._tooFewPointsForIntersection(1)&&this._lineSegmentsIntersectsRange(f,r,_,a?1:0)},_tooFewPointsForIntersection:function(r){var a=this._getProjectedPoints(),l=a?a.length:0;return l+=r||0,!a||l<=3},_lineSegmentsIntersectsRange:function(r,a,l,u){var f,_,g=this._getProjectedPoints();u=u||0;for(var p=l;p>u;p--)if(f=g[p-1],_=g[p],L.LineUtil.segmentsIntersect(r,a,f,_))return!0;return!1},_getProjectedPoints:function(){if(!this._defaultShape)return this._originalPoints;for(var r=[],a=this._defaultShape(),l=0;l<a.length;l++)r.push(this._map.latLngToLayerPoint(a[l]));return r}}),L.Polygon.include({intersects:function(){var r,a,l,u,f=this._getProjectedPoints();return!this._tooFewPointsForIntersection()&&(!!L.Polyline.prototype.intersects.call(this)||(r=f.length,a=f[0],l=f[r-1],u=r-2,this._lineSegmentsIntersectsRange(l,a,u,1)))}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(r){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Control.prototype.initialize.call(this,r);var a;this._toolbars={},L.DrawToolbar&&this.options.draw&&(a=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=a,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.EditToolbar&&this.options.edit&&(a=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=a,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.toolbar=this},onAdd:function(r){var a,l=L.DomUtil.create("div","leaflet-draw"),u=!1;for(var f in this._toolbars)this._toolbars.hasOwnProperty(f)&&(a=this._toolbars[f].addToolbar(r))&&(u||(L.DomUtil.hasClass(a,"leaflet-draw-toolbar-top")||L.DomUtil.addClass(a.childNodes[0],"leaflet-draw-toolbar-top"),u=!0),l.appendChild(a));return l},onRemove:function(){for(var r in this._toolbars)this._toolbars.hasOwnProperty(r)&&this._toolbars[r].removeToolbar()},setDrawingOptions:function(r){for(var a in this._toolbars)this._toolbars[a]instanceof L.DrawToolbar&&this._toolbars[a].setOptions(r)},_toolbarEnabled:function(r){var a=r.target;for(var l in this._toolbars)this._toolbars[l]!==a&&this._toolbars[l].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))}),L.Toolbar=L.Class.extend({initialize:function(r){L.setOptions(this,r),this._modes={},this._actionButtons=[],this._activeMode=null;var a=L.version.split(".");parseInt(a[0],10)===1&&parseInt(a[1],10)>=2?L.Toolbar.include(L.Evented.prototype):L.Toolbar.include(L.Mixin.Events)},enabled:function(){return this._activeMode!==null},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(r){var a,l=L.DomUtil.create("div","leaflet-draw-section"),u=0,f=this._toolbarClass||"",_=this.getModeHandlers(r);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=r,a=0;a<_.length;a++)_[a].enabled&&this._initModeHandler(_[a].handler,this._toolbarContainer,u++,f,_[a].title);if(u)return this._lastButtonIndex=--u,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),l.appendChild(this._toolbarContainer),l.appendChild(this._actionsContainer),l},removeToolbar:function(){for(var r in this._modes)this._modes.hasOwnProperty(r)&&(this._disposeButton(this._modes[r].button,this._modes[r].handler.enable,this._modes[r].handler),this._modes[r].handler.disable(),this._modes[r].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var a=0,l=this._actionButtons.length;a<l;a++)this._disposeButton(this._actionButtons[a].button,this._actionButtons[a].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(r,a,l,u,f){var _=r.type;this._modes[_]={},this._modes[_].handler=r,this._modes[_].button=this._createButton({type:_,title:f,className:u+"-"+_,container:a,callback:this._modes[_].handler.enable,context:this._modes[_].handler}),this._modes[_].buttonIndex=l,this._modes[_].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_detectIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!n.MSStream},_createButton:function(r){var a=L.DomUtil.create("a",r.className||"",r.container),l=L.DomUtil.create("span","sr-only",r.container);a.href="#",a.appendChild(l),r.title&&(a.title=r.title,l.innerHTML=r.title),r.text&&(a.innerHTML=r.text,l.innerHTML=r.text);var u=this._detectIOS()?"touchstart":"click";return L.DomEvent.on(a,"click",L.DomEvent.stopPropagation).on(a,"mousedown",L.DomEvent.stopPropagation).on(a,"dblclick",L.DomEvent.stopPropagation).on(a,"touchstart",L.DomEvent.stopPropagation).on(a,"click",L.DomEvent.preventDefault).on(a,u,r.callback,r.context),a},_disposeButton:function(r,a){var l=this._detectIOS()?"touchstart":"click";L.DomEvent.off(r,"click",L.DomEvent.stopPropagation).off(r,"mousedown",L.DomEvent.stopPropagation).off(r,"dblclick",L.DomEvent.stopPropagation).off(r,"touchstart",L.DomEvent.stopPropagation).off(r,"click",L.DomEvent.preventDefault).off(r,l,a)},_handlerActivated:function(r){this.disable(),this._activeMode=this._modes[r.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(r){var a,l,u,f,_=this._actionsContainer,g=this.getActions(r),p=g.length;for(l=0,u=this._actionButtons.length;l<u;l++)this._disposeButton(this._actionButtons[l].button,this._actionButtons[l].callback);for(this._actionButtons=[];_.firstChild;)_.removeChild(_.firstChild);for(var m=0;m<p;m++)"enabled"in g[m]&&!g[m].enabled||(a=L.DomUtil.create("li","",_),f=this._createButton({title:g[m].title,text:g[m].text,container:a,callback:g[m].callback,context:g[m].context}),this._actionButtons.push({button:f,callback:g[m].callback}))},_showActionsToolbar:function(){var r=this._activeMode.buttonIndex,a=this._lastButtonIndex,l=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=l+"px",r===0&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),r===a&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block",this._map.fire(L.Draw.Event.TOOLBAROPENED)},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom"),this._map.fire(L.Draw.Event.TOOLBARCLOSED)}}),L.Draw=L.Draw||{},L.Draw.Tooltip=L.Class.extend({initialize:function(r){this._map=r,this._popupPane=r._panes.popupPane,this._visible=!1,this._container=r.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1,this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this),this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(r){return this._container?(r.subtext=r.subtext||"",r.subtext.length!==0||this._singleLineLabel?r.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(r.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+r.subtext+"</span><br />":"")+"<span>"+r.text+"</span>",r.text||r.subtext?(this._visible=!0,this._container.style.visibility="inherit"):(this._visible=!1,this._container.style.visibility="hidden"),this):this},updatePosition:function(r){var a=this._map.latLngToLayerPoint(r),l=this._container;return this._container&&(this._visible&&(l.style.visibility="inherit"),L.DomUtil.setPosition(l,a)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this},_onMouseOut:function(){this._container&&(this._container.style.visibility="hidden")}}),L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{polyline:{},polygon:{},rectangle:{},circle:{},marker:{},circlemarker:{}},initialize:function(r){for(var a in this.options)this.options.hasOwnProperty(a)&&r[a]&&(r[a]=L.extend({},this.options[a],r[a]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,r)},getModeHandlers:function(r){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(r,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(r,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(r,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(r,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(r,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.circlemarker,handler:new L.Draw.CircleMarker(r,this.options.circlemarker),title:L.drawLocal.draw.toolbar.buttons.circlemarker}]},getActions:function(r){return[{enabled:r.completeShape,title:L.drawLocal.draw.toolbar.finish.title,text:L.drawLocal.draw.toolbar.finish.text,callback:r.completeShape,context:r},{enabled:r.deleteLastVertex,title:L.drawLocal.draw.toolbar.undo.title,text:L.drawLocal.draw.toolbar.undo.text,callback:r.deleteLastVertex,context:r},{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(r){L.setOptions(this,r);for(var a in this._modes)this._modes.hasOwnProperty(a)&&r.hasOwnProperty(a)&&this._modes[a].handler.setOptions(r[a])}}),L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1}},remove:{},poly:null,featureGroup:null},initialize:function(r){r.edit&&(r.edit.selectedPathOptions===void 0&&(r.edit.selectedPathOptions=this.options.edit.selectedPathOptions),r.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,r.edit.selectedPathOptions)),r.remove&&(r.remove=L.extend({},this.options.remove,r.remove)),r.poly&&(r.poly=L.extend({},this.options.poly,r.poly)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,r),this._selectedFeatureCount=0},getModeHandlers:function(r){var a=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(r,{featureGroup:a,selectedPathOptions:this.options.edit.selectedPathOptions,poly:this.options.poly}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(r,{featureGroup:a}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(r){var a=[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}];return r.removeAllLayers&&a.push({title:L.drawLocal.edit.toolbar.actions.clearAll.title,text:L.drawLocal.edit.toolbar.actions.clearAll.text,callback:this._clearAllLayers,context:this}),a},addToolbar:function(r){var a=L.Toolbar.prototype.addToolbar.call(this,r);return this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),a},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save(),this._activeMode&&this._activeMode.handler.disable()},_clearAllLayers:function(){this._activeMode.handler.removeAllLayers(),this._activeMode&&this._activeMode.handler.disable()},_checkDisabled:function(){var r,a=this.options.featureGroup,l=a.getLayers().length!==0;this.options.edit&&(r=this._modes[L.EditToolbar.Edit.TYPE].button,l?L.DomUtil.removeClass(r,"leaflet-disabled"):L.DomUtil.addClass(r,"leaflet-disabled"),r.setAttribute("title",l?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(r=this._modes[L.EditToolbar.Delete.TYPE].button,l?L.DomUtil.removeClass(r,"leaflet-disabled"):L.DomUtil.addClass(r,"leaflet-disabled"),r.setAttribute("title",l?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},initialize:function(r,a){if(L.Handler.prototype.initialize.call(this,r),L.setOptions(this,a),this._featureGroup=a.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE;var l=L.version.split(".");parseInt(l[0],10)===1&&parseInt(l[1],10)>=2?L.EditToolbar.Edit.include(L.Evented.prototype):L.EditToolbar.Edit.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.EDITSTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.EDITSTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var r=this._map;r&&(r.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),r._editTooltip=this._tooltip,this._updateTooltip(),this._map.on("mousemove",this._onMouseMove,this).on("touchmove",this._onMouseMove,this).on("MSPointerMove",this._onMouseMove,this).on(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this).off("touchmove",this._onMouseMove,this).off("MSPointerMove",this._onMouseMove,this).off(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},revertLayers:function(){this._featureGroup.eachLayer(function(r){this._revertLayer(r)},this)},save:function(){var r=new L.LayerGroup;this._featureGroup.eachLayer(function(a){a.edited&&(r.addLayer(a),a.edited=!1)}),this._map.fire(L.Draw.Event.EDITED,{layers:r})},_backupLayer:function(r){var a=L.Util.stamp(r);this._uneditedLayerProps[a]||(r instanceof L.Polyline||r instanceof L.Polygon||r instanceof L.Rectangle?this._uneditedLayerProps[a]={latlngs:L.LatLngUtil.cloneLatLngs(r.getLatLngs())}:r instanceof L.Circle?this._uneditedLayerProps[a]={latlng:L.LatLngUtil.cloneLatLng(r.getLatLng()),radius:r.getRadius()}:(r instanceof L.Marker||r instanceof L.CircleMarker)&&(this._uneditedLayerProps[a]={latlng:L.LatLngUtil.cloneLatLng(r.getLatLng())}))},_getTooltipText:function(){return{text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}},_updateTooltip:function(){this._tooltip.updateContent(this._getTooltipText())},_revertLayer:function(r){var a=L.Util.stamp(r);r.edited=!1,this._uneditedLayerProps.hasOwnProperty(a)&&(r instanceof L.Polyline||r instanceof L.Polygon||r instanceof L.Rectangle?r.setLatLngs(this._uneditedLayerProps[a].latlngs):r instanceof L.Circle?(r.setLatLng(this._uneditedLayerProps[a].latlng),r.setRadius(this._uneditedLayerProps[a].radius)):(r instanceof L.Marker||r instanceof L.CircleMarker)&&r.setLatLng(this._uneditedLayerProps[a].latlng),r.fire("revert-edited",{layer:r}))},_enableLayerEdit:function(r){var a,l,u=r.layer||r.target||r;this._backupLayer(u),this.options.poly&&(l=L.Util.extend({},this.options.poly),u.options.poly=l),this.options.selectedPathOptions&&(a=L.Util.extend({},this.options.selectedPathOptions),a.maintainColor&&(a.color=u.options.color,a.fillColor=u.options.fillColor),u.options.original=L.extend({},u.options),u.options.editing=a),u instanceof L.Marker?(u.editing&&u.editing.enable(),u.dragging.enable(),u.on("dragend",this._onMarkerDragEnd).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onMarkerDragEnd,this).on("MSPointerUp",this._onMarkerDragEnd,this)):u.editing.enable()},_disableLayerEdit:function(r){var a=r.layer||r.target||r;a.edited=!1,a.editing&&a.editing.disable(),delete a.options.editing,delete a.options.original,this._selectedPathOptions&&(a instanceof L.Marker?this._toggleMarkerHighlight(a):(a.setStyle(a.options.previousOptions),delete a.options.previousOptions)),a instanceof L.Marker?(a.dragging.disable(),a.off("dragend",this._onMarkerDragEnd,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onMarkerDragEnd,this).off("MSPointerUp",this._onMarkerDragEnd,this)):a.editing.disable()},_onMouseMove:function(r){this._tooltip.updatePosition(r.latlng)},_onMarkerDragEnd:function(r){var a=r.target;a.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:a})},_onTouchMove:function(r){var a=r.originalEvent.changedTouches[0],l=this._map.mouseEventToLayerPoint(a),u=this._map.layerPointToLatLng(l);r.target.setLatLng(u)},_hasAvailableLayers:function(){return this._featureGroup.getLayers().length!==0}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},initialize:function(r,a){if(L.Handler.prototype.initialize.call(this,r),L.Util.setOptions(this,a),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE;var l=L.version.split(".");parseInt(l[0],10)===1&&parseInt(l[1],10)>=2?L.EditToolbar.Delete.include(L.Evented.prototype):L.EditToolbar.Delete.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DELETESTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DELETESTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var r=this._map;r&&(r.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._deletedLayers.eachLayer(function(r){this._deletableLayers.addLayer(r),r.fire("revert-deleted",{layer:r})},this)},save:function(){this._map.fire(L.Draw.Event.DELETED,{layers:this._deletedLayers})},removeAllLayers:function(){this._deletableLayers.eachLayer(function(r){this._removeLayer({layer:r})},this),this.save()},_enableLayerDelete:function(r){(r.layer||r.target||r).on("click",this._removeLayer,this)},_disableLayerDelete:function(r){var a=r.layer||r.target||r;a.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(a)},_removeLayer:function(r){var a=r.layer||r.target||r;this._deletableLayers.removeLayer(a),this._deletedLayers.addLayer(a),a.fire("deleted")},_onMouseMove:function(r){this._tooltip.updatePosition(r.latlng)},_hasAvailableLayers:function(){return this._deletableLayers.getLayers().length!==0}})})(window,document);L.Control.Fullscreen=L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(n){var t=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",t),this.link.href="#",this._map=n,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),t},_click:function(n){L.DomEvent.stopPropagation(n),L.DomEvent.preventDefault(n),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}});L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(n){var t=this.getContainer();this.isFullscreen()?n&&n.pseudoFullscreen?this._disablePseudoFullscreen(t):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(t):n&&n.pseudoFullscreen?this._enablePseudoFullscreen(t):t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen?t.msRequestFullscreen():this._enablePseudoFullscreen(t)},_enablePseudoFullscreen:function(n){L.DomUtil.addClass(n,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(n){L.DomUtil.removeClass(n,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(n){this._isFullscreen=n;var t=this.getContainer();n?L.DomUtil.addClass(t,"leaflet-fullscreen-on"):L.DomUtil.removeClass(t,"leaflet-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(n){var t=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;t===this.getContainer()&&!this._isFullscreen?(this._setFullscreen(!0),this.fire("fullscreenchange")):t!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange"))}});L.Map.mergeOptions({fullscreenControl:!1});L.Map.addInitHook(function(){this.options.fullscreenControl&&(this.fullscreenControl=new L.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl));var n;if("onfullscreenchange"in document?n="fullscreenchange":"onmozfullscreenchange"in document?n="mozfullscreenchange":"onwebkitfullscreenchange"in document?n="webkitfullscreenchange":"onmsfullscreenchange"in document&&(n="MSFullscreenChange"),n){var t=L.bind(this._onFullscreenChange,this);this.whenReady(function(){L.DomEvent.on(document,n,t)}),this.on("unload",function(){L.DomEvent.off(document,n,t)})}});L.control.fullscreen=function(n){return new L.Control.Fullscreen(n)};const cn=(n,t)=>{t.split(" ").forEach(i=>{n.classList.add(i)})},ln=(n,t)=>{t.split(" ").forEach(i=>{n.classList.remove(i)})},id=xt.Marker.extend({initialize(n,t){xt.setOptions(this,t),this._latlng=n,this.createIcon()},createIcon(){const n=this.options,t=[["stroke",n.color],["stroke-width",n.weight],["fill",n.fillColor],["fill-opacity",n.fillOpacity],["opacity",n.opacity]].filter(([s,r])=>r!==void 0).map(([s,r])=>`${s}="${r}"`).join(" "),i=this._getIconSVG(n,t);this._locationIcon=xt.divIcon({className:i.className,html:i.svg,iconSize:[i.w,i.h]}),this.setIcon(this._locationIcon)},_getIconSVG(n,t){const i=n.radius,s=n.weight,r=i+s,a=r*2;return{className:"leaflet-control-locate-location",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="${a}" height="${a}" version="1.1" viewBox="-${r} -${r} ${a} ${a}"><circle r="${i}" ${t} /></svg>`,w:a,h:a}},setStyle(n){xt.setOptions(this,n),this.createIcon()}}),r0=id.extend({initialize(n,t,i){xt.setOptions(this,i),this._latlng=n,this._heading=t,this.createIcon()},setHeading(n){this._heading=n},_getIconSVG(n,t){const i=n.radius,s=i+n.weight+n.depth,r=s*2,a=this._arrowPoints(i,n.width,n.depth,this._heading);return{className:"leaflet-control-locate-heading",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="${r}" height="${r}" version="1.1" viewBox="-${s} -${s} ${r} ${r}"><path d="${a}" ${t} /></svg>`,w:r,h:r}},_arrowPoints(n,t,i,s){const r=(s-90)*Math.PI/180,a=Math.cos(r),l=Math.sin(r),u=-Math.sin(r),f=Math.cos(r),_=t/2,g=n*a,p=n*l,m=g+_*u,v=p+_*f,b=g-_*u,S=p-_*f,C=g+i*a,V=p+i*l;return`M ${m},${v} L ${b},${S} L ${C},${V} Z`}}),o0=xt.Control.extend({options:{position:"topleft",layer:void 0,setView:"untilPanOrZoom",keepCurrentZoomLevel:!1,initialZoomLevel:!1,getLocationBounds(n){return n.bounds},flyTo:!1,clickBehavior:{inView:"stop",outOfView:"setView",inViewNotFollowing:"inView"},returnToPrevBounds:!1,cacheLocation:!0,drawCircle:!0,drawMarker:!0,showCompass:!0,markerClass:id,compassClass:r0,circleStyle:{className:"leaflet-control-locate-circle",color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:0},markerStyle:{className:"leaflet-control-locate-marker",color:"#fff",fillColor:"#2A93EE",fillOpacity:1,weight:3,opacity:1,radius:9},compassStyle:{fillColor:"#2A93EE",fillOpacity:1,weight:0,color:"#fff",opacity:1,radius:9,width:9,depth:6},followCircleStyle:{},followMarkerStyle:{},followCompassStyle:{},icon:"leaflet-control-locate-location-arrow",iconLoading:"leaflet-control-locate-spinner",iconElementTag:"span",textElementTag:"small",circlePadding:[0,0],metric:!0,createButtonCallback(n,t){const i=xt.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",n);i.title=t.strings.title,i.href="#",i.setAttribute("role","button");const s=xt.DomUtil.create(t.iconElementTag,t.icon,i);if(t.strings.text!==void 0){const r=xt.DomUtil.create(t.textElementTag,"leaflet-locate-text",i);r.textContent=t.strings.text,i.classList.add("leaflet-locate-text-active"),i.parentNode.style.display="flex",t.icon.length>0&&s.classList.add("leaflet-locate-icon")}return{link:i,icon:s}},onLocationError(n,t){alert(n.message)},onLocationOutsideMapBounds(n){n.stop(),alert(n.options.strings.outsideMapBoundsMsg)},showPopup:!0,strings:{title:"Show me where I am",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:1/0,watch:!0,setView:!1}},initialize(n){for(const t in n)typeof this.options[t]=="object"?xt.extend(this.options[t],n[t]):this.options[t]=n[t];this.options.followMarkerStyle=xt.extend({},this.options.markerStyle,this.options.followMarkerStyle),this.options.followCircleStyle=xt.extend({},this.options.circleStyle,this.options.followCircleStyle),this.options.followCompassStyle=xt.extend({},this.options.compassStyle,this.options.followCompassStyle)},onAdd(n){const t=xt.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control");this._container=t,this._map=n,this._layer=this.options.layer||new xt.LayerGroup,this._layer.addTo(n),this._event=void 0,this._compassHeading=null,this._prevBounds=null;const i=this.options.createButtonCallback(t,this.options);return this._link=i.link,this._icon=i.icon,xt.DomEvent.on(this._link,"click",function(s){xt.DomEvent.stopPropagation(s),xt.DomEvent.preventDefault(s),this._onClick()},this).on(this._link,"dblclick",xt.DomEvent.stopPropagation),this._resetVariables(),this._map.on("unload",this._unload,this),t},_onClick(){this._justClicked=!0;const n=this._isFollowing();if(this._userPanned=!1,this._userZoomed=!1,this._active&&!this._event)this.stop();else if(this._active){const t=this.options.clickBehavior;let i=t.outOfView;switch(this._map.getBounds().contains(this._event.latlng)&&(i=n?t.inView:t.inViewNotFollowing),t[i]&&(i=t[i]),i){case"setView":this.setView();break;case"stop":this.stop(),this.options.returnToPrevBounds&&(this.options.flyTo?this._map.flyToBounds:this._map.fitBounds).bind(this._map)(this._prevBounds);break}}else this.options.returnToPrevBounds&&(this._prevBounds=this._map.getBounds()),this.start();this._updateContainerStyle()},start(){this._activate(),this._event&&(this._drawMarker(this._map),this.options.setView&&this.setView()),this._updateContainerStyle()},stop(){this._deactivate(),this._cleanClasses(),this._resetVariables(),this._removeMarker()},stopFollowing(){this._userPanned=!0,this._updateContainerStyle(),this._drawMarker()},_activate(){if(!(this._active||!this._map)&&(this._map.locate(this.options.locateOptions),this._map.fire("locateactivate",this),this._active=!0,this._map.on("locationfound",this._onLocationFound,this),this._map.on("locationerror",this._onLocationError,this),this._map.on("dragstart",this._onDrag,this),this._map.on("zoomstart",this._onZoom,this),this._map.on("zoomend",this._onZoomEnd,this),this.options.showCompass)){const n="ondeviceorientationabsolute"in window;if(n||"ondeviceorientation"in window){const t=this,i=function(){xt.DomEvent.on(window,n?"deviceorientationabsolute":"deviceorientation",t._onDeviceOrientation,t)};DeviceOrientationEvent&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(s){s==="granted"&&i()}):i()}}},_deactivate(){!this._active||!this._map||(this._map.stopLocate(),this._map.fire("locatedeactivate",this),this._active=!1,this.options.cacheLocation||(this._event=void 0),this._map.off("locationfound",this._onLocationFound,this),this._map.off("locationerror",this._onLocationError,this),this._map.off("dragstart",this._onDrag,this),this._map.off("zoomstart",this._onZoom,this),this._map.off("zoomend",this._onZoomEnd,this),this.options.showCompass&&(this._compassHeading=null,"ondeviceorientationabsolute"in window?xt.DomEvent.off(window,"deviceorientationabsolute",this._onDeviceOrientation,this):"ondeviceorientation"in window&&xt.DomEvent.off(window,"deviceorientation",this._onDeviceOrientation,this)))},setView(){if(this._drawMarker(),this._isOutsideMapBounds())this._event=void 0,this.options.onLocationOutsideMapBounds(this);else if(this._justClicked&&this.options.initialZoomLevel!==!1)(this.options.flyTo?this._map.flyTo:this._map.setView).bind(this._map)([this._event.latitude,this._event.longitude],this.options.initialZoomLevel);else if(this.options.keepCurrentZoomLevel)(this.options.flyTo?this._map.flyTo:this._map.panTo).bind(this._map)([this._event.latitude,this._event.longitude]);else{let n=this.options.flyTo?this._map.flyToBounds:this._map.fitBounds;this._ignoreEvent=!0,n.bind(this._map)(this.options.getLocationBounds(this._event),{padding:this.options.circlePadding,maxZoom:this.options.initialZoomLevel||this.options.locateOptions.maxZoom}),xt.Util.requestAnimFrame(function(){this._ignoreEvent=!1},this)}},_drawCompass(){if(!this._event)return;const n=this._event.latlng;if(this.options.showCompass&&n&&this._compassHeading!==null){const t=this._isFollowing()?this.options.followCompassStyle:this.options.compassStyle;this._compass?(this._compass.setLatLng(n),this._compass.setHeading(this._compassHeading),this._compass.setStyle&&this._compass.setStyle(t)):this._compass=new this.options.compassClass(n,this._compassHeading,t).addTo(this._layer)}this._compass&&(!this.options.showCompass||this._compassHeading===null)&&(this._compass.removeFrom(this._layer),this._compass=null)},_drawMarker(){this._event.accuracy===void 0&&(this._event.accuracy=0);const n=this._event.accuracy,t=this._event.latlng;if(this.options.drawCircle){const l=this._isFollowing()?this.options.followCircleStyle:this.options.circleStyle;this._circle?this._circle.setLatLng(t).setRadius(n).setStyle(l):this._circle=xt.circle(t,n,l).addTo(this._layer)}let i,s;if(this.options.metric?(i=n.toFixed(0),s=this.options.strings.metersUnit):(i=(n*3.2808399).toFixed(0),s=this.options.strings.feetUnit),this.options.drawMarker){const l=this._isFollowing()?this.options.followMarkerStyle:this.options.markerStyle;this._marker?(this._marker.setLatLng(t),this._marker.setStyle&&this._marker.setStyle(l)):this._marker=new this.options.markerClass(t,l).addTo(this._layer)}this._drawCompass();const r=this.options.strings.popup;function a(){return typeof r=="string"?xt.Util.template(r,{distance:i,unit:s}):typeof r=="function"?r({distance:i,unit:s}):r}this.options.showPopup&&r&&this._marker&&this._marker.bindPopup(a())._popup.setLatLng(t),this.options.showPopup&&r&&this._compass&&this._compass.bindPopup(a())._popup.setLatLng(t)},_removeMarker(){this._layer.clearLayers(),this._marker=void 0,this._circle=void 0},_unload(){this.stop(),this._map&&this._map.off("unload",this._unload,this)},_setCompassHeading(n){!isNaN(parseFloat(n))&&isFinite(n)?(n=Math.round(n),this._compassHeading=n,xt.Util.requestAnimFrame(this._drawCompass,this)):this._compassHeading=null},_onCompassNeedsCalibration(){this._setCompassHeading()},_onDeviceOrientation(n){this._active&&(n.webkitCompassHeading?this._setCompassHeading(n.webkitCompassHeading):n.absolute&&n.alpha&&this._setCompassHeading(360-n.alpha))},_onLocationError(n){n.code==3&&this.options.locateOptions.watch||(this.stop(),this.options.onLocationError(n,this))},_onLocationFound(n){if(!(this._event&&this._event.latlng.lat===n.latlng.lat&&this._event.latlng.lng===n.latlng.lng&&this._event.accuracy===n.accuracy)&&this._active){switch(this._event=n,this._drawMarker(),this._updateContainerStyle(),this.options.setView){case"once":this._justClicked&&this.setView();break;case"untilPan":this._userPanned||this.setView();break;case"untilPanOrZoom":!this._userPanned&&!this._userZoomed&&this.setView();break;case"always":this.setView();break}this._justClicked=!1}},_onDrag(){this._event&&!this._ignoreEvent&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_onZoom(){this._event&&!this._ignoreEvent&&(this._userZoomed=!0,this._updateContainerStyle(),this._drawMarker())},_onZoomEnd(){this._event&&this._drawCompass(),this._event&&!this._ignoreEvent&&this._marker&&!this._map.getBounds().pad(-.3).contains(this._marker.getLatLng())&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_isFollowing(){if(!this._active)return!1;if(this.options.setView==="always")return!0;if(this.options.setView==="untilPan")return!this._userPanned;if(this.options.setView==="untilPanOrZoom")return!this._userPanned&&!this._userZoomed},_isOutsideMapBounds(){return this._event===void 0?!1:this._map.options.maxBounds&&!this._map.options.maxBounds.contains(this._event.latlng)},_updateContainerStyle(){this._container&&(this._active&&!this._event?this._setClasses("requesting"):this._isFollowing()?this._setClasses("following"):this._active?this._setClasses("active"):this._cleanClasses())},_setClasses(n){n=="requesting"?(ln(this._container,"active following"),cn(this._container,"requesting"),ln(this._icon,this.options.icon),cn(this._icon,this.options.iconLoading)):n=="active"?(ln(this._container,"requesting following"),cn(this._container,"active"),ln(this._icon,this.options.iconLoading),cn(this._icon,this.options.icon)):n=="following"&&(ln(this._container,"requesting"),cn(this._container,"active following"),ln(this._icon,this.options.iconLoading),cn(this._icon,this.options.icon))},_cleanClasses(){xt.DomUtil.removeClass(this._container,"requesting"),xt.DomUtil.removeClass(this._container,"active"),xt.DomUtil.removeClass(this._container,"following"),ln(this._icon,this.options.iconLoading),cn(this._icon,this.options.icon)},_resetVariables(){this._active=!1,this._justClicked=!1,this._userPanned=!1,this._userZoomed=!1}});function cr(n){if(typeof n!="string"||!n)throw new Error("expected a non-empty string, got: "+n)}function Yo(n){if(typeof n!="number")throw new Error("expected a number, got: "+n)}const s0=1,a0=1,Ln="emoji",Gn="keyvalue",Qs="favorites",c0="tokens",rd="tokens",l0="unicode",od="count",h0="group",u0="order",sd="group-order",ks="eTag",zr="url",cl="skinTone",Wn="readonly",ta="readwrite",ad="skinUnicodes",d0="skinUnicodes",f0="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",_0="en";function p0(n,t){const i=new Set,s=[];for(const r of n){const a=t(r);i.has(a)||(i.add(a),s.push(r))}return s}function ll(n){return p0(n,t=>t.unicode)}function m0(n){function t(i,s,r){const a=s?n.createObjectStore(i,{keyPath:s}):n.createObjectStore(i);if(r)for(const[l,[u,f]]of Object.entries(r))a.createIndex(l,u,{multiEntry:f});return a}t(Gn),t(Ln,l0,{[rd]:[c0,!0],[sd]:[[h0,u0]],[ad]:[d0,!0]}),t(Qs,void 0,{[od]:[""]})}const Ts={},yr={},Rr={};function cd(n,t,i){i.onerror=()=>t(i.error),i.onblocked=()=>t(new Error("IDB blocked")),i.onsuccess=()=>n(i.result)}async function g0(n){const t=await new Promise((i,s)=>{const r=indexedDB.open(n,s0);Ts[n]=r,r.onupgradeneeded=a=>{a.oldVersion<a0&&m0(r.result)},cd(i,s,r)});return t.onclose=()=>ea(n),t}function y0(n){return yr[n]||(yr[n]=g0(n)),yr[n]}function qe(n,t,i,s){return new Promise((r,a)=>{const l=n.transaction(t,i,{durability:"relaxed"}),u=typeof t=="string"?l.objectStore(t):t.map(_=>l.objectStore(_));let f;s(u,l,_=>{f=_}),l.oncomplete=()=>r(f),l.onerror=()=>a(l.error)})}function ea(n){const t=Ts[n],i=t&&t.result;if(i){i.close();const s=Rr[n];if(s)for(const r of s)r()}delete Ts[n],delete yr[n],delete Rr[n]}function v0(n){return new Promise((t,i)=>{ea(n);const s=indexedDB.deleteDatabase(n);cd(t,i,s)})}function b0(n,t){let i=Rr[n];i||(i=Rr[n]=[]),i.push(t)}const w0=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function Nn(n){return n.split(/[\s_]+/).map(t=>!t.match(/\w/)||w0.has(t)?t.toLowerCase():t.replace(/[)(:,]/g,"").replace(/’/g,"'").toLowerCase()).filter(Boolean)}const x0=2;function ld(n){return n.filter(Boolean).map(t=>t.toLowerCase()).filter(t=>t.length>=x0)}function L0(n){return n.map(({annotation:i,emoticon:s,group:r,order:a,shortcodes:l,skins:u,tags:f,emoji:_,version:g})=>{const p=[...new Set(ld([...(l||[]).map(Nn).flat(),...(f||[]).map(Nn).flat(),...Nn(i),s]))].sort(),m={annotation:i,group:r,order:a,tags:f,tokens:p,unicode:_,version:g};if(s&&(m.emoticon=s),l&&(m.shortcodes=l),u){m.skinTones=[],m.skinUnicodes=[],m.skinVersions=[];for(const{tone:v,emoji:b,version:S}of u)m.skinTones.push(v),m.skinUnicodes.push(b),m.skinVersions.push(S)}return m})}function hd(n,t,i,s){n[t](i).onsuccess=r=>s&&s(r.target.result)}function bn(n,t,i){hd(n,"get",t,i)}function ud(n,t,i){hd(n,"getAll",t,i)}function na(n){n.commit&&n.commit()}function S0(n,t){let i=n[0];for(let s=1;s<n.length;s++){const r=n[s];t(i)>t(r)&&(i=r)}return i}function dd(n,t){const i=S0(n,r=>r.length),s=[];for(const r of i)n.some(a=>a.findIndex(l=>t(l)===t(r))===-1)||s.push(r);return s}async function E0(n){return!await ia(n,Gn,zr)}async function k0(n,t,i){const[s,r]=await Promise.all([ks,zr].map(a=>ia(n,Gn,a)));return s===i&&r===t}async function T0(n,t){return qe(n,Ln,Wn,(s,r,a)=>{let l;const u=()=>{s.getAll(l&&IDBKeyRange.lowerBound(l,!0),50).onsuccess=f=>{const _=f.target.result;for(const g of _)if(l=g.unicode,t(g))return a(g);if(_.length<50)return a();u()}};u()})}async function fd(n,t,i,s){try{const r=L0(t);await qe(n,[Ln,Gn],ta,([a,l],u)=>{let f,_,g=0;function p(){++g===2&&m()}function m(){if(!(f===s&&_===i)){a.clear();for(const v of r)a.put(v);l.put(s,ks),l.put(i,zr),na(u)}}bn(l,ks,v=>{f=v,p()}),bn(l,zr,v=>{_=v,p()})})}finally{}}async function C0(n,t){return qe(n,Ln,Wn,(i,s,r)=>{const a=IDBKeyRange.bound([t,0],[t+1,0],!1,!0);ud(i.index(sd),a,r)})}async function _d(n,t){const i=ld(Nn(t));return i.length?qe(n,Ln,Wn,(s,r,a)=>{const l=[],u=()=>{l.length===i.length&&f()},f=()=>{const _=dd(l,g=>g.unicode);a(_.sort((g,p)=>g.order<p.order?-1:1))};for(let _=0;_<i.length;_++){const g=i[_],p=_===i.length-1?IDBKeyRange.bound(g,g+"￿",!1,!0):IDBKeyRange.only(g);ud(s.index(rd),p,m=>{l.push(m),u()})}}):[]}async function M0(n,t){const i=await _d(n,t);return i.length?i.filter(s=>(s.shortcodes||[]).map(a=>a.toLowerCase()).includes(t.toLowerCase()))[0]||null:await T0(n,r=>(r.shortcodes||[]).includes(t.toLowerCase()))||null}async function P0(n,t){return qe(n,Ln,Wn,(i,s,r)=>bn(i,t,a=>{if(a)return r(a);bn(i.index(ad),t,l=>r(l||null))}))}function ia(n,t,i){return qe(n,t,Wn,(s,r,a)=>bn(s,i,a))}function I0(n,t,i,s){return qe(n,t,ta,(r,a)=>{r.put(s,i),na(a)})}function A0(n,t){return qe(n,Qs,ta,(i,s)=>bn(i,t,r=>{i.put((r||0)+1,t),na(s)}))}function D0(n,t,i){return i===0?[]:qe(n,[Qs,Ln],Wn,([s,r],a,l)=>{const u=[];s.index(od).openCursor(void 0,"prev").onsuccess=f=>{const _=f.target.result;if(!_)return l(u);function g(v){if(u.push(v),u.length===i)return l(u);_.continue()}const p=_.primaryKey,m=t.byName(p);if(m)return g(m);bn(r,p,v=>{if(v)return g(v);_.continue()})}})}const lr="";function O0(n,t){const i=new Map;for(const r of n){const a=t(r);for(const l of a){let u=i;for(let _=0;_<l.length;_++){const g=l.charAt(_);let p=u.get(g);p||(p=new Map,u.set(g,p)),u=p}let f=u.get(lr);f||(f=[],u.set(lr,f)),f.push(r)}}return(r,a)=>{let l=i;for(let _=0;_<r.length;_++){const g=r.charAt(_),p=l.get(g);if(p)l=p;else return[]}if(a)return l.get(lr)||[];const u=[],f=[l];for(;f.length;){const g=[...f.shift().entries()].sort((p,m)=>p[0]<m[0]?-1:1);for(const[p,m]of g)p===lr?u.push(...m):f.push(m)}return u}}const B0=["name","url"];function z0(n){const t=n&&Array.isArray(n),i=t&&n.length&&(!n[0]||B0.some(s=>!(s in n[0])));if(!t||i)throw new Error("Custom emojis are in the wrong format")}function hl(n){z0(n);const t=(m,v)=>m.name.toLowerCase()<v.name.toLowerCase()?-1:1,i=n.sort(t),r=O0(n,m=>{const v=new Set;if(m.shortcodes)for(const b of m.shortcodes)for(const S of Nn(b))v.add(S);return v}),a=m=>r(m,!0),l=m=>r(m,!1),u=m=>{const v=Nn(m),b=v.map((S,C)=>(C<v.length-1?a:l)(S));return dd(b,S=>S.name).sort(t)},f=new Map,_=new Map;for(const m of n){_.set(m.name.toLowerCase(),m);for(const v of m.shortcodes||[])f.set(v.toLowerCase(),m)}return{all:i,search:u,byShortcode:m=>f.get(m.toLowerCase()),byName:m=>_.get(m.toLowerCase())}}const R0=typeof wrappedJSObject<"u";function hi(n){if(!n)return n;if(R0&&(n=structuredClone(n)),delete n.tokens,n.skinTones){const t=n.skinTones.length;n.skins=Array(t);for(let i=0;i<t;i++)n.skins[i]={tone:n.skinTones[i],unicode:n.skinUnicodes[i],version:n.skinVersions[i]};delete n.skinTones,delete n.skinUnicodes,delete n.skinVersions}return n}function pd(n){n||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const H0=["annotation","emoji","group","order","version"];function j0(n){if(!n||!Array.isArray(n)||!n[0]||typeof n[0]!="object"||H0.some(t=>!(t in n[0])))throw new Error("Emoji data is in the wrong format")}function md(n,t){if(Math.floor(n.status/100)!==2)throw new Error("Failed to fetch: "+t+":  "+n.status)}async function U0(n){const t=await fetch(n,{method:"HEAD"});md(t,n);const i=t.headers.get("etag");return pd(i),i}async function Cs(n){const t=await fetch(n);md(t,n);const i=t.headers.get("etag");pd(i);const s=await t.json();return j0(s),[i,s]}function F0(n){for(var t="",i=new Uint8Array(n),s=i.byteLength,r=-1;++r<s;)t+=String.fromCharCode(i[r]);return t}function N0(n){for(var t=n.length,i=new ArrayBuffer(t),s=new Uint8Array(i),r=-1;++r<t;)s[r]=n.charCodeAt(r);return i}async function gd(n){const t=JSON.stringify(n);let i=N0(t);const s=await crypto.subtle.digest("SHA-1",i),r=F0(s);return btoa(r)}async function $0(n,t){let i,s=await U0(t);if(!s){const r=await Cs(t);s=r[0],i=r[1],s||(s=await gd(i))}await k0(n,t,s)||(i||(i=(await Cs(t))[1]),await fd(n,i,t,s))}async function Z0(n,t){let[i,s]=await Cs(t);i||(i=await gd(s)),await fd(n,s,t,i)}async function V0(n,t){try{await $0(n,t)}catch(i){if(i.name!=="InvalidStateError")throw i}}class G0{constructor({dataSource:t=f0,locale:i=_0,customEmoji:s=[]}={}){this.dataSource=t,this.locale=i,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=hl(s),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const t=this._db=await y0(this._dbName);b0(this._dbName,this._clear);const i=this.dataSource;await E0(t)?await Z0(t,i):this._lazyUpdate=V0(t,i)}async ready(){const t=async()=>(this._ready||(this._ready=this._init()),this._ready);await t(),this._db||await t()}async getEmojiByGroup(t){return Yo(t),await this.ready(),ll(await C0(this._db,t)).map(hi)}async getEmojiBySearchQuery(t){cr(t),await this.ready();const i=this._custom.search(t),s=ll(await _d(this._db,t)).map(hi);return[...i,...s]}async getEmojiByShortcode(t){cr(t),await this.ready();const i=this._custom.byShortcode(t);return i||hi(await M0(this._db,t))}async getEmojiByUnicodeOrName(t){cr(t),await this.ready();const i=this._custom.byName(t);return i||hi(await P0(this._db,t))}async getPreferredSkinTone(){return await this.ready(),await ia(this._db,Gn,cl)||0}async setPreferredSkinTone(t){return Yo(t),await this.ready(),I0(this._db,Gn,cl,t)}async incrementFavoriteEmojiCount(t){return cr(t),await this.ready(),A0(this._db,t)}async getTopFavoriteEmoji(t){return Yo(t),await this.ready(),(await D0(this._db,this._custom,t)).map(hi)}set customEmoji(t){this._custom=hl(t)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch{}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await ea(this._dbName)}async delete(){await this._shutdown(),await v0(this._dbName)}}const Ms=[[-1,"✨","custom"],[0,"\uD83D\uDE00","smileys-emotion"],[1,"\uD83D\uDC4B","people-body"],[3,"\uD83D\uDC31","animals-nature"],[4,"\uD83C\uDF4E","food-drink"],[5,"\uD83C\uDFE0️","travel-places"],[6,"⚽","activities"],[7,"\uD83D\uDCDD","objects"],[8,"⛔️","symbols"],[9,"\uD83C\uDFC1","flags"]].map(([n,t,i])=>({id:n,emoji:t,name:i})),Jo=Ms.slice(1),W0=2,ul=6,yd=typeof requestIdleCallback=="function"?requestIdleCallback:setTimeout;function dl(n){return n.unicode.includes("‍")}const q0={"\uD83E\uDEE9":16,"\uD83E\uDEE8":15.1,"\uD83E\uDEE0":14,"\uD83E\uDD72":13.1,"\uD83E\uDD7B":12.1,"\uD83E\uDD70":11,"\uD83E\uDD29":5,"\uD83D\uDC71‍♀️":4,"\uD83E\uDD23":3,"\uD83D\uDC41️‍\uD83D\uDDE8️":2,"\uD83D\uDE00":1,"\uD83D\uDE10️":.7,"\uD83D\uDE03":.6},K0=1e3,Y0="\uD83D\uDD90️",J0=8,X0=["\uD83D\uDE0A","\uD83D\uDE12","❤️","\uD83D\uDC4D️","\uD83D\uDE0D","\uD83D\uDE02","\uD83D\uDE2D","☺️","\uD83D\uDE14","\uD83D\uDE29","\uD83D\uDE0F","\uD83D\uDC95","\uD83D\uDE4C","\uD83D\uDE18"],vd='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',Q0=(n,t)=>n<t?-1:n>t?1:0,fl=(n,t)=>{const i=document.createElement("canvas");i.width=i.height=1;const s=i.getContext("2d",{willReadFrequently:!0});return s.textBaseline="top",s.font=`100px ${vd}`,s.fillStyle=t,s.scale(.01,.01),s.fillText(n,0,0),s.getImageData(0,0,1,1).data},tb=(n,t)=>{const i=[...n].join(","),s=[...t].join(",");return i===s&&!i.startsWith("0,0,0,")};function eb(n){const t=fl(n,"#000"),i=fl(n,"#fff");return t&&i&&tb(t,i)}function nb(){const n=Object.entries(q0);try{for(const[t,i]of n)if(eb(t))return i}catch{}finally{}return n[0][1]}let Xo;const Qo=()=>(Xo||(Xo=new Promise(n=>yd(()=>n(nb())))),Xo),Ps=new Map,ib="️",rb="\uD83C",ob="‍",sb=127995,ab=57339;function cb(n,t){if(t===0)return n;const i=n.indexOf(ob);return i!==-1?n.substring(0,i)+String.fromCodePoint(sb+t-1)+n.substring(i):(n.endsWith(ib)&&(n=n.substring(0,n.length-1)),n+rb+String.fromCodePoint(ab+t-1))}function Te(n){n.preventDefault(),n.stopPropagation()}function ts(n,t,i){return t+=n?-1:1,t<0?t=i.length-1:t>=i.length&&(t=0),t}function bd(n,t){const i=new Set,s=[];for(const r of n){const a=t(r);i.has(a)||(i.add(a),s.push(r))}return s}function lb(n,t){const i=s=>{const r={};for(const a of s)typeof a.tone=="number"&&a.version<=t&&(r[a.tone]=a.unicode);return r};return n.map(({unicode:s,skins:r,shortcodes:a,url:l,name:u,category:f,annotation:_})=>({unicode:s,name:u,shortcodes:a,url:l,category:f,annotation:_,id:s||u,skins:r&&i(r)}))}const vr=requestAnimationFrame;let hb=typeof ResizeObserver=="function";function ub(n,t,i){let s;hb?(s=new ResizeObserver(i),s.observe(n)):vr(i),t.addEventListener("abort",()=>{s&&s.disconnect()})}function _l(n){{const t=document.createRange();return t.selectNode(n.firstChild),t.getBoundingClientRect().width}}let es;function db(n,t,i){let s=!0;for(const r of n){const a=i(r);if(!a)continue;const l=_l(a);typeof es>"u"&&(es=_l(t));const u=l/1.8<es;Ps.set(r.unicode,u),u||(s=!1)}return s}function fb(n){return bd(n,t=>t)}function _b(n){n&&(n.scrollTop=0)}function mi(n,t,i){let s=n.get(t);return s||(s=i(),n.set(t,s)),s}function pl(n){return""+n}function pb(n){const t=document.createElement("template");return t.innerHTML=n,t}const mb=new WeakMap,gb=new WeakMap,yb=Symbol("un-keyed"),vb="replaceChildren"in Element.prototype;function bb(n,t){vb?n.replaceChildren(...t):(n.innerHTML="",n.append(...t))}function wb(n,t){let i=n.firstChild,s=0;for(;i;){if(t[s]!==i)return!0;i=i.nextSibling,s++}return s!==t.length}function xb(n,t){const{targetNode:i}=t;let{targetParentNode:s}=t,r=!1;s?r=wb(s,n):(r=!0,t.targetNode=void 0,t.targetParentNode=s=i.parentNode),r&&bb(s,n)}function Lb(n,t){for(const i of t){const{targetNode:s,currentExpression:r,binding:{expressionIndex:a,attributeName:l,attributeValuePre:u,attributeValuePost:f}}=i,_=n[a];if(r!==_)if(i.currentExpression=_,l)if(_===null)s.removeAttribute(l);else{const g=u+pl(_)+f;s.setAttribute(l,g)}else{let g;Array.isArray(_)?xb(_,i):_ instanceof Element?(g=_,s.replaceWith(g)):s.nodeValue=pl(_),g&&(i.targetNode=g)}}}function Sb(n){let t="",i=!1,s=!1,r=-1;const a=new Map,l=[];let u=0;for(let _=0,g=n.length;_<g;_++){const p=n[_];if(t+=p.slice(u),_===g-1)break;for(let A=0;A<p.length;A++)switch(p.charAt(A)){case"<":{p.charAt(A+1)==="/"?l.pop():(i=!0,l.push(++r));break}case">":{i=!1,s=!1;break}case"=":{s=!0;break}}const m=l[l.length-1],v=mi(a,m,()=>[]);let b,S,C;if(s){const A=/(\S+)="?([^"=]*)$/.exec(p);b=A[1],S=A[2];const w=/^([^">]*)("?)/.exec(n[_+1]);C=w[1],t=t.slice(0,-1*A[0].length),u=w[0].length}else u=0;const V={attributeName:b,attributeValuePre:S,attributeValuePost:C,expressionIndex:_};v.push(V),!i&&!s&&(t+=" ")}return{template:pb(t),elementsToBindings:a}}function ml(n,t,i){for(let s=0;s<n.length;s++){const r=n[s],a=r.attributeName?t:t.firstChild,l={binding:r,targetNode:a,targetParentNode:void 0,currentExpression:void 0};i.push(l)}}function Eb(n,t){const i=[];let s;if(t.size===1&&(s=t.get(0)))ml(s,n,i);else{const r=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT);let a=n,l=-1;do{const u=t.get(++l);u&&ml(u,a,i)}while(a=r.nextNode())}return i}function kb(n){const{template:t,elementsToBindings:i}=mi(mb,n,()=>Sb(n)),s=t.cloneNode(!0).content.firstElementChild,r=Eb(s,i);return function(l){return Lb(l,r),s}}function Tb(n){const t=mi(gb,n,()=>new Map);let i=yb;function s(a,...l){const u=mi(t,a,()=>new Map);return mi(u,i,()=>kb(a))(l)}function r(a,l,u){return a.map((f,_)=>{const g=i;i=u(f);try{return l(f,_)}finally{i=g}})}return{map:r,html:s}}function Cb(n,t,i,s,r,a,l,u,f){const{labelWithSkin:_,titleForEmoji:g,unicodeWithSkin:p}=i,{html:m,map:v}=Tb(t);function b(A,w,F){return v(A,(O,K)=>m`<button role="${w?"option":"menuitem"}" aria-selected="${w?K===t.activeSearchItem:null}" aria-label="${_(O,t.currentSkinTone)}" title="${g(O)}" class="${"emoji"+(w&&K===t.activeSearchItem?" active":"")+(O.unicode?"":" custom-emoji")}" id="${`${F}-${O.id}`}" style="${O.unicode?null:`--custom-emoji-background: url(${JSON.stringify(O.url)})`}">${O.unicode?p(O,t.currentSkinTone):""}</button>`,O=>`${F}-${O.id}`)}const C=m`<section data-ref="rootElement" class="picker" aria-label="${t.i18n.regionLabel}" style="${t.pickerStyle||""}"><div class="pad-top"></div><div class="search-row"><div class="search-wrapper"><input id="search" class="search" type="search" role="combobox" enterkeyhint="search" placeholder="${t.i18n.searchLabel}" autocapitalize="none" autocomplete="off" spellcheck="true" aria-expanded="${!!(t.searchMode&&t.currentEmojis.length)}" aria-controls="search-results" aria-describedby="search-description" aria-autocomplete="list" aria-activedescendant="${t.activeSearchItemId?`emo-${t.activeSearchItemId}`:null}" data-ref="searchElement" data-on-input="onSearchInput" data-on-keydown="onSearchKeydown"><label class="sr-only" for="search">${t.i18n.searchLabel}</label> <span id="search-description" class="sr-only">${t.i18n.searchDescription}</span></div><div class="skintone-button-wrapper ${t.skinTonePickerExpandedAfterAnimation?"expanded":""}"><button id="skintone-button" class="emoji ${t.skinTonePickerExpanded?"hide-focus":""}" aria-label="${t.skinToneButtonLabel}" title="${t.skinToneButtonLabel}" aria-describedby="skintone-description" aria-haspopup="listbox" aria-expanded="${t.skinTonePickerExpanded}" aria-controls="skintone-list" data-on-click="onClickSkinToneButton">${t.skinToneButtonText||""}</button></div><span id="skintone-description" class="sr-only">${t.i18n.skinToneDescription}</span><div data-ref="skinToneDropdown" id="skintone-list" class="skintone-list hide-focus ${t.skinTonePickerExpanded?"":"hidden no-animate"}" style="transform:translateY(${t.skinTonePickerExpanded?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))"})" role="listbox" aria-label="${t.i18n.skinTonesLabel}" aria-activedescendant="skintone-${t.activeSkinTone}" aria-hidden="${!t.skinTonePickerExpanded}" tabIndex="-1" data-on-focusout="onSkinToneOptionsFocusOut" data-on-click="onSkinToneOptionsClick" data-on-keydown="onSkinToneOptionsKeydown" data-on-keyup="onSkinToneOptionsKeyup">${v(t.skinTones,(A,w)=>m`<div id="skintone-${w}" class="emoji ${w===t.activeSkinTone?"active":""}" aria-selected="${w===t.activeSkinTone}" role="option" title="${t.i18n.skinTones[w]}" aria-label="${t.i18n.skinTones[w]}">${A}</div>`,A=>A)}</div></div><div class="nav" role="tablist" style="grid-template-columns:repeat(${t.groups.length},1fr)" aria-label="${t.i18n.categoriesLabel}" data-on-keydown="onNavKeydown" data-on-click="onNavClick">${v(t.groups,A=>m`<button role="tab" class="nav-button" aria-controls="tab-${A.id}" aria-label="${t.i18n.categories[A.name]}" aria-selected="${!t.searchMode&&t.currentGroup.id===A.id}" title="${t.i18n.categories[A.name]}" data-group-id="${A.id}"><div class="nav-emoji emoji">${A.emoji}</div></button>`,A=>A.id)}</div><div class="indicator-wrapper"><div class="indicator" style="transform:translateX(${(t.isRtl?-1:1)*t.currentGroupIndex*100}%)"></div></div><div class="message ${t.message?"":"gone"}" role="alert" aria-live="polite">${t.message||""}</div><div data-ref="tabpanelElement" class="tabpanel ${!t.databaseLoaded||t.message?"gone":""}" role="${t.searchMode?"region":"tabpanel"}" aria-label="${t.searchMode?t.i18n.searchResultsLabel:t.i18n.categories[t.currentGroup.name]}" id="${t.searchMode?null:`tab-${t.currentGroup.id}`}" tabIndex="0" data-on-click="onEmojiClick"><div data-action="calculateEmojiGridStyle">${v(t.currentEmojisWithCategories,(A,w)=>m`<div><div id="menu-label-${w}" class="category ${t.currentEmojisWithCategories.length===1&&t.currentEmojisWithCategories[0].category===""?"gone":""}" aria-hidden="true">${t.searchMode?t.i18n.searchResultsLabel:A.category?A.category:t.currentEmojisWithCategories.length>1?t.i18n.categories.custom:t.i18n.categories[t.currentGroup.name]}</div><div class="emoji-menu ${w!==0&&!t.searchMode&&t.currentGroup.id===-1?"visibility-auto":""}" style="${`--num-rows: ${Math.ceil(A.emojis.length/t.numColumns)}`}" data-action="updateOnIntersection" role="${t.searchMode?"listbox":"menu"}" aria-labelledby="menu-label-${w}" id="${t.searchMode?"search-results":null}">${b(A.emojis,t.searchMode,"emo")}</div></div>`,A=>A.category)}</div></div><div class="favorites onscreen emoji-menu ${t.message?"gone":""}" role="menu" aria-label="${t.i18n.favoritesLabel}" data-on-click="onEmojiClick">${b(t.currentFavorites,!1,"fav")}</div><button data-ref="baselineEmoji" aria-hidden="true" tabindex="-1" class="abs-pos hidden emoji baseline-emoji">😀</button></section>`,V=(A,w)=>{for(const F of n.querySelectorAll(`[${A}]`))w(F,F.getAttribute(A))};if(f){n.appendChild(C);for(const A of["click","focusout","input","keydown","keyup"])V(`data-on-${A}`,(w,F)=>{w.addEventListener(A,s[F])});V("data-ref",(A,w)=>{a[w]=A}),l.addEventListener("abort",()=>{n.removeChild(C)})}V("data-action",(A,w)=>{let F=u.get(w);F||u.set(w,F=new WeakSet),F.has(A)||(F.add(A),r[w](A))})}const Hr=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n);function Mb(n){let t=!1,i;const s=new Map,r=new Set;let a;const l=()=>{if(t)return;const _=[...r];r.clear();try{for(const g of _)g()}finally{a=!1,r.size&&(a=!0,Hr(l))}},u=new Proxy({},{get(_,g){if(i){let p=s.get(g);p||(p=new Set,s.set(g,p)),p.add(i)}return _[g]},set(_,g,p){if(_[g]!==p){_[g]=p;const m=s.get(g);if(m){for(const v of m)r.add(v);a||(a=!0,Hr(l))}}return!0}}),f=_=>{const g=()=>{const p=i;i=g;try{return _()}finally{i=p}};return g()};return n.addEventListener("abort",()=>{t=!0}),{state:u,createEffect:f}}function ns(n,t,i){if(n.length!==t.length)return!1;for(let s=0;s<n.length;s++)if(!i(n[s],t[s]))return!1;return!0}const gl=new WeakMap;function Pb(n,t,i){{const s=n.closest(".tabpanel");let r=gl.get(s);r||(r=new IntersectionObserver(i,{root:s,rootMargin:"50% 0px 50% 0px",threshold:0}),gl.set(s,r),t.addEventListener("abort",()=>{r.disconnect()})),r.observe(n)}}const is=[],{assign:hr}=Object;function Ib(n,t){const i={},s=new AbortController,r=s.signal,{state:a,createEffect:l}=Mb(r),u=new Map;hr(a,{skinToneEmoji:void 0,i18n:void 0,database:void 0,customEmoji:void 0,customCategorySorting:void 0,emojiVersion:void 0}),hr(a,t),hr(a,{initialLoad:!0,currentEmojis:[],currentEmojisWithCategories:[],rawSearchText:"",searchText:"",searchMode:!1,activeSearchItem:-1,message:void 0,skinTonePickerExpanded:!1,skinTonePickerExpandedAfterAnimation:!1,currentSkinTone:0,activeSkinTone:0,skinToneButtonText:void 0,pickerStyle:void 0,skinToneButtonLabel:"",skinTones:[],currentFavorites:[],defaultFavoriteEmojis:void 0,numColumns:J0,isRtl:!1,currentGroupIndex:0,groups:Jo,databaseLoaded:!1,activeSearchItemId:void 0}),l(()=>{a.currentGroup!==a.groups[a.currentGroupIndex]&&(a.currentGroup=a.groups[a.currentGroupIndex])});const f=z=>{n.getElementById(z).focus()},_=z=>n.getElementById(`emo-${z.id}`),g=(z,et)=>{i.rootElement.dispatchEvent(new CustomEvent(z,{detail:et,bubbles:!0,composed:!0}))},p=(z,et)=>z.id===et.id,m=(z,et)=>{const{category:at,emojis:dt}=z,{category:zt,emojis:Rt}=et;return at!==zt?!1:ns(dt,Rt,p)},v=z=>{ns(a.currentEmojis,z,p)||(a.currentEmojis=z)},b=z=>{a.searchMode!==z&&(a.searchMode=z)},S=z=>{ns(a.currentEmojisWithCategories,z,m)||(a.currentEmojisWithCategories=z)},C=(z,et)=>et&&z.skins&&z.skins[et]||z.unicode,w={labelWithSkin:(z,et)=>fb([z.name||C(z,et),z.annotation,...z.shortcodes||is].filter(Boolean)).join(", "),titleForEmoji:z=>z.annotation||(z.shortcodes||is).join(", "),unicodeWithSkin:C},F={onClickSkinToneButton:gt,onEmojiClick:tt,onNavClick:q,onNavKeydown:T,onSearchKeydown:j,onSkinToneOptionsClick:_t,onSkinToneOptionsFocusOut:qt,onSkinToneOptionsKeydown:ct,onSkinToneOptionsKeyup:Ct,onSearchInput:Ke},O={calculateEmojiGridStyle:Q,updateOnIntersection:N};let K=!0;l(()=>{Cb(n,a,w,F,O,i,r,u,K),K=!1}),a.emojiVersion||Qo().then(z=>{z||(a.message=a.i18n.emojiUnsupportedMessage)}),l(()=>{async function z(){let et=!1;const at=setTimeout(()=>{et=!0,a.message=a.i18n.loadingMessage},K0);try{await a.database.ready(),a.databaseLoaded=!0}catch(dt){console.error(dt),a.message=a.i18n.networkErrorMessage}finally{clearTimeout(at),et&&(et=!1,a.message="")}}a.database&&z()}),l(()=>{a.pickerStyle=`
      --num-groups: ${a.groups.length}; 
      --indicator-opacity: ${a.searchMode?0:1}; 
      --num-skintones: ${ul};`}),l(()=>{a.customEmoji&&a.database&&nt()}),l(()=>{a.customEmoji&&a.customEmoji.length?a.groups!==Ms&&(a.groups=Ms):a.groups!==Jo&&(a.currentGroupIndex&&a.currentGroupIndex--,a.groups=Jo)}),l(()=>{async function z(){a.databaseLoaded&&(a.currentSkinTone=await a.database.getPreferredSkinTone())}z()}),l(()=>{a.skinTones=Array(ul).fill().map((z,et)=>cb(a.skinToneEmoji,et))}),l(()=>{a.skinToneButtonText=a.skinTones[a.currentSkinTone]}),l(()=>{a.skinToneButtonLabel=a.i18n.skinToneLabel.replace("{skinTone}",a.i18n.skinTones[a.currentSkinTone])}),l(()=>{async function z(){const{database:et}=a,at=(await Promise.all(X0.map(dt=>et.getEmojiByUnicodeOrName(dt)))).filter(Boolean);a.defaultFavoriteEmojis=at}a.databaseLoaded&&z()});function nt(){const{customEmoji:z,database:et}=a,at=z||is;et.customEmoji!==at&&(et.customEmoji=at)}l(()=>{async function z(){nt();const{database:et,defaultFavoriteEmojis:at,numColumns:dt}=a,zt=await et.getTopFavoriteEmoji(dt),Rt=await Z(bd([...zt,...at],Jt=>Jt.unicode||Jt.name).slice(0,dt));a.currentFavorites=Rt}a.databaseLoaded&&a.defaultFavoriteEmojis&&z()});function Q(z){ub(z,r,()=>{{const et=getComputedStyle(i.rootElement),at=parseInt(et.getPropertyValue("--num-columns"),10),dt=et.getPropertyValue("direction")==="rtl";a.numColumns=at,a.isRtl=dt}})}function N(z){Pb(z,r,et=>{for(const{target:at,isIntersecting:dt}of et)at.classList.toggle("onscreen",dt)})}l(()=>{async function z(){const{searchText:et,currentGroup:at,databaseLoaded:dt,customEmoji:zt}=a;if(!dt)a.currentEmojis=[],a.searchMode=!1;else if(et.length>=W0){const Rt=await R(et);a.searchText===et&&(v(Rt),b(!0))}else{const{id:Rt}=at;if(Rt!==-1||zt&&zt.length){const Jt=await H(Rt);a.currentGroup.id===Rt&&(v(Jt),b(!1))}}}z()});const G=()=>{vr(()=>_b(i.tabpanelElement))};l(()=>{const{currentEmojis:z,emojiVersion:et}=a,at=z.filter(dt=>dt.unicode).filter(dt=>dl(dt)&&!Ps.has(dt.unicode));if(!et&&at.length)v(z),vr(()=>J(at));else{const dt=et?z:z.filter(ot);v(dt),G()}});function J(z){db(z,i.baselineEmoji,_)?G():a.currentEmojis=[...a.currentEmojis]}function ot(z){return!z.unicode||!dl(z)||Ps.get(z.unicode)}async function E(z){const et=a.emojiVersion||await Qo();return z.filter(({version:at})=>!at||at<=et)}async function Z(z){return lb(z,a.emojiVersion||await Qo())}async function H(z){const et=z===-1?a.customEmoji:await a.database.getEmojiByGroup(z);return Z(await E(et))}async function R(z){return Z(await E(await a.database.getEmojiBySearchQuery(z)))}l(()=>{}),l(()=>{function z(){const{searchMode:at,currentEmojis:dt}=a;if(at)return[{category:"",emojis:dt}];const zt=new Map;for(const Rt of dt){const Jt=Rt.category||"";let Ye=zt.get(Jt);Ye||(Ye=[],zt.set(Jt,Ye)),Ye.push(Rt)}return[...zt.entries()].map(([Rt,Jt])=>({category:Rt,emojis:Jt})).sort((Rt,Jt)=>a.customCategorySorting(Rt.category,Jt.category))}const et=z();S(et)}),l(()=>{a.activeSearchItemId=a.activeSearchItem!==-1&&a.currentEmojis[a.activeSearchItem].id}),l(()=>{const{rawSearchText:z}=a;yd(()=>{a.searchText=(z||"").trim(),a.activeSearchItem=-1})});function j(z){if(!a.searchMode||!a.currentEmojis.length)return;const et=at=>{Te(z),a.activeSearchItem=ts(at,a.activeSearchItem,a.currentEmojis)};switch(z.key){case"ArrowDown":return et(!1);case"ArrowUp":return et(!0);case"Enter":if(a.activeSearchItem===-1)a.activeSearchItem=0;else return Te(z),$(a.currentEmojis[a.activeSearchItem].id)}}function q(z){const{target:et}=z,at=et.closest(".nav-button");if(!at)return;const dt=parseInt(at.dataset.groupId,10);i.searchElement.value="",a.rawSearchText="",a.searchText="",a.activeSearchItem=-1,a.currentGroupIndex=a.groups.findIndex(zt=>zt.id===dt)}function T(z){const{target:et,key:at}=z,dt=zt=>{zt&&(Te(z),zt.focus())};switch(at){case"ArrowLeft":return dt(et.previousElementSibling);case"ArrowRight":return dt(et.nextElementSibling);case"Home":return dt(et.parentElement.firstElementChild);case"End":return dt(et.parentElement.lastElementChild)}}async function I(z){const et=await a.database.getEmojiByUnicodeOrName(z),at=[...a.currentEmojis,...a.currentFavorites].find(zt=>zt.id===z),dt=at.unicode&&C(at,a.currentSkinTone);return await a.database.incrementFavoriteEmojiCount(z),{emoji:et,skinTone:a.currentSkinTone,...dt&&{unicode:dt},...at.name&&{name:at.name}}}async function $(z){const et=I(z);g("emoji-click-sync",et),g("emoji-click",await et)}function tt(z){const{target:et}=z;if(!et.classList.contains("emoji"))return;Te(z);const at=et.id.substring(4);$(at)}function ht(z){a.currentSkinTone=z,a.skinTonePickerExpanded=!1,f("skintone-button"),g("skin-tone-change",{skinTone:z}),a.database.setPreferredSkinTone(z)}function _t(z){const{target:{id:et}}=z,at=et&&et.match(/^skintone-(\d)/);if(!at)return;Te(z);const dt=parseInt(at[1],10);ht(dt)}function gt(z){a.skinTonePickerExpanded=!a.skinTonePickerExpanded,a.activeSkinTone=a.currentSkinTone,a.skinTonePickerExpanded&&(Te(z),vr(()=>f("skintone-list")))}l(()=>{a.skinTonePickerExpanded?i.skinToneDropdown.addEventListener("transitionend",()=>{a.skinTonePickerExpandedAfterAnimation=!0},{once:!0}):a.skinTonePickerExpandedAfterAnimation=!1});function ct(z){if(!a.skinTonePickerExpanded)return;const et=async at=>{Te(z),a.activeSkinTone=at};switch(z.key){case"ArrowUp":return et(ts(!0,a.activeSkinTone,a.skinTones));case"ArrowDown":return et(ts(!1,a.activeSkinTone,a.skinTones));case"Home":return et(0);case"End":return et(a.skinTones.length-1);case"Enter":return Te(z),ht(a.activeSkinTone);case"Escape":return Te(z),a.skinTonePickerExpanded=!1,f("skintone-button")}}function Ct(z){if(a.skinTonePickerExpanded)switch(z.key){case" ":return Te(z),ht(a.activeSkinTone)}}async function qt(z){const{relatedTarget:et}=z;(!et||et.id!=="skintone-list")&&(a.skinTonePickerExpanded=!1)}function Ke(z){a.rawSearchText=z.target.value}return{$set(z){hr(a,z)},$destroy(){s.abort()}}}const Ab="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",Db="en";var Ob={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading…",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}},Bb=':host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--border-radius:0;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){color-scheme:light;--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);border-radius:var(--border-radius);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;scrollbar-gutter:stable;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.emoji-menu.visibility-auto{content-visibility:auto;contain-intrinsic-size:calc(var(--num-columns)*var(--total-emoji-size)) calc(var(--num-rows)*var(--total-emoji-size))}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;height:var(--total-emoji-size);width:var(--total-emoji-size);line-height:1;overflow:hidden;font-family:var(--emoji-font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.onscreen .custom-emoji::after{content:"";width:var(--emoji-size);height:var(--emoji-size);background-repeat:no-repeat;background-position:center center;background-size:contain;background-image:var(--custom-emoji-background)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{overflow-y:auto;scrollbar-gutter:stable;display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}';const wd=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji","emojiVersion"],zb=`:host{--emoji-font-family:${vd}}`;class xd extends HTMLElement{constructor(t){super(),this.attachShadow({mode:"open"});const i=document.createElement("style");i.textContent=Bb+zb,this.shadowRoot.appendChild(i),this._ctx={locale:Db,dataSource:Ab,skinToneEmoji:Y0,customCategorySorting:Q0,customEmoji:null,i18n:Ob,emojiVersion:null,...t};for(const s of wd)s!=="database"&&Object.prototype.hasOwnProperty.call(this,s)&&(this._ctx[s]=this[s],delete this[s]);this._dbFlush()}connectedCallback(){this._cmp||(this._cmp=Ib(this.shadowRoot,this._ctx))}disconnectedCallback(){Hr(()=>{if(!this.isConnected&&this._cmp){this._cmp.$destroy(),this._cmp=void 0;const{database:t}=this._ctx;t.close().catch(i=>console.error(i))}})}static get observedAttributes(){return["locale","data-source","skin-tone-emoji","emoji-version"]}attributeChangedCallback(t,i,s){this._set(t.replace(/-([a-z])/g,(r,a)=>a.toUpperCase()),t==="emoji-version"?parseFloat(s):s)}_set(t,i){this._ctx[t]=i,this._cmp&&this._cmp.$set({[t]:i}),["locale","dataSource"].includes(t)&&this._dbFlush()}_dbCreate(){const{locale:t,dataSource:i,database:s}=this._ctx;(!s||s.locale!==t||s.dataSource!==i)&&this._set("database",new G0({locale:t,dataSource:i}))}_dbFlush(){Hr(()=>this._dbCreate())}}const Ld={};for(const n of wd)Ld[n]={get(){return n==="database"&&this._dbCreate(),this._ctx[n]},set(t){if(n==="database")throw new Error("database is read-only");this._set(n,t)}};Object.defineProperties(xd.prototype,Ld);customElements.get("emoji-picker")||customElements.define("emoji-picker",xd);const Rb=[{annotation:"warning",emoji:"⚠️"},{annotation:"police car light",emoji:"\uD83D\uDEA8"},{annotation:"radioactive",emoji:"☢️"},{annotation:"biohazard",emoji:"☣️"},{annotation:"skull and crossbones",emoji:"☠️"},{annotation:"fire",emoji:"\uD83D\uDD25"},{annotation:"collision",emoji:"\uD83D\uDCA5"},{annotation:"bomb",emoji:"\uD83D\uDCA3"},{annotation:"high voltage",emoji:"⚡"},{annotation:"construction",emoji:"\uD83D\uDEA7"},{annotation:"tornado",emoji:"\uD83C\uDF2A️"},{annotation:"water wave",emoji:"\uD83C\uDF0A"},{annotation:"volcano",emoji:"\uD83C\uDF0B"},{annotation:"snowflake",emoji:"❄️"},{annotation:"fog",emoji:"\uD83C\uDF2B️"},{annotation:"fire extinguisher",emoji:"\uD83E\uDDEF"},{annotation:"stop sign",emoji:"\uD83D\uDED1"},{annotation:"no pedestrians",emoji:"\uD83D\uDEB7"},{annotation:"non-potable water",emoji:"\uD83D\uDEB1"}],Hb="_container_qssrv_1",jb="_grid_qssrv_20",yl={container:Hb,grid:jb};var Ub=Ve("<p style=font-size:30px;line-height:30px;margin:0>"),Fb=Ve("<div>"),Nb=Ve(`<div><form><article><header>Add Feature</header><label><p>Marker (optional)</p><div class=flex style=align-items:center><input type=hidden name=marker><button class=secondary type=button style=margin:0>Change</button></div></label><label><p>Title</p><input name=title></label><label><p>Description</p><textarea required autofocus name=description></textarea><small>Don't share personally identifiable information</small></label><footer><div class="flex end"><button type=button class=outline>Cancel</button><button>Save`),$b=Ve("<img style=height:100%;padding:0.5rem>"),Zb=Ve("<button class=secondary type=button>");function Vb(n){const[t,i]=mn(!1),[s,r]=mn();return(()=>{var a=Nb(),l=a.firstChild,u=l.firstChild,f=u.firstChild,_=f.nextSibling,g=_.firstChild,p=g.nextSibling,m=p.firstChild,v=m.nextSibling,b=_.nextSibling,S=b.nextSibling,C=S.nextSibling,V=C.firstChild,A=V.firstChild;return l.addEventListener("submit",w=>{w.preventDefault();const F=new FormData(w.currentTarget);n.onSave(n.data,Object.fromEntries(F.entries()))}),Ie(p,se(rs,{get when(){return s()},get fallback(){return(()=>{var w=$b();return fn(()=>Il(w,"src",te.Icon.Default.imagePath+te.Icon.Default.prototype.options.iconUrl)),w})()},get children(){var w=Ub();return Ie(w,s),w}}),m),v.$$click=()=>i(w=>!w),Ie(u,se(rs,{get when(){return t()},get children(){var w=Fb();return Ie(w,se(a_,{each:Rb,children:F=>(()=>{var O=Zb();return O.$$click=()=>r(F.emoji),Ie(O,()=>F.emoji),O})()})),fn(()=>_c(w,`flex ${yl.grid}`)),w}}),b),u_(A,"click",n.onCancel),fn(w=>{var F=yl.container,O=`--x: ${n.anchor?.x}px; --y: ${n.anchor?.y}px;`;return F!==w.e&&_c(a,w.e=F),w.t=d_(a,O,w.t),w},{e:void 0,t:void 0}),fn(()=>m.value=s()??""),a})()}h_(["click"]);var Gb=Ve("<div><h1></h1><p>");function Wb(n){return(()=>{var t=Gb(),i=t.firstChild,s=i.nextSibling;return Ie(i,()=>n.data.title),Ie(s,()=>n.data.description),t})()}function ur(n){const t=n.toGeoJSON();t.properties={...t.properties||{}};const i=gi(n);t.properties.recordId=i;const s=Jb(n);return Object.assign(t.properties,s),t}function qb(n){const t=L.geoJSON(n,{pointToLayer:(s,r)=>L.marker(r)});let i=t;if(t.getLayers){const s=t.getLayers();s.length===1&&(i=s[0])}return n.properties?.recordId||Sd(),Yb(i,n.properties||{}),i}function Sd(){return crypto&&crypto.randomUUID?crypto.randomUUID():`rec_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}function gi(n){let t;const i=n.feature;return i&&i.properties&&i.properties.recordId?t=i.properties.recordId:t=Sd(),Kb(n,"recordId",t,!0),t}function Kb(n,t,i,s=!1){if(!n.feature){if(!s)return;n.feature={type:"Feature",properties:{},geometry:null}}n.feature.properties??={},n.feature.properties[t]=i}function Yb(n,t={}){const i=gi(n);n.feature??={type:"Feature",properties:{},geometry:null},n.feature.properties={...t,recordId:i}}function Jb(n){return n.feature&&n.feature.properties?{...n.feature.properties}:{}}function vl(n,t){return typeof n.getLatLng=="function"?n.getLatLng():typeof n.getBounds=="function"?n.getBounds().getCenter():typeof n.getCenter=="function"?n.getCenter():t.getCenter()}function bl(n,t,i=0){const s=n.latLngToContainerPoint(t),r=n.getSize(),l=te.point(r.x/2,r.y-i).subtract(s),u=n.containerPointToLatLng(n.latLngToContainerPoint(n.getCenter()).subtract(l));n.panTo(u,{animate:!0})}function Xb(n){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return n.replace(/[&<>"']/g,i=>t[i])}var Qb=Ve("<div class=map>"),tw=Ve("<div class=pico style=position:fixed;inset:0;pointer-events:none;z-index:1000;overflow:hidden>");function ew(){let n,t,i,s;const[r,a]=mn(),[l,u]=mn(),[f,_]=mn();function g(v){i.update(b=>lu(b,v))}function p(){if(!l()){f()&&_();return}_(t.latLngToContainerPoint(l()))}function m(){if(!r())return;const v=r().id;g(b=>{const S=b.features.findIndex(C=>C.id===v);b.features.splice(S,1)}),a()}return Sl(()=>{l()&&p()}),te.Icon.Default.imagePath="./",Xf(async()=>{let v,b;t=te.map(n,{zoomControl:!0}),t.setView([45.515,-122.679],12),t.addControl(new te.Control.Fullscreen),b=new te.FeatureGroup,t.addLayer(b),te.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> contributors'}).addTo(t),v=new te.Control.Draw({position:"topleft",draw:{marker:!0,polyline:!0,polygon:{allowIntersection:!1,showArea:!1},rectangle:{showArea:!1},circle:!1,circlemarker:!1},edit:{edit:{},featureGroup:b}}),t.addControl(v),t.addControl(new o0({position:"bottomright"}));const S=await fetch("./config.json").then(w=>w.json());console.log({config:S.websocketHosts});const C=S.websocketHosts.map(w=>new Qv(w)),V=new Zv({network:C,storage:new e0});try{i=await V.find("automerge:2Cf1B3S7XenfVxwavLVFHWcSeypy",{}).catch(async()=>{const w=await fetch("/initial-doc.bin").then(F=>F.arrayBuffer());return console.log("bin"),V.import(new Uint8Array(w),{docId:"automerge:2Cf1B3S7XenfVxwavLVFHWcSeypy"})})}catch(w){console.error(w)}await i.whenReady(),s=await i.doc(),console.log({doc:s}),A(s.features);function A(w=[]){for(const F of w){const{formData:O}=F;let K=qb(F.feature);if(O){O.marker?.length&&K.setIcon?.(te.divIcon({className:"emoji-icon",html:`<div class='emoji-glyph'>${Xb(O.marker)}</div>`,iconSize:[30,30],iconAnchor:[15,15]}));const nt=document.createElement("div");console.log({formData:O}),Pl(()=>se(Wb,{data:O}),nt),K.bindPopup(nt)}b.addLayer(K)}}i.on("change",w=>{b.clearLayers(),A(w.doc.features??[])}),t.on("move",p),t.on("zoom",p),t.on("viewreset",p),t.on("resize",p),t.on(te.Draw.Event.CREATED,async w=>{m();const F=w.layer;b.addLayer(F);let O=ur(F);const K={id:O.properties.recordId,feature:O},nt=vl(F,t);u(nt),bl(t,nt,24),a({id:K.id,feature:O,layer:F}),g(Q=>{Q.features??=[],Q.features.push(K)})}),t.on("contextmenu",w=>{m();const F=te.marker(w.latlng,{draggable:!0});F.addTo(b);let O=ur(F);const K={id:O.properties.recordId,feature:O},nt=vl(F,t);u(nt),bl(t,nt,24),F.addEventListener("dragend",()=>{g(Q=>{const N=gi(F),G=Q.features.findIndex(ot=>ot.id===N),J=ur(F);Q.features[G]={id:J.properties.recordId,feature:J}})}),a({id:K.id,feature:O,layer:F}),g(Q=>{Q.features??=[],Q.features.push(K)})}),t.on(te.Draw.Event.EDITED,w=>{g(F=>{F.features??=[],w.layers.eachLayer(O=>{const K=gi(O),nt=F.features.findIndex(N=>N.id===K),Q=ur(O);F.features[nt]={id:Q.properties.recordId,feature:Q}})})}),t.on(te.Draw.Event.DELETED,w=>{g(F=>{F.features??=[],w.layers.eachLayer(O=>{const K=gi(O),nt=F.features.findIndex(Q=>Q.id===K);console.log({index:nt}),F.features.splice(nt,1)})})})}),[(()=>{var v=Qb(),b=n;return typeof b=="function"?f_(b,v):n=v,v})(),(()=>{var v=tw();return Ie(v,se(rs,{get when(){return r()},keyed:!0,get children(){return se(Vb,{get data(){return r()},get anchor(){return f()},onCancel:m,onSave:(b,S)=>{g(C=>{S.created=new Date;const V=C.features.findIndex(A=>A.id===b.id);if(V<0){console.log("feature not found");return}C.features[V]={id:b.id,feature:b.feature,formData:S}}),a()}})}})),v})()]}const nw=n=>null;var iw=Ve("<span style=font-size:1.5em;text-align:center;position:fixed;left:0px;bottom:55%;width:100%>");const rw=n=>{const t="Error | Uncaught Client Exception";return se(c_,{fallback:i=>(console.error(i),[(()=>{var s=iw();return Ie(s,t),s})(),se(nw,{code:500})]),get children(){return n.children}})};function wl(n){return n.children}function ow(){return se(wl,{get children(){return se(wl,{get children(){return se(rw,{get children(){return se(ew,{})}})}})}})}function sw(n,t){Pl(n,t)}sw(()=>se(ow,{}),document.getElementById("app"));aw=void 0})();export{aw as default,__tla};